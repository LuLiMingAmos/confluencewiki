try {
/* module-key = 'confluence.extra.jira:macro-browser-resources', location = 'templates/extra/jira/view-in-jira.js' */
AJS.bind("add-handler.property-panel",function(b,a){AJS.log("add-handler.property-panel: panel name = "+a.name);if(a.name!="macro"){return}a.registerButtonHandler("view-in-jira",function(d,j){if(AJS.Editor.JiraConnector.servers){var s=AJS.Editor.JiraConnector.servers;var l=AJS.$(j);var g=l.attr("data-macro-default-parameter");var k=l.attr("data-macro-parameters")||"";var t=Confluence.MacroParameterSerializer.deserialize(k);var n=/=|!=|~|>|<|!~| is | in /i;var h=function(u){var i=u.indexOf("|");if(i>=0){return u.substring(0,i)}return u};var f=g||t.jqlQuery||t.key||h(k);var c=t.server;var q=t.serverId;var p=f.match(n);var m=null;for(var o=0;o<s.length;o++){if((q&&s[o].id==q)){m=s[o];break}if((c&&s[o].name==c)||(!c&&s[o].selected)){m=s[o];break}}if(m!=null){var e=(typeof m.displayUrl!=="undefined")?m.displayUrl:m.url;if(e.charAt(e.length-1)=="/"){e=e.substr(0,e.length-1)}var r=tinymce.isIE?"_blank":"confluence-goto-jiralink-"+AJS.params.pageId;if(!p){window.open(e+"/browse/"+encodeURIComponent(f),r)}else{window.open(e+"/secure/IssueNavigator.jspa?reset=true&jqlQuery="+encodeURIComponent(f),r)}}}})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:macro-browser-resources', location = 'templates/extra/jira/show-summary.js' */
AJS.bind("init.rte",function(){if(!AJS.Confluence&&!AJS.Confluence.PropertyPanel&&!AJS.Confluence.PropertyPanel.Macro){AJS.logError("JIRA Issues Macro : can't register property panel init handler since AJS.Confluence.PropertyPanel.Macro is undefined");return}var a="showSummary";var f="jira";var e="jiraissues";var d="show-summary";AJS.Confluence.PropertyPanel.Macro.registerInitHandler(c,f);AJS.Confluence.PropertyPanel.Macro.registerInitHandler(c,e);function c(g,m,j){var l=AJS.$.grep(m,function(i){return i.parameterName==d})[0];if(!l){AJS.logError("JIRA Issues Macro - Show-summary : The system cannot find SummaryButton, all buttons are: ");for(var k in m){AJS.logError(m[k].text)}return}if(b(g)){var h=AJS.SummaryHelper.getParam(g,a);if(h=="false"){l.text="Show summary"}else{l.text="Hide summary"}}else{l.className+=" hidden"}}function b(g){var i=AJS.$(g);var j=i.attr("src");if(!j){return true}var h=AJS.SummaryHelper.getParam(g,"count");if(j.indexOf("confluence.extra.jira/jira-table")==-1&&h!="true"){return true}return false}});AJS.bind("add-handler.property-panel",function(b,a){if(a.name!="macro"){return}a.registerButtonHandler("show-summary",function(e,c){var d=AJS.SummaryHelper.getParam(c,"showSummary");AJS.SummaryHelper.updateMacro("jira",c,"showSummary",d=="false"?"true":"false")})});AJS.SummaryHelper=(function(){return{getCurrentParams:function(a){return Confluence.MacroParameterSerializer.deserialize(a.attr("data-macro-parameters"))},getParam:function(a,d){var c=AJS.$(a);var b=AJS.SummaryHelper.getCurrentParams(c);return b[d]},updateMacro:function(b,a,c,g){var e=AJS.$(a);AJS.Rte.getEditor().selection.select(e[0]);AJS.Rte.BookmarkManager.storeBookmark();var d=AJS.SummaryHelper.getCurrentParams(e);d[c]=g;var f={contentId:Confluence.Editor.getContentId(),macro:{name:b,params:d,defaultParameterValue:e.attr("data-macro-default-parameter")}};tinymce.confluence.MacroUtils.insertMacro(f)}}})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-macro-browser:macro-browser-js', location = 'js/macro-parameter-serializer.js' */
(function ($) {

    /**
     * Singleton instance that is able to serialize/deserialize macro parameters according to the format defined in
     * the server-side java class DefaultMacroParameterSerializer.
     */
    Confluence.MacroParameterSerializer = (function ()
    {
        function escape(str) {
            return str.replace(/\\/g, "\\\\")   /* \ -> \\ */
                    .replace(/=/g, "\\=")       /* = -> \= */
                    .replace(/[|]/g, "\\|");    /* | -> \| */
        }

        function unescape(str) {
            return str.replace(/\\(.)/g, "$1");
        }

        return {
            /**
             * Serialize map of macro parameters.
             *
             * @param parameters a map of macro parameters (the key being the parameter name, and the value the parameter value)
             */
            serialize: function (parameters) {
                var result = [];

                for (paramName in parameters) {
                    result.push(escape(paramName) + "=" + escape(parameters[paramName]));
                }

                return result.join("|");
            },
            /**
             * Deserializes a string representing macro parameters into a map.
             *
             * @param parameters a string containing macro parameters (e.g. "a=b|c=d")
             */
            deserialize: function (parameters) {
                function split(str, splitChar) {
                    var buffer = [], result = [], c;
                    str = str || "";

                    for (var i = 0, l = str.length; i < l; i++) {
                        c = str[i];
                        if (c == "\\") {
                            buffer.push(c + (i + 1 != str.length ? str[++i] : ""));
                        } else if (c == splitChar) {
                            result.push(buffer.join(""));
                            buffer = [];
                        } else {
                            buffer.push(c);
                        }
                    }

                    result.push(buffer.join(""));

                    return result;
                }

                var result = {};

                $.each(split(parameters || "", "|"), function (index, macroParam) {
                    var macroParamSplit = split(macroParam, "=");

                    if (macroParamSplit.length == 2 && macroParamSplit[0]) {
                        result[unescape(macroParamSplit[0])] = unescape(macroParamSplit[1]);
                    }
                });

                return result;
            }
        };
    })();

})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-macro-browser:macro-browser-js', location = 'js/macro-browser-rest.js' */
/**
 * Encapsulates service rest calls
 */
AJS.MacroBrowser = AJS.MacroBrowser || {};
AJS.MacroBrowser.Rest = (function ($) {

    var MACRO_META_DATA_ENDPOINT = "/plugins/macrobrowser/browse-macros.action";
    var MACRO_META_DATA_DETAILS_ENDPOINT = "/plugins/macrobrowser/browse-macros-details.action";
    var MACRO_PREVIEW_ENDPOINT = "/rest/tinymce/1/macro/preview";

    var TIMEOUT = 30000; // mitigate CONF-29810

    function defaultErrorCallback (e){
        AJS.logError (e);
    }

    function loadMacroMetadata (options) {
        $.ajax({
            type: "GET",
            timeout: options.timeout || TIMEOUT,
            dataType: "json",
            url: (options.context || AJS.params.contextPath) + MACRO_META_DATA_ENDPOINT,
            data: options.data,
            success: options.successCallback,
            error: options.errorCallback || defaultErrorCallback
        });
    };

    function fetchMacroMetadataDetails (options){
        var data = { id: options.id };
        if (options.alternateId){
            data.alternateId = options.alternateId;
        }

        $.ajax({
            type: "GET",
            dataType: "json",
            url:  (options.context || AJS.params.contextPath) + MACRO_META_DATA_DETAILS_ENDPOINT,
            data: data,
            success: options.successCallback,
            error: options.errorCallback || defaultErrorCallback
        });
    };

    function fetchMacroPreviewData (options) {

        function createDataParameters(options){
            var data = {
                contentId: options.contentId,
                macro: {
                    name: options.macroName,
                    body : options.body,
                    params: options.params,
                    defaultParameterValue: options.defaultParameterValue
                }
            };

            return $.toJSON(data);
        }

        if (!options.contentId || !options.macroName){
            return (options.errorCallback || defaultErrorCallback)('invalid parameters');
        }

        $.ajax({
            type: "POST",
            contentType: "application/json; charset=utf-8",
            url: (options.context || AJS.params.contextPath) + MACRO_PREVIEW_ENDPOINT,
            data: createDataParameters(options),
            dataType: "html",
            success: options.successCallback,
            error: options.errorCallback || defaultErrorCallback
        });
    }

    return {
        /**
         * Fetches metadata for registered macros/widgets
         *
         * @param {Object} options.data
         * @param {Object} options.timeout [XHR timeout = TIMEOUT]
         * @param {Object} options.context [Confluence base url = AJS.params.contextPath]
         * @param {Function} options.successCallback
         * @param {Function} [options.errorCallback = AJS.logError] - error callback or logging to console.
         */

        loadMacroMetadata: loadMacroMetadata,

        /**
         * Fetches more details for a particular widget on the server endpoint.
         *
         * @param {Object} options.id - widget id
         * @param {Object} options.context [Confluence base url = AJS.params.contextPath]
         * @param {Function} options.successCallback
         * @param {Function} [options.errorCallback = AJS.logError] - error callback or logging to console.
         */

        fetchMacroMetadataDetails: fetchMacroMetadataDetails,

        /**
         * Fetch macro preview
         * @param {Object} options.macroName Macro name
         * @param {Object} options.body Macro body
         * @param {Object} options.params Macro body
         * @param {Object} options.defaultParameterValue defaultParameterValue
         * @param {Object} options.contentId contentId
         * @param {Object} options.context [Confluence base url = AJS.params.contextPath]
         * @param {Function} options.successCallback
         * @param {Function} [options.errorCallback = AJS.logError] - error callback or logging to console.
         */

        fetchMacroPreviewData: fetchMacroPreviewData
    };

}(AJS.$));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-macro-browser:macro-browser-js', location = 'js/macro-browser-editor.js' */
/**
 * Namespace to organize common methods related to the macro editor
 */
AJS.MacroBrowser = AJS.MacroBrowser || {};
AJS.MacroBrowser.Editor = (function ($) {

    function loadMacroInBrowser (metadata, mode) {
        if (!metadata || !metadata.formDetails) {
            AJS.trigger("analytics", {name: "macro-browser.unknown-macro-error"});
            alert("\u4E0D\u80FD\u5728\u5B8F\u6D4F\u89C8\u5668\u4E2D\u52A0\u8F7D\u672A\u77E5\u5B8F\u3002");
            return;
        }

        var t = AJS.MacroBrowser,
                detail = metadata.formDetails,
                macroName = detail.macroName,
                jsOverride = t.jsOverrides[macroName],
                selectedMacro = t.settings.selectedMacro,
                selectedMacroElement = tinymce.confluence.macrobrowser.editedMacroDiv;

        if (macroName){
            var jsOverride = t.getMacroJsOverride(macroName);
            if (jsOverride && typeof jsOverride.opener == "function"){
                t.close();
                jsOverride.opener({ name: macroName });
                return;
            }
        }

        $("#save-warning-span").addClass("hidden"); // gadgets may have put it in this state

        // Macro description and documentation link
        $("#macro-insert-container .macro-name").val(macroName);
        var macroDescription = metadata.extendedDescription ? metadata.extendedDescription : metadata.description;
        var macroDesc = $(Confluence.Templates.MacroBrowser.macroDescription({ description: macroDescription })),
            macroParametersForm = $("#macro-insert-container .macro-input-fields form").html(macroDesc);
        if (detail.documentationLink) {
            var doco = $(Confluence.Templates.MacroBrowser.macroDocLink({ href: detail.documentationLink}));
            macroDesc.append(doco);
        } else if (!macroDesc.text()) { // remove the div and its padding style
            macroDesc.remove();
        }

        if (detail.body && detail.body.bodyType != "NONE" && (selectedMacroElement && $(selectedMacroElement).hasClass("editor-inline-macro"))) { // only enable editing of the body in the macro browser for inline body macros
            var pluginKey = metadata.pluginKey;
            if (detail.body.label == AJS.MacroBrowser.Utils.makeDefaultKey(pluginKey, macroName, "body", "label")) {
                detail.body.label = "";
            }
            if (detail.body.description == AJS.MacroBrowser.Utils.makeDefaultKey(pluginKey, macroName, "body", "desc")) {
                detail.body.description = "";
            }
            var body = makeBodyDiv(detail.body, t.selectedMacroDefinition);
            if (body) {
                macroParametersForm.append(body);
            }
        }

        // Parameters may have dependencies so all fields need to be created before values are set.
        $(detail.parameters).each(function() {
            macroParametersForm.append(makeParameterDiv(metadata, this, jsOverride));
        });

        var selectedParams = selectedMacro ? $.extend({}, selectedMacro.params) : {}; // make a copy

        // Fully-implemented macros may have JS overrides defined in a Macro object.
        if (jsOverride && typeof jsOverride.beforeParamsSet == "function") {
            selectedParams = jsOverride.beforeParamsSet(selectedParams, !selectedMacro);
        }

        $(detail.parameters).each(function() {
            var param = this,
                    value;

            if (param.name == "") {
                value = t.selectedMacroDefinition ? t.selectedMacroDefinition.defaultParameterValue : param.defaultValue;
            } else {
                value = selectedParams[param.name];
            }

            if (value != null) {
                delete selectedParams[param.name];
            } else {
                // try looking for aliased parameters
                $(param.aliases).each(function() {
                    if (selectedParams[this]) {
                        value = selectedParams[this];
                        delete selectedParams[this];
                    }
                });
            }
            if (value == null) {
                value = param.defaultValue;
            }
            if (value != null) {
                t.fields[param.name].setValue(value);
            }
        });

        // Any remaining "selectedParameters" are unknown for the current Macro details.
        t.unknownParams = selectedParams;

        // open all links in a new window
        $("a", macroParametersForm).click(function() {
            window.open(this.href, '_blank').focus();
            return false;
        });

        if (!$("#macro-browser-dialog:visible").length) {
            t.showBrowserDialog();
        }

        var macroData = {};
        $.extend(true, macroData, metadata); // clone the metadata to a new object

        // for safety ensure that we have a 'formDetails', containing a body.
        if (!macroData.formDetails) macroData.formDetails = {};
        if (!macroData.formDetails.body) macroData.formDetails.body = {};

        t.dialog.activeMetadata = macroData; // This is important to getMacroBody.

        // do we have have selected text for the macro body or are we editing an existing macro (in which case any selected text is ignored)
        if (t.settings.selectedMacro) {
            macroData.formDetails.body.content = t.settings.selectedMacro.body;
        } else if (macroData.formDetails.body.bodyType && macroData.formDetails.body.bodyType.toLowerCase() == "plain_text") {
            macroData.formDetails.body.content = t.settings.selectedText;
        } else {
            macroData.formDetails.body.content = t.settings.selectedHtml;
        }
    }

    function getMacroParametersFromForm (metadata) {
        return getMacroDefinitionFromForm(metadata).params;
    }

    function getMacroDefinitionFromForm (metadata) {
        var macroName = $("#macro-insert-container").find(".macro-name").val(); // todo: why don't we get this from the metadata?
        var defaultParameterValue,
                t = AJS.MacroBrowser,
                sharedParameters = {};

        var parameters = getMacroParametersFromFormFields(metadata, sharedParameters);

        if (parameters[""])
            defaultParameterValue = parameters[""];

        $.extend(parameters, t.unknownParams); // apply unknown parameters

        parameters = applyjsOverrides(macroName, parameters, metadata, sharedParameters);

        return {
            name : macroName,
            bodyHtml : t.getMacroBody(),
            params : parameters,
            defaultParameterValue: defaultParameterValue
        };
    }

    function processRequiredParameters() {
        var blankRequiredInputs = $("#macro-insert-container .macro-param-div.required .macro-param-input")
            .filter(function() {
                var val = $(this).val();
                return (val == null || val == "");
            });
        var hasAllRequiredData = (blankRequiredInputs.length == 0);
        var disabled = hasAllRequiredData ? "" : "disabled";
        var classFn = disabled ? "addClass" : "removeClass";

        $("#macro-browser-dialog button.ok").prop("disabled", disabled);
        $("#macro-browser-dialog .macro-preview-header .refresh-link").prop("disabled", disabled)[classFn]("disabled");

        return hasAllRequiredData;
    }


    // private functions

    /**
     * Apply jsOverrides for a macroName
     *
     * @param macroName
     * @param parameters
     * @param macro
     * @param sharedParameters
     * @returns {*} parameters
     */
    function applyjsOverrides(macroName, parameters, macro, sharedParameters) {
        var jsOverride = AJS.MacroBrowser.getMacroJsOverride(macroName);
        if (jsOverride && typeof jsOverride.beforeParamsRetrieved == "function") {
            parameters = jsOverride.beforeParamsRetrieved(parameters, macro, sharedParameters);
        }
        return parameters;
    }

    /**
     * Get value from the input element according to input type (input text, checkbox, etc)
     * @param $element jQuery input element
     * @returns {*}
     */
    function extractValueFromInputElement($element) {
        var paramVal = $element.val();

        if ($element.attr("type") == "checkbox") {
            paramVal = "" + $element.prop("checked"); //will return 'true' if checked property is not empty
        }
        return paramVal;
    }

    /**
     * Fill parameters and shared parameters according to form values
     * @param metadata
     * @param sharedParameters
     * @returns {{}}
     */
    function getMacroParametersFromFormFields(metadata, sharedParameters) {
        var parameters = {};
        for (var i = 0, l = metadata.formDetails.parameters.length; i < l; i++) {
            var parameter = metadata.formDetails.parameters[i];
            var paramVal = extractValueFromInputElement($("#macro-param-" + parameter.name));
            if (paramVal) {
                // the shared property is used by gadgets in jsOverrides
                if (parameter.shared) {
                    sharedParameters[parameter.name] = paramVal;
                }

                if (parameter.hidden ||
                        (!parameter.defaultValue || parameter.defaultValue != paramVal)) {
                    // only add the parameter value if its not the default
                    parameters[parameter.name] = paramVal;
                }
            }
        }
        return parameters;
    }

    /**
     * Creates a div for a macro body.
     *
     * @param macroBodyFormComponent
     * @param macroDefinition
     * @returns {*|jQuery|HTMLElement}
     */
    function makeBodyDiv (macroBodyFormComponent, macroDefinition) {
        var t = AJS.MacroBrowser,
            bodyDiv = $(Confluence.Templates.MacroBrowser.macroBody()),
            bodyTextareaValue;

        if (macroDefinition) { // we are editing an existing macro
            bodyTextareaValue = macroDefinition.body;
        } else { // check if there is selected text in the editor
            bodyTextareaValue = t.settings.selectedText;
        }

        $("textarea", bodyDiv).val(bodyTextareaValue || "");

        if (macroBodyFormComponent.label) {
            $("label", bodyDiv).text(macroBodyFormComponent.label);
        }
        if (macroBodyFormComponent.description) {
            bodyDiv.append(Confluence.Templates.MacroBrowser.macroParameterDesc({ description: macroBodyFormComponent.description }));
        }
        if(macroBodyFormComponent.hidden) {
            bodyDiv.hide();
        }
        return bodyDiv;
    }

    /**
     * Creates a div for a single macro parameter.
     *
     * @param metadata
     * @param param
     * @param jsOverride
     * @returns {*}
     */
    function makeParameterDiv (metadata, param, jsOverride) {
        var t = AJS.MacroBrowser, field;
        var type = param.type.name;

        // Plugin point - other JS files can define more specific field-builders based on macro name, param name and
        // type.
        if (jsOverride) {
            var builder = jsOverride.fields && jsOverride.fields[type];
            if (builder && typeof builder != "function") {
                // Types can be overridden for specific parameters - so the "type" object contains a "name" function.
                builder = builder[param.name];
            }
            if (typeof builder == "function") {
                field = builder.call(jsOverride, param);
            }
        }
        // If no override specific to the macro, look for general overrides specific to the parameter type.
        if (!field) {
            if (!(type in t.ParameterFields && typeof t.ParameterFields[type] == "function")) {
                type = "string";
            }
            field = t.ParameterFields[type](param);
        }

        t.fields[param.name] = field;
        var paramDiv = field.paramDiv;
        var input = field.input;

        var paramId = "macro-param-" + param.name;
        paramDiv.attr("id", "macro-param-div-" + param.name);
        input.addClass("macro-param-input").attr("id", paramId);
        if (param.hidden) {
            paramDiv.hide();
        }

        // Use param label and desc or correct fallback.
        var pluginKey = metadata.pluginKey;
        if (param.displayName == AJS.MacroBrowser.Utils.makeDefaultKey(pluginKey, metadata.macroName, "param", param.name, "label")) {
            param.displayName = param.name;
        }
        if (param.description == AJS.MacroBrowser.Utils.makeDefaultKey(pluginKey, metadata.macroName, "param", param.name, "desc")) {
            param.description = "";
        }

        var labelText = param.displayName;
        if (param.required) {
            labelText += " *";
            paramDiv.addClass("required");  // set class against div, not input, to allow styling of label if nec
        }
        $("label", paramDiv).attr("for", paramId).text(labelText);

        if (param.description) {
            paramDiv.append(Confluence.Templates.MacroBrowser.macroParameterDesc({ description: param.description }));
        }
        return paramDiv;
    }

    return {
        /**
         * Loads the given macro json in the browser's insert macro page.
         *
         * @param metadata
         * @param mode "insert" or "edit"
         */

        loadMacroInBrowser: loadMacroInBrowser,

        /**
         * Returns a Map of all parameter values from the form, including the default parameter value which has a zero
         * length string as a key.
         * @param metadata meta data about each parameter in the macro
         */

        getMacroParametersFromForm: getMacroParametersFromForm,

        /**
         * Constructs the macro markup from the insert macro page
         *
         * @param {Object} metadata detailed metadata about the macro.  Includes form details etc.
         * @returns {{name: (*|jQuery), bodyHtml: *, params: {}, defaultParameterValue: *}}
         */

        getMacroDefinitionFromForm: getMacroDefinitionFromForm,

        /**
         * Checks and returns true if all the required macro parameters have values.
         * It disables the insert/preview buttons if false.
         *
         * @returns {boolean}
         */

        processRequiredParameters: processRequiredParameters
    };

}(AJS.$));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-macro-browser:macro-browser-js', location = 'js/macro-browser-model.js' */
/**
 * Metadata model operations
 *
 */
AJS.MacroBrowser = AJS.MacroBrowser || {};
AJS.MacroBrowser.Model = (function ($) {

    function transformMetaDataDefault (metadata){
        // if we get an internationalization key back for the title, then pull the macro name out.
        if (metadata.title == AJS.MacroBrowser.Utils.makeDefaultKey(metadata.pluginKey, metadata.macroName, "label")) {
            metadata.title = metadata.macroName.charAt(0).toUpperCase() + metadata.macroName.substring(1).replace(/-/g, ' ');
        }

        if (metadata.description == AJS.MacroBrowser.Utils.makeDefaultKey(metadata.pluginKey, metadata.macroName, "desc")) {
            metadata.description = "";
        }
        metadata.id = "macro-" + (metadata.alternateId || metadata.macroName);

        // Store two copies of keywords - for Macro Browser and Macro Autocomplete searching
        var keywordsArr = [metadata.macroName, metadata.title].concat(metadata.aliases || []);
        metadata.keywordsNoDesc = keywordsArr.join(',');

        var desc = (metadata.description && metadata.description.replace(/,/g, ' ')) || "";
        keywordsArr.push(desc);
        metadata.keywords = keywordsArr.join(',');
        return metadata;
    }

     function loadMacros (macros) {

        if (!macros) {
            AJS.log("AJS.MacroBrowser.loadModel - no macro data, aborting");
            return;
        }

        var t = AJS.MacroBrowser;
        t.metadataList = [];
        t.aliasMap = {};

        // Clean up unset titles and descriptions before sorting
        for (var i = 0, ii = macros.length; i < ii; i++) {
            var metadata = macros[i];

            metadata = transformMetaDataDefault(metadata);

            if (metadata.aliases) {
                for (var j = 0, jl = metadata.aliases.length; j < jl; j++) {
                    metadata.aliases[j] = metadata.aliases[j].toLowerCase();
                    t.aliasMap[metadata.aliases[j]] = metadata.macroName.toLowerCase();
                }
            }

            t.metadataList.push(metadata);
        }
        t.metadataList.sort(function(one, two) { return (one.title.toLowerCase() > two.title.toLowerCase() ? 1 : -1); });
    }

    return {
        /**
         * Called when the macro data is returned from the back-end, loads the macro metadata into a JS model for the
         * browser (and autocomplete) to use.
         *
         * @param macros the macros array from the browse-macros.action JSON response
         */

        loadMacros: loadMacros,

        /**
         * Applies the necessary transformations when macro metadata is retrieved form the server
         * @param metadata
         * @returns transformed metadata
         */
        transformMetaDataDefault: transformMetaDataDefault
    };

}(AJS.$));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-macro-browser:macro-browser-js', location = 'js/macro-browser-preview.js' */
/**
 * Macro preview rendering
 * @type {Function}
 */
AJS.MacroBrowser = AJS.MacroBrowser || {};
AJS.MacroBrowser.Preview = (function ($) {

    var refreshButton = {
        disable : function() {
            $("#macro-browser-preview-link").attr("disabled", true).addClass("disabled");
        },
        enable : function () {
            $("#macro-browser-preview-link").removeAttr("disabled").removeClass("disabled");
        }
    };

    function createPreviewContainer() {
        // Set the iframe source to an empty JS statement to avoid
        // secure/nonsecure warnings on https, without needing a back-end call.
        var src = AJS.params.staticResourceUrlPrefix + "/blank.html";
        var previewDiv = $("#macro-insert-container .macro-preview");
        previewDiv.html('<iframe src="' + src + '" frameborder="0" name="macro-browser-preview-frame" id="macro-preview-iframe"></iframe>');
    }

    function renderPreview(html) {
        var iframe = $("#macro-insert-container .macro-preview iframe")[0];
        var doc = iframe.contentDocument || iframe.contentWindow.document;
        doc.write(html);
        doc.close(); // for firefox

        var errorSpan = $("div.error span.error", doc);
        if (errorSpan.length) {
            AJS.logError("Error rendering macro definition : ");
        }
    }

    function loadingInProgressUI (loading) {
        if (loading) {
            AJS.MacroBrowser.UI.showPreviewSpinner(true);
            refreshButton.disable();
        } else {
            AJS.MacroBrowser.UI.showPreviewSpinner(false);
            refreshButton.enable();
        }
    }

    function previewMacro (macro) {
        var t = AJS.MacroBrowser;
        $("#macro-insert-container .macro-preview").html("");

        if (!AJS.MacroBrowser.Editor.processRequiredParameters()) {
            AJS.trigger("analytics", {name: "macro-browser.missing-params-error"});
            AJS.log("previewMacro: missing required params");
            return false;
        }

        var macroDefinition = AJS.MacroBrowser.Editor.getMacroDefinitionFromForm(macro);
        var params = macroDefinition.params;

        var jsOverrides = t.getMacroJsOverride(macro.macroName);
        if (jsOverrides && typeof jsOverrides.updateMacroParametersForPreview == "function") {
            params = jsOverrides.updateMacroParametersForPreview(params);
        }

        if (params[""]) {
            delete params[""]; // this is sent separately as the defaultParameterValue
        }

        var options = {
            contentId: Confluence.getContentId(),
            macroName: macro.macroName,
            params: params,
            body: t.getMacroBody(),
            defaultParameterValue: macroDefinition.defaultParameterValue,

            successCallback : function(html) {
                renderPreview(html);
                // todo: the spinner is being hidden when the iframe gets loaded
                // so this timeout won't affect it anyway. It will disable the preview button though
                setTimeout(function(){
                    loadingInProgressUI(false);
                }, 1000);
            },

            errorCallback : function(e) {
                // todo: better err handling?
                AJS.logError(e);
                loadingInProgressUI(false);
            }
        };

        createPreviewContainer();
        loadingInProgressUI(true);

        AJS.MacroBrowser.Rest.fetchMacroPreviewData(options);
    }

    return {

        /**
         * Makes an ajax request to render the macro markup and updates the preview
         *
         * @param macro
         */

        previewMacro : previewMacro
    };

}(AJS.$));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-macro-browser:macro-browser-js', location = 'js/macro-browser-UI.js' */
AJS.MacroBrowser = AJS.MacroBrowser || {};
AJS.MacroBrowser.UI = (function ($) {

    var BUTTON_SAVE_SELECTOR = "#macro-browser-dialog .dialog-button-panel .ok";

    function toggleSpinner($elm, show) {
        if (show) {
            $elm.spin('large');
        } else {
            $elm.spinStop();
        }
    }

    function showBrowserSpinner (show) {
        toggleSpinner($("#macro-browser-dialog"), show);
    }

    function showPreviewSpinner(show) {
        toggleSpinner($("#macro-browser-preview"), show);
    }

    function enableSaveButton (enable) {
        var okButton = $(BUTTON_SAVE_SELECTOR);
        okButton.prop("disabled", !enable);
    }

    function updateButtonText(mode) {
        var okButton = $(BUTTON_SAVE_SELECTOR);
        if (mode == "edit") {
            okButton.text("\u4FDD\u5B58");
        }
        else {
            okButton.text("\u63D2\u5165");
        }
    }

    // private functions
    /**
     * Returns the template for macro summary list
     * @param {int} id Category
     * @returns {*|jQuery|HTMLElement}
     */
    function makeCategoryList (id) {
        return $(Confluence.Templates.MacroBrowser.macroSummaryList({ category: id }));
    };


    /**
     * Creates the DOM element for the macro summary panel and returns it.
     * @param metadata
     * @returns {*|jQuery|HTMLElement}
     */
    function makeMacroSummary(metadata, onclick) {
        var macroDiv = $(Confluence.Templates.MacroBrowser.macroSummaryItem());

        // setting icon
        if (metadata.icon) {
            var iconLocation = (metadata.icon.relative ? AJS.params.staticResourceUrlPrefix : "") + metadata.icon.location;
            if(!metadata.icon.relative && AJS.$.browser.msie && !window.location.href.indexOf("https") && iconLocation.indexOf("https")) {
                macroDiv.prepend("<span class='macro-icon-holder icon-" + metadata.macroName + "'></span>");
            }
            else {
                macroDiv.prepend("<img src='" +  iconLocation + "' alt='icon' " +
                        "width='" + metadata.icon.width + "' height='" + metadata.icon.height + "' title='" + metadata.title + "'/>");
            }
        } else {
            macroDiv.prepend("<span class='macro-icon-holder icon-" + metadata.macroName + "'></span>");
        }

        $(".macro-title", macroDiv).text(metadata.title);
        $(".macro-desc", macroDiv).prepend(metadata.description);
        if (metadata.macroName == "gadget") {
            var url = metadata.gadgetUrl;
            if (url) {
                if (!url.match("^https?://.*")) {
                    url = AJS.params.contextPath + "/" + url;
                }
                $(".macro-title", macroDiv).after(Confluence.Templates.MacroBrowser.gadgetLink({url: url}));
            }
        }

        macroDiv.click(function(e){
            onclick(e, metadata);
        });

        return macroDiv;
    };

    /**
     *
     * @returns {{all: (*|jQuery|HTMLElement)}}
     */
    function getMacroSummaryHTMLElements(macros, onclick) {

        var cats = { all: makeCategoryList("all") };

        // Content on the right, setup macro list items
        for (var i = 0, ii = macros.length; i < ii; i++) {
            var macro = macros[i];
            if (macro.hidden) {
                if (AJS.MacroBrowser.isHiddenMacroShown(macro)) {
                    macro.categories.push("hidden-macros");
                } else {
                    continue;
                }
            }
            // fill the ALL category
            cats.all.append(makeMacroSummary(macro, onclick).attr("id",
                macro.id));

            // for each category, we create a different macroDiv.
            // be AWARE: we are duplicating macroDivs for the same macro in different categories!!
            // TODO: event delegation for onclick
            // TODO: unique macro summary DOM instances
            for (var j = 0, jj = macro.categories.length; j < jj; j++) {
                var catKey = macro.categories[j];
                cats[catKey] = cats[catKey] || makeCategoryList(catKey);
                cats[catKey].append(makeMacroSummary(macro, onclick).attr("id", catKey + "-" + macro.id));
            }
        }
        return cats;
    }

    function createDialog (options) {

        var categorySummaryHTMLElements = getMacroSummaryHTMLElements(options.macros,
                options.onClickMacroSummary);

        var dialog = AJS.ConfluenceDialog({
            width: options.width || 865,
            height: options.height || 530,
            id: "macro-browser-dialog",
            onSubmit: options.onSubmit,
            onCancel: options.onCancel
        });

        // Set an id on the "Select Macro Page"
        dialog.getPage(0).element.attr('id', 'select-macro-page');

        dialog.addHeader(options.title);

        // menu on the left, setup category panels
        dialog.addPanel("\u5168\u90E8", categorySummaryHTMLElements.all,
            "all", "category-button-all");

        for (i = 0, ii = options.categories.length; i < ii; i++) {
            var category = options.categories[i];
            dialog.addPanel(category.displayName,
                    categorySummaryHTMLElements[category.name] || makeCategoryList(category.name),
                    category.name, "category-button-" + category.name)
                .getPanel(i).setPadding(0); // remove the default dialog padding
        }

        dialog.addCancel("\u53D6\u6D88", options.onCancel);

        // CONFDEV-12853: Add help link via prepend() instead of append() to prevent FF display issue
        dialog.popup.element.find(".dialog-title").prepend(Confluence.Templates.MacroBrowser.helpLink());

        // todo: make sure this is needed.
        // if it is, add proper comments an tests. Otherwise, delete it.
        if (AJS.Meta.get('confluence-flavour') == 'VANILLA') {
            dialog.addHelpText("<a href='{0}' id='marketplace-link'><span class='icon icon-marketplace'/>{1}</a>", [
                AJS.params.contextPath + "/plugins/servlet/upm/marketplace/featured?category=Macros&source=macro_browser",
                "Find more macros..."
            ]);
        } else {
            dialog.addHelpText("\u63D0\u793A: \u5728\u7F16\u8F91\u5668\u4E2D\u8F93\u5165 \"\u003cstrong>{\u003c\/strong>\" \u5728\u9875\u9762\u603B\u63D2\u5165\u5B8F\u3002");
        }


        // prepare insert macro page
        var insertMacroBody = AJS.$(Confluence.Templates.MacroBrowser.insertMacroPanel());
        insertMacroBody.find("form").submit(function(e){
            AJS.MacroBrowser.complete();
            return AJS.stopEvent(e);
        });

        $("#macro-browser-preview-link", insertMacroBody).click(function (e) {
            var $link = $(this);
            if (!$link.prop("disabled")){
                AJS.MacroBrowser.previewMacro(dialog.activeMetadata);
            }
            return AJS.stopEvent(e);
        });

        dialog.addPage()
            .addPanel("X", insertMacroBody, "macro-input-panel")
            .addLink("\u9009\u62E9\u5B8F", function (dialog) {
                dialog.prevPage();
                dialog.searcher.focus();
            }, "dialog-back-link")
            .addButton("insert.name", function () {
                AJS.MacroBrowser.complete();
            }, "ok")
            .addCancel("\u53D6\u6D88", function () {
                return options.onCancel();
            })
            .getPanel(0).setPadding(0); // remove the default dialog padding

        // Set an id on the "Insert/Update Macro Page"
        dialog.getPage(1).element.attr('id', 'macro-details-page');

        $("#macro-browser-dialog .dialog-button-panel .ok").before("<span id='save-warning-span' class='hidden'/>");

        // todo: move search component to AJS.MacroBrowser.Search?? is it worthy?
        // add search box
        dialog.searcher = Confluence.DomFilterField({
            items: '#macro-browser-dialog .dialog-panel-body #category-all .macro-list-item',
            formId: 'macro-browser-search-form',
            inputId: 'macro-browser-search',
            searcher: function ($items, text) {
                var ids = null;
                if (text != '') {
                    if (dialog.getCurrentPanel() != dialog.getPanel(0)) {
                        dialog.gotoPanel(0);
                    }
                    var filteredSummaries = AJS.MacroBrowser.searchSummaries(text);
                    ids = {};
                    $.each(filteredSummaries, function () {
                        ids[this.id] = this;
                    });
                }
                $items.each(function () {
                    (!ids || this.id in ids) ? $(this).show() : $(this).hide();
                });
            },
            submitCallback: function ($visibleItems, searchText) {
                if (searchText != '' && $visibleItems.length == 1) {
                    // Only one macro found with search - select it.
                    $visibleItems.click();
                }
            }
        });

        dialog.page[0].header.append(dialog.searcher.form);
        dialog.page[0].ontabchange = function (newPanel, oldPanel) {
            if (newPanel != dialog.getPanel(0, 0)) {
                // Moving away from the "All" macro panel; reset the search value if present
                dialog.searcher.reset();
            }
        };

        // Create the missing meta-data page
        var missingMetadataBody = AJS.$(Confluence.Templates.MacroBrowser.missingUserMacroMetadataPanel({
            showAdminMessage: AJS.Meta.getBoolean("is-admin") }));

        dialog.addPage()
            .addPanel("\u65E0\u5B8F\u7684\u5143\u6570\u636E", missingMetadataBody, "missing-metadata-panel")
            .addLink("\u540E\u9000", function (dialog) {
                dialog.gotoPage(0);
                dialog.searcher.focus();
            }, "dialog-back-link")
            .addCancel("\u53D6\u6D88", function () {
                // todo: does it need return value? can we just pass the reference to onCancel?
                return options.onCancel();
            });

        dialog.gotoPage(2);
        dialog.addHeader("\u65E0\u5B8F\u7684\u5143\u6570\u636E");

        dialog.gotoPanel(0, 0);

        dialog.ready = true; // todo: necessary?

        return dialog;
    }

    function focusOnMacroDetailsFirstInput() {
        var $firstInput = $(":input:visible:first", $("#macro-insert-container .macro-input-fields form"));
        if ($firstInput.length) {
            $firstInput.focus();
            if (!AJS.MacroBrowser.selectedMacroDefinition && $firstInput.val() != "") {
                // prefilled data in new macro form - select first field for easy overwrite.
                $firstInput.select();
            }
        }
    }

    return {

        /**
         * Creates the macro browser dialog using AUI components
         * @param {Object} options.macroBrowser MacroBrowser instance
         * @returns {*}
         */

        createDialog: createDialog,

        /**
         * Show/hide macro browser spinner
         * @param show
         */

        showBrowserSpinner: showBrowserSpinner,

        /**
         * Show/hide macro browser spinner
         * @param show
         */

        showPreviewSpinner: showPreviewSpinner,

        /**
         * Update button text according to operation mode (save/insert)
         * @param mode - Defaults to "edit"
         */
        updateButtonText: updateButtonText,

        /**
         * Enable/Disable save/edit button
         * @param {Boolean} enable
         */
        enableSaveButton: enableSaveButton,

        /**
         * Focus on the first input of the details form
         */

        focusOnMacroDetailsFirstInput: focusOnMacroDetailsFirstInput
    };

}(AJS.$));

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-macro-browser:macro-browser-js', location = 'js/macro-browser-utils.js' */
/**
 * Macro browser util methods
 */
AJS.MacroBrowser = AJS.MacroBrowser || {};
AJS.MacroBrowser.Utils = (function ($) {

    function makeDefaultKey () {
        return $.makeArray(arguments).join(".");
    }

    return {
        makeDefaultKey: makeDefaultKey
    };

}(AJS.$));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-macro-browser:macro-browser-js', location = 'js/macro-browser.js' */
AJS.MacroBrowser = AJS.MacroBrowser || {};
(function($) {

    var jsOverrides = {}; // todo pending remove this private member. instance approach?

    /**
     *
     * @param metadata
     * @param mode
     */
     var fetchMetaDataAndLoadMacro = function(metadata, mode) {
        var options = {
                id: metadata.macroName,
                successCallback: function (data) {
                    if(data && data.details) {
                        data.details = AJS.MacroBrowser.Model.transformMetaDataDefault(data.details);
                    }
                    AJS.MacroBrowser.Editor.loadMacroInBrowser(data.details, mode);

                    fetchMetaDataAndLoadMacro.displayDetails();
                    AJS.MacroBrowser.Preview.previewMacro(data.details);
                },
                errorCallback: function (err) {
                    AJS.trigger("analytics", {name: "macro-browser.fetch-metadata-error"});
                    alert("\u52A0\u8F7D\u5B8F\u6D4F\u89C8\u5668\u65F6\u53D1\u751F\u9519\u8BEF\u3002\u8BF7\u91CD\u8BD5\u6216\u8054\u7CFB\u7CFB\u7EDF\u7BA1\u7406\u5458\u3002");
                    fetchMetaDataAndLoadMacro.displayDetails();
                }
        };

        if (metadata.alternateId){
            options.alternateId = metadata.alternateId;
        }

        fetchMetaDataAndLoadMacro.setUI(mode, metadata.title);

        AJS.MacroBrowser.Rest.fetchMacroMetadataDetails(options);
    };

    fetchMetaDataAndLoadMacro.setUI = function(mode, title) {
        var placeHolderTitle = mode=="edit" ? t.editTitle : t.insertTitle;

        $("#macro-insert-container").hide();
        AJS.MacroBrowser.UI.updateButtonText(mode);
        AJS.MacroBrowser.UI.enableSaveButton(false);
        AJS.MacroBrowser.dialog.gotoPage(1).addHeader(placeHolderTitle.replace(/\{0\}/, title));
        AJS.MacroBrowser.dialog.show();
        AJS.MacroBrowser.UI.showBrowserSpinner(true);
    };

    fetchMetaDataAndLoadMacro.displayDetails = function() {
        AJS.MacroBrowser.UI.showBrowserSpinner(false);
        AJS.MacroBrowser.UI.enableSaveButton(false);
        $("#macro-insert-container").show();
        AJS.MacroBrowser.UI.focusOnMacroDetailsFirstInput();
    };

    var t = AJS.MacroBrowser;

        // this is absolutely horrible.
        // we should go with instance objects instead of singleton
    t.reset = function () {
        this.initMacroBrowserAfterRequest = null;
        this.initData = null;
        this.hasInit = false;
        this.metadataList = [];
        this.aliasMap = {};
        this.fields = {};
        jsOverrides = {};
        //this.jsOverrides = jsOverrides;
        this.Macros = jsOverrides;
    };

    t.jsOverrides = jsOverrides;

    /**
     * @deprecated Since 3.3. Macros is an ambiguous name, use getMacroJsOverride and setMacroJsOverride.
     */
    t.Macros= jsOverrides;

    t.getMacroJsOverride = function (macroName) {
            return jsOverrides[macroName];
    };

    t.setMacroJsOverride = function (macroName, override) {
            return jsOverrides[macroName] = override;
    };

    t.hasInit = false;
    t.metadataList = [];
    t.aliasMap= {}; // maps each alias to the corresponding macro name
    t.fields= {}; // stores fields for a given macro form.

    /**
     * Checks and returns true if all the required macro parameters have values.
     * It disables the insert/preview buttons if false.
     *
     * @returns {*}
     */
    t.processRequiredParameters = function() {
        return AJS.MacroBrowser.Editor.processRequiredParameters();
    };

    /**
     * Called when a parameter field value changes.
     */
    t.paramChanged = function () {
        // TODO - Could be used to preview?
        AJS.MacroBrowser.Editor.processRequiredParameters();
    };

    // Loads the given macro json in the browser's insert macro page.
    // Exposed to plugins (don't remove)
    t.loadMacroInBrowser = function(metadata, mode) {
        AJS.MacroBrowser.Editor.loadMacroInBrowser (metadata, mode);
    };

    // Constructs the macro markup from the insert macro page
    t.getMacroDefinitionFromForm = function(metadata) {
        AJS.MacroBrowser.Editor.getMacroDefinitionFromForm(metadata);
    };

    /**
     * Returns a Map of all parameter values from the form, including the default parameter value which has a zero
     * length string as a key.
     * @param macroParamDetails meta data about each parameter in the macro
     */
    t.getMacroParametersFromForm = function(macro) {
        AJS.MacroBrowser.Editor.getMacroParametersFromForm(macro);
    };

    // Makes an ajax request to render the macro markup and updates the preview
    // Moved to different namespace. This is just a facade.
    t.previewMacro = function(macro) {
        AJS.MacroBrowser.Preview.previewMacro(macro);
    };

    // This gets called on the preview window's onload to re-adjust the height of the frame
    t.previewOnload = function(body) {
        var selectedMacroName = AJS.MacroBrowser.dialog.activeMetadata.macroName;
        var jsOverride = jsOverrides[selectedMacroName];
        if (jsOverride && jsOverride.postPreview) {
            jsOverride.postPreview(AJS.$("#macro-preview-iframe")[0], AJS.MacroBrowser.dialog.activeMetadata);
        }
        AJS.Editor.disableFrame(body);

        // open all links in a new window
        $(body).click(function(e) {
            if (e.target.tagName.toLowerCase() === "a") {
                var a = e.target;
                var link = $(e.target).attr("href");
                if (link && link.indexOf("#") != 0 && link.indexOf(window.location) == -1) {
                    window.open(link, '_blank').focus();
                }
                return false;
            }
        });
    };

    /**
     * Returns the macro metadata object for a given macro name.
     *
     * Call jsOverride.getMacroDetailsFromSelectedMacro instead of this method for macros such as "gadget" that map
     * multiple macros to a single name.
     *
     * @param macroName macro name to search metadata for
     */
    t.getMacroMetadata = function (macroName) {
        for (var i = 0, len = this.metadataList.length; i < len; i++) {
            var metadata = this.metadataList[i];
            if (metadata.macroName == macroName) {
                return metadata;
            }
        }
        return null;
    };

    /**
     * Called when the user either clicks the Macro Browser button or clicks Edit in a
     * macro placeholder in the RTE.
     *
     * Note that the macro browser is not initialsed/loaded until opened for the first time.
     *
     * @param settings macro browser settings include:
     *      presetMacroMetadata : the metadata for a preset macro to load into the macro browser
     *      selectedHtml : string of selected HTML from RTE when no macro selected
     *      selectedText: the text contents of the selected HTML from the RTE when no macro selected
     *      onComplete : function to call when Macro Browser's "Insert" button is pressed
     *      onCancel : function to call when Macro Browser is closed when incomplete
     *      searchText : text to filter on if opening to the "Select Macro" page, if omitted no filter is done
     *      selectedCategory: the category name that should be selected by default
     */
    t.open = function(settings) {
        if (!settings) {
            settings = {};
            AJS.log("No settings to open the macro browser.");
        }
        var t = AJS.MacroBrowser;

        // if there is a custom editor for this macro, launch that instead
        var macro = settings.selectedMacro;

        if (!macro && settings.presetMacroMetadata) {
            macro = {
                name: settings.presetMacroMetadata.macroName
            };
        }
        if (macro && macro.name){
            var jsOverride = t.getMacroJsOverride(macro.name);
            if (jsOverride && typeof jsOverride.opener == "function"){
                jsOverride.opener(macro);
                return;
            }
        }

        if (!t.hasInit) { // init the macro browser for the first time
            AJS.debug("init macro browser");
            AJS.MacroBrowser.UI.showBrowserSpinner(true);

            if ((t.initData !== null) && $.isEmptyObject(t.initData)) {
                // the only case where we set initData={} is when we got an error on preloading from the rest endpoint
                // try preloading again..
                AJS.trigger("analytics", {name: "macro-browser.init-reattempt"});
                AJS.logError('Macro browser preload failed. Trying again...');
                t.initMacroBrowserAfterRequest = settings;
                t.preLoadMacro();
                return;
            }
            else if (t.initData) { // preloading completed
                t.initBrowser();
            }
            else { // ajax request not returned yet; set a flag to init the browser later
                AJS.trigger("analytics", {name: "macro-browser.init-overlap"});
                AJS.debug('Waiting for macro browser preloading...');
                t.initMacroBrowserAfterRequest = settings;
                return;
            }
        }
        t.openMacroBrowser(settings);
    };

    /**
     * Open the Macro Browser Dialog, either to a specific macro or the selection page depending on
     * the settings parameter.
     * This method must be called after the dialog has been initialised
     *
     * @param {Object} settings.presetMacroName
     * @param {Object} settings.selectedCategory
     */
    t.openMacroBrowser = function(settings) {
        var t = AJS.MacroBrowser;
        t.settings = settings;
        t.selectedMacroDefinition = settings.selectedMacro;

        var selectedMacroName = (t.selectedMacroDefinition && t.selectedMacroDefinition.name) ||
                settings.presetMacroName;

        // Preset macro overrides everything, just use it if present
        if (settings.presetMacroName)
            settings.presetMacroMetadata = t.getMacroMetadata(settings.presetMacroName);

        var metadata = settings.presetMacroMetadata;
        if (!metadata) {
            var selectedMacro = settings.selectedMacro;
            if (selectedMacro) {
                // Editing an existing macro - find metadata for it
                selectedMacroName = selectedMacro.name.toLowerCase();
                selectedMacroName = t.aliasMap[selectedMacroName] || selectedMacroName;

                var jsOverride = jsOverrides[selectedMacroName];
                if (jsOverride) {

                    if (typeof jsOverride.updateSelectedMacro == "function") {
                        jsOverride.updateSelectedMacro(selectedMacro);
                    }
                    // Could be a gadget (or other) macro that has a custom metadata lookup function
                    if (typeof jsOverride.getMacroDetailsFromSelectedMacro == "function") {
                        metadata = jsOverride.getMacroDetailsFromSelectedMacro(t.metadataList, selectedMacro);
                    }

                }
                if (!metadata) {
                    metadata = t.getMacroMetadata(selectedMacroName);
                }
            }
        }

        // todo: get a reference to the back button, or create functions to show/hide the button
        // those functions should go on UI?
        var backButton = $("#macro-browser-dialog").find("button.back");

        if (metadata) {
            AJS.debug("Open macro browser to edit macro: "+ metadata.macroName);

            backButton.hide();

            //todo: should we remove this replicateSelectMacro method and use fetchMetaDataAndLoadMacro?
            t.replicateSelectMacro(metadata, settings.mode || "edit");
        }
        // todo: using selectedMacroName var, which is declared above inside an if??
        else if (selectedMacroName) {
            // the user chose to edit a macro but no metadata was available
            backButton.show();

            // todo:  move to UI namespace??

            t.dialog.overrideLastTab();
            t.dialog.gotoPage(2);
            t.showBrowserDialog();
        } else {
            backButton.show();
            if(settings.selectedCategory) {
                // todo: extract category selection to function
                var categoryIndex = $('#select-macro-page .dialog-page-menu button').index($('#category-button-' + settings.selectedCategory));
                if(categoryIndex < 0) {
                    categoryIndex = 0;
                }
                t.dialog.overrideLastTab();
                t.dialog.gotoPanel(0, categoryIndex);
            }
            else {
                t.dialog.gotoPage(0);
            }
            t.showBrowserDialog();

            // If non-blank searchText has been passed in, filter on it
            t.dialog.searcher.focusAndSearch(settings.searchText);
        }
    };

    t.showBrowserDialog = function() {
        AJS.MacroBrowser.dialog.show();
        AJS.MacroBrowser.UI.showBrowserSpinner(false);
    };

    // Called when dialog is closed by Inserting/Saving.
    t.complete = function (dialog) {
        if (!$("#macro-browser-dialog .dialog-button-panel .ok").is(":visible:not(:disabled)")) {
            // If triggered by enter key but not ready to complete, ignore.
            return;
        }
        var t = AJS.MacroBrowser;
        var metadata = t.dialog.activeMetadata;
        var jsOverride = jsOverrides[metadata.macroName];
        if (jsOverride && jsOverride.manipulateMarkup) {
            jsOverride.manipulateMarkup(metadata);
        }

        var macroDefinition = AJS.MacroBrowser.Editor.getMacroDefinitionFromForm(metadata);

        t.close();
        if (t.settings.onComplete) {
            t.settings.onComplete(macroDefinition);
        }
    };

    /**
     * Called when dialog is closed by various cancel buttons or via Esc key.
     * @returns {boolean}
     */
    t.cancel = function() {
        var t = AJS.MacroBrowser;
        t.close();
        if (typeof t.settings.onCancel == "function") {
            t.settings.onCancel();
        }
        return false;
    };

    t.close = function() {
        var t = this;
        t.unknownParams = {};
        t.fields = {};
        t.dialog.hide();
    };

    /**
     * Replicates the user behaviour of selecting a macro and displaying the insert macro page
     * @param metadata
     * @param mode
     */
    t.replicateSelectMacro = function (metadata, mode) {
        fetchMetaDataAndLoadMacro(metadata, mode);
    };

    /**
     * Loads the categories and macros into the dialog
     * @returns {boolean}
     */
    t.initBrowser = function() {

        var t = AJS.MacroBrowser,
            data = t.initData;

        // 1 . validation
        if (!data.categories || !AJS.MacroBrowser.metadataList.length) {
            AJS.trigger("analytics", {name: "macro-browser.init-browser-error"});
            alert("\u52A0\u8F7D\u5B8F\u6D4F\u89C8\u5668\u65F6\u53D1\u751F\u9519\u8BEF\u3002\u8BF7\u91CD\u8BD5\u6216\u8054\u7CFB\u7CFB\u7EDF\u7BA1\u7406\u5458\u3002");
            AJS.MacroBrowser.UI.showBrowserSpinner(false);
            return false;
        }

        // 2. Save state
        t.editTitle = data.editTitle;
        t.insertTitle = data.insertTitle;


        // 3. Prepare data
        //--
        // sort the categories and macros
        // Skip the hidden category unless option is set, in which case append it to end of array.
        var hiddenCat;
        data.categories = $.map(data.categories, function (cat) {
            if (cat.name == "hidden-macros") {
                hiddenCat = cat;
                return null;
            }
            return cat;
        });
        data.categories.sort(function(one, two) {
            return (one.displayName.toLowerCase() > two.displayName.toLowerCase() ? 1 : -1);
        });
        if (hiddenCat && AJS.params.showHiddenUserMacros) {
            data.categories.push(hiddenCat);
        }
        //--


        // 4. Build UI
        t.dialog = AJS.MacroBrowser.UI.createDialog ({

            title: data.title,
            categories: data.categories,
            macros : t.metadataList,
            onClickMacroSummary: function(e, metadata) {
                e.preventDefault();
                fetchMetaDataAndLoadMacro(metadata, "insert");
            },
            onSubmit : t.complete,
            onCancel : t.cancel

        });

        t.hasInit = true;

        return true;
    };

    /**
     * Search macro name, title and description for the given text.
     * @param text (required) text to search on
     * @param options options to pass to the AJS.filterBySearch method
     * @return array of macro summaries matching the search text.
     */
    t.searchSummaries = function (text, options) {
        options = $.extend({
            splitRegex: /[\s\-]+/
        }, options);
        return AJS.filterBySearch(this.metadataList, text, options);
    };

    /**
     * Convenience method to return the macro body. This will be one of -
     * - the text in the body textarea on the macro browser dialog
     * - currently selected text in the editor
     * - the current body if editing an existing macro (disregarding any editor selection)
     * - empty String if neither previous case applies.
     */
    t.getMacroBody = function () {
        var t = AJS.MacroBrowser;
        var body = "";
        if ($("#macro-insert-container .macro-body-div textarea").length) {
            body = $("#macro-insert-container .macro-body-div textarea").val();
        } else if (t.selectedMacroDefinition) {
            if (t.selectedMacroDefinition.body) {
                body = t.selectedMacroDefinition.body;
            }
        } else if (t.dialog.activeMetadata) {
            body = t.dialog.activeMetadata.formDetails.body.content; // this is encoded as appropriate for the current macro
        }
        return body;
    };

    /**
     * Checks if a normally-hidden macro should be displayed in the UI or not.
     * @param macro - a macro summary
     */
    t.isHiddenMacroShown = function (macro) {
        return AJS.params.showHiddenUserMacros && macro.pluginKey == "_-user-macro-_";
    };

    /**
     * Returns true if the metadata indicates that there are required parameters for this macro
     */
    t.hasRequiredParameters = function (macroMetadata) {
        return macroMetadata.anyParameterRequired;
    };

    /**
     * Provide a CSV of macroNames to include only these macros. Has to be called before preLoadMacro() runs.
     *
     * E.g. "code, cheese"
     *
     * @param whitelist
     */
    t.setWhitelist = function (whitelist) {
        AJS.MacroBrowser.whitelist = whitelist;
    };

   /**
    * Preloads required data (list of macros, etc) to be able to create the macro browser dialog quickly when necessary.
    */
    t.preLoadMacro = function () {
        var t = AJS.MacroBrowser;
        t.initData = null; // flag async request started

        AJS.MacroBrowser.Rest.loadMacroMetadata({

            // todo: currently you can either have a whitelist or drop the details.  Both is to-be-implemented
            data: t.whitelist ? { whitelist: t.whitelist } : { detailed: false },

            successCallback: function(data) {
                t.initData = data;
                AJS.MacroBrowser.Model.loadMacros(data.macros);
                if (t.initMacroBrowserAfterRequest) { // we have an existing "open browser" command in the queue waiting for the preloading operation to complete
                    t.initBrowser();
                    t.openMacroBrowser(t.initMacroBrowserAfterRequest);
                }
         },
            errorCallback: function(e) {
                AJS.trigger("analytics", {name: "macro-browser.preload-error"});
                AJS.logError("Error requesting macro browser metadata:");
                AJS.logError(e);
                t.initData = {}; // empty initData is used as an error flag in the "open" method
            }
        });
    };

})(AJS.$);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-macro-browser:macro-browser-js', location = 'js/macro-browser-fields.js' */
/**
 * Returns an object wrapper for a parameter-div jQuery object and the input in
 * that div that stores the internal parameter value (as opposed to the display
 * field, although they may be the same).
 */
AJS.MacroBrowser.Field = function (paramDiv, input, options) {
    options = options || {};

    var setValue = options.setValue || function (value) {
        input.val(value);
    };

    var getValue = options.getValue || function () {
        return input.val();
    };
    
    input.change(options.onchange || AJS.MacroBrowser.paramChanged);

    return {
        paramDiv : paramDiv,
        input : input,
        setValue : setValue,
        getValue : getValue
    };
};

/**
 * ParameterFields defines default "type" logic for fields in the Macro
 * Browser's Insert/Edit Macro form.
 * 
 * Each method in this object corresponds to a parameter type as defined in the
 * MacroParameterType enum.
 */
AJS.MacroBrowser.ParameterFields = (function ($) { 

   /**
     * Update the dependencies of the identified parameter with the supplied value.
     */
    var updateDependencies = function (paramName, dependencies, value) {
        if (dependencies && dependencies.length) {
            for ( var i = 0, length = dependencies.length; i < length; i++) {
                AJS.MacroBrowser.fields[dependencies[i]] && AJS.MacroBrowser.fields[dependencies[i]].dependencyUpdated(paramName, value);
            }
        }
    };

    return {
        "updateDependencies" : updateDependencies,
    	
        "username" : function(param, options) {

            options = options || {};

            var className = param.multiple ? "autocomplete-multiuser" : "autocomplete-user";
            var paramDiv = $(Confluence.Templates.MacroBrowser.macroParameter());
            var input = AJS.$("input[type='text']", paramDiv);
            input.addClass(className).attr("data-none-message", "\u672A\u53D1\u73B0");

            // CONF-16859 - check if mandatory params are now filled
            if (param.required) {
                input.keyup(AJS.MacroBrowser.processRequiredParameters);
            }

            if (param.multiple) {
                Confluence.Binder.autocompleteMultiUser(paramDiv);
                options.setValue = function (value) {
                    input.val(value);

                    var values = value.split(','),
                        requests = [],
                        users = [];

                    // unfortunately there is no rest api to get me a list of users, however since its not a common case
                    // to edit macros with multiple users, going to call the existing api for each user
                    for (var i=0,l=values.length; i<l; i++) {
                        var request = function(username) {
                            return $.getJSON(Confluence.getContextPath() + "/rest/prototype/1/user/non-system/" + username)
                                .done(function(user){
                                    if (user && user.name) {
                                        users.push({id: user.name, text: user.displayName, imgSrc: user.avatarUrl});
                                    }
                                }).fail(function(response) {
                                    AJS.logError("Cannot parse user data for macro browser field with: " + response);
                                    users.push({id: username, text: AJS.format("Unknown User ({0})",username), imgSrc: Confluence.getContextPath() + "/images/icons/profilepics/default.png"})
                                });
                        };

                        requests.push(request(values[i]));
                    }

                    // wait for all requests to finish, whether they passed/failed and then populate the field value
                    $.when.apply($, _.map(requests, function (aRequest) {
                        var monitor = $.Deferred();
                        aRequest.always(function () {
                            monitor.resolve();
                        });
                        return monitor.promise();
                    })).done(function () {
                        if (users.length) {
                            input.auiSelect2('data', users);
                        }
                    });
                };
            }
            else {
                input.bind("selected.autocomplete-content", function(e, data) {
                    if (options.onselect) {
                        options.onselect(data.selection);
                    }
                    else if(options.setValue) {
                        options.setValue(data.content.username);
                    }
                    else {
                        updateDependencies(param.name, options.dependencies, input.val());
                        (typeof options.onchange == "function") && options.onchange.apply(input);
                    }
                });
                AJS.Confluence.Binder.autocompleteUserOrGroup(paramDiv);
            }
            return AJS.MacroBrowser.Field(paramDiv, input, options);
        },

        "spacekey" : function(param, options) {
            // for multple space keys just use a String field at the moment
            if (param.multiple) {
                return AJS.MacroBrowser.ParameterFields["string"](param, options);
            }

            options = options || {};

            var paramDiv = $(Confluence.Templates.MacroBrowser.macroParameter());
            var input = AJS.$("input[type='text']", paramDiv);
            input.addClass("autocomplete-space")
                 .attr("data-template", "{key}")
                 .attr("data-none-message", "\u672A\u53D1\u73B0");

            // CONF-16859 - check if mandatory params are now filled
            if (param.required) {
                input.keyup(AJS.MacroBrowser.processRequiredParameters);
            }

            input.bind("selected.autocomplete-content", function(e, data) {
              if (options.onselect) {
                  options.onselect(data.selection);
              }
              else if(options.setValue) {
                  options.setValue(data.content.key);
              }
              else {
                  updateDependencies(param.name, options.dependencies, input.val());
                  (typeof options.onchange == "function") && options.onchange.apply(input);
              }
            });
            AJS.Confluence.Binder.autocompleteSpace(paramDiv);

            return AJS.MacroBrowser.Field(paramDiv, input);
        },

        "attachment" : function (param, options) {
            if (param.multiple) {
                return AJS.MacroBrowser.ParameterFields["string"](param,
                        options);
            }

            var paramDiv = $(Confluence.Templates.MacroBrowser.macroParameterSelect());
            var input = AJS.$("select", paramDiv);

            options = options || {};
            options.setValue = options.setValue || function(value) {
                // check if the value being set is in the list of options
                // if not then add it as a new option - with an indication that
                // it is not a valid choice for this select box
                var foundOption = false;
                //Don't use a JQuery filter of "[value=" +value+"]" since value is un-escaped user-data
                input.find("option").each(function() {
                    if (this.value == value) {
                        foundOption = true;
                        return false;
                    }
                });

                if (!foundOption) {
                    input.append(AJS.$("<option/>").attr("value", value).text(value + " (" + "\u672A\u53D1\u73B0" + ")"));
                    input.tempValue = value;
                } else {
                    delete input.tempValue;
                }
                
                // CONF-15415 : Spurious error thrown in IE6
                try {
                    input.val(value);
                } catch (err) {
                    AJS.logError(err);
                }

                input.change();
            };

            var field = AJS.MacroBrowser.Field(paramDiv, input, options);
            field.updateDependencies = updateDependencies;
            field.getData = function(req) {
            	if (!((req.title && req.spaceKey) || req.pageId || req.draftId)) {
            		AJS.log("Not enough parameters to send attachmentsearch request");
                    return;	// not enough content info to get attachments
            	}

                var currentValue = input.tempValue || input.val();

                if (options.fileTypes) {
                    req.fileTypes = options.fileTypes;
                }
                
                var url = AJS.params.contextPath + (req.draftId ? "/json/draftattachmentsearch.action" : "/json/attachmentsearch.action");
                $.getJSON(url, req, function(data) {
                    if (data.error) {
                        return;
                    }

                    $("option", input).remove();
                    var attachments = data.attachments;

                    // if there are no attachments on the page then populate the options with
                    // a message stating this
                    if (!attachments || !attachments.length) {
                        // AJS.log("attachment - No attachments so creating message. tempValue = " + input.tempValue);
                        input.append(AJS.$("<option/>").attr("value", "").html("\u65E0\u5408\u9002\u9644\u4EF6"));

                        if (input.tempValue) {
                            options.setValue(input.tempValue);
                        }
                    } else {
                        for (var i = 0, length = attachments.length; i < length; i++) {
                            input.append(AJS.$("<option/>").attr("value", attachments[i].name).text(attachments[i].name));
                        }

                        currentValue = currentValue || input.tempValue;
                        options.setValue(currentValue || attachments[0].name);
                    }
                    //in IE9 only the first character of the selected option is shown, force a redraw
                    input.attr("style", "");
                });
            };

            return field;
        },

        "confluence-content" : function (param, options) {
    
            // If multiple confluence-content field then only return a String at the moment
            if (param.multiple) {
                return AJS.MacroBrowser.ParameterFields["string"](param, options);
            }

            options = options || {};
            param.options = param.options || {};

            var paramDiv = $(Confluence.Templates.MacroBrowser.macroParameter()),
                input = AJS.$("input[type='text']", paramDiv)
                        .attr("data-none-message", "\u672A\u53D1\u73B0")
                        .attr("data-template", ""); // no template as some logic is required to build the value

            // CONF-16859 - check if mandatory params are filled on keypresses in this field.
            if (param.required) {
                input.keyup(AJS.MacroBrowser.processRequiredParameters);
            }

            // CONF-15438 - update any dependencies of the field when it is changed
            options.onchange = options.onchange || function (e) {
                var val = input.val();
                updateDependencies(param.name, options.dependencies, val);
            };
            options.setValue = options.setValue || function (value) {
                input.val(value);
                (typeof options.onchange == "function") && options.onchange.apply(input);
            };
            
            input.bind("selected.autocomplete-content", function(e, data) {
                var datePathPrefix = "";
                if (param.options.includeDatePath == "true" && data.content.type == "blogpost") {
                    var splitDate = data.content.createdDate.date.split("-");
                    datePathPrefix = "/" + splitDate[0] + "/" + splitDate[1]  + "/" + splitDate[2].substring(0, 2) + "/";
                }
                var spaceKey = data.content.space && data.content.space.key;
                var isSpaceKeyNeeded = (spaceKey && spaceKey != AJS.Meta.get('space-key'));
                if (data.content.title.indexOf(":") != -1) {
                    isSpaceKeyNeeded = true;
                }
                var markup = (isSpaceKeyNeeded ? (spaceKey + ":") : "") + datePathPrefix + data.content.title;

                input.val(markup);

                if (options.onselect) {
                  options.onselect(data.selection);
                }
                else {
                  options.setValue(markup, input);
                }
            });

            if (param.options.spaceKey) {
                if (param.options.spaceKey.toLowerCase() == "@self") {
                    param.options.spaceKey = AJS.Meta.get('space-key');
                }
                input.attr("data-spacekey", param.options.spaceKey);
            }

            var type = param.options.type;
            if (typeof type == "string") {
                if(type == "page") {
                    input.addClass("autocomplete-page");
                    AJS.Confluence.Binder.autocompletePage(paramDiv);
                }
                else if (type == "blogpost") {
                    input.addClass("autocomplete-blogpost");
                    AJS.Confluence.Binder.autocompleteBlogpost(paramDiv);
                }
                else if (type == "attachment") {
                    input.addClass("autocomplete-attachment");
                    AJS.Confluence.Binder.autocompleteAttachment(paramDiv);
                }
            }
            else { // default to pages and blogs
                input.addClass("autocomplete-confluence-content");
                AJS.Confluence.Binder.autocompleteConfluenceContent(paramDiv);
            }

            return AJS.MacroBrowser.Field(paramDiv, input, options);
        },
    
        /**
         * Default field for all unknown types.
         */
        "string" : function (param, options) {

            var paramDiv = $(Confluence.Templates.MacroBrowser.macroParameter());
            var input = $("input", paramDiv);

            if (param.required) {
                input.keyup(AJS.MacroBrowser.processRequiredParameters);
            }

            return AJS.MacroBrowser.Field(paramDiv, input, options);
        },

        /**
         * A checkbox - assumes not true means false, not null.
         */
        "boolean" : function (param, options) {

            var paramDiv = $(Confluence.Templates.MacroBrowser.macroParameterBoolean());
            var input = $("input", paramDiv);

            options = options || {};
            options.setValue = options.setValue || function (value) {
                if (/true/i.test(value) ||
                    (/true/i.test(param.defaultValue) && !(/false/i).test(value))) {
                    input.prop("checked", true);
                }
            };

            return AJS.MacroBrowser.Field(paramDiv, input, options);
        },

        "enum" : function (param, options) {
            if (param.multiple) {
                return AJS.MacroBrowser.ParameterFields["string"](param, options);
            }

            var paramDiv = $(Confluence.Templates.MacroBrowser.macroParameterSelect());
            var input = $("select", paramDiv);
            if (!(param.required || param.defaultValue)) {
                input.append(AJS.$("<option/>").attr("value", ""));
            }
            $(param.enumValues).each(function() {
                input.append(AJS.$("<option/>").attr("value", this).html("" + this));
            });

            return AJS.MacroBrowser.Field(paramDiv, input, options);
        },

        /**
         * Like a "string" field but hidden.
         */
        "_hidden" : function (param, options) {

            var paramDiv = $(Confluence.Templates.MacroBrowser.macroParameterHidden()).hide();
            var input = $("input", paramDiv);

            return AJS.MacroBrowser.Field(paramDiv, input, options);
        }
    
    };
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-macro-browser:macro-browser-js', location = 'js/macro-browser-smartfields.js' */
/**
 * Activates smart fields support for a pair of Page / Attachment fields in a macro.
 * 
 * Expects the following macro parameters for the "macroName" to be defined:
 * 
 *   <parameter name="page" type="confluence-content"/>
 *   <parameter name="name" type="attachment" required="true">
 *     <alias name=""/>
 *   </parameter>
 * 
 * Usage in macro specific js file:
 *   AJS.MacroBrowser.activateAttachmentsFromPageSmartFields("multimedia", ["swf","avi"]);
 *
 * Note this function uses AJS.MacroBrowser.setMacroJsOverride for the specified macro, so
 * this will replace any existing override previous set, or this functionality will stop working
 * if an override is set after calling activateSmartFieldsAttachmentsOnPage. 
 *
 * @param macroName the name of the macro to add page/attachment smart field support to
 * @param fileTypes an array containing the file extensions to be shown
 */
(function($) {

    var MacroJsOverrideForSmartFields = function(fileTypes) {
        this.fileTypes = fileTypes;
    };

    MacroJsOverrideForSmartFields.prototype.beforeParamsSet = function(params, inserting) {
        // If the macro has no parameters set for the page, date or space set the page to the one
        // currently being edited. See beforeParamsRetrieved for the reverse.
        if (!params.page && !(params.date || params.space)) {
            if (AJS.params.contentType == "page" || AJS.params.contentType == "blogpost") {
                params.page = AJS.Editor.getCurrentTitle();
            } else if (AJS.params.contentType == "comment") {
                params.page = AJS.params.pageTitle;
            }
        }
        if (params.date) {
            // will be in format mm/dd/yyyy, should be yyyy/mm/dd
            var parts = params.date.split("/");
            params.page = ["", parts[2], parts[0], parts[1], params.page].join("/");
        }
        if (params.space) {
            params.page = params.space + ":" + params.page;
        }
        return params;
    };

    MacroJsOverrideForSmartFields.prototype.beforeParamsRetrieved = function(params) {
        if (params.page) {
            var spacePageArr = params.page.split(":");
            if (spacePageArr.length > 1) {
                params.space = spacePageArr[0];
                params.page = spacePageArr[1];
            }
            var parts = params.page.split("/");
            if (parts.length > 1) {
                // will be in format yyyy/mm/dd/Page, should be mm/dd/yyyy
                params.date = [parts[2], parts[3], parts[1]].join("/");
                params.page = parts[4];
            }
            // If the page specified is the current page being edited, remove the page title parameter.
            // Even if a user entered it manually it is good to get rid of it as the macro parameters don't handle page renames
            // See beforeParamsSet for the reverse.
            if (((AJS.params.contentType == "page" || AJS.params.contentType == "blogpost") && params.page == AJS.Editor.getCurrentTitle()) ||
                 (AJS.params.contentType == "comment" && params.page == AJS.params.pageTitle)) {
                delete params.page;
            }
        }
        return params;
    };

    MacroJsOverrideForSmartFields.prototype.fields = {
        "attachment" : function(param) {

            /**
             *  Assumes value in form SPACEKEY:(/yyyy/mm/dd/)Title
             */
            var parsePageLink = function(pageLink) {
                var o = {};

                var bits = pageLink.split(":", 2);
                o.spaceKey = ((bits.length == 2) && bits[0]) || AJS.Meta.get('space-key');
                o.title = bits[bits.length - 1];

                if (o.title.indexOf("/") == 0) {
                    // blogpost
                    o.postingDay = o.title.substr(1, 10);
                    o.title = o.title.substr(12);
                }

                // If the page title is the same as the page being edited, leave it blank and use the content Id.
                if (o.title == AJS.Editor.getCurrentTitle()) {
                    o.title = "";
                }
                if (!o.title) {
                    if (AJS.params.newPage) {
                        o.draftId = AJS.Meta.get('content-id');
                    } else {
                        o.pageId = AJS.params.pageId;
                    }
                }
                return o;
            };

            var attachmentOptions = {
                fileTypes : this.fileTypes
            }

            var field = AJS.MacroBrowser.ParameterFields["attachment"](param, attachmentOptions);

            field.dependencyUpdated = function(dependencyName, dependencyValue) {
                AJS.debug("attachment:dependencyUpdated called: " + dependencyName + ", " + dependencyValue);

                var req = parsePageLink(dependencyValue);
                this.getData(req);
            };
            return field;
        },

        "confluence-content" : function(param) {
            var options = {
                dependencies : ["name"]
            };

            return AJS.MacroBrowser.ParameterFields["confluence-content"](param, options);
        }
    };

    AJS.MacroBrowser.activateSmartFieldsAttachmentsOnPage = function(macroName, fileTypes) {
        AJS.MacroBrowser.setMacroJsOverride(macroName, new MacroJsOverrideForSmartFields(fileTypes));
    }

})(AJS.$);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-macro-browser:macro-browser-js', location = 'soy/macro-browser.soy' */
// This file was automatically generated from macro-browser.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.MacroBrowser == 'undefined') { Confluence.Templates.MacroBrowser = {}; }


Confluence.Templates.MacroBrowser.macroSummaryList = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ol id="category-', soy.$$escapeHtml(opt_data.category), '" class="macro-list"></ol>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.MacroBrowser.macroSummaryItem = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li class="macro-list-item"><h4 class="macro-title"></h4><div class="macro-desc"> </div></li>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.MacroBrowser.macroDescription = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="macro-desc">', opt_data.description, ' </div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.MacroBrowser.insertMacroPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="macro-insert-container"><input class="macro-name" type="hidden"/><div class="macro-input-fields dialog-panel"><form action="#" class="aui"></form></div><div class="macro-preview-container dialog-panel"><div class="macro-preview-header"><ul class="macro-preview-links"><li><a id="macro-browser-preview-link" class="refresh-link icon icon-refresh" href="#">', soy.$$escapeHtml("\u5237\u65b0"), '</a></li></ul><span>', soy.$$escapeHtml("\u9884\u89c8"), '</span></div><div id="macro-browser-preview" class="macro-preview"></div></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.MacroBrowser.missingUserMacroMetadataPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="macro-missing-metadata-container"><p>', "\u6b64\u5b8f\u672a\u914d\u7f6e\u5143\u6570\u636e\uff0c\u6545\u914d\u7f6e\u754c\u9762\u65e0\u6cd5\u663e\u793a\u3002", '</p>', (opt_data.showAdminMessage) ? '<p>' + AJS.format("\u5982\u679c\u4f7f\u7528\u7528\u6237\u5b8f\uff0c\u8bf7\u4f7f\u7528 \x3ca href\x3d\x22{0}\x22 target\x3d\x22_blank\x22\x3e\u7528\u6237\u5b8f\u7ba1\u7406\x3c/a\x3e \u63a7\u5236\u53f0\u6dfb\u52a0\u5143\u6570\u636e\u5230\u6a21\u677f\u4e2d\u3002","" + '/admin/usermacros.action') + '</p>' : '<p>' + "\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u4e3a\u6b64\u5b8f\u914d\u7f6e\u5143\u6570\u636e\u3002" + '</p>', '</div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.MacroBrowser.macroDocLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<span><a href="', soy.$$escapeHtml(opt_data.href), '" class="macro-doco-link">', soy.$$escapeHtml("\u6587\u6863"), '</a></span>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.MacroBrowser.macroParameter = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="macro-param-div"><label></label><input type="text" class="text"/></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.MacroBrowser.macroParameterBoolean = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="checkbox macro-param-div boolean-param"><input class="checkbox" type="checkbox" value="true"/><label></label></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.MacroBrowser.macroParameterSelect = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="macro-param-div"><label></label><select class="select"></select></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.MacroBrowser.macroParameterHidden = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="macro-param-div"><input type="hidden"/></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.MacroBrowser.macroParameterDesc = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="macro-param-desc">', opt_data.description, '</div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.MacroBrowser.macroBody = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="macro-body-div"><label>', soy.$$escapeHtml("\u6b63\u6587\u6587\u672c"), '</label><textarea class="monospaceInput textarea" type="text" rows="10"></textarea></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.MacroBrowser.helpLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  Confluence.Templates.Dialog.helpLink({href: "https://docs.atlassian.com/confluence/docs-55/Working+with+Macros"}, output);
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.MacroBrowser.gadgetLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<a class=\'macro-uri\' href="', soy.$$escapeHtml(opt_data.url), '" title="', soy.$$escapeHtml(opt_data.url), '" target=\'_blank\'>', soy.$$escapeHtml("Gadget URL"), '</a>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-macro-browser:macro-browser-js', location = 'js/macro-browser-preload.js' */
AJS.toInit(function($) {

    // bind the function to be run when the macro browser preview frame is loaded
    $(window).bind("render-content-loaded", function(e, body) {
        var iframe = $("#macro-preview-iframe");
        if (iframe.contents().find("body")[0] == body) {
            AJS.MacroBrowser.previewOnload(body);
        }
    });

    AJS.MacroBrowser.preLoadMacro();
});

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:page-editor-js', location = 'js/page-editor.js' */
Confluence.Editor=AJS.$.extend(Confluence.Editor||{},(function(f){var e=[];var a=[];var b=[];var c=false;var h=function(){for(var k=0;k<e.length;k++){Confluence.Editor.UI.cancelButton.click(e[k])}for(var k=0;k<a.length;k++){Confluence.Editor.UI.saveButton.click(a[k])}var j=AJS.$(Confluence.Editor.getCurrentForm());for(var k=0;k<b.length;k++){j.submit(b[k])}AJS.$.unbind("init.rte",this)};var g=function(i,k,j,l){l.push(j);if(AJS.Rte&&AJS.Rte.BootstrapManager&&AJS.Rte.BootstrapManager.isInitComplete()){i.bind(k,j)}else{if(!c){c=true;AJS.$.bind("init.rte",h)}}};var d=function(i,k,l){var m=null;if(AJS.Rte&&AJS.Rte.BootstrapManager&&AJS.Rte.BootstrapManager.isInitComplete()){m=function(o,p,n){o.unbind(p,n)}}var j=l.pop();while(j){m&&m(i,k,j);j=l.pop()}};return{bookmark:"",MODE_RICHTEXT:"richtext",MODE_SOURCE:"source",MODE_PREVIEW:"preview",currentEditMode:null,contentHasChangedSinceLastSave:false,sourceInitialValue:false,isSubmitting:false,isCancelling:false,addCancelHandler:function(i){g(Confluence.Editor.UI.cancelButton,"click",i,e)},addSaveHandler:function(i){g(Confluence.Editor.UI.saveButton,"click",i,a)},addSubmitHandler:function(i){g(AJS.$(Confluence.Editor.getCurrentForm()),"submit",i,b)},removeAllCancelHandlers:function(){d(Confluence.Editor.UI.cancelButton,"click",e)},removeAllSaveHandlers:function(){d(Confluence.Editor.UI.saveButton,"click",a)},removeAllSubmitHandlers:function(){d(AJS.$(Confluence.Editor.getCurrentForm()),"submit",b)},hasContentChanged:function(){if(!this.inRichTextMode()&&!this.contentHasChangedSinceLastSave){return false}return this.editorHasContentChanged()},editorHasContentChanged:function(){if(AJS.Rte.getEditor()==null){AJS.debug("Confluence.Editor: editorHasContentChanged - No active editor present. Returning false.");return false}return AJS.Rte.Content.editorHasContentChanged()},getResumeDraftUrl:function(){var i=[];i.push(Confluence.getContextPath());i.push("/pages/"+(AJS.params.newPage?"create":"edit")+AJS.params.draftType+".action");i.push("?useDraft=true");i.push("&pageId="+AJS.params.pageId);i.push("&contentChanged="+this.hasContentChanged());this.getCurrentForm().spaceKey&&i.push("&spaceKey="+AJS.Meta.get("space-key"));return i.join("")},getCurrentTitle:function(){return f("#content-title")&&f("#content-title").val()},contentFormSubmit:function(i){Confluence.Editor.Drafts.unBindUnloadMessage();AJS.$(".editable-title #content-title").prop("disabled",true);return true},getPagePermissions:function(){return{viewPermissionsUsers:f("#viewPermissionsUsers").val(),editPermissionsUsers:f("#editPermissionsUsers").val(),viewPermissionsGroups:f("#viewPermissionsGroups").val(),editPermissionsGroups:f("#editPermissionsGroups").val()}},heartbeat:function(){var i={dataType:"json",contentId:AJS.params.pageId,draftType:AJS.params.draftType,spaceKey:AJS.params.spaceKey};if(AJS.params.pageId=="0"||AJS.Meta.get("content-type")=="comment"){AJS.safe.post(AJS.params.contextPath+"/json/heartbeat.action",{})}else{AJS.safe.post(AJS.params.contextPath+"/json/startheartbeatactivity.action",i,function(j){Confluence.Editor.heartbeatType.normal();AJS.trigger("rte.heartbeat",j);var n=j.length;if(n){var k=AJS.$("#other-users-span");k.empty();for(var m=0;m<n;++m){if(m>0){k.append(", ")}var l=j[m];k.append(AJS("a").attr("href",AJS.params.contextPath+"/display/~"+encodeURIComponent(l.userName)).text(l.fullName));if(l.lastEditMessage!=null){k.append(" ").append(AJS("span").addClass("smalltext").text(l.lastEditMessage))}}}AJS.setVisible("#heartbeat-div",!!n);f(document).trigger("resize.resizeplugin")},"json").fail(function(j){if(j.status===503||j.status===0){Confluence.Editor.heartbeatType.recovery()}AJS.trigger("rte.heartbeat-error",j)})}},heartbeatType:(function(){var i=false;var l;var k=+AJS.Meta.get("heartbeat-interval")||30000;var n=Math.max(k/5,5000);function m(o,p){if(i!==o||!l){AJS.debug("Changing heartbeat period to "+p+" (recoveryMode = "+o+")");clearInterval(l);i=o;l=setInterval(Confluence.Editor.heartbeat,p)}}var j={normal:function(){m(false,k)},recovery:function(){m(true,n)},isNormal:function(){return !i},reset:function(){i=true;j.normal()}};return j}()),disableFrame:function(i){AJS.$("form",i).each(function(){AJS.$(this).unbind();this.onsubmit=function(){return false}});AJS.$("a",i).each(function(){AJS.$(this).attr("target","_top").unbind()});AJS.$("input, img",i).each(function(){AJS.$(this).unbind()})},previewFrameOnload:function(r,o){Confluence.Editor.setMode(Confluence.Editor.MODE_PREVIEW);tinyMCE.activeEditor.setProgressState(false);Confluence.Editor.disableFrame(r);var s=AJS.$("#main",r)[0];if(AJS.Meta.get("content-type")!="comment"&&AJS.$(s).find("#main-header").length==0){var u=AJS.$("#title-heading");var n=u.attr("class");AJS.$(s).prepend('<div id="preview-header"><div id="title-heading" class="'+n+'">'+u.html()+"</div></div>")}AJS.$("a",r).attr("target","_parent");if(f("#all-messages").children().length<1){f("#editor-precursor").css({display:"none"})}if(AJS.Rte.getEditorContainer().hasClass("resize")){var v=f(o||"#previewArea iframe"),m=0,j=0,k,q=v.height();s&&(function(){var w=f(s).outerHeight(true);if(m!=w){if(w!=v.height()){v.height(0).height(Math.max(w,q))}m=w;j=0}else{j++}if(j<500){k=setTimeout(arguments.callee,500)}})();f(document).one("mode-changed.resize-editor",function(w,x){if(x!=Confluence.Editor.MODE_PREVIEW){k&&clearTimeout(k)}})}else{if(tinymce.isIE||tinymce.isOpera){var i=f(window).height(),p=f("#header-precursor").height()+f("#header").height()+f("#editor-precursor").height(),t=f("#savebar-container").height(),l=4;f("#preview iframe").height(i-p-t-l);f("#content.edit").height("auto")}}},showRichText:function(i){AJS.setVisible("#wysiwyg",i);f("#editor-precursor").css({display:"table-row"});f(".toolbar-group-preview").toggleClass("assistive",!i);f(".toolbar-group-edit").toggleClass("assistive",i);f("#main").toggleClass("active-richtext",i);if(tinymce.isGecko&&i){AJS.Rte.fixEditorFocus(Confluence.Editor.bookmark)}},showPreview:function(i){if(AJS.Meta.get("content-type")!=="comment"){var j=f("#content-title");if(j.hasClass("placeholded")){f("#preview-title-text").text("");f("#title-text").text("")}else{f("#preview-title-text").text(j.val());f("#title-text").text(j.val())}}AJS.setVisible("#preview",i);f(".toolbar-group-preview").toggleClass("assistive",i);f(".toolbar-group-edit").toggleClass("assistive",!i);f("#main").toggleClass("active-preview",i);!!f("#full-height-container").length&&f("#full-height-container").toggleClass("active-preview",i)},showSource:function(i){if(i){this.showSourceArea()}else{this.hideSourceArea()}f("#main")[i?"addClass":"removeClass"]("active-source")},setMode:function(i){AJS.debug("Set mode: "+i);if(i==Confluence.Editor.MODE_RICHTEXT){this.showRichText(true);this.showPreview(false);this.showSource(false)}else{if(i==Confluence.Editor.MODE_SOURCE){this.showSource(true);this.showRichText(false);this.showPreview(false)}else{if(i==Confluence.Editor.MODE_PREVIEW){this.showPreview(true);this.showRichText(false);this.showSource(false);Confluence.Editor.UI.spinner.removeClass("aui-icon-wait")}}}setTimeout(function(){var j=f(".toolbar-group-preview");j.height(0);j.height();j.height("auto")},1);this.currentEditMode=i;f(document).trigger("mode-changed",[i])},getContentId:function(){return Confluence.getContentId()},addErrorMessage:function(m,k,l){var j=f("#"+m);var i=(l?"#all-messages":"#editor-messages");if(j.length){j.empty()}else{j=f("<div></div>").attr("id",m).appendTo(i)}AJS.messages.error(j,{closeable:true,body:k})},changeMode:function(m,i){AJS.debug("Change mode: "+m);i=i||{};if(this.inRichTextMode()&&!AJS.Rte.BootstrapManager.isInitComplete()){return false}if(this.currentEditMode==m){return false}var j=this.currentEditMode;Confluence.Editor.Drafts.save();if(m==Confluence.Editor.MODE_PREVIEW){var l=AJS.Rte.getEditor();if(j==Confluence.Editor.MODE_SOURCE){Confluence.Editor.transferSourceToEditor()}if(tinyMCE.isGecko&&(j==Confluence.Editor.MODE_RICHTEXT)&&!Confluence.Editor.bookmark){Confluence.Editor.bookmark=tinymce.activeEditor.selection.getBookmark()}this.currentEditMode=m;var k={contentId:Confluence.getContentId(),contentType:AJS.Meta.get("content-type"),spaceKey:AJS.Meta.get("space-key"),xHtml:l.getContent()};AJS.safe.ajax({type:"POST",url:AJS.params.contextPath+"/pages/rendercontent.action",data:k,success:Confluence.Editor.replysetPreviewArea,timeout:20000,error:function(){Confluence.Editor.addErrorMessage("preview-error","\u9884\u89C8\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5\u3002");Confluence.Editor.currentEditMode=j;i.errorCallback&&i.errorCallback()}})}else{this.setMode(m)}if(m==Confluence.Editor.MODE_RICHTEXT){f(document).trigger("resize.resizeplugin")}return false},replysetPreviewArea:function(i){f("#preview-error").remove();var l=AJS.params.staticResourceUrlPrefix+"/blank.html";tinyMCE.activeEditor.setProgressState(true);AJS.$("#previewArea").html('<iframe id="editor-preview-iframe" src="'+l+'" scrolling="yes" frameborder="0"></iframe>');var j=AJS.$("#previewArea iframe")[0];var k=j.contentDocument||j.contentWindow.document;k.write(i);k.close()},inRichTextMode:function(){return this.currentEditMode==Confluence.Editor.MODE_RICHTEXT},isNewPage:function(){return AJS.$("#createpageform, #createpagetemplate").length>0},onInit:function(){Confluence.Editor.setMode(Confluence.Editor.MODE_RICHTEXT);tinyMCE.activeEditor.onClick.add(function(i,k){var j=Confluence.Editor.UI.postingDatePicker;j&&j.hide()})},contentChangeHandler:function(){this.contentHasChangedSinceLastSave=true},getCurrentForm:function(){return tinyMCE.activeEditor.formElement},transferSourceToEditor:function(){var j=Confluence.Editor;if(j.sourceInitialValue){var i=j.getSourceAreaVal();if(i!=j.sourceInitialValue){var k=tinyMCE.activeEditor;k.setContent(i);k.setDirty(i)}}j.sourceInitialValue=false},hideSourceArea:function(){AJS.$("#editor-html-source-container").addClass("hidden");this.setToolBarInactive(false);this.transferSourceToEditor();f("#rte-button-source-mode").removeClass("active");f("#rte-button-publish").unbind("click.source-save")},showSourceArea:function(){AJS.$("#editor-html-source-container").removeClass("hidden");this.setSourceAreaHeight();this.setToolBarInactive(true);this.sourceInitialValue=tinyMCE.activeEditor.getContent();this.setSourceAreaVal(this.sourceInitialValue);f("#rte-button-source-mode").addClass("active");f("#rte-button-publish").bind("click.source-save",Confluence.Editor.transferSourceToEditor)},getSourceAreaVal:function(){return AJS.$("#editor-html-source").val()},setSourceAreaVal:function(i){AJS.$("#editor-html-source").val(i)},setSourceAreaHeight:function(){var i=AJS.Rte.getTinyMceEditorMinHeight();AJS.debug("HTML source height= "+i);var j=f("#editor-html-source")[0].scrollHeight;if(j>i){i=j;AJS.debug("ACTUAL HEIGHT "+j)}f("#editor-html-source-container").height(i+"px")},setToolBarInactive:function(i){f("#rte-toolbar").toggleClass("disabled",i)},isVisible:function(){return(f("#wysiwyg:visible").length>0)||(f("#editor-html-source-container:visible").length>0)||(f("#preview:visible").length>0)}}})(AJS.$));AJS.toInit(function(a){AJS.bind("init.rte",Confluence.Editor.onInit)});AJS.bind("init.rte",function(){var d=AJS.$;var a=function(h){for(var j=0;j<Confluence.Editor.UI.buttons.length;j++){e(h,d(Confluence.Editor.UI.buttons[j]))}};var e=function(h,i){if(!i){return}if(h){i.removeAttr("aria-disabled")}else{i.attr("aria-disabled","true")}};var b=function(h,i){AJS.$(h).replaceWith(i);return AJS.$(h)};var g=function(){return b("#rte-button-publish",Confluence.Templates.Editor.Page.saveButton({contentType:AJS.Meta.get("content-type")}))};Confluence.Editor.UI={spinner:AJS.$("#rte-spinner"),saveButton:g(),overwriteButton:AJS.$("#rte-button-overwrite"),editButton:AJS.$("#rte-button-edit"),previewButton:AJS.$("#rte-button-preview"),cancelButton:AJS.$("#rte-button-cancel"),saveDraftButton:AJS.$("#rte-button-save-draft"),watchPageCheckbox:AJS.$("#watchPage"),watchPageToolbarGroup:AJS.$(".toolbar-group-watch-page"),setButtonsState:a,setButtonState:e,postingDatePicker:null,isFormEnabled:function(){return c.UI.saveButton.attr("aria-disabled")!=="true"},toggleSavebarBusy:function(h,i){if(h&&!Confluence.Editor.UI.isFormEnabled()){if(i){Confluence.Editor.UI.spinner.removeClass("aui-icon-wait")}return false}if(h){if(!Confluence.Editor.isCancelling){if(AJS.Meta.get("content-type")==="comment"&&AJS.Rte.Content.isEmpty()){AJS.Confluence.EditorNotification.notify("warning","\u8BC4\u8BBA\u6587\u5B57\u4E3A\u7A7A\uFF0C\u4E0D\u80FD\u6DFB\u52A0\u7A7A\u7684\u8BC4\u8BBA\u3002",8);return false}if(i!==true){Confluence.Editor.UI.spinner.addClass("aui-icon-wait")}}a(false)}else{Confluence.Editor.UI.spinner.removeClass("aui-icon-wait");a(true)}return true},toggleWatchPage:function(h){if(h&&AJS.Meta.get("content-type")==="comment"){Confluence.Editor.UI.watchPageToolbarGroup.show();if(Confluence.Editor.UI.watchPageCheckbox.length){Confluence.Editor.UI.watchPageCheckbox[0].checked=false}}else{Confluence.Editor.UI.watchPageToolbarGroup.hide()}}};AJS.trigger("rte.init.ui");Confluence.Editor.UI.buttons=[Confluence.Editor.UI.saveButton,Confluence.Editor.UI.overwriteButton,Confluence.Editor.UI.editButton,Confluence.Editor.UI.previewButton,Confluence.Editor.UI.cancelButton,Confluence.Editor.UI.saveDraftButton];var c=Confluence.Editor;if(c.isNewPage()){AJS.$("#content-title").focus().select()}c.addSubmitHandler(function(h){if(Confluence.Editor.UI.toggleSavebarBusy(true)){Confluence.Editor.isCancelling=false;a(false);return c.contentFormSubmit(h)}else{return false}});c.addCancelHandler(function(h){Confluence.Editor.isCancelling=true});this.currentEditMode=this.MODE_RICHTEXT;if(AJS.DarkFeatures.isEnabled("move.page.on.save")){c.UI.saveButton.click(function(i){i.preventDefault();if(AJS.$("#move-page-dialog").length>0){AJS.$("#move-page-dialog, body > .shadow, body > .aui-blanket").remove()}var h;if(AJS.Meta.getBoolean("new-page")&&AJS.Meta.get("content-type")!="blogpost"){new Confluence.MovePageDialog({spaceName:h,spaceKey:AJS.$("#newSpaceKey").val(),pageTitle:AJS.$("#content-title").val(),parentPageTitle:AJS.$("#parentPageString").val(),buttonName:"\u4FDD\u5B58",title:"\u8BBE\u7F6E\u9875\u9762\u4F4D\u7F6E",hint:{text:"\u63D0\u793A: \u4F7F\u7528\"\u5DE5\u5177\"\u83DC\u5355\uFF0C\u7A0D\u540E\u80FD\u591F\u79FB\u52A8\u6B64\u9875\u9762\u3002"},moveHandler:function(n,k,o,p,m,l,j){AJS.$("#newSpaceKey").val(k);AJS.$("#parentPageString").val(p);if(p!=""){AJS.$("#position").val("append")}else{AJS.$("#position").val("topLevel")}if(m){AJS.$("#targetId").val(m);AJS.$("#position").val(l)}AJS.$(c.getCurrentForm()).submit()}})}else{AJS.$(c.getCurrentForm()).submit()}})}c.UI.editButton.click(function(h){if(Confluence.Editor.UI.isFormEnabled()){Confluence.Editor.changeMode(c.MODE_RICHTEXT);setTimeout(function(){AJS.Rte.getEditor().focus();if(tinymce.isGecko&&Confluence.Editor.bookmark){AJS.Rte.getEditor().selection.moveToBookmark(Confluence.Editor.bookmark)}},0)}h.preventDefault()});c.UI.previewButton.click(function(h){if(Confluence.Editor.UI.isFormEnabled()&&c.currentEditMode!=c.MODE_PREVIEW){a(false);Confluence.Editor.UI.spinner.addClass("aui-icon-wait");if(tinymce.isGecko&&!Confluence.Editor.bookmark){Confluence.Editor.bookmark=tinymce.activeEditor.selection.getBookmark()}c.changeMode(c.MODE_PREVIEW,{errorCallback:function(){a(true);Confluence.Editor.UI.spinner.removeClass("aui-icon-wait")}})}h.preventDefault()});AJS.$("#editor-html-source").change(c.setSourceAreaHeight).keyup(c.setSourceAreaHeight);AJS.$("#rte-button-attachments").bind("updateLabel",function(){var i=+AJS.Meta.get("num-attachments");var h=(i>1)?AJS.format("{0} \u9644\u4EF6",i):(i==0)?AJS.format("\u9644\u4EF6",i):AJS.format("{0} \u9644\u4EF6",i);AJS.$("#rte-button-attachments > .trigger-text").text(h)});AJS.$("#rte-button-labels").bind("updateLabel",function(){var i=+AJS.Meta.get("num-labels")||0;var h="\u6807\u7B7E";if(i===1){h=AJS.format("{0} \u6807\u7B7E",i)}else{if(i>1){h=AJS.format("{0} \u6807\u7B7E",i)}}AJS.$("#rte-button-labels  > .trigger-text").text(h)});var f=AJS.$("#PostingDate");if(f.length){f.attr("max",moment().format("YYYY-MM-DD"));c.UI.postingDatePicker=f.datePicker({overrideBrowserDefault:true});c.UI.postingDatePicker.hide()}AJS.$(".mceProgress, .mceBlocker",AJS.$("#wysiwygTextarea_parent")[0]).live("click",function(){AJS.Rte.getEditor().focus()});AJS.$(window).bind("render-content-loaded",function(j,h){var i=AJS.$("#previewArea iframe");if(i.contents().find("body")[0]==h){c.previewFrameOnload(h,i);c.UI.setButtonsState(true);c.UI.setButtonState(false,c.UI.saveDraftButton);i.focus();window.focus();AJS.$(document).trigger("iframeAppended",i)}});if(AJS.Meta.get("heartbeat")){c.heartbeat();Confluence.Editor.heartbeatType.normal()}AJS.bind("watchpage.pageoperation",function(){Confluence.Editor.UI.toggleWatchPage(false)});AJS.bind("unwatchpage.pageoperation",function(){Confluence.Editor.UI.toggleWatchPage(true)});AJS.trigger("init.rte-control")});AJS.Editor=Confluence.Editor;
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:page-editor-js', location = 'soy/image-dialog.soy' */
// This file was automatically generated from image-dialog.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Image == 'undefined') { Confluence.Templates.Image = {}; }


Confluence.Templates.Image.uploadFileForm = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="upload-attachment"><form action="', soy.$$escapeHtml(""), '/pages/attachfile.action" method="post" enctype="multipart/form-data" class="aui"><label for="file_0">', soy.$$escapeHtml("\u4e0a\u4f20\u56fe\u50cf:"), '</label><input name="file_0" type="file" class="upfile"><input type="hidden" name="minorEdit_0" value="true" /><input type="hidden" name="atl_token" value="', soy.$$escapeHtml(opt_data.atlToken), '" /></form><div class="image-uploading hidden">', "\u56fe\u7247\u4e0a\u4f20\x26hellip;", '</div><div class="warning hidden"></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Image.attachedImagesPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="attached-images"><div class="loading-message">', "\u8f7d\u5165\x26hellip;", '</div><ul class="image-list"></ul></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Image.searchPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="search-image"><form class="aui search-form" id="search-image-form" action="#"><fieldset class="inline"><div class="search-input"><label for="search-image" class="assistive">', soy.$$escapeHtml("\u641c\u7d22"), '</label><input type="text" class="text search-image-text" size="50" autocomplete="off"></div><select class="search-space select" id="search-image-space-select"><option value="">', soy.$$escapeHtml("\u5168\u90e8\u7a7a\u95f4"), '</option><option value="', soy.$$escapeHtml(opt_data.spaceKey), '">', soy.$$escapeHtml(opt_data.spaceName), '</option></select><button type="submit" class="aui-button search-button">', soy.$$escapeHtml("\u641c\u7d22"), '</button></fieldset></form></div><div id="searched-images"><div class="loading-message hidden">', soy.$$escapeHtml("\u6b63\u5728\u641c\u7d22\u2026"), '</div><ul class="image-list"></ul></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Image.webPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="insert-web-image"><form id="insert-web-image-form" action="#" class="aui"><fieldset class="inline"><div class="web-image-input"><label for="insert-web-image-image-url" id="insert-web-image-image-url-label">', soy.$$escapeHtml("\u56fe\u50cfURL:"), '</label><input type="text" class="text image-url" value="http://" id="insert-web-image-image-url" name="insert-web-image-image-url"></div><input type="submit" class="image-preview aui-button" value="', soy.$$escapeHtml("\u9884\u89c8"), '"></fieldset></form><p class="faraway image-preview-area"></p><p class="hidden image-preview-error">', soy.$$escapeHtml("\u56fe\u7247\u4e0d\u80fd\u4e0a\u4f20\u9884\u89c8\uff0c\u8bf7\u68c0\u67e5URL\u3002"), '</p><p class="hidden image-preview-throbber">&nbsp;</p></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Image.imageDialogListItem = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li class="attached-image"><div class="image-container loading"><img class="thumbnail" src="', soy.$$escapeHtml(opt_data.nonceUrl), '" title="', soy.$$escapeHtml(opt_data.imageTooltip), '" width="', soy.$$escapeHtml(opt_data.image.thumbnailWidth), '" height="', soy.$$escapeHtml(opt_data.image.thumbnailHeight), '" style="margin-top: ', soy.$$escapeHtml(opt_data.topMargin), 'px"><a href="', soy.$$escapeHtml(opt_data.image.downloadUrl), '" class="zoom">Zoom</a></div><span class="caption filename" title="', soy.$$escapeHtml(opt_data.imageName), '">', opt_data.highlightedImageName, '</span><span class="caption owner-title ', soy.$$escapeHtml(opt_data.parentTitleClass), '" title="', soy.$$escapeHtml(opt_data.image.parentTitle), '">', opt_data.highlightedParentTitle, '</span></li>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.Image.helpLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="dialog-help-link"><a href="', soy.$$escapeHtml("https://docs.atlassian.com/confluence/docs-55/Displaying+Images"), '" target="_blank">', soy.$$escapeHtml("\u5e2e\u52a9"), '</a></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:page-editor-js', location = 'soy/insert-wiki-markup.soy' */
// This file was automatically generated from insert-wiki-markup.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.InsertWiki == 'undefined') { Confluence.Templates.InsertWiki = {}; }


Confluence.Templates.InsertWiki.originalDefaultTempWikiMarkupDialog = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form action=\'#\' method=\'post\' id="insert-wiki-markup-form" class="aui"><textarea class=\'monospaceInput textarea originalDefault\' id=\'insert-wiki-textarea\' name=\'wikitext\'/></form>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.InsertWiki.previewWikiIframeContent = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<!DOCTYPE html><html class="insert-wiki-markup-dialog"><head></head><body class="wiki-content previewWiki"></body></html>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.InsertWiki.wikiMarkupDialog = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<p id="insert-wiki-info-title">', soy.$$escapeHtml("Enter wiki markup or markdown below. Confluence will convert your content to editor format and insert it into your page."), '</p><form action=\'#\' method=\'post\' id="insert-wiki-markup-form" class="aui"><h3 class="wiki-title"><span id="insert-wiki-insert-title">', soy.$$escapeHtml("Insert"), '</span><span id="insert-wiki-preview-title">', soy.$$escapeHtml("Preview"), '</span></h3><textarea class=\'monospaceInput textarea\' id=\'insert-wiki-textarea\' name=\'wikitext\'/><!-- --><div class=\'example-container\' id=\'insert-wiki-textarea-preview\'></div></form>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.InsertWiki.wikiErrorSubDialog = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<p class=\'warning\'>', soy.$$escapeHtml(opt_data.warningMessage), '</p><p class=\'exception-report\'><span class=\'exceptionMessage\'>', soy.$$escapeHtml(opt_data.exceptionMessage), '</span></p>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.InsertWiki.wikiParserSelector = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<span class="wiki-parser-selector"><form action="#" method="post" id="d" class="aui"><select class="select medium-field" id="wiki-parser-selection-tool" name="wiki-parser-selection-tool" title="wiki parser selector"><option value="', soy.$$escapeHtml(opt_data.DEFAULT.val), '">', soy.$$escapeHtml(opt_data.DEFAULT.label), '</option>');
  var wikiLangList26 = soy.$$getMapKeys(opt_data.WIKI);
  var wikiLangListLen26 = wikiLangList26.length;
  for (var wikiLangIndex26 = 0; wikiLangIndex26 < wikiLangListLen26; wikiLangIndex26++) {
    var wikiLangData26 = wikiLangList26[wikiLangIndex26];
    output.append((opt_data.WIKI[wikiLangData26].val != opt_data.DEFAULT.val) ? '<option value="' + soy.$$escapeHtml(opt_data.WIKI[wikiLangData26].val) + '">' + soy.$$escapeHtml(opt_data.WIKI[wikiLangData26].label) + '</option>' : '');
  }
  output.append('</select></form></span>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:page-editor-js', location = 'soy/page-editor.soy' */
// This file was automatically generated from page-editor.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Editor == 'undefined') { Confluence.Templates.Editor = {}; }
if (typeof Confluence.Templates.Editor.Page == 'undefined') { Confluence.Templates.Editor.Page = {}; }


Confluence.Templates.Editor.Page.saveButton = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<button id="rte-button-publish" class="aui-button aui-button-primary" type="submit" name="confirm" value="Save"', (opt_data.contentType == 'blogpost') ? 'title="' + soy.$$escapeHtml("Publish your blog post") + '"' : (opt_data.contentType == 'page') ? 'title="' + soy.$$escapeHtml("Save your page") + '"' : 'title="' + soy.$$escapeHtml("Save") + '"', 'tabindex="101">', (opt_data.contentType == 'blogpost') ? '<span class="trigger-text">' + soy.$$escapeHtml("Publish") + '</span>' : '<span class="trigger-text">' + soy.$$escapeHtml("Save") + '</span>', '</button>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:page-editor-js', location = 'js/insert-image-dialog.js' */
jQuery.fn.sizeToFit=function(){var a=jQuery;this.each(function(){var d=this;var b=a(this).parent();var e=b.height();b.children().each(function(){if(this!=d){e-=a(this).outerHeight()}});var c=a(this).outerHeight()-a(this).height();a(this).css("height",Math.max(0,e-c)+"px")});return this};Confluence.Editor.ImageDialog={beforeShowListeners:[],afterThumbnailsDisplayedListeners:[],panelComponent:[]};AJS.toInit(function(c){Confluence.Editor.ImageDialog.findPanelComponentById=function(h){var e=Confluence.Editor.ImageDialog.panelComponent;for(var f=0,g=e.length;f<g;f++){if(e[f].id==h){return e[f]}}return undefined};AJS.wikiAttrToString=function(e){var f=[];for(var g in e){if(e.hasOwnProperty(g)){f.push(typeof e[g]=="boolean"?e[g]?g:"":g+"="+e[g])}}return f.length?"|"+f.join(","):""};Confluence.Editor.defaultInsertImageDialog=function(){var f=function(g){AJS.Rte.BookmarkManager.restoreBookmark();tinymce.confluence.ImageUtils.insertFromProperties(g);if(!!c("#comments-section").length){AJS.Rte.fixEditorFocus()}},e=function(){AJS.Rte.BookmarkManager.restoreBookmark()};AJS.Rte.BookmarkManager.storeBookmark();Confluence.Editor.insertImageDialog(f,e)};Confluence.Editor.insertImageDialog=function(f,e){this.openImageDialog({submitCallback:f,cancelCallback:e})};var a=function(e,f,g){c(document).bind("keydown.insert-image",function(i){if(!e.is(":visible")){return}if(c("#fancybox-overlay").is(":visible")){if(i.which==32){c("#fancybox-close").click();i.preventDefault();i.stopPropagation();return false}}else{function h(n){var k=c(".attached-image",e);var m=c(".attached-image.selected",e);var j=k.index(m)+n;if(j<0){j=k.length-1}if(j>=k.length){j=0}var l=k.eq(j);l.click().focus();e.simpleScrollTo(l)}if(i.which==37){h(-1);return AJS.stopEvent(i)}else{if(i.which==38){h(-4);return AJS.stopEvent(i)}else{if(i.which==39){h(1);return AJS.stopEvent(i)}else{if(i.which==40){h(4);return AJS.stopEvent(i)}else{if(i.which==32&&c(".attached-image.selected").length>0){c(g.imageSelector+".selected .zoom").click();return AJS.stopEvent(i)}else{if(i.which==13&&f.isInsertAllowed()){f.insert();return AJS.stopEvent(i)}}}}}}}})};var d=function(e,g,j,m){var h=100,m=m||new Confluence.Highlighter(),k=g.name||g.fileName,o;if(Math.max(g.thumbnailWidth,g.thumbnailHeight)>h){if(g.thumbnailHeight>g.thumbnailWidth){g.thumbnailWidth=g.thumbnailWidth*h/g.thumbnailHeight;g.thumbnailHeight=h}else{g.thumbnailHeight=g.thumbnailHeight*h/g.thumbnailWidth;g.thumbnailWidth=h}}if(!g.thumbnailUrl&&g.thumbnailLink){g.thumbnailUrl=g.thumbnailLink.href}if(!g.downloadUrl&&g.link){for(var f=0,n=g.link.length;f<n;f++){var l=g.link[f];if(l.rel=="download"){g.downloadUrl=l.href;break}}}o=c(Confluence.Templates.Image.imageDialogListItem({image:g,nonceUrl:g.thumbnailUrl&&g.thumbnailUrl+(g.thumbnailUrl.indexOf("?")+1?"&":"?")+"nonce="+(+new Date),imageTooltip:k+(g.space&&(" ("+g.space.name+")")||""),topMargin:g.thumbnailHeight&&(100-g.thumbnailHeight)/2,parentTitleClass:j?"":"hidden",imageName:k,parentTitle:g.parentTitle||"",highlightedImageName:m.highlight(k),highlightedParentTitle:m.highlight(g.parentTitle||"")}));o.attr("data-attachment-id",g.attachmentId||"");o.attr("data-owner-id",g.ownerId||"");o.attr("data-destination",AJS.REST.wikiLink(g).destination);o.find(".image-container").andSelf().hover(function(){c(this).addClass("hover")},function(){c(this).removeClass("hover")});o.find("img").load(function(){o.find(".image-container").removeClass("loading")});o.click(function(i){c("#insert-image-dialog .image-list .selected").removeClass("selected");c(this).addClass("selected").focus();e.selectedName=this.name=this.name||c(".caption.filename",this).text();e.selectedOwnerId=c(this).attr("data-owner-id");e.selectedDestination=c(this).attr("data-destination");e.allowInsert(true);i.stopPropagation();return false});o.dblclick(function(){c(this).click();e.insert()});c(".zoom",o).fancybox({padding:0,zoomSpeedIn:500,zoomSpeedOut:500,overlayShow:true,overlayOpacity:0.5});return o};var b=function(f,e){var h=e.imageContainer.find(".image-list"),i=c.map(e.justAttached||[],function(r){return r&&r.toLowerCase()}),q=f.options,m=e.imageContainer,n=e.images||[],j=e.noImageMessage,k=e.showParentTitle,o=e.highlighter,p=e.displayErrors,l=[],g;m.find(".loading-message").addClass("hidden");m.find(".no-images").remove();c(n).each(function(){if(this.name&&c.inArray(this.name.toLowerCase(),i)!=-1){h.prepend(d(f,this,k,o))}else{h.append(d(f,this,k,o))}});if(h.find("li").length==0){m.append(c("<p></p>").addClass("no-images").text(j))}m.sizeToFit().click(function(){f.clearSelection()});if(i.length){h.find("li:first").click()}else{if(q.imageProperties&&q.imageProperties.imageFileName){imageContainter.find("img[src*=/"+q.imageProperties.imageFileName+"?]").click()}}l=[];g=c.map(n,function(r){return r.name&&r.name.toLowerCase()});c.each(i,function(r,s){if(c.inArray(s,g)==-1){l.push(AJS.format("\u4E0A\u4F20\u7684\u6587\u4EF6\u4E0D\u662F\u6709\u6548\u56FE\u5F62\u683C\u5F0F(gif, jpg\u6216png )\u3002\u5C06\u65E0\u6CD5\u663E\u793A\u7F29\u7565\u56FE\u3002",s))}});if(l.length){p(l)}};Confluence.Editor.openImageDialog=function(m){m=m||{};var l="insert-image-dialog";var j=new AJS.Dialog(840,590,l),f={baseElement:j.popup.element,selectedName:"",selectedOwnerId:null,selectedDestination:null,allowInsert:null,isInsertAllowed:null,insert:null,attachmentSourceContentId:AJS.Meta.get("attachment-source-content-id"),options:m,clearSelection:null,imageContainerSupport:{bindImageContainer:a,refreshImageList:b},addPanel:function(r,n,p,o){var q=j.getPage(0).panel.length;j.addPanel(r,n,p,o);return q},selectPanel:function(n){j.selectPanel(n)},getPanel:function(n){return j.getPanel(n)}},e="\u63D2\u5165\u56FE\u7247",k="\u63D2\u5165",i,g;f.clearSelection=function(){f.selectedName="";f.selectedOwnerId=null;f.selectedDestination=null;f.allowInsert(false);f.baseElement.find(".image-list .selected").removeClass("selected")};function h(){j.hide().remove();c(document).unbind(".insert-image");m.cancelCallback&&m.cancelCallback();return false}c(document).bind("keydown.insert-image",function(n){if(n.which==27&&!c("#fancybox-overlay").is(":visible")){h();return AJS.stopEvent(n)}});if(m.imageProperties){e="\u7F16\u8F91\u56FE\u7247";k="\u4FDD\u5B58"}j.addHeader(e);c("#"+l+" .dialog-components .dialog-title").prepend(Confluence.Templates.Image.helpLink());j.addButton(k,function(o){var q=o.getCurrentPanel().body;var n=c("input.image-url",q).val();var p={url:n,filename:f.selectedName,contentId:f.selectedOwnerId||f.attachmentSourceContentId};o.remove();c(document).unbind(".insert-image");if(m.submitCallback){m.submitCallback(p)}},"insert");i=j.popup.element;i.attr("data-tab-default","0");g=i.find(".dialog-button-panel .insert");f.allowInsert=function(n){g.prop("disabled",!n)};f.allowInsert(false);f.isInsertAllowed=function(){return !g.is(":disabled")};f.insert=function(){g.click()};c.each(Confluence.Editor.ImageDialog.panelComponent,function(){this&&this.createPanel&&this.createPanel(f)});j.addCancel("\u53D6\u6D88",h);AJS.debug(Confluence.Editor.ImageDialog.beforeShowListeners.length+" beforeShow listeners registered.");c.each(Confluence.Editor.ImageDialog.beforeShowListeners,function(){this()});j.show();j.popup.element.find(".dialog-button-panel").append(c("<div></div>").addClass("dialog-tip").html("\u63D0\u793A: \u5728\u7F16\u8F91\u5668\u4E2D\u8F93\u5165 \"\u003cstrong>!\u003c\/strong>\" \u5728\u9875\u9762\u4E2D\u63D2\u5165\u56FE\u7247\u3002"))}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:page-editor-js', location = 'js/insert-image-dialog-attachments.js' */
AJS.toInit(function(e){if(AJS.Meta.get("content-type")==="template"){return}var c,g,d,h=function(i){var j=function(){return e(".attachments-panel",i.baseElement)},m=function(){return e("#attached-images")},l=function(){return e(".image-list",m())},n=function(){return e("form",j())},k=function(p,q){q=q?e.map(q,function(r){return r&&r.toLowerCase()}):[];var o=m();o.find(".image-list").empty();AJS.getJSONWrap({url:Confluence.getContextPath()+"/pages/attachedimages.action",data:{contentId:i.attachmentSourceContentId},messageHandler:d,loadingElement:o.find(".loading-message"),errorMessage:"\u65E0\u6CD5\u4ECEConfluence\u83B7\u53D6\u9644\u4EF6\u4FE1\u606F\u3002\u670D\u52A1\u5668\u4E0D\u53EF\u7528\u3002",successCallback:function(r){i.imageContainerSupport.refreshImageList(i,{imageContainer:o,images:r.images,noImageMessage:"\u672C\u9875\u9762\u6CA1\u6709\u4EFB\u4F55\u4E0A\u4F20\u7684\u56FE\u50CF\u3002",justAttached:q,showParentTitle:false,displayErrors:function(s){g.displayErrors(s)}});AJS.Meta.set("num-attachments",+r.totalImages);e("#rte-button-attachments").trigger("updateLabel");p.trigger("afterThumbnail",[l()])}})};return{getPanelElement:j,getContainer:m,getForm:n,refreshWithLatestImages:k,getPanel:function(){var o=Confluence.Templates.Image.attachedImagesPanel();if(AJS.Meta.getBoolean("can-attach-files")){o=Confluence.Templates.Image.uploadFileForm({atlToken:AJS.Meta.get("atl-token")})+o}return o},focus:function(){e("select.img-align",j()).focus()},upload:function(o){e.ajax({dataType:"json",data:{contentId:i.attachmentSourceContentId,responseFormat:"html"},resetForm:true,error:o.error,success:o.success})},getUploaderController:function(){var o=function(p){return{onUploadSuccess:function(q){b.refreshWithLatestImages(f,e.map(q||[],function(r){return r.name.toLowerCase()}))},pack:function(){m().sizeToFit()},getDefaultErrorMessage:function(){return "\u65E0\u6CD5\u4E0A\u4F20\u6587\u4EF6\u3002\u670D\u52A1\u5668\u4E0D\u53EF\u7528\u3002"},getDefaultUploadingMessage:function(){return "\u56FE\u7247\u4E0A\u4F20&hellip;"},getUploadingMessageElement:function(){return e(".image-uploading",p.baseElement)}}};return Confluence.AttachmentUploader({baseElement:e("#upload-attachment",i.baseElement)},o)}}},b,a={id:"attachments",createPanel:function(j,i){b=(i&&i(j))||h(j),c=j.addPanel("\u4E0A\u4F20\u56FE\u50CF",b.getPanel(),"attachments-panel");g=b.getUploaderController(j);d=g.getMessageHandler();j.imageContainerSupport.bindImageContainer(b.getContainer(),j);b.refreshWithLatestImages(f)},refresh:function(i){b.refreshWithLatestImages(f,i)},getImageContainer:function(){return b.getContainer()},clearErrors:function(){d.clearMessages()},displayErrors:function(){d.displayErrors()},setUploadInProgress:function(i,j){g.setUploadInProgress(i,j)}},f=e(a);Confluence.Editor.ImageDialog.panelComponent.push(a)});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:page-editor-js', location = 'js/insert-image-dialog-external.js' */
AJS.toInit(function(b){var a;var c=function(e){var g=function(){return b("#insert-web-image-form",e.baseElement)},f=function(){return b("input.image-url",e.baseElement)},d=function(){f().focus()};return{getForm:g,getContainer:function(){return b(".insert-web-image",e.baseElement)},getImageInput:f,getPanel:function(){return Confluence.Templates.Image.webPanel()},bindPanelSelection:function(){e.getPanel(a).onselect=d}}};Confluence.Editor.ImageDialog.panelComponent.push({id:"external",createPanel:function(g,e){var e=(e&&e(g))||c(g),d,f,h;a=g.addPanel("\u4ECE Web\u9875\u9762",e.getPanel(),"web-image-panel");f=e.getForm();d=e.getContainer();h=e.getImageInput();if(g.options&&g.options.imageProperties&&g.options.imageProperties.url){g.selectPanel(a);h.val(g.options.imageProperties.url).click();f.submit()}h.bind("keyup click",function(i){var j=b(this).val();g.clearSelection();g.selectedName=j;g.allowInsert(j!=""&&j!="http://")});f.submit(function(m){var n=h.val();if(n==="http://"){return false}var l=d.find(".image-preview-area"),k=d.find(".image-preview-throbber"),j=Raphael.spinner(k[0],60,"#666"),i=d.find(".image-preview-error");k.removeClass("hidden");l.addClass("faraway");i.addClass("hidden");l.html("");b("<img>").load(function(){j();k.addClass("hidden");l.removeClass("faraway")}).error(function(){j();k.addClass("hidden");i.removeClass("hidden")}).appendTo(l).attr("src",n);m.preventDefault();return false});e.bindPanelSelection()}})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:page-editor-js', location = 'js/insert-image-dialog-search.js' */
AJS.toInit(function(b){var a;var c=function(h){var i=function(){return b(".search-panel",h.baseElement)},j=function(){return b("#searched-images")},k=function(){return b(".search-form",h.baseElement)},g=function(){return b("input.search-image-text",k())},f=function(){return g().val()},e=function(){return b(".search-space",k()).val()},d=function(){g().focus()};return{clearContainer:function(){var l=j();l.find(".loading-message").removeClass("hidden");l.find(".image-list").empty();l.find(".warning").remove()},getPanelElement:i,getForm:k,getContainer:j,getSpaceKey:e,getQuery:f,getPanel:function(){return Confluence.Templates.Image.searchPanel({spaceKey:AJS.Meta.get("space-key"),spaceName:AJS.Meta.get("space-name")})},loadImages:function(l){b.ajax({type:"GET",dataType:"json",url:Confluence.getContextPath()+AJS.REST.getBaseUrl()+"search.json",data:{spaceKey:e(),query:f(),search:"name",type:"attachment",attachmentType:["image"],groupResults:false,searchParentName:true,pageSize:Confluence.Defaults.maxResults},success:l.success,error:l.error})},bindPanelSelection:function(){h.getPanel(a).onselect=d}}};Confluence.Editor.ImageDialog.panelComponent.push({id:"search",createPanel:function(f,d){var d=(d&&d(f))||c(f),e,g;a=f.addPanel("\u641C\u7D22",d.getPanel(),"search-panel");e=d.getForm();e.focusin(f.clearSelection);g=d.getContainer();e.submit(function(i){var h=d.getQuery();try{if(h){d.clearContainer();d.loadImages({success:function(k){if(k.result){d.clearContainer();var j=new Confluence.Highlighter(h.split(" "));f.imageContainerSupport.refreshImageList(f,{imageContainer:d.getContainer(),images:k.result,noImageMessage:"\u65E0\u641C\u7D22\u7ED3\u679C\u3002",justAttached:false,showParentTitle:true,highlighter:j})}},error:function(){g.find(".loading-message").addClass("hidden");g.append(b("<p></p>").addClass("warning").text("\u641C\u7D22\u9644\u4EF6\u51FA\u9519\uFF0C\u670D\u52A1\u5668\u53EF\u80FD\u80FD\u5DF2\u5931\u6548\u3002"))}})}}finally{i.preventDefault()}return false});d.bindPanelSelection();f.imageContainerSupport.bindImageContainer(g,f)}})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:page-editor-js', location = 'js/page-editor-drafts.js' */
Confluence.Editor.Drafts=(function(d){var a=false,c=false,b=function(h,i,g){d("<input>").attr({type:"hidden",name:h,value:i}).appendTo(g)};var e=function(j){var k=j.getHours();var g=j.getMinutes();var i=k>11?"PM":"AM";k=k%12;return(k==0?"12":k)+":"+(g<10?"0":"")+g+" "+i},f=function(h,g){Confluence.Editor.Drafts.unBindUnloadMessage();var i=Confluence.Editor.getCurrentForm();b(h,"true",i);b("contentChanged",""+Confluence.Editor.hasContentChanged(),i);b("pageId",AJS.params.pageId,i);AJS.$("#draftId",Confluence.Editor.getCurrentForm()).val(g);if(!i.spaceKey){b("spaceKey",AJS.Meta.get("space-key"),i)}i.action=AJS.Confluence.getContextPath()+"/pages/"+(AJS.params.newPage?"create":"edit")+AJS.params.draftType+".action";i.submit()};return{isDraftSaved:function(){return a},isDraftManuallySaved:function(){return c},isDraftBlank:function(){return AJS.Rte.Content.isEmpty()&&!d.trim(Confluence.Editor.getCurrentTitle())},unloadMessage:function(){var g=function(){if(Confluence.Editor.Drafts.isDraftBlank()){Confluence.Editor.Drafts.discardDraft(AJS.Meta.get("draft-id"));return false}else{Confluence.Editor.Drafts.save({skipErrorHandler:true});return true}};if(typeof seleniumAlert!=="undefined"){g();return}if(Confluence.Editor.hasContentChanged()||(Confluence.Editor.Drafts.isDraftSaved()&&!Confluence.Editor.Drafts.isDraftManuallySaved())){if(AJS.params.saveDrafts){g();return "\u8349\u7A3F\u5DF2\u4FDD\u5B58\uFF0C\u8BF7\u901A\u8FC7\'\u8349\u7A3F\'\u9875\u9762\u8BBF\u95EE\u3002"}else{if(Confluence.Editor.UI.isFormEnabled()&&Confluence.Editor.hasContentChanged()){return "\u8BC4\u8BBA\u5C06\u4E22\u5931\u3002"}}}},bindUnloadMessage:function(){d(window).bind("beforeunload.editor",Confluence.Editor.Drafts.unloadMessage)},unBindUnloadMessage:function(){d(window).unbind("beforeunload.editor")},useDraft:function(){f("useDraft",AJS.Meta.get("existing-draft-id"))},discardDraft:function(g){AJS.safeAjax({url:Confluence.getContextPath()+"/json/deletedraft.action",type:"GET",dataType:"json",data:{draftId:g},success:function(k){if(k.actionErrors){var j=["<ul>"],l=k.actionErrors;for(var h=0;h<l.length;h++){AJS.log("error: "+(l[h]));j.push("<li>"+l[h]+"</li>")}j.push("</ul>");AJS.messages.error("#editor-messages",{title:"Error",body:"There were errors discarding your draft: "+j.join("\n")})}else{AJS.$("#draft-messages").remove();AJS.messages.success("#editor-messages",{body:"Your draft has been discarded."})}},error:function(h){AJS.messages.error({title:"Error",body:h.errors||"An unknown error has occurred. Please check your logs."})}})},save:function(j){j=j||{};if(!AJS.params.saveDrafts||Confluence.Editor.isSubmitting||(!Confluence.Editor.hasContentChanged()&&!j.forceSave)){AJS.debug("skipping draft save");return}AJS.debug("preparing to save editor draft");var h=d("#content-title"),g=d("#newSpaceKey"),k=d("#originalVersion"),l=Confluence.Editor.inRichTextMode();var i={draftId:AJS.Meta.get("draft-id"),pageId:AJS.params.pageId,type:AJS.params.draftType,title:h.hasClass("placeholded")?"":h.val(),spaceKey:g.length?g.val():encodeURIComponent(AJS.Meta.get("space-key")),content:AJS.Rte.getEditor().getContent(),permissions:Confluence.Editor.getPagePermissions()};if(k.length){i.pageVersion=parseInt(k.val(),10)}var n=function(p){if(p==null){return}Confluence.Editor.contentHasChangedSinceLastSave=false;if(l){AJS.Rte.Content.editorResetContentChanged()}a=true;c=!!j.manualSave;AJS.Meta.set("draft-id",p.draftId);AJS.$("#draftId",Confluence.Editor.getCurrentForm()).val(p.draftId);d("#draft-error").remove();var o=d("#draft-status"),q=p.time||e(new Date());if(AJS.params.newPage){if(j.manualSave){o.html(AJS.format("\u8349\u7A3F\u4FDD\u5B58\u4E8E{0}",q))}else{o.html(AJS.format("Draft autosaved at {0}",q))}}else{if(j.manualSave){o.html(AJS.format("\u8349\u7A3F\u4FDD\u5B58\u4E8E{0}",q,"<a id='view-diff-link-heartbeat' class='view-diff-link' href='#'>","</a>"))}else{o.html(AJS.format("Draft autosaved at {0} ({1}view change{2})",q,"<a id='view-diff-link-heartbeat' class='view-diff-link' href='#'>","</a>"))}}if(!+AJS.Meta.get("content-id")){AJS.Meta.set("content-id",p.pageId)}if(d.isFunction(j.onSuccessHandler)){j.onSuccessHandler(p)}Confluence.Editor.Drafts.lastSaveTime=q;if(c){Confluence.Editor.UI.saveDraftButton.addClass("disabled");Confluence.Editor.UI.cancelButton.attr("value","close");Confluence.Editor.UI.cancelButton.text(AJS.Meta.get("cancel-button-close-text"))}};var m=function(o,p){if(j.skipErrorHandler){return}Confluence.Editor.addErrorMessage("draft-error",Confluence.Editor.Drafts.lastSaveTime?AJS.format("\u4FDD\u5B58\u8349\u7A3F\u5931\u8D25\uFF0C\u6700\u65B0\u7684\u8349\u7A3F\u4FDD\u5B58\u5728 {0}",Confluence.Editor.Drafts.lastSaveTime):"\u4FDD\u5B58\u8349\u7A3F\u5931\u8D25\uFF0C\u8349\u7A3F\u672A\u4FDD\u5B58\u3002",true);if(d.isFunction(j.onErrorHandler)){j.onErrorHandler(p)}};d.ajax({type:"POST",url:AJS.params.contextPath+"/rest/tinymce/1/drafts",data:d.toJSON(i),contentType:"application/json",dataType:"text json",success:n,error:m,timeout:30000})}}})(AJS.$);AJS.bind("init.rte",function(){Confluence.Editor.Drafts.bindUnloadMessage();var b=Confluence.Editor.UI.saveDraftButton;var c=function(d){if(d){b.text("\u6B63\u4FDD\u5B58\u2026")}else{b.text("Save Draft")}Confluence.Editor.UI.setButtonsState(!d)};AJS.$("#draft-messages").find("a.use-draft").click(function(d){Confluence.Editor.Drafts.useDraft();d.stopPropagation();return false});AJS.$("#draft-messages").find("a.discard-draft").click(function(d){Confluence.Editor.Drafts.discardDraft(AJS.Meta.get("existing-draft-id"));d.stopPropagation();return false});b.click(function(f){if(Confluence.Editor.UI.saveDraftButton.hasClass("disabled")){f.stopPropagation();return false}var d=function(){c(false)};c(true);setTimeout(function(){Confluence.Editor.Drafts.save({forceSave:true,onSuccessHandler:d,onErrorHandler:d,manualSave:true})},100);f.stopPropagation();return false});var a=function(){b.removeClass("disabled");if(b[0]){b[0].disabled=false}};b.addClass("disabled");AJS.Rte.getEditor().onChange.add(a);AJS.Rte.getEditor().onKeyDown.add(a);AJS.$("#content-title").bind("change keypress",a);if(AJS.params.saveDrafts){setInterval(Confluence.Editor.Drafts.save,+AJS.params.draftSaveInterval||30000)}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.resources:draft-changes-js', location = '/includes/js/draft-changes.js' */
AJS.toInit(function(e){var a,f;var h=function(j){a=new AJS.Dialog(860,530,"view-diff-draft-dialog");var k="\'{0}\'\u7684\u672A\u53D1\u5E03\u66F4\u65B0";a.addHeader(k.replace(/\{0\}/,""));var i=e(Confluence.Templates.DraftChanges.dialogContent());a.addPanel("Diff",i);if(j){a.addButton("\u7F16\u8F91",function(l){a.hide();if(Confluence.Editor&&Confluence.Editor.Drafts){Confluence.Editor.Drafts.useDraft()}else{window.location=e(this).attr("data-href")}},"resume-diff-link");a.addButton("\u53D6\u6D88",function(m){if(Confluence.Editor&&Confluence.Editor.Drafts){a.hide();Confluence.Editor.Drafts.discardDraft(AJS.Meta.get("existing-draft-id"))}else{var l=e(this).data("draftid");if(c(l)){a.hide()}}},"discard-diff-link")}a.addCancel("\u786E\u8BA4",function(){a.hide();return false});i.removeClass("hidden")};var d=function(l,j){e("#diff-view").html(l.htmlDiff);var m=AJS.format("\'\'{0}\'\'\u7684\u672A\u53D1\u5E03\u66F4\u65B0",AJS.escapeHtml(l.title));a.addHeader(m);a.popup.element.find(".dialog-title").prepend(Confluence.Templates.DraftChanges.helpLink());var k=e("#atlassian-token").attr("content");var i=Confluence.getContextPath();e(".resume-diff-link").attr("data-href",i+"/pages/resumedraft.action?draftId="+j);e(".discard-diff-link").data("draftid",j);AJS.setVisible("#merge-warning",l.isMergeRequired)};var g=function(k){var i,m,j;var l=function(o){var n=/draftPageId:([^ ]*)/.exec(o);i=n?n[1]:AJS.Meta.get("page-id");n=/username:([^ ]*)/.exec(o);m=n?n[1]:AJS.Meta.get("remote-user");n=/draftId:([^ ]*)/.exec(o);j=n?n[1]:null};l(k.attr("class"));AJS.safeAjax({url:Confluence.getContextPath()+"/draftchanges/viewdraftchanges.action",type:"GET",dataType:"json",data:{pageId:i,username:m},success:function(p){if(p.actionErrors){var o="";var q=p.actionErrors;for(var n=0;n<q.length;n++){AJS.log("error: "+(q[n]));o=o+"<div>"+q[n]+"</div>"}e("#diff-view").html(o)}else{d(p,j)}},error:function(n){var o=n.errors||"An unknown error has occurred. Please check your logs";e("#diff-view").html(o)}})};var b=function(j,i){if(!a){h(i)}a.addHeader("\u6B63\u5728\u8BFB\u53D6");e("#diff-view").html("<tr><td id='draft-changes-waiting-icon'>Loading...</td></tr>");g(j);a.show()};e("body").on("click","#draft-status .view-diff-link",function(i){b(e(this),false);return AJS.stopEvent(i)});e("body").on("click","#draft-messages .view-diff-link",function(i){b(e(this),true);return AJS.stopEvent(i)});e("#draft-space-list").on("click",".view-diff-link",function(i){b(e(this),true);return AJS.stopEvent(i)});var c=function(i){var j="Are you sure you want to discard this draft?";if(confirm(j)){AJS.safeAjax({url:Confluence.getContextPath()+"/json/deletedraft.action",type:"GET",dataType:"json",data:{draftId:i},success:function(o){if(o.actionErrors){var n=["<ul>"],q=o.actionErrors;for(var m=0;m<q.length;m++){AJS.log("error: "+(q[m]));n.push("<li>"+q[m]+"</li>")}n.push("</ul>");AJS.messages.error("#errors",{title:"Error",body:"There were errors discarding your draft."+" "+n.join("\n")})}else{var k=e("#draft-"+i);var l=k.closest("table");var p=l.closest(".drafts-container");k.remove();if(l.find("tbody tr").length==0){p.append('<span id="no-drafts-message">'+"\u672A\u627E\u5230\u8349\u7A3F\u3002"+"</span>")}}},error:function(k){AJS.messages.error({title:"Error",body:k.errors||"An unknown error has occurred. Please check your logs."})}});return true}return false};e(".discard-draft-link").click(function(j){j.preventDefault();var i=e(this).data("draftid");c(i)})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.resources:draft-changes-js', location = '/includes/soy/draft-changes-dialog.soy' */
// This file was automatically generated from draft-changes-dialog.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.DraftChanges == 'undefined') { Confluence.Templates.DraftChanges = {}; }


Confluence.Templates.DraftChanges.dialogContent = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="draft-changes-dialog" class="hidden"><div id="diff-view" class="wiki-content"></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.DraftChanges.helpLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  Confluence.Templates.Dialog.helpLink({href: "https://docs.atlassian.com/confluence/docs-55/Working+with+Drafts#viewchange"}, output);
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/tinymce.js' */
(function(d){var a=/^\s*|\s*$/g,e,c="B".replace(/A(.)|B/,"$1")==="$1";var b={majorVersion:"3",minorVersion:"4.9-atlassian-11",releaseDate:"2012-03-06",_init:function(){var y=this,u=document,s=navigator,g=s.userAgent,r,f,o,m,k,x;y.isOpera=d.opera&&opera.buildNumber;y.isWebKit=/WebKit/.test(g);y.isChrome=y.isWebKit&&/Chrome/.test(g);y.isIE11=!!(g.indexOf("Trident/")!=-1&&(g.indexOf("rv:")!=-1||s.appName.indexOf("Netscape")!=-1));y.isIE=!y.isWebKit&&!y.isOpera&&(/MSIE/gi).test(g)&&(/Explorer/gi).test(s.appName);y.isIE=y.isIE&&/MSIE (\w+)\./.exec(g)[1];y.isIE=y.isIE||y.isIE11;y.isIE6=y.isIE&&/MSIE [56]/.test(g);y.isIE7=y.isIE&&/MSIE [7]/.test(g);y.isIE8=y.isIE&&/MSIE [8]/.test(g);y.isIE9=y.isIE&&/MSIE [9]/.test(g);y.isIE10=y.isIE&&/MSIE \d\d/.test(g);y.isIE10up=y.isIE&&/MSIE \d\d/.test(g)||y.isIE11;y.isGecko=!y.isWebKit&&!y.isIE11&&/Gecko/.test(g);y.isMac=g.indexOf("Mac")!=-1;y.isAir=/adobeair/i.test(g);y.isIDevice=/(iPad|iPhone)/.test(g);y.isIOS5=y.isIDevice&&g.match(/AppleWebKit\/(\d*)/)[1]>=534;if(d.tinyMCEPreInit){y.suffix=tinyMCEPreInit.suffix;y.baseURL=tinyMCEPreInit.base;y.query=tinyMCEPreInit.query;return}y.suffix="";f=u.getElementsByTagName("base");for(r=0;r<f.length;r++){if(x=f[r].href){if(/^https?:\/\/[^\/]+$/.test(x)){x+="/"}m=x?x.match(/.*\//)[0]:""}}if(!m){var q=document.location;m=q.protocol+"//"+q.hostname+(q.port?":"+q.port:"")}function j(l){var i=/editor/.test(l);if(l&&/tiny_mce(|_gzip|_jquery|_prototype|_full)(_dev|_src)?.js/.test(l)||i){if(/_(src|dev)\.js/g.test(l)){y.suffix="_src"}if((k=l.indexOf("?"))!=-1){y.query=l.substring(k+1)}if(i){y.baseURL=l.substring(0,l.indexOf("/download/"))}else{y.baseURL=l.substring(0,l.lastIndexOf("/"))}if(m&&y.baseURL.indexOf("://")==-1&&y.baseURL.indexOf("/")!==0){y.baseURL=m+y.baseURL}if(i){y.baseURL+="/download/resources/com.atlassian.plugins.editor/tinymcesource"}return y.baseURL}return null}var h=AJS.Meta.get("rte.src.url");if(h){j(h)}else{f=u.getElementsByTagName("script");for(r=0;r<f.length;r++){if(j(f[r].src)){return}}o=u.getElementsByTagName("head")[0];if(o){f=o.getElementsByTagName("script");for(r=0;r<f.length;r++){if(j(f[r].src)){return}}}}return},is:function(g,f){if(!f){return g!==e}if(f=="array"&&(g.hasOwnProperty&&g instanceof Array)){return true}return typeof(g)==f},makeMap:function(f,j,h){var g;f=f||[];j=j||",";if(typeof(f)=="string"){f=f.split(j)}h=h||{};g=f.length;while(g--){h[f[g]]={}}return h},each:function(i,f,h){var j,g;if(!i){return 0}h=h||i;if(i.length!==e){for(j=0,g=i.length;j<g;j++){if(f.call(h,i[j],j,i)===false){return 0}}}else{for(j in i){if(i.hasOwnProperty(j)){if(f.call(h,i[j],j,i)===false){return 0}}}}return 1},map:function(g,h){var i=[];b.each(g,function(f){i.push(h(f))});return i},grep:function(g,h){var i=[];b.each(g,function(f){if(!h||h(f)){i.push(f)}});return i},inArray:function(g,h){var j,f;if(g){for(j=0,f=g.length;j<f;j++){if(g[j]===h){return j}}}return -1},extend:function(k,j){var h,g,f=arguments;for(h=1,g=f.length;h<g;h++){j=f[h];b.each(j,function(i,l){if(i!==e){k[l]=i}})}return k},trim:function(f){return(f?""+f:"").replace(a,"")},create:function(o,f,j){var n=this,g,i,k,l,h,m=0;o=/^((static) )?([\w.]+)(:([\w.]+))?/.exec(o);k=o[3].match(/(^|\.)(\w+)$/i)[2];i=n.createNS(o[3].replace(/\.\w+$/,""),j);if(i[k]){return}if(o[2]=="static"){i[k]=f;if(this.onCreate){this.onCreate(o[2],o[3],i[k])}return}if(!f[k]){f[k]=function(){};m=1}i[k]=f[k];n.extend(i[k].prototype,f);if(o[5]){g=n.resolve(o[5]).prototype;l=o[5].match(/\.(\w+)$/i)[1];h=i[k];if(m){i[k]=function(){return g[l].apply(this,arguments)}}else{i[k]=function(){this.parent=g[l];return h.apply(this,arguments)}}i[k].prototype[k]=i[k];n.each(g,function(p,q){i[k].prototype[q]=g[q]});n.each(f,function(p,q){if(g[q]){i[k].prototype[q]=function(){this.parent=g[q];return p.apply(this,arguments)}}else{if(q!=k){i[k].prototype[q]=p}}})}n.each(f["static"],function(p,q){i[k][q]=p});if(this.onCreate){this.onCreate(o[2],o[3],i[k].prototype)}},walk:function(i,h,j,g){g=g||this;if(i){if(j){i=i[j]}b.each(i,function(k,f){if(h.call(g,k,f,j)===false){return false}b.walk(k,h,j,g)})}},createNS:function(j,h){var g,f;h=h||d;j=j.split(".");for(g=0;g<j.length;g++){f=j[g];if(!h[f]){h[f]={}}h=h[f]}return h},resolve:function(j,h){var g,f;h=h||d;j=j.split(".");for(g=0,f=j.length;g<f;g++){h=h[j[g]];if(!h){break}}return h},addUnload:function(j,i){var h=this;j={func:j,scope:i||this};if(!h.unloads){function g(){var f=h.unloads,l,m;if(f){for(m in f){l=f[m];if(l&&l.func){l.func.call(l.scope,1)}}if(d.detachEvent){d.detachEvent("onbeforeunload",k);d.detachEvent("onunload",g)}else{if(d.removeEventListener){d.removeEventListener("unload",g,false)}}h.unloads=l=f=w=g=0;if(d.CollectGarbage){CollectGarbage()}}}function k(){var l=document;if(l.readyState=="interactive"){function f(){l.detachEvent("onstop",f);if(g){g()}l=0}if(l){l.attachEvent("onstop",f)}d.setTimeout(function(){if(l){l.detachEvent("onstop",f)}},0)}}if(d.attachEvent){d.attachEvent("onunload",g);d.attachEvent("onbeforeunload",k)}else{if(d.addEventListener){d.addEventListener("unload",g,false)}}h.unloads=[j]}else{h.unloads.push(j)}return j},removeUnload:function(i){var g=this.unloads,h=null;b.each(g,function(j,f){if(j&&j.func==i){g.splice(f,1);h=i;return false}});return h},explode:function(f,g){return f?b.map(f.split(g||","),b.trim):f},_addVer:function(g){var f;if(!this.query){return g}f=(g.indexOf("?")==-1?"?":"&")+this.query;if(g.indexOf("#")==-1){return g+f}return g.replace("#",f+"#")},_replace:function(h,f,g){if(c){return g.replace(h,function(){var l=f,j=arguments,k;for(k=0;k<j.length-2;k++){if(j[k]===e){l=l.replace(new RegExp("\\$"+k,"g"),"")}else{l=l.replace(new RegExp("\\$"+k,"g"),j[k])}}return l})}return g.replace(h,f)}};b._init();d.tinymce=d.tinyMCE=b})(window);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/util/Dispatcher.js' */
tinymce.create("tinymce.util.Dispatcher",{scope:null,listeners:null,Dispatcher:function(a){this.scope=a||this;this.listeners=[]},add:function(a,b){this.listeners.push({cb:a,scope:b||this.scope});return a},addToTop:function(a,b){this.listeners.unshift({cb:a,scope:b||this.scope});return a},remove:function(a){var b=this.listeners,c=null;tinymce.each(b,function(e,d){if(a==e.cb){c=a;b.splice(d,1);return false}});return c},dispatch:function(){var f,d=arguments,e,b=this.listeners,g;for(e=0;e<b.length;e++){g=b[e];f=g.cb.apply(g.scope,d.length>0?d:[g.scope]);if(f===false){break}}return f}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/util/URI.js' */
(function(){var a=tinymce.each;tinymce.create("tinymce.util.URI",{URI:function(e,g){var f=this,i,d,c,h;e=tinymce.trim(e);g=f.settings=g||{};if(/^([\w\-]+):([^\/]{2})/i.test(e)||/^\s*#/.test(e)){f.source=e;return}if(e.indexOf("/")===0&&e.indexOf("//")!==0){e=(g.base_uri?g.base_uri.protocol||"http":"http")+"://mce_host"+e}if(!/^[\w-]*:?\/\//.test(e)){h=g.base_uri?g.base_uri.path:new tinymce.util.URI(location.href).directory;e=((g.base_uri&&g.base_uri.protocol)||"http")+"://mce_host"+f.toAbsPath(h,e)}e=e.replace(/@@/g,"(mce_at)");e=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(e);a(["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],function(b,j){var k=e[j];if(k){k=k.replace(/\(mce_at\)/g,"@@")}f[b]=k});if(c=g.base_uri){if(!f.protocol){f.protocol=c.protocol}if(!f.userInfo){f.userInfo=c.userInfo}if(!f.port&&f.host=="mce_host"){f.port=c.port}if(!f.host||f.host=="mce_host"){f.host=c.host}f.source=""}},setPath:function(c){var b=this;c=/^(.*?)\/?(\w+)?$/.exec(c);b.path=c[0];b.directory=c[1];b.file=c[2];b.source="";b.getURI()},toRelative:function(b){var c=this,d;if(b==="./"){return b}b=new tinymce.util.URI(b,{base_uri:c});if((b.host!="mce_host"&&c.host!=b.host&&b.host)||c.port!=b.port||c.protocol!=b.protocol){return b.getURI()}d=c.toRelPath(c.path,b.path);if(b.query){d+="?"+b.query}if(b.anchor){d+="#"+b.anchor}return d},toAbsolute:function(b,c){var b=new tinymce.util.URI(b,{base_uri:this});return b.getURI(this.host==b.host&&this.protocol==b.protocol?c:0)},toRelPath:function(g,h){var c,f=0,d="",e,b;g=g.substring(0,g.lastIndexOf("/"));g=g.split("/");c=h.split("/");if(g.length>=c.length){for(e=0,b=g.length;e<b;e++){if(e>=c.length||g[e]!=c[e]){f=e+1;break}}}if(g.length<c.length){for(e=0,b=c.length;e<b;e++){if(e>=g.length||g[e]!=c[e]){f=e+1;break}}}if(f==1){return h}for(e=0,b=g.length-(f-1);e<b;e++){d+="../"}for(e=f-1,b=c.length;e<b;e++){if(e!=f-1){d+="/"+c[e]}else{d+=c[e]}}return d},toAbsPath:function(e,f){var c,b=0,h=[],d,g;d=/\/$/.test(f)?"/":"";e=e.split("/");f=f.split("/");a(e,function(i){if(i){h.push(i)}});e=h;for(c=f.length-1,h=[];c>=0;c--){if(f[c].length==0||f[c]=="."){continue}if(f[c]==".."){b++;continue}if(b>0){b--;continue}h.push(f[c])}c=e.length-b;if(c<=0){g=h.reverse().join("/")}else{g=e.slice(0,c).join("/")+"/"+h.reverse().join("/")}if(g.indexOf("/")!==0){g="/"+g}if(d&&g.lastIndexOf("/")!==g.length-1){g+=d}return g},getURI:function(d){var c,b=this;if(!b.source||d){c="";if(!d){if(b.protocol){c+=b.protocol+"://"}if(b.userInfo){c+=b.userInfo+"@"}if(b.host){c+=b.host}if(b.port){c+=":"+b.port}}if(b.path){c+=b.path}if(b.query){c+="?"+b.query}if(b.anchor){c+="#"+b.anchor}b.source=c}return b.source}})})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/util/Cookie.js' */
(function(){var a=tinymce.each;tinymce.create("static tinymce.util.Cookie",{getHash:function(d){var b=this.get(d),c;if(b){a(b.split("&"),function(e){e=e.split("=");c=c||{};c[unescape(e[0])]=unescape(e[1])})}return c},setHash:function(j,b,g,f,i,c){var h="";a(b,function(e,d){h+=(!h?"":"&")+escape(d)+"="+escape(e)});this.set(j,h,g,f,i,c)},get:function(i){var h=document.cookie,g,f=i+"=",d;if(!h){return}d=h.indexOf("; "+f);if(d==-1){d=h.indexOf(f);if(d!=0){return null}}else{d+=2}g=h.indexOf(";",d);if(g==-1){g=h.length}return unescape(h.substring(d+f.length,g))},set:function(i,b,g,f,h,c){document.cookie=i+"="+escape(b)+((g)?"; expires="+g.toGMTString():"")+((f)?"; path="+escape(f):"")+((h)?"; domain="+h:"")+((c)?"; secure":"")},remove:function(e,b){var c=new Date();c.setTime(c.getTime()-1000);this.set(e,"",c,b,c)}})})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/util/JSON.js' */
(function(){function serialize(o,quote){var i,v,t;quote=quote||'"';if(o==null){return"null"}t=typeof o;if(t=="string"){v="\bb\tt\nn\ff\rr\"\"''\\\\";return quote+o.replace(/([\u0080-\uFFFF\x00-\x1f\"\'\\])/g,function(a,b){if(quote==='"'&&a==="'"){return a}i=v.indexOf(b);if(i+1){return"\\"+v.charAt(i+1)}a=b.charCodeAt().toString(16);return"\\u"+"0000".substring(a.length)+a})+quote}if(t=="object"){if(o.hasOwnProperty&&o instanceof Array){for(i=0,v="[";i<o.length;i++){v+=(i>0?",":"")+serialize(o[i],quote)}return v+"]"}v="{";for(i in o){if(o.hasOwnProperty(i)){v+=typeof o[i]!="function"?(v.length>1?","+quote:quote)+i+quote+":"+serialize(o[i],quote):""}}return v+"}"}return""+o}tinymce.util.JSON={serialize:serialize,parse:function(s){try{return eval("("+s+")")}catch(ex){}}}})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/util/XHR.js' */
tinymce.create("static tinymce.util.XHR",{send:function(g){var a,e,b=window,h=0;g.scope=g.scope||this;g.success_scope=g.success_scope||g.scope;g.error_scope=g.error_scope||g.scope;g.async=g.async===false?false:true;g.data=g.data||"";function d(i){a=0;try{a=new ActiveXObject(i)}catch(c){}return a}a=b.XMLHttpRequest?new XMLHttpRequest():d("Microsoft.XMLHTTP")||d("Msxml2.XMLHTTP");if(a){if(a.overrideMimeType){a.overrideMimeType(g.content_type)}a.open(g.type||(g.data?"POST":"GET"),g.url,g.async);if(g.content_type){a.setRequestHeader("Content-Type",g.content_type)}a.setRequestHeader("X-Requested-With","XMLHttpRequest");a.send(g.data);function f(){if(!g.async||a.readyState==4||h++>10000){if(g.success&&h<10000&&a.status==200){g.success.call(g.success_scope,""+a.responseText,a,g)}else{if(g.error){g.error.call(g.error_scope,h>10000?"TIMED_OUT":"GENERAL",a,g)}}a=null}else{b.setTimeout(f,10)}}if(!g.async){return f()}e=b.setTimeout(f,10)}}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/util/JSONRequest.js' */
(function(){var c=tinymce.extend,b=tinymce.util.JSON,a=tinymce.util.XHR;tinymce.create("tinymce.util.JSONRequest",{JSONRequest:function(d){this.settings=c({},d);this.count=0},send:function(f){var e=f.error,d=f.success;f=c(this.settings,f);f.success=function(h,g){h=b.parse(h);if(typeof(h)=="undefined"){h={error:"JSON Parse error."}}if(h.error){e.call(f.error_scope||f.scope,h.error,g)}else{d.call(f.success_scope||f.scope,h.result)}};f.error=function(h,g){if(e){e.call(f.error_scope||f.scope,h,g)}};f.data=b.serialize({id:f.id||"c"+(this.count++),method:f.method,params:f.params});f.content_type="application/json";a.send(f)},"static":{sendRPC:function(d){return new tinymce.util.JSONRequest().send(d)}}})}());
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/util/VK.js' */
(function(a){a.VK={DELETE:46,BACKSPACE:8,ENTER:13,TAB:9,SPACEBAR:32,UP:38,DOWN:40,modifierPressed:function(b){return b.shiftKey||b.ctrlKey||b.altKey}}})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/util/Quirks.js' */
(function(m){var k=m.VK,l=k.BACKSPACE,i=k.DELETE;function c(o){var s=o.dom,q=o.selection;function r(t,u){var v;v=s.getParent(t.startContainer,s.isBlock);if(u){return[v,s.getNext(v,s.isBlock)]}return[s.getPrev(v,s.isBlock),v]}function p(t,u){AJS.$(t).find(".non-editable").attr("contenteditable",u)}o.onKeyDown.add(function(u,x){var t,y,w;w=x.keyCode==i;if((w||x.keyCode==l)&&!k.modifierPressed(x)){x.preventDefault();t=q.getRng();y=r(t,w);m.each(AJS.$(y).find("span"),function(z){z.setAttribute("data-mce-mark","1")});var v=!w&&y[1]&&AJS.EditorUtils.isCursorAtStartOf(y[1],t)||w&&y[0]&&AJS.EditorUtils.isCursorAtEndOf(y[0],t);v&&p(y[1],true);u.getDoc().execCommand(w?"ForwardDelete":"Delete",false,null);v&&p(y,false);m.each(AJS.$(y).find("span"),function(z){if(!z.getAttribute("data-mce-mark")){if(z.style.color){AJS.$(z).attr("style",("color: "+z.style.color))}else{s.remove(z,true)}}else{z.removeAttribute("data-mce-mark")}})}})}function d(o){function p(s){var r=o.dom.create("body");var t=s.cloneContents();r.appendChild(t);return o.selection.serializer.serialize(r,{format:"html"})}function q(r){var t=p(r);var u=o.dom.createRng();u.selectNode(o.getBody());var s=p(u);return t===s}o.onKeyDown.addToTop(function(s,u){var t=u.keyCode;if(t==i||t==l){var r=s.selection.getRng(true);if(!r.collapsed&&q(r)){s.setContent("",{format:"raw"});s.nodeChanged();u.preventDefault()}}})}function b(o){o.dom.bind(o.getDoc(),"focusin",function(){setTimeout(function(){o.selection.setRng(o.selection.getRng())},0)})}function e(o){o.onKeyDown.add(function(p,s){if(s.keyCode===l){if(p.selection.isCollapsed()&&p.selection.getRng(true).startOffset===0){var r=p.selection.getNode();var q=r.previousSibling;if(q&&q.nodeName&&q.nodeName.toLowerCase()==="hr"){p.dom.remove(q);m.dom.Event.cancel(s)}}}})}function f(o){function p(v){return v.parentNode?v.parentNode.childNodes||[]:[]}function u(v){var x=true,w=/TABLE|TH|TD/;x=!w.test(v.nodeName);x=(x&&v.previousSibling)?!w.test(v.previousSibling.nodeName):x;x=(x&&v.nextSibling)?!w.test(v.nextSibling.nodeName):x;return x}function r(v,x,w){var y=/^&nbsp;$|^<br>$/,z;w=w||x;z=p(w);return u(x)&&(y.test(v)||(z.length>1&&z[0].nodeName=="BR"))}function t(v,w){v.dom.remove(w)}function s(w,x){var y=w.selection,v=y.getRng(true);w.focus();x.focus();v.setStart(x,0);v.setEnd(x,0);y.setRng(v)}function q(v){return v&&v.innerHTML&&(v.innerHTML.replace(/\uFEFF|\u200B/g,"")||"&nbsp;")}o.onKeyDown.add(function(x,C){var z=x.selection.getNode(),A=z.nextSibling,w=x.selection.isCollapsed(),v,B,y;if(w&&z!=x.dom.getRoot()){if(C.keyCode===l){if(x.selection.getRng(true).startOffset===0){v=z.previousSibling;B=q(v);if(v&&r(B,z,v)){t(x,v);m.dom.Event.cancel(C)}}}else{if(C.keyCode==i){B=q(z);y=z.innerText||z.textContent||"";if(p(z).length<=1||z.childNodes.length>1){return}if(A&&r(B,z,A)){t(x,z);m.dom.Event.cancel(C);s(x,A)}}}}})}function h(o){if(!Range.prototype.getClientRects){o.onMouseDown.add(function(q,r){if(r.target.nodeName==="HTML"){var p=q.getBody();p.blur();setTimeout(function(){p.focus()},0)}})}}function g(o){o.onClick.add(function(p,q){q=q.target;if(/^(IMG|HR)$/.test(q.nodeName)){p.selection.getSel().setBaseAndExtent(q,0,q,1)}if(q.nodeName=="A"&&p.dom.hasClass(q,"mceItemAnchor")){p.selection.select(q)}p.nodeChanged()})}function j(o){o.onKeyDown.add(function(p,q){function r(s){var t=s.selection.getNode();var u="h1,h2,h3,h4,h5,h6";return s.dom.is(t,u)||s.dom.getParent(t,u)!==null}if(q.keyCode===k.ENTER&&!k.modifierPressed(q)&&r(p)){setTimeout(function(){var s=p.selection.getNode();if(p.dom.is(s,"p")){p.dom.setAttrib(s,"style",null);p.execCommand("mceCleanup")}},0)}})}function g(o){o.onClick.add(function(p,q){q=q.target;if(/^(IMG|HR)$/.test(q.nodeName)){p.selection.getSel().setBaseAndExtent(q,0,q,1)}if(q.nodeName=="A"&&p.dom.hasClass(q,"mceItemAnchor")){p.selection.select(q)}p.nodeChanged()})}function a(o){document.body.setAttribute("role","application")}function n(o){var q,p;o.dom.bind(o.getDoc(),"selectionchange",function(){if(p){clearTimeout(p);p=0}p=window.setTimeout(function(){var r=o.selection.getRng();if(!q||!m.dom.RangeUtils.compareRanges(r,q)){o.nodeChanged();q=r}},50)})}function a(o){document.body.setAttribute("role","application")}m.create("tinymce.util.Quirks",{Quirks:function(o){if(m.isWebKit){if(m.isChrome){c(o)}d(o);b(o);g(o);if(m.isIDevice){n(o)}f(o)}if(m.isIE){e(o);d(o);a(o);j(o);f(o)}if(m.isGecko){e(o);f(o);h(o)}}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/html/Entities.js' */
(function(j){var a,g,d,k=/[&<>\"\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,b=/[<>&\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,f=/[<>&\"\']/g,c=/&(#x|#)?([\w]+);/g,i={128:"\u20AC",130:"\u201A",131:"\u0192",132:"\u201E",133:"\u2026",134:"\u2020",135:"\u2021",136:"\u02C6",137:"\u2030",138:"\u0160",139:"\u2039",140:"\u0152",142:"\u017D",145:"\u2018",146:"\u2019",147:"\u201C",148:"\u201D",149:"\u2022",150:"\u2013",151:"\u2014",152:"\u02DC",153:"\u2122",154:"\u0161",155:"\u203A",156:"\u0153",158:"\u017E",159:"\u0178"};g={'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;","&":"&amp;"};d={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&apos;":"'"};function h(l){var m;m=document.createElement("div");m.innerHTML=l;return m.textContent||m.innerText||l}function e(m,p){var n,o,l,q={};if(m){m=m.split(",");p=p||10;for(n=0;n<m.length;n+=2){o=String.fromCharCode(parseInt(m[n],p));if(!g[o]){l="&"+m[n+1]+";";q[o]=l;q[l]=o}}return q}}a=e("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32);j.html=j.html||{};j.html.Entities={encodeRaw:function(m,l){return m.replace(l?k:b,function(n){return g[n]||n})},encodeAllRaw:function(l){return(""+l).replace(f,function(m){return g[m]||m})},encodeNumeric:function(m,l){return m.replace(l?k:b,function(n){if(n.length>1){return"&#"+(((n.charCodeAt(0)-55296)*1024)+(n.charCodeAt(1)-56320)+65536)+";"}return g[n]||"&#"+n.charCodeAt(0)+";"})},encodeNamed:function(n,l,m){m=m||a;return n.replace(l?k:b,function(o){return g[o]||m[o]||o})},getEncodeFunc:function(l,o){var p=j.html.Entities;o=e(o)||a;function m(r,q){return r.replace(q?k:b,function(s){return g[s]||o[s]||"&#"+s.charCodeAt(0)+";"||s})}function n(r,q){return p.encodeNamed(r,q,o)}l=j.makeMap(l.replace(/\+/g,","));if(l.named&&l.numeric){return m}if(l.named){if(o){return n}return p.encodeNamed}if(l.numeric){return p.encodeNumeric}return p.encodeRaw},decode:function(l){return l.replace(c,function(n,m,o){if(m){o=parseInt(o,m.length===2?16:10);if(o>65535){o-=65536;return String.fromCharCode(55296+(o>>10),56320+(o&1023))}else{return i[o]||String.fromCharCode(o)}}return d[n]||a[n]||h(n)})}}})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/html/Styles.js' */
tinymce.html.Styles=function(d,f){var k=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/gi,h=/(?:url(?:(?:\(\s*\"([^\"]+)\"\s*\))|(?:\(\s*\'([^\']+)\'\s*\))|(?:\(\s*([^)\s]+)\s*\))))|(?:\'([^\']+)\')|(?:\"([^\"]+)\")/gi,b=/\s*([^:]+):\s*([^;]+);?/g,l=/\s+$/,m=/rgb/,e,g,a={},j;d=d||{};j="\\\" \\' \\; \\: ; : \uFEFF".split(" ");for(g=0;g<j.length;g++){a[j[g]]="\uFEFF"+g;a["\uFEFF"+g]=j[g]}function c(n,q,p,i){function o(r){r=parseInt(r).toString(16);return r.length>1?r:"0"+r}return"#"+o(q)+o(p)+o(i)}return{toHex:function(i){return i.replace(k,c)},parse:function(r){var x={},p,n,v,q,u=d.url_converter,w=d.url_converter_scope||this;function o(B,E){var D,A,z,C;D=x[B+"-top"+E];if(!D){return}A=x[B+"-right"+E];if(D!=A){return}z=x[B+"-bottom"+E];if(A!=z){return}C=x[B+"-left"+E];if(z!=C){return}x[B+E]=C;delete x[B+"-top"+E];delete x[B+"-right"+E];delete x[B+"-bottom"+E];delete x[B+"-left"+E]}function t(A){var B=x[A],z;if(!B||B.indexOf(" ")<0){return}B=B.split(" ");z=B.length;while(z--){if(B[z]!==B[0]){return false}}x[A]=B[0];return true}function y(B,A,z,C){if(!t(A)){return}if(!t(z)){return}if(!t(C)){return}x[B]=x[A]+" "+x[z]+" "+x[C];delete x[A];delete x[z];delete x[C]}function s(z){q=true;return a[z]}function i(A,z){if(q){A=A.replace(/\uFEFF[0-9]/g,function(B){return a[B]})}if(!z){A=A.replace(/\\([\'\";:])/g,"$1")}return A}if(r){r=r.replace(/\\[\"\';:\uFEFF]/g,s).replace(/\"[^\"]+\"|\'[^\']+\'/g,function(z){return z.replace(/[;:]/g,s)});while(p=b.exec(r)){n=p[1].replace(l,"").toLowerCase();v=p[2].replace(l,"");if(n&&v.length>0){if(n==="font-weight"&&v==="700"){v="bold"}else{if(n==="color"||n==="background-color"){v=v.toLowerCase()}}v=v.replace(k,c);v=v.replace(h,function(A,z,D,C,E,B){E=E||B;if(E){E=i(E);return"'"+E.replace(/\'/g,"\\'")+"'"}z=i(z||D||C);if(u){z=u.call(w,z,"style")}return"url('"+z.replace(/\'/g,"\\'")+"')"});x[n]=q?i(v,true):v}b.lastIndex=p.index+p[0].length}o("border","");o("border","-width");o("border","-color");o("border","-style");o("padding","");o("margin","");y("border","border-width","border-style","border-color");if(x.border==="medium none"){delete x.border}}return x},serialize:function(p,r){var o="",n,q;function i(t){var w,u,s,v;w=f.styles[t];if(w){for(u=0,s=w.length;u<s;u++){t=w[u];v=p[t];if(v!==e&&v.length>0){o+=(o.length>0?" ":"")+t+": "+v+";"}}}}if(r&&f&&f.styles){i("*");i(r)}else{for(n in p){q=p[n];if(q!==e&&q.length>0){o+=(o.length>0?" ":"")+n+": "+q+";"}}}return o}}};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/html/Schema.js' */
(function(m){var h={},j,l,g,f,c={},b,e,d=m.makeMap,k=m.each;function i(o,n){return o.split(n||",")}function a(r,q){var o,p={};function n(s){return s.replace(/[A-Z]+/g,function(t){return n(r[t])})}for(o in r){if(r.hasOwnProperty(o)){r[o]=n(r[o])}}n(q).replace(/#/g,"#text").replace(/(\w+)\[([^\]]+)\]\[([^\]]*)\]/g,function(v,t,s,u){s=i(s,"|");p[t]={attributes:d(s),attributesOrder:s,children:d(u,"|",{"#comment":{}})}});return p}l="h1,h2,h3,h4,h5,h6,hr,p,div,address,pre,form,table,tbody,thead,tfoot,th,tr,td,li,ol,ul,caption,blockquote,center,dl,dt,dd,dir,fieldset,noscript,menu,isindex,samp,header,footer,article,section,hgroup";l=d(l,",",d(l.toUpperCase()));h=a({Z:"H|K|N|O|P",Y:"X|form|R|Q",ZG:"E|span|width|align|char|charoff|valign",X:"p|T|div|U|W|isindex|fieldset|table",ZF:"E|align|char|charoff|valign",W:"pre|hr|blockquote|address|center|noframes",ZE:"abbr|axis|headers|scope|rowspan|colspan|align|char|charoff|valign|nowrap|bgcolor|width|height",ZD:"[E][S]",U:"ul|ol|dl|menu|dir",ZC:"p|Y|div|U|W|table|br|span|bdo|object|applet|img|map|K|N|Q",T:"h1|h2|h3|h4|h5|h6",ZB:"X|S|Q",S:"R|P",ZA:"a|G|J|M|O|P",R:"a|H|K|N|O",Q:"noscript|P",P:"ins|del|script",O:"input|select|textarea|label|button",N:"M|L",M:"em|strong|dfn|code|q|samp|kbd|var|cite|abbr|acronym",L:"sub|sup",K:"J|I",J:"tt|i|b|u|s|strike",I:"big|small|font|basefont",H:"G|F",G:"br|span|bdo",F:"object|applet|img|map|iframe",E:"A|B|C",D:"accesskey|tabindex|onfocus|onblur",C:"onclick|ondblclick|onmousedown|onmouseup|onmouseover|onmousemove|onmouseout|onkeypress|onkeydown|onkeyup",B:"lang|xml:lang|dir",A:"id|class|style|title"},"script[id|charset|type|language|src|defer|xml:space][]style[B|id|type|media|title|xml:space][]object[E|declare|classid|codebase|data|type|codetype|archive|standby|width|height|usemap|name|tabindex|align|border|hspace|vspace][#|param|Y]param[id|name|value|valuetype|type][]p[E|align][#|S]a[E|D|charset|type|name|href|hreflang|rel|rev|shape|coords|target][#|Z]br[A|clear][]span[E][#|S]bdo[A|C|B][#|S]applet[A|codebase|archive|code|object|alt|name|width|height|align|hspace|vspace][#|param|Y]h1[E|align][#|S]img[E|src|alt|name|longdesc|width|height|usemap|ismap|align|border|hspace|vspace][]map[B|C|A|name][X|form|Q|area]h2[E|align][#|S]iframe[A|longdesc|name|src|frameborder|marginwidth|marginheight|scrolling|align|width|height][#|Y]h3[E|align][#|S]tt[E][#|S]i[E][#|S]b[E][#|S]u[E][#|S]s[E][#|S]strike[E][#|S]big[E][#|S]small[E][#|S]font[A|B|size|color|face][#|S]basefont[id|size|color|face][]em[E][#|S]strong[E][#|S]dfn[E][#|S]code[E][#|S]q[E|cite][#|S]samp[E][#|S]kbd[E][#|S]var[E][#|S]cite[E][#|S]abbr[E][#|S]acronym[E][#|S]sub[E][#|S]sup[E][#|S]input[E|D|type|name|value|checked|disabled|readonly|size|maxlength|src|alt|usemap|onselect|onchange|accept|align][]select[E|name|size|multiple|disabled|tabindex|onfocus|onblur|onchange][optgroup|option]optgroup[E|disabled|label][option]option[E|selected|disabled|label|value][]textarea[E|D|name|rows|cols|disabled|readonly|onselect|onchange][]label[E|for|accesskey|onfocus|onblur][#|S]button[E|D|name|value|type|disabled][#|p|T|div|U|W|table|G|object|applet|img|map|K|N|Q]h4[E|align][#|S]ins[E|cite|datetime][#|Y]h5[E|align][#|S]del[E|cite|datetime][#|Y]h6[E|align][#|S]div[E|align][#|Y]ul[E|type|compact][li]li[E|type|value][#|Y]ol[E|type|compact|start][li]dl[E|compact][dt|dd]dt[E][#|S]dd[E][#|Y]menu[E|compact][li]dir[E|compact][li]pre[E|width|xml:space][#|ZA]hr[E|align|noshade|size|width][]blockquote[E|cite][#|Y]address[E][#|S|p]center[E][#|Y]noframes[E][#|Y]isindex[A|B|prompt][]fieldset[E][#|legend|Y]legend[E|accesskey|align][#|S]table[E|summary|width|border|frame|rules|cellspacing|cellpadding|align|bgcolor][caption|col|colgroup|thead|tfoot|tbody|tr]caption[E|align][#|S]col[ZG][]colgroup[ZG][col]thead[ZF][tr]tr[ZF|bgcolor][th|td]th[E|ZE][#|Y]form[E|action|method|name|enctype|onsubmit|onreset|accept|accept-charset|target][#|X|R|Q]noscript[E][#|Y]td[E|ZE][#|Y]tfoot[ZF][tr]tbody[ZF][tr]area[E|D|shape|coords|href|nohref|alt|target][]base[id|href|target][]body[E|onload|onunload|background|bgcolor|text|link|vlink|alink][#|Y]");j=d("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected,autoplay,loop,controls");g=d("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed,source");f=m.extend(d("td,th,iframe,video,audio,object"),g);b=d("pre,script,style,textarea,code");e=d("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr");m.html.Schema=function(r){var z=this,n={},o={},x=[],q,p;r=r||{};if(r.verify_html===false){r.valid_elements="*[*]"}if(r.valid_styles){q={};k(r.valid_styles,function(B,A){q[A]=m.explode(B)})}p=r.whitespace_elements?d(r.whitespace_elements):b;function y(A){return new RegExp("^"+A.replace(/([?+*])/g,".$1")+"$")}function t(H){var G,C,V,R,W,B,E,Q,T,M,U,Y,K,F,S,A,O,D,X,Z,L,P,J=/^([#+-])?([^\[\/]+)(?:\/([^\[]+))?(?:\[([^\]]+)\])?$/,N=/^([!\-])?(\w+::\w+|[^=:<]+)?(?:([=:<])(.*))?$/,I=/[*?+]/;if(H){H=i(H);if(n["@"]){O=n["@"].attributes;D=n["@"].attributesOrder}for(G=0,C=H.length;G<C;G++){B=J.exec(H[G]);if(B){S=B[1];M=B[2];A=B[3];T=B[4];K={};F=[];E={attributes:K,attributesOrder:F};if(S==="#"){E.paddEmpty=true}if(S==="-"){E.removeEmpty=true}if(O){for(Z in O){K[Z]=O[Z]}F.push.apply(F,D)}if(T){T=i(T,"|");for(V=0,R=T.length;V<R;V++){B=N.exec(T[V]);if(B){Q={};Y=B[1];U=B[2].replace(/::/g,":");S=B[3];P=B[4];if(Y==="!"){E.attributesRequired=E.attributesRequired||[];E.attributesRequired.push(U);Q.required=true}if(Y==="-"){delete K[U];F.splice(m.inArray(F,U),1);continue}if(S){if(S==="="){E.attributesDefault=E.attributesDefault||[];E.attributesDefault.push({name:U,value:P});Q.defaultValue=P}if(S===":"){E.attributesForced=E.attributesForced||[];E.attributesForced.push({name:U,value:P});Q.forcedValue=P}if(S==="<"){Q.validValues=d(P,"?")}}if(I.test(U)){E.attributePatterns=E.attributePatterns||[];Q.pattern=y(U);E.attributePatterns.push(Q)}else{if(!K[U]){F.push(U)}K[U]=Q}}}}if(!O&&M=="@"){O=K;D=F}if(A){E.outputName=M;n[A]=E}if(I.test(M)){E.pattern=y(M);x.push(E)}else{n[M]=E}}}}}function v(A){n={};x=[];t(A);k(h,function(C,B){o[B]=C.children})}function s(B){var A=/^(~)?(.+)$/;if(B){k(i(B),function(F){var D=A.exec(F),E=D[1]==="~",G=E?"span":"div",C=D[2];o[C]=o[G];c[C]=G;if(!E){l[C]={}}k(o,function(H,I){if(H[G]){H[C]=H[G]}})})}}function u(B){var A=/^([+\-]?)(\w+)\[([^\]]+)\]$/;if(B){k(i(B),function(F){var E=A.exec(F),C,D;if(E){D=E[1];if(D){C=o[E[2]]}else{C=o[E[2]]={"#comment":{}}}C=o[E[2]];k(i(E[3],"|"),function(G){if(D==="-"){delete C[G]}else{C[G]={}}})}})}}function w(A){var C=n[A],B;if(C){return C}B=x.length;while(B--){C=x[B];if(C.pattern.test(A)){return C}}}if(!r.valid_elements){k(h,function(B,A){n[A]={attributes:B.attributes,attributesOrder:B.attributesOrder};o[A]=B.children});k(i("strong/b,em/i"),function(A){A=i(A,"/");n[A[1]].outputName=A[0]});n.img.attributesDefault=[{name:"alt",value:""}];k(i("ol,ul,sub,sup,blockquote,span,font,a,table,tbody,tr"),function(A){n[A].removeEmpty=true});k(i("p,h1,h2,h3,h4,h5,h6,th,td,pre,div,address,caption"),function(A){n[A].paddEmpty=true})}else{v(r.valid_elements)}s(r.custom_elements);u(r.valid_children);t(r.extended_valid_elements);u("+ol[ul|ol],+ul[ul|ol]");if(!w("span")){t("span[!data-mce-type|*]")}if(r.invalid_elements){m.each(m.explode(r.invalid_elements),function(A){if(n[A]){delete n[A]}})}z.children=o;z.styles=q;z.getBoolAttrs=function(){return j};z.getBlockElements=function(){return l};z.getShortEndedElements=function(){return g};z.getSelfClosingElements=function(){return e};z.getNonEmptyElements=function(){return f};z.getWhiteSpaceElements=function(){return p};z.isValidChild=function(A,C){var B=o[A];return !!(B&&B[C])};z.getElementRule=w;z.getCustomElements=function(){return c};z.addValidElements=t;z.setValidElements=v;z.addCustomElements=s;z.addValidChildren=u};m.html.Schema.boolAttrMap=j;m.html.Schema.blockElementsMap=l})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/html/SaxParser.js' */
(function(a){a.html.SaxParser=function(c,e){var b=this,d=function(){};c=c||{};b.schema=e=e||new a.html.Schema();if(c.fix_self_closing!==false){c.fix_self_closing=true}a.each("comment cdata text start end pi doctype".split(" "),function(f){if(f){b[f]=c[f]||d}});b.parse=function(C){var n=this,g,E=0,G,z,y=[],L,O,A,q,x,r,K,F,M,u,m,k,s,P,o,N,D,Q,J,f,H,l,B,I,h,v=0,j=a.html.Entities.decode,w,p;function t(R){var T,S;T=y.length;while(T--){if(y[T].name===R){break}}if(T>=0){for(S=y.length-1;S>=T;S--){R=y[S];if(R.valid){n.end(R.name)}}y.length=T}}l=new RegExp("<(?:(?:!--([\\w\\W]*?)-->)|(?:!\\[CDATA\\[([\\w\\W]*?)\\]\\]>)|(?:!DOCTYPE([\\w\\W]*?)>)|(?:\\?([^\\s\\/<>]+) ?([\\w\\W]*?)[?/]>)|(?:\\/([^>]+)>)|(?:([^\\s\\/<>]+)((?:\\s+[^\"'>]+(?:(?:\"[^\"]*\")|(?:'[^']*')|[^>]*))*|\\/)>))","g");B=/([\w:\-]+)(?:\s*=\s*(?:(?:\"((?:\\.|[^\"])*)\")|(?:\'((?:\\.|[^\'])*)\')|([^>\s]+)))?/g;I={script:/<\/script[^>]*>/gi,style:/<\/style[^>]*>/gi,noscript:/<\/noscript[^>]*>/gi};K=e.getShortEndedElements();H=e.getSelfClosingElements();F=e.getBoolAttrs();u=c.validate;r=c.remove_internals;w=c.fix_self_closing;p=a.isIE;o=/^:/;while(g=l.exec(C)){if(E<g.index){n.text(j(C.substr(E,g.index-E)))}if(G=g[6]){G=G.toLowerCase();if(p&&o.test(G)){G=G.substr(1)}t(G)}else{if(G=g[7]){G=G.toLowerCase();if(p&&o.test(G)){G=G.substr(1)}M=G in K;if(w&&H[G]&&y.length>0&&y[y.length-1].name===G){t(G)}if(!u||(m=e.getElementRule(G))){k=true;if(u){N=m.attributes;D=m.attributePatterns}if(P=g[8]){x=P.indexOf("data-mce-type")!==-1;if(x&&r){k=false}L=[];L.map={};P.replace(B,function(S,R,W,V,U){var X,T;R=R.toLowerCase();W=R in F?R:j(W||V||U||"");if(u&&!x&&R.indexOf("data-")!==0){X=N[R];if(!X&&D){T=D.length;while(T--){X=D[T];if(X.pattern.test(R)){break}}if(T===-1){X=null}}if(!X){return}if(X.validValues&&!(W in X.validValues)){return}}L.map[R]=W;L.push({name:R,value:W})})}else{L=[];L.map={}}if(u&&!x){Q=m.attributesRequired;J=m.attributesDefault;f=m.attributesForced;if(f){O=f.length;while(O--){s=f[O];q=s.name;h=s.value;if(h==="{$uid}"){h="mce_"+v++}L.map[q]=h;L.push({name:q,value:h})}}if(J){O=J.length;while(O--){s=J[O];q=s.name;if(!(q in L.map)){h=s.value;if(h==="{$uid}"){h="mce_"+v++}L.map[q]=h;L.push({name:q,value:h})}}}if(Q){O=Q.length;while(O--){if(Q[O] in L.map){break}}if(O===-1){k=false}}if(L.map["data-mce-bogus"]){k=false}}if(k){n.start(G,L,M)}}else{k=false}if(z=I[G]){z.lastIndex=E=g.index+g[0].length;if(g=z.exec(C)){if(k){A=C.substr(E,g.index-E)}E=g.index+g[0].length}else{A=C.substr(E);E=C.length}if(k&&A.length>0){n.text(A,true)}if(k){n.end(G)}l.lastIndex=E;continue}if(!M){if(!P||P.indexOf("/")!=P.length-1){y.push({name:G,valid:k})}else{if(k){n.end(G)}}}}else{if(G=g[1]){n.comment(G)}else{if(G=g[2]){n.cdata(G)}else{if(G=g[3]){n.doctype(G)}else{if(G=g[4]){n.pi(G,g[5])}}}}}}E=g.index+g[0].length}if(E<C.length){n.text(j(C.substr(E)))}for(O=y.length-1;O>=0;O--){G=y[O];if(G.valid){n.end(G.name)}}}}})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/html/Node.js' */
(function(d){var c=/^[ \t\r\n]*$/,e={"#text":3,"#comment":8,"#cdata":4,"#pi":7,"#doctype":10,"#document-fragment":11};function a(k,l,j){var i,h,f=j?"lastChild":"firstChild",g=j?"prev":"next";if(k[f]){return k[f]}if(k!==l){i=k[g];if(i){return i}for(h=k.parent;h&&h!==l;h=h.parent){i=h[g];if(i){return i}}}}function b(f,g){this.name=f;this.type=g;if(g===1){this.attributes=[];this.attributes.map={}}}d.extend(b.prototype,{replace:function(g){var f=this;if(g.parent){g.remove()}f.insert(g,f);f.remove();return f},attr:function(h,l){var f=this,g,j,k;if(typeof h!=="string"){for(j in h){f.attr(j,h[j])}return f}if(g=f.attributes){if(l!==k){if(l===null){if(h in g.map){delete g.map[h];j=g.length;while(j--){if(g[j].name===h){g=g.splice(j,1);return f}}}return f}if(h in g.map){j=g.length;while(j--){if(g[j].name===h){g[j].value=l;break}}}else{g.push({name:h,value:l})}g.map[h]=l;return f}else{return g.map[h]}}},clone:function(){var g=this,n=new b(g.name,g.type),h,f,m,j,k;if(m=g.attributes){k=[];k.map={};for(h=0,f=m.length;h<f;h++){j=m[h];if(j.name!=="id"){k[k.length]={name:j.name,value:j.value};k.map[j.name]=j.value}}n.attributes=k}n.value=g.value;n.shortEnded=g.shortEnded;return n},wrap:function(g){var f=this;f.parent.insert(g,f);g.append(f);return f},unwrap:function(){var f=this,h,g;for(h=f.firstChild;h;){g=h.next;f.insert(h,f,true);h=g}f.remove()},remove:function(){var f=this,h=f.parent,g=f.next,i=f.prev;if(h){if(h.firstChild===f){h.firstChild=g;if(g){g.prev=null}}else{i.next=g}if(h.lastChild===f){h.lastChild=i;if(i){i.next=null}}else{g.prev=i}f.parent=f.next=f.prev=null}return f},append:function(h){var f=this,g;if(h.parent){h.remove()}g=f.lastChild;if(g){g.next=h;h.prev=g;f.lastChild=h}else{f.lastChild=f.firstChild=h}h.parent=f;return h},insert:function(h,f,i){var g;if(h.parent){h.remove()}g=f.parent||this;if(i){if(f===g.firstChild){g.firstChild=h}else{f.prev.next=h}h.prev=f.prev;h.next=f;f.prev=h}else{if(f===g.lastChild){g.lastChild=h}else{f.next.prev=h}h.next=f.next;h.prev=f;f.next=h}h.parent=g;return h},getAll:function(g){var f=this,h,i=[];for(h=f.firstChild;h;h=a(h,f)){if(h.name===g){i.push(h)}}return i},empty:function(){var g=this,f,h,j;if(g.firstChild){f=[];for(j=g.firstChild;j;j=a(j,g)){f.push(j)}h=f.length;while(h--){j=f[h];j.parent=j.firstChild=j.lastChild=j.next=j.prev=null}}g.firstChild=g.lastChild=null;return g},isEmpty:function(l){l=l||new d.html.Schema();var g=this,k=g.firstChild,j,h,f=l.getNonEmptyElements(),m=l.getWhiteSpaceElements();if(k){do{if(k.type===1){if(k.attributes.map["data-mce-bogus"]){continue}if(f[k.name]){return false}j=k.attributes.length;while(j--){h=k.attributes[j].name;if(h==="name"||h.indexOf("data-")===0){return false}}}if(k.type===8){return false}if(k.type===3&&(!c.test(k.value)||(m[g.name]&&k.value&&k.value.length>0&&c.test(k.value)))){return false}}while(k=a(k,g))}return true},walk:function(f){return a(this,null,f)}});d.extend(b,{create:function(g,f){var i,h;i=new b(g,e[g]||1);if(f){for(h in f){i.attr(h,f[h])}}return i}});d.html.Node=b})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/html/DomParser.js' */
(function(b){var a=b.html.Node;b.html.DomParser=function(g,h){var f=this,e={},d=[],i={},c={};g=g||{};g.validate="validate" in g?g.validate:true;g.root_name=g.root_name||"body";f.schema=h=h||new b.html.Schema();function j(m){var o,p,w,v,y,n,q,l,t,u,k,s,x,r;s=b.makeMap("tr,td,th,tbody,thead,tfoot,table");k=h.getNonEmptyElements();for(o=0;o<m.length;o++){p=m[o];if(!p.parent){continue}v=[p];for(w=p.parent;w&&!h.isValidChild(w.name,p.name)&&!s[w.name];w=w.parent){v.push(w)}if(w&&v.length>1){v.reverse();y=n=f.filterNode(v[0].clone());for(t=0;t<v.length-1;t++){if(h.isValidChild(n.name,v[t].name)){q=f.filterNode(v[t].clone());n.append(q)}else{q=n}for(l=v[t].firstChild;l&&l!=v[t+1];){r=l.next;q.append(l);l=r}n=q}if(!y.isEmpty(h)){w.insert(y,v[0],true);w.insert(p,y)}else{w.insert(p,v[0],true)}w=v[0];if(w.isEmpty(h)||w.firstChild===w.lastChild&&w.firstChild.name==="br"){w.empty().remove()}}else{if(p.parent){if(p.name==="li"){x=p.prev;if(x&&(x.name==="ul"||x.name==="ul")){x.append(p);continue}x=p.next;if(x&&(x.name==="ul"||x.name==="ul")){x.insert(p,x.firstChild,true);continue}p.wrap(f.filterNode(new a("ul",1)));continue}if(h.isValidChild(p.parent.name,"div")&&h.isValidChild("div",p.name)){p.wrap(f.filterNode(new a("div",1)))}else{if(p.name==="style"||p.name==="script"){p.empty().remove()}else{p.unwrap()}}}}}}f.filterNode=function(m){var l,k,n;if(k in e){n=i[k];if(n){n.push(m)}else{i[k]=[m]}}l=d.length;while(l--){k=d[l].name;if(k in m.attributes.map){n=c[k];if(n){n.push(m)}else{c[k]=[m]}}}return m};f.addNodeFilter=function(k,l){b.each(b.explode(k),function(m){var n=e[m];if(!n){e[m]=n=[]}n.push(l)})};f.addAttributeFilter=function(k,l){b.each(b.explode(k),function(m){var n;for(n=0;n<d.length;n++){if(d[n].name===m){d[n].callbacks.push(l);return}}d.push({name:m,callbacks:[l]})})};f.parse=function(v,m){var n,G,z,y,B,A,w,r,D,J,x,o,C,I=[],t,k,s,p,u,q;m=m||{};i={};c={};o=b.extend(b.makeMap("script,style,head,html,body,title,meta,param"),h.getBlockElements());u=h.getNonEmptyElements();p=h.children;x=g.validate;q="forced_root_block" in m?m.forced_root_block:g.forced_root_block;s=h.getWhiteSpaceElements();C=/^[ \t\r\n]+/;t=/[ \t\r\n]+$/;k=/[ \t\r\n]+/g;function E(){var K=G.firstChild,l,L;while(K){l=K.next;if(K.type==3||(K.type==1&&K.name!=="p"&&!o[K.name]&&!K.attr("data-mce-type"))){if(!L){L=H(q,1);G.insert(L,K);L.append(K)}else{L.append(K)}}else{L=null}K=l}}function H(l,K){var L=new a(l,K),M;if(l in e){M=i[l];if(M){M.push(L)}else{i[l]=[L]}}return L}function F(L){var M,l,K;for(M=L.prev;M&&M.type===3;){l=M.value.replace(t,"");if(l.length>0){M.value=l;M=M.prev}else{K=M.prev;M.remove();M=K}}}n=new b.html.SaxParser({validate:x,fix_self_closing:!x,cdata:function(l){z.append(H("#cdata",4)).value=l},text:function(L,l){var K;if(!s[z.name]){L=L.replace(k," ");if(z.lastChild&&o[z.lastChild.name]){L=L.replace(C,"")}}if(L.length!==0){K=H("#text",3);K.raw=!!l;z.append(K).value=L}},comment:function(l){z.append(H("#comment",8)).value=l},pi:function(l,K){z.append(H(l,7)).value=K;F(z)},doctype:function(K){var l;l=z.append(H("#doctype",10));l.value=K;F(z)},start:function(l,S,L){var Q,N,M,K,O,T,R,P;M=x?h.getElementRule(l):{};if(M){Q=H(M.outputName||l,1);Q.attributes=S;Q.shortEnded=L;z.append(Q);P=p[z.name];if(P&&p[Q.name]&&!P[Q.name]){I.push(Q)}N=d.length;while(N--){O=d[N].name;if(O in S.map){D=c[O];if(D){D.push(Q)}else{c[O]=[Q]}}}if(o[l]){F(Q)}if(!L){z=Q}}},end:function(l){var O,L,N,K,M;L=x?h.getElementRule(l):{};if(L){if(o[l]){if(!s[z.name]){for(O=z.firstChild;O&&O.type===3;){N=O.value.replace(C,"");if(N.length>0){O.value=N;O=O.next}else{K=O.next;O.remove();O=K}}for(O=z.lastChild;O&&O.type===3;){N=O.value.replace(t,"");if(N.length>0){O.value=N;O=O.prev}else{K=O.prev;O.remove();O=K}}}}if(L.removeEmpty||L.paddEmpty){if(z.isEmpty(h)){if(L.paddEmpty){z.empty().append(new a("#text","3")).value="\u00a0"}else{if(!z.attributes.map.name){M=z.parent;z.empty().remove();z=M;return}}}}z=z.parent}}},h);G=z=new a(m.context||g.root_name,11);n.parse(v);if(x&&I.length){if(!m.context){j(I)}else{m.invalid=true}}if(q&&G.name=="body"){E()}if(!m.invalid){for(J in i){D=e[J];y=i[J];w=y.length;while(w--){if(!y[w].parent){y.splice(w,1)}}for(B=0,A=D.length;B<A;B++){D[B](y,J,m)}}for(B=0,A=d.length;B<A;B++){D=d[B];if(D.name in c){y=c[D.name];w=y.length;while(w--){if(!y[w].parent){y.splice(w,1)}}for(w=0,r=D.callbacks.length;w<r;w++){D.callbacks[w](y,D.name,m)}}}}return G};if(g.remove_trailing_brs){f.addNodeFilter("br",function(n,m){var r,q=n.length,o,u=h.getBlockElements(),k=h.getNonEmptyElements(),s,p,t;u.body=1;for(r=0;r<q;r++){o=n[r];s=o.parent;if(u[o.parent.name]&&o===s.lastChild){p=o.prev;while(p){t=p.name;if(t!=="span"||p.attr("data-mce-type")!=="bookmark"){if(t!=="br"){break}if(t==="br"){o=null;break}}p=p.prev}if(o){o.remove();if(s.isEmpty(h)){elementRule=h.getElementRule(s.name);if(elementRule){if(elementRule.removeEmpty){s.remove()}else{if(elementRule.paddEmpty){s.empty().append(new b.html.Node("#text",3)).value="\u00a0"}}}}}}}})}}})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/html/Writer.js' */
tinymce.html.Writer=function(e){var c=[],a,b,d,f,g;e=e||{};a=e.indent;b=tinymce.makeMap(e.indent_before||"");d=tinymce.makeMap(e.indent_after||"");f=tinymce.html.Entities.getEncodeFunc(e.entity_encoding||"raw",e.entities);g=e.element_format=="html";return{start:function(m,k,p){var n,j,h,o;if(a&&b[m]&&c.length>0){o=c[c.length-1];if(o.length>0&&o!=="\n"){c.push("\n")}}c.push("<",m);if(k){for(n=0,j=k.length;n<j;n++){h=k[n];c.push(" ",h.name,'="',f(h.value,true),'"')}}if(!p||g){c[c.length]=">"}else{c[c.length]=" />"}if(p&&a&&d[m]&&c.length>0){o=c[c.length-1];if(o.length>0&&o!=="\n"){c.push("\n")}}},end:function(h){var i;c.push("</",h,">");if(a&&d[h]&&c.length>0){i=c[c.length-1];if(i.length>0&&i!=="\n"){c.push("\n")}}},text:function(i,h){if(i.length>0){c[c.length]=h?i:f(i)}},cdata:function(h){c.push("<![CDATA[",h,"]]>")},comment:function(h){c.push("<!--",h,"-->")},pi:function(h,i){if(i){c.push("<?",h," ",i,"?>")}else{c.push("<?",h,"?>")}if(a){c.push("\n")}},doctype:function(h){c.push("<!DOCTYPE",h,">",a?"\n":"")},reset:function(){c.length=0},getContent:function(){return c.join("").replace(/\n$/,"")}}};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/html/Serializer.js' */
(function(a){a.html.Serializer=function(c,d){var b=this,e=new a.html.Writer(c);c=c||{};c.validate="validate" in c?c.validate:true;b.schema=d=d||new a.html.Schema();b.writer=e;b.serialize=function(h){var g,i;i=c.validate;g={3:function(k,j){e.text(k.value,k.raw)},8:function(j){e.comment(j.value)},7:function(j){e.pi(j.name,j.value)},10:function(j){e.doctype(j.value)},4:function(j){e.cdata(j.value)},11:function(j){if((j=j.firstChild)){do{f(j)}while(j=j.next)}}};e.reset();function f(k){var t=g[k.type],j,o,s,r,p,u,n,m,q;if(!t){j=k.name;o=k.shortEnded;s=k.attributes;if(i&&s&&s.length>1){u=[];u.map={};q=d.getElementRule(k.name);for(n=0,m=q.attributesOrder.length;n<m;n++){r=q.attributesOrder[n];if(r in s.map){p=s.map[r];u.map[r]=p;u.push({name:r,value:p})}}for(n=0,m=s.length;n<m;n++){r=s[n].name;if(!(r in u.map)){p=s.map[r];u.map[r]=p;u.push({name:r,value:p})}}s=u}e.start(k.name,s,o);if(!o){if((k=k.firstChild)){do{f(k)}while(k=k.next)}e.end(j)}}else{t(k)}}if(h.type==1&&!c.inner){f(h)}else{g[11](h)}return e.getContent()}}})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/dom/DOMUtils.js' */
(function(h){var f=h.each,e=h.is,d=h.isWebKit,b=h.isIE,c=h.html.Entities,a=/^([a-z0-9],?)+$/i,g=h.html.Schema.blockElementsMap,i=/^[ \t\r\n]*$/;h.create("tinymce.dom.DOMUtils",{doc:null,root:null,files:null,pixelStyles:/^(top|left|bottom|right|width|height|borderWidth)$/,props:{"for":"htmlFor","class":"className",className:"className",checked:"checked",disabled:"disabled",maxlength:"maxLength",readonly:"readOnly",selected:"selected",value:"value",id:"id",name:"name",type:"type"},DOMUtils:function(o,m){var l=this,j,k;l.doc=o;l.win=window;l.files={};l.cssFlicker=false;l.counter=0;l.stdMode=!h.isIE||o.documentMode>=8;l.boxModel=!h.isIE||o.compatMode=="CSS1Compat"||l.stdMode;l.hasOuterHTML="outerHTML" in o.createElement("a");l.settings=m=h.extend({keep_values:false,hex_colors:1},m);l.schema=m.schema;l.styles=new h.html.Styles({url_converter:m.url_converter,url_converter_scope:m.url_converter_scope},m.schema);if(h.isIE6){try{o.execCommand("BackgroundImageCache",false,true)}catch(n){l.cssFlicker=true}}if(b&&m.schema){("abbr article aside audio canvas details figcaption figure footer header hgroup mark menu meter nav output progress section summary time video").replace(/\w+/g,function(p){o.createElement(p)});for(k in m.schema.getCustomElements()){o.createElement(k)}}h.addUnload(l.destroy,l)},getRoot:function(){var j=this,k=j.settings;return(k&&j.get(k.root_element))||j.doc.body},getViewPort:function(k){var l,j;k=!k?this.win:k;l=k.document;j=this.boxModel?l.documentElement:l.body;return{x:k.pageXOffset||j.scrollLeft,y:k.pageYOffset||j.scrollTop,w:k.innerWidth||j.clientWidth,h:k.innerHeight||j.clientHeight}},getRect:function(m){var l,j=this,k;m=j.get(m);l=j.getPos(m);k=j.getSize(m);return{x:l.x,y:l.y,w:k.w,h:k.h}},getSize:function(m){var k=this,j,l;m=k.get(m);j=k.getStyle(m,"width");l=k.getStyle(m,"height");if(j.indexOf("px")===-1){j=0}if(l.indexOf("px")===-1){l=0}return{w:parseInt(j)||m.offsetWidth||m.clientWidth,h:parseInt(l)||m.offsetHeight||m.clientHeight}},getParent:function(l,k,j){return this.getParents(l,k,j,false)},getParents:function(u,p,l,s){var k=this,j,m=k.settings,q=[];u=k.get(u);s=s===undefined;if(m.strict_root){l=l||k.getRoot()}if(e(p,"string")){j=p;if(p==="*"){p=function(o){return o.nodeType==1}}else{p=function(o){return k.is(o,j)}}}while(u){if(u==l||!u.nodeType||u.nodeType===9){break}if(!p||p(u)){if(s){q.push(u)}else{return u}}u=u.parentNode}return s?q:null},get:function(j){var k;if(j&&this.doc&&typeof(j)=="string"){k=j;j=this.doc.getElementById(j);if(j&&j.id!==k){return this.doc.getElementsByName(k)[1]}}return j},getNext:function(k,j){return this._findSib(k,j,"nextSibling")},getPrev:function(k,j){return this._findSib(k,j,"previousSibling")},select:function(l,k){var j=this;return h.dom.Sizzle(l,j.get(k)||j.get(j.settings.root_element)||j.doc,[])},is:function(l,j){var k;if(l.length===undefined){if(j==="*"){return l.nodeType==1}if(a.test(j)){j=j.toLowerCase().split(/,/);l=l.nodeName.toLowerCase();for(k=j.length-1;k>=0;k--){if(j[k]==l){return true}}return false}}return h.dom.Sizzle.matches(j,l.nodeType?[l]:l).length>0},add:function(m,q,j,l,o){var k=this;return this.run(m,function(s){var r,n;r=e(q,"string")?k.doc.createElement(q):q;k.setAttribs(r,j);if(l){if(l.nodeType){r.appendChild(l)}else{k.setHTML(r,l)}}return !o?s.appendChild(r):r})},create:function(l,j,k){return this.add(this.doc.createElement(l),l,j,k,1)},createHTML:function(r,j,p){var q="",m=this,l;q+="<"+r;for(l in j){if(j.hasOwnProperty(l)){q+=" "+l+'="'+m.encode(j[l])+'"'}}if(typeof(p)!="undefined"){return q+">"+p+"</"+r+">"}return q+" />"},remove:function(j,k){return this.run(j,function(m){var n,l=m.parentNode;if(!l){return null}if(k){while(n=m.firstChild){if(!h.isIE||n.nodeType!==3||n.nodeValue){l.insertBefore(n,m)}else{m.removeChild(n)}}}return l.removeChild(m)})},setStyle:function(m,j,k){var l=this;return l.run(m,function(p){var o,n;o=p.style;j=j.replace(/-(\D)/g,function(r,q){return q.toUpperCase()});if(l.pixelStyles.test(j)&&(h.is(k,"number")||/^[\-0-9\.]+$/.test(k))){k+="px"}switch(j){case"opacity":if(b){o.filter=k===""?"":"alpha(opacity="+(k*100)+")";if(!m.currentStyle||!m.currentStyle.hasLayout){o.display="inline-block"}}o[j]=o["-moz-opacity"]=o["-khtml-opacity"]=k||"";break;case"float":b?o.styleFloat=k:o.cssFloat=k;break;default:o[j]=k||""}if(l.settings.update_styles){l.setAttrib(p,"data-mce-style")}})},getStyle:function(m,j,l){m=this.get(m);if(!m){return}if(this.doc.defaultView&&l){j=j.replace(/[A-Z]/g,function(n){return"-"+n});try{return this.doc.defaultView.getComputedStyle(m,null).getPropertyValue(j)}catch(k){return null}}j=j.replace(/-(\D)/g,function(o,n){return n.toUpperCase()});if(j=="float"){j=b?"styleFloat":"cssFloat"}if(m.currentStyle&&l){return m.currentStyle[j]}return m.style?m.style[j]:undefined},setStyles:function(m,n){var k=this,l=k.settings,j;j=l.update_styles;l.update_styles=0;f(n,function(o,p){k.setStyle(m,p,o)});l.update_styles=j;if(l.update_styles){k.setAttrib(m,l.cssText)}},removeAllAttribs:function(j){return this.run(j,function(m){var l,k=m.attributes;for(l=k.length-1;l>=0;l--){m.removeAttributeNode(k.item(l))}})},setAttrib:function(l,m,j){var k=this;if(!l||!m){return}if(k.settings.strict){m=m.toLowerCase()}return this.run(l,function(q){var p=k.settings;var n=q.getAttribute(m);if(j!==null){switch(m){case"style":if(!e(j,"string")){f(j,function(r,s){k.setStyle(q,s,r)});return}if(p.keep_values){if(j&&!k._isRes(j)){q.setAttribute("data-mce-style",j,2)}else{q.removeAttribute("data-mce-style",2)}}q.style.cssText=j;break;case"class":q.className=j||"";break;case"src":case"href":if(p.keep_values){if(p.url_converter){j=p.url_converter.call(p.url_converter_scope||k,j,m,q)}k.setAttrib(q,"data-mce-"+m,j,2)}break;case"shape":q.setAttribute("data-mce-style",j);break}}if(e(j)&&j!==null&&j.length!==0){q.setAttribute(m,""+j,2)}else{q.removeAttribute(m,2)}if(tinyMCE.activeEditor&&n!=j){var o=tinyMCE.activeEditor;o.onSetAttrib.dispatch(o,q,m,j)}})},setAttribs:function(k,l){var j=this;return this.run(k,function(m){f(l,function(o,p){j.setAttrib(m,p,o)})})},getAttrib:function(o,p,l){var j,k=this,m;o=k.get(o);if(!o||o.nodeType!==1){return l===m?false:l}if(!e(l)){l=""}if(/^(src|href|style|coords|shape)$/.test(p)){j=o.getAttribute("data-mce-"+p);if(j){return j}}if(b&&k.props[p]){j=o[k.props[p]];j=j&&j.nodeValue?j.nodeValue:j}if(!j){j=o.getAttribute(p,2)}if(/^(checked|compact|declare|defer|disabled|ismap|multiple|nohref|noshade|nowrap|readonly|selected)$/.test(p)){if(o[k.props[p]]===true&&j===""){return p}return j?p:""}if(o.nodeName==="FORM"&&o.getAttributeNode(p)){return o.getAttributeNode(p).nodeValue}if(p==="style"){j=j||o.style.cssText;if(j){j=k.serializeStyle(k.parseStyle(j),o.nodeName);if(k.settings.keep_values&&!k._isRes(j)){o.setAttribute("data-mce-style",j)}}}if(d&&p==="class"&&j){j=j.replace(/(apple|webkit)\-[a-z\-]+/gi,"")}if(b){switch(p){case"rowspan":case"colspan":if(j===1){j=""}break;case"size":if(j==="+0"||j===20||j===0){j=""}break;case"width":case"height":case"vspace":case"checked":case"disabled":case"readonly":if(j===0){j=""}break;case"hspace":if(j===-1){j=""}break;case"maxlength":case"tabindex":if(j===32768||j===2147483647||j==="32768"){j=""}break;case"multiple":case"compact":case"noshade":case"nowrap":if(j===65535){return p}return l;case"shape":j=j.toLowerCase();break;default:if(p.indexOf("on")===0&&j){j=h._replace(/^function\s+\w+\(\)\s+\{\s+(.*)\s+\}$/,"$1",""+j)}}}return(j!==m&&j!==null&&j!=="")?""+j:l},getPos:function(s,m){var k=this,j=0,q=0,o,p=k.doc,l;s=k.get(s);m=m||p.body;if(s){if(s.getBoundingClientRect){s=s.getBoundingClientRect();o=k.boxModel?p.documentElement:p.body;j=s.left+(p.documentElement.scrollLeft||p.body.scrollLeft)-o.clientTop;q=s.top+(p.documentElement.scrollTop||p.body.scrollTop)-o.clientLeft;return{x:j,y:q}}l=s;while(l&&l!=m&&l.nodeType){j+=l.offsetLeft||0;q+=l.offsetTop||0;l=l.offsetParent}l=s.parentNode;while(l&&l!=m&&l.nodeType){j-=l.scrollLeft||0;q-=l.scrollTop||0;l=l.parentNode}}return{x:j,y:q}},parseStyle:function(j){return this.styles.parse(j)},serializeStyle:function(k,j){return this.styles.serialize(k,j)},loadCSS:function(j){var l=this,m=l.doc,k;if(!j){j=""}k=l.select("head")[0];f(j.split(","),function(n){var o;if(l.files[n]){return}l.files[n]=true;o=l.create("link",{rel:"stylesheet",href:h._addVer(n)});if(b&&m.documentMode&&m.recalc){o.onload=function(){if(m.recalc){m.recalc()}o.onload=null}}k.appendChild(o)})},addClass:function(j,k){return this.run(j,function(l){var m;if(!k){return 0}if(this.hasClass(l,k)){return l.className}m=this.removeClass(l,k);return l.className=(m!=""?(m+" "):"")+k})},removeClass:function(l,m){var j=this,k;return j.run(l,function(o){var n;if(j.hasClass(o,m)){if(!k){k=new RegExp("(^|\\s+)"+m+"(\\s+|$)","g")}n=o.className.replace(k," ");n=h.trim(n!=" "?n:"");o.className=n;if(!n){o.removeAttribute("class");o.removeAttribute("className")}return n}return o.className})},hasClass:function(k,j){k=this.get(k);if(!k||!j){return false}return(" "+k.className+" ").indexOf(" "+j+" ")!==-1},show:function(j){return this.setStyle(j,"display","block")},hide:function(j){return this.setStyle(j,"display","none")},isHidden:function(j){j=this.get(j);return !j||j.style.display=="none"||this.getStyle(j,"display")=="none"},uniqueId:function(j){return(!j?"mce_":j)+(this.counter++)},setHTML:function(l,k){var j=this;return j.run(l,function(n){if(b){while(n.firstChild){n.removeChild(n.firstChild)}try{n.innerHTML="<br />"+k;n.removeChild(n.firstChild)}catch(m){n=j.create("div");n.innerHTML="<br />"+k;f(n.childNodes,function(p,o){if(o){n.appendChild(p)}})}}else{n.innerHTML=k}return k})},getOuterHTML:function(l){var k,j=this;l=j.get(l);if(!l){return null}if(l.nodeType===1&&j.hasOuterHTML){return l.outerHTML}k=(l.ownerDocument||j.doc).createElement("body");k.appendChild(l.cloneNode(true));return k.innerHTML},setOuterHTML:function(m,k,n){var j=this;function l(p,o,r){var s,q;q=r.createElement("body");q.innerHTML=o;s=q.lastChild;while(s){j.insertAfter(s.cloneNode(true),p);s=s.previousSibling}j.remove(p)}return this.run(m,function(p){p=j.get(p);if(p.nodeType==1){n=n||p.ownerDocument||j.doc;if(b){try{if(b&&p.nodeType==1){p.outerHTML=k}else{l(p,k,n)}}catch(o){l(p,k,n)}}else{l(p,k,n)}}})},decode:c.decode,encode:c.encodeAllRaw,insertAfter:function(j,k){k=this.get(k);return this.run(j,function(m){var l,n;l=k.parentNode;n=k.nextSibling;if(n){l.insertBefore(m,n)}else{l.appendChild(m)}return m})},isBlock:function(k){var j=k.nodeType;if(j){return !!(j===1&&g[k.nodeName])}return !!g[k]},replace:function(p,m,j){var l=this;if(e(m,"array")){p=p.cloneNode(true)}return l.run(m,function(k){if(j){f(h.grep(k.childNodes),function(n){p.appendChild(n)})}return k.parentNode.replaceChild(p,k)})},rename:function(m,j){var l=this,k;if(m.nodeName!=j.toUpperCase()){k=l.create(j);f(l.getAttribs(m),function(n){l.setAttrib(k,n.nodeName,l.getAttrib(m,n.nodeName))});l.replace(k,m,1)}return k||m},findCommonAncestor:function(l,j){var m=l,k;while(m){k=j;while(k&&m!=k){k=k.parentNode}if(m==k){break}m=m.parentNode}if(!m&&l.ownerDocument){return l.ownerDocument.documentElement}return m},toHex:function(j){var l=/^\s*rgb\s*?\(\s*?([0-9]+)\s*?,\s*?([0-9]+)\s*?,\s*?([0-9]+)\s*?\)\s*$/i.exec(j);function k(m){m=parseInt(m).toString(16);return m.length>1?m:"0"+m}if(l){j="#"+k(l[1])+k(l[2])+k(l[3]);return j}return j},getClasses:function(){var n=this,j=[],m,o={},p=n.settings.class_filter,l;if(n.classes){return n.classes}function q(r){f(r.imports,function(s){q(s)});f(r.cssRules||r.rules,function(s){switch(s.type||1){case 1:if(s.selectorText){f(s.selectorText.split(","),function(t){t=t.replace(/^\s*|\s*$|^\s\./g,"");if(/\.mce/.test(t)||!/\.[\w\-]+$/.test(t)){return}l=t;t=h._replace(/.*\.([a-z0-9_\-]+).*/i,"$1",t);if(p&&!(t=p(t,l))){return}if(!o[t]){j.push({"class":t});o[t]=1}})}break;case 3:q(s.styleSheet);break}})}try{f(n.doc.styleSheets,q)}catch(k){}if(j.length>0){n.classes=j}return j},run:function(m,l,k){var j=this,n;if(j.doc&&typeof(m)==="string"){m=j.get(m)}if(!m){return false}k=k||this;if(!m.nodeType&&(m.length||m.length===0)){n=[];f(m,function(p,o){if(p){if(typeof(p)=="string"){p=j.doc.getElementById(p)}n.push(l.call(k,p,o))}});return n}return l.call(k,m)},getAttribs:function(k){var j;k=this.get(k);if(!k){return[]}if(b){j=[];if(k.nodeName=="OBJECT"){return k.attributes}if(k.nodeName==="OPTION"&&this.getAttrib(k,"selected")){j.push({specified:1,nodeName:"selected"})}k.cloneNode(false).outerHTML.replace(/<\/?[\w:\-]+ ?|=[\"][^\"]+\"|=\'[^\']+\'|=[\w\-]+|>/gi,"").replace(/[\w:\-]+/gi,function(l){j.push({specified:1,nodeName:l})});return j}return k.attributes},isEmpty:function(m,k){var r=this,o,n,q,j,l,p;m=m.firstChild;if(m){j=new h.dom.TreeWalker(m);k=k||r.schema?r.schema.getNonEmptyElements():null;do{q=m.nodeType;if(q===1){if(m.getAttribute("data-mce-bogus")){continue}l=m.nodeName.toLowerCase();if(k&&k[l]){p=m.parentNode;if(l==="br"&&r.isBlock(p)&&p.firstChild===m&&p.lastChild===m){continue}return false}n=r.getAttribs(m);o=m.attributes.length;while(o--){l=m.attributes[o].nodeName.toLowerCase();if(l==="name"||l==="data-mce-bookmark"||(l==="contenteditable"&&m.attributes[o].value==="true")){return false}}}if(q==8){return false}if((q===3&&!i.test(m.nodeValue))){return false}}while(m=j.next())}return true},destroy:function(k){var j=this;if(j.events){j.events.destroy()}j.win=j.doc=j.root=j.events=null;if(!k){h.removeUnload(j.destroy)}},createRng:function(){var j=this.doc;return j.createRange?j.createRange():new h.dom.Range(this)},nodeIndex:function(n,o){var j=0,l,m,k;if(n){for(l=n.nodeType,n=n.previousSibling,m=n;n;n=n.previousSibling){k=n.nodeType;if(o&&k==3){if(k==l||!n.nodeValue.length){continue}}j++;l=k}}return j},split:function(n,m,q){var s=this,j=s.createRng(),o,l,p;function k(w){var u,t=w.childNodes,v=w.nodeType;function x(A){var z=A.previousSibling&&A.previousSibling.nodeName=="SPAN";var y=A.nextSibling&&A.nextSibling.nodeName=="SPAN";return z&&y}if(v==1&&w.getAttribute("data-mce-type")=="bookmark"){return}for(u=t.length-1;u>=0;u--){k(t[u])}if(v!=9){if(v==3&&w.nodeValue.length>0){var r=h.trim(w.nodeValue).length;if(!s.isBlock(w.parentNode)||r>0||r==0&&x(w)){return}}else{if(v==1){t=w.childNodes;if(t.length==1&&t[0]&&t[0].nodeType==1&&t[0].getAttribute("data-mce-type")=="bookmark"){w.parentNode.insertBefore(t[0],w)}if(t.length||/^(br|hr|input|img)$/i.test(w.nodeName)){return}}}s.remove(w)}return w}if(n&&m){j.setStart(n.parentNode,s.nodeIndex(n));j.setEnd(m.parentNode,s.nodeIndex(m));o=j.extractContents();j=s.createRng();j.setStart(m.parentNode,s.nodeIndex(m)+1);j.setEnd(n.parentNode,s.nodeIndex(n)+1);l=j.extractContents();p=n.parentNode;p.insertBefore(k(o),n);if(q){p.replaceChild(q,m)}else{p.insertBefore(m,n)}p.insertBefore(k(l),n);s.remove(n);return q||m}},bind:function(n,j,m,l){var k=this;if(!k.events){k.events=new h.dom.EventUtils()}return k.events.add(n,j,m,l||this)},unbind:function(m,j,l){var k=this;if(!k.events){k.events=new h.dom.EventUtils()}return k.events.remove(m,j,l)},dumpRng:function(j){return"startContainer: "+j.startContainer.nodeName+", startOffset: "+j.startOffset+", endContainer: "+j.endContainer.nodeName+", endOffset: "+j.endOffset},_findSib:function(m,j,k){var l=this,n=j;if(m){if(e(n,"string")){n=function(o){return l.is(o,j)}}for(m=m[k];m;m=m[k]){if(n(m)){return m}}}return null},_isRes:function(j){return/^(top|left|bottom|right|width|height)/i.test(j)||/;\s*(top|left|bottom|right|width|height)/i.test(j)}});h.DOM=new h.dom.DOMUtils(document,{process_html:0})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/dom/Range.js' */
(function(a){function b(c){var M=this,e=c.doc,R=0,D=1,j=2,C=true,Q=false,T="startOffset",h="startContainer",O="endContainer",y="endOffset",k=tinymce.extend,n=c.nodeIndex;k(M,{startContainer:e,startOffset:0,endContainer:e,endOffset:0,collapsed:C,commonAncestorContainer:e,START_TO_START:0,START_TO_END:1,END_TO_END:2,END_TO_START:3,setStart:q,setEnd:s,setStartBefore:g,setStartAfter:H,setEndBefore:I,setEndAfter:u,collapse:z,selectNode:w,selectNodeContents:E,compareBoundaryPoints:v,deleteContents:p,extractContents:G,cloneContents:d,insertNode:B,surroundContents:L,cloneRange:J});function q(U,t){A(C,U,t)}function s(U,t){A(Q,U,t)}function g(t){q(t.parentNode,n(t))}function H(t){q(t.parentNode,n(t)+1)}function I(t){s(t.parentNode,n(t))}function u(t){s(t.parentNode,n(t)+1)}function z(t){if(t){M[O]=M[h];M[y]=M[T]}else{M[h]=M[O];M[T]=M[y]}M.collapsed=C}function w(t){g(t);u(t)}function E(t){q(t,0);s(t,t.nodeType===1?t.childNodes.length:t.nodeValue.length)}function v(X,t){var aa=M[h],V=M[T],Z=M[O],U=M[y],Y=t.startContainer,ac=t.startOffset,W=t.endContainer,ab=t.endOffset;if(X===0){return F(aa,V,Y,ac)}if(X===1){return F(Z,U,Y,ac)}if(X===2){return F(Z,U,W,ab)}if(X===3){return F(aa,V,W,ab)}}function p(){m(j)}function G(){return m(R)}function d(){return m(D)}function B(X){var U=this[h],t=this[T],W,V;if((U.nodeType===3||U.nodeType===4)&&U.nodeValue){if(!t){U.parentNode.insertBefore(X,U)}else{if(t>=U.nodeValue.length){c.insertAfter(X,U)}else{W=U.splitText(t);U.parentNode.insertBefore(X,W)}}}else{if(U.childNodes.length>0){V=U.childNodes[t]}if(V){U.insertBefore(X,V)}else{U.appendChild(X)}}}function L(U){var t=M.extractContents();M.insertNode(U);U.appendChild(t);M.selectNode(U)}function J(){return k(new b(c),{startContainer:M[h],startOffset:M[T],endContainer:M[O],endOffset:M[y],collapsed:M.collapsed,commonAncestorContainer:M.commonAncestorContainer})}function N(t,U){var V;if(t.nodeType==3){return t}if(U<0){return t}V=t.firstChild;while(V&&U>0){--U;V=V.nextSibling}if(V){return V}return t}function l(){return(M[h]==M[O]&&M[T]==M[y])}function F(W,Y,U,X){var Z,V,t,aa,ac,ab;if(W==U){if(Y==X){return 0}if(Y<X){return -1}return 1}Z=U;while(Z&&Z.parentNode!=W){Z=Z.parentNode}if(Z){V=0;t=W.firstChild;while(t!=Z&&V<Y){V++;t=t.nextSibling}if(Y<=V){return -1}return 1}Z=W;while(Z&&Z.parentNode!=U){Z=Z.parentNode}if(Z){V=0;t=U.firstChild;while(t!=Z&&V<X){V++;t=t.nextSibling}if(V<X){return -1}return 1}aa=c.findCommonAncestor(W,U);ac=W;while(ac&&ac.parentNode!=aa){ac=ac.parentNode}if(!ac){ac=aa}ab=U;while(ab&&ab.parentNode!=aa){ab=ab.parentNode}if(!ab){ab=aa}if(ac==ab){return 0}t=aa.firstChild;while(t){if(t==ac){return -1}if(t==ab){return 1}t=t.nextSibling}}function A(U,X,W){var t,V;if(U){M[h]=X;M[T]=W}else{M[O]=X;M[y]=W}t=M[O];while(t.parentNode){t=t.parentNode}V=M[h];while(V.parentNode){V=V.parentNode}if(V==t){if(F(M[h],M[T],M[O],M[y])>0){M.collapse(U)}}else{M.collapse(U)}M.collapsed=l();M.commonAncestorContainer=c.findCommonAncestor(M[h],M[O])}function m(aa){var Z,W=0,ac=0,U,Y,V,X,t,ab;if(M[h]==M[O]){return f(aa)}for(Z=M[O],U=Z.parentNode;U;Z=U,U=U.parentNode){if(U==M[h]){return r(Z,aa)}++W}for(Z=M[h],U=Z.parentNode;U;Z=U,U=U.parentNode){if(U==M[O]){return S(Z,aa)}++ac}Y=ac-W;V=M[h];while(Y>0){V=V.parentNode;Y--}X=M[O];while(Y<0){X=X.parentNode;Y++}for(t=V.parentNode,ab=X.parentNode;t!=ab;t=t.parentNode,ab=ab.parentNode){V=t;X=ab}return o(V,X,aa)}function f(Y){var aa,X,W,Z,t,V,U;if(Y!=j){aa=e.createDocumentFragment()}if(M[T]==M[y]){return aa}if(M[h].nodeType==3){X=M[h].nodeValue;W=X.substring(M[T],M[y]);if(Y!=D){M[h].deleteData(M[T],M[y]-M[T]);M.collapse(C)}if(Y==j){return}aa.appendChild(e.createTextNode(W));return aa}Z=N(M[h],M[T]);t=M[y]-M[T];while(t>0){V=Z.nextSibling;U=x(Z,Y);if(aa){aa.appendChild(U)}--t;Z=V}if(Y!=D){M.collapse(C)}return aa}function r(aa,X){var Z,Y,U,t,W,V;if(X!=j){Z=e.createDocumentFragment()}Y=i(aa,X);if(Z){Z.appendChild(Y)}U=n(aa);t=U-M[T];if(t<=0){if(X!=D){M.setEndBefore(aa);M.collapse(Q)}return Z}Y=aa.previousSibling;while(t>0){W=Y.previousSibling;V=x(Y,X);if(Z){Z.insertBefore(V,Z.firstChild)}--t;Y=W}if(X!=D){M.setEndBefore(aa);M.collapse(Q)}return Z}function S(Y,X){var aa,U,Z,t,W,V;if(X!=j){aa=e.createDocumentFragment()}Z=P(Y,X);if(aa){aa.appendChild(Z)}U=n(Y);++U;t=M[y]-U;Z=Y.nextSibling;while(t>0){W=Z.nextSibling;V=x(Z,X);if(aa){aa.appendChild(V)}--t;Z=W}if(X!=D){M.setStartAfter(Y);M.collapse(C)}return aa}function o(Y,t,ab){var V,ad,X,Z,aa,U,ac,W;if(ab!=j){ad=e.createDocumentFragment()}V=P(Y,ab);if(ad){ad.appendChild(V)}X=Y.parentNode;Z=n(Y);aa=n(t);++Z;U=aa-Z;ac=Y.nextSibling;while(U>0){W=ac.nextSibling;V=x(ac,ab);if(ad){ad.appendChild(V)}ac=W;--U}V=i(t,ab);if(ad){ad.appendChild(V)}if(ab!=D){M.setStartAfter(Y);M.collapse(C)}return ad}function i(Z,aa){var V=N(M[O],M[y]-1),ab,Y,X,t,U,W=V!=M[O];if(V==Z){return K(V,W,Q,aa)}ab=V.parentNode;Y=K(ab,Q,Q,aa);while(ab){while(V){X=V.previousSibling;t=K(V,W,Q,aa);if(aa!=j){Y.insertBefore(t,Y.firstChild)}W=C;V=X}if(ab==Z){return Y}V=ab.previousSibling;ab=ab.parentNode;U=K(ab,Q,Q,aa);if(aa!=j){U.appendChild(Y)}Y=U}}function P(Z,aa){var W=N(M[h],M[T]),X=W!=M[h],ab,Y,V,t,U;if(W==Z){return K(W,X,C,aa)}ab=W.parentNode;Y=K(ab,Q,C,aa);while(ab){while(W){V=W.nextSibling;t=K(W,X,C,aa);if(aa!=j){Y.appendChild(t)}X=C;W=V}if(ab==Z){return Y}W=ab.nextSibling;ab=ab.parentNode;U=K(ab,Q,C,aa);if(aa!=j){U.appendChild(Y)}Y=U}}function K(t,X,aa,ab){var W,V,Y,U,Z;if(X){return x(t,ab)}if(t.nodeType==3){W=t.nodeValue;if(aa){U=M[T];V=W.substring(U);Y=W.substring(0,U)}else{U=M[y];V=W.substring(0,U);Y=W.substring(U)}if(ab!=D){t.nodeValue=Y}if(ab==j){return}Z=t.cloneNode(Q);Z.nodeValue=V;return Z}if(ab==j){return}return t.cloneNode(Q)}function x(U,t){if(t!=j){return t==D?U.cloneNode(C):U}U.parentNode.removeChild(U)}}a.Range=b})(tinymce.dom);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/dom/TridentSelection.js' */
(function(){function a(d){var b=this,h=d.dom,c=true,f=false;function e(i,j){var k,t=0,q,n,m,l,o,r,p=-1,s;k=i.duplicate();k.collapse(j);s=k.parentElement();if(s.ownerDocument!==d.dom.doc){return}while(s.contentEditable==="false"){s=s.parentNode}if(!s.hasChildNodes()){return{node:s,inside:1}}m=s.children;q=m.length-1;while(t<=q){r=Math.floor((t+q)/2);l=m[r];k.moveToElementText(l);p=k.compareEndPoints(j?"StartToStart":"EndToEnd",i);if(p>0){q=r-1}else{if(p<0){t=r+1}else{return{node:l}}}}if(p<0){if(!l){k.moveToElementText(s);k.collapse(true);l=s;n=true}else{k.collapse(false)}k.setEndPoint(j?"EndToStart":"EndToEnd",i);if(k.compareEndPoints(j?"StartToStart":"StartToEnd",i)>0){k=i.duplicate();k.collapse(j);o=-1;while(s==k.parentElement()){if(k.move("character",-1)==0){break}o++}}o=o||k.text.replace("\r\n"," ").length}else{k.collapse(true);k.setEndPoint(j?"StartToStart":"StartToEnd",i);o=k.text.replace("\r\n"," ").length}return{node:l,position:p,offset:o,inside:n}}function g(){var i=d.getRng(),r=h.createRng(),l,k,p,q,m,j;l=i.item?i.item(0):i.parentElement();if(l.ownerDocument!=h.doc){return r}k=d.isCollapsed();if(i.item){r.setStart(l.parentNode,h.nodeIndex(l));r.setEnd(r.startContainer,r.startOffset+1);return r}function o(z){var u=e(i,z),s,x,y=0,w,v,t;s=u.node;x=u.offset;if(u.inside&&!s.hasChildNodes()){r[z?"setStart":"setEnd"](s,0);return}if(x===v){r[z?"setStartBefore":"setEndAfter"](s);return}if(u.position<0){w=u.inside?s.firstChild:s.nextSibling;if(!w){r[z?"setStartAfter":"setEndAfter"](s);return}if(!x){if(w.nodeType==3){r[z?"setStart":"setEnd"](w,0)}else{r[z?"setStartBefore":"setEndBefore"](w)}return}while(w){t=w.nodeValue;y+=t.length;if(y>=x){s=w;y-=x;y=t.length-y;break}w=w.nextSibling}}else{w=s.previousSibling;if(!w){return r[z?"setStartBefore":"setEndBefore"](s)}if(!x){if(s.nodeType==3){r[z?"setStart":"setEnd"](w,s.nodeValue.length)}else{r[z?"setStartAfter":"setEndAfter"](w)}return}while(w){y+=w.nodeValue.length;if(y>=x){s=w;y-=x;break}w=w.previousSibling}}r[z?"setStart":"setEnd"](s,y)}try{o(true);if(!k){o()}}catch(n){if(n.number==-2147024809){m=b.getBookmark(2);p=i.duplicate();p.collapse(true);l=p.parentElement();if(!k){p=i.duplicate();p.collapse(false);q=p.parentElement();q.innerHTML=q.innerHTML}l.innerHTML=l.innerHTML;b.moveToBookmark(m);i=d.getRng();o(true);if(!k){o()}}else{throw n}}return r}this.getBookmark=function(m){var j=d.getRng(),o,i,l={};function n(u){var u,t,p,s,r,q=[];t=u.parentNode;p=h.doc.body.parentNode;while(t!=p&&t.nodeType!==9){s=t.children;r=s.length;while(r--){if(u===s[r]){q.push(r);break}}u=t;t=t.parentNode}return q}function k(q){var p;p=e(j,q);if(p){return{position:p.position,offset:p.offset,indexes:n(p.node),inside:p.inside}}}if(m===2){if(!j.item){l.start=k(true);if(!d.isCollapsed()){l.end=k()}}else{l.start={ctrl:true,indexes:n(j.item(0))}}}return l};this.moveToBookmark=function(k){var j,i=h.doc.body;function m(o){var r,q,n,p;r=h.doc.body;for(q=o.length-1;q>=0;q--){p=r.children;n=o[q];if(n<=p.length-1){r=p[n]}}return r}function l(r){var n=k[r?"start":"end"],q,p,o;if(n){q=n.position>0;p=i.createTextRange();p.moveToElementText(m(n.indexes));offset=n.offset;if(offset!==o){p.collapse(n.inside||q);p.moveStart("character",q?-offset:offset)}else{p.collapse(r)}j.setEndPoint(r?"StartToStart":"EndToStart",p);if(r){j.collapse(true)}}}if(k.start){if(k.start.ctrl){j=i.createControlRange();j.addElement(m(k.start.indexes));j.select()}else{j=i.createTextRange();l(true);l();j.select()}}};this.addRange=function(i){var n,l,k,p,s,q,r=d.dom.doc,m=r.body;function j(y){var u,x,t,w,v;t=h.create("a");u=y?k:s;x=y?p:q;w=n.duplicate();if(u==r||u==r.documentElement){u=m;x=0}if(u.nodeType==3){u.parentNode.insertBefore(t,u);w.moveToElementText(t);w.moveStart("character",x);h.remove(t);n.setEndPoint(y?"StartToStart":"EndToEnd",w)}else{v=u.childNodes;if(v.length){if(x>=v.length){h.insertAfter(t,v[v.length-1])}else{u.insertBefore(t,v[x])}w.moveToElementText(t)}else{t=r.createTextNode("\uFEFF");u.appendChild(t);w.moveToElementText(t.parentNode);w.collapse(c)}n.setEndPoint(y?"StartToStart":"EndToEnd",w);h.remove(t)}}k=i.startContainer;p=i.startOffset;s=i.endContainer;q=i.endOffset;n=m.createTextRange();if(k==s&&k.nodeType==1&&p==q-1){if(p==q-1){try{l=m.createControlRange();l.addElement(k.childNodes[p]);l.select();return}catch(o){}}}j(true);j();n.select()};this.getRangeAt=g}tinymce.dom.TridentSelection=a})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/dom/Sizzle.js' */
(function(){var p=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,j=0,d=Object.prototype.toString,o=false,i=true;[0,0].sort(function(){i=false;return 0});var b=function(v,e,y,z){y=y||[];e=e||document;var B=e;if(e.nodeType!==1&&e.nodeType!==9){return[]}if(!v||typeof v!=="string"){return y}var w=[],s,D,G,r,u=true,t=b.isXML(e),A=v,C,F,E,x;do{p.exec("");s=p.exec(A);if(s){A=s[3];w.push(s[1]);if(s[2]){r=s[3];break}}}while(s);if(w.length>1&&k.exec(v)){if(w.length===2&&f.relative[w[0]]){D=h(w[0]+w[1],e)}else{D=f.relative[w[0]]?[e]:b(w.shift(),e);while(w.length){v=w.shift();if(f.relative[v]){v+=w.shift()}D=h(v,D)}}}else{if(!z&&w.length>1&&e.nodeType===9&&!t&&f.match.ID.test(w[0])&&!f.match.ID.test(w[w.length-1])){C=b.find(w.shift(),e,t);e=C.expr?b.filter(C.expr,C.set)[0]:C.set[0]}if(e){C=z?{expr:w.pop(),set:a(z)}:b.find(w.pop(),w.length===1&&(w[0]==="~"||w[0]==="+")&&e.parentNode?e.parentNode:e,t);D=C.expr?b.filter(C.expr,C.set):C.set;if(w.length>0){G=a(D)}else{u=false}while(w.length){F=w.pop();E=F;if(!f.relative[F]){F=""}else{E=w.pop()}if(E==null){E=e}f.relative[F](G,E,t)}}else{G=w=[]}}if(!G){G=D}if(!G){b.error(F||v)}if(d.call(G)==="[object Array]"){if(!u){y.push.apply(y,G)}else{if(e&&e.nodeType===1){for(x=0;G[x]!=null;x++){if(G[x]&&(G[x]===true||G[x].nodeType===1&&b.contains(e,G[x]))){y.push(D[x])}}}else{for(x=0;G[x]!=null;x++){if(G[x]&&G[x].nodeType===1){y.push(D[x])}}}}}else{a(G,y)}if(r){b(r,B,y,z);b.uniqueSort(y)}return y};b.uniqueSort=function(r){if(c){o=i;r.sort(c);if(o){for(var e=1;e<r.length;e++){if(r[e]===r[e-1]){r.splice(e--,1)}}}}return r};b.matches=function(e,r){return b(e,null,null,r)};b.find=function(x,e,y){var w;if(!x){return[]}for(var t=0,s=f.order.length;t<s;t++){var v=f.order[t],u;if((u=f.leftMatch[v].exec(x))){var r=u[1];u.splice(1,1);if(r.substr(r.length-1)!=="\\"){u[1]=(u[1]||"").replace(/\\/g,"");w=f.find[v](u,e,y);if(w!=null){x=x.replace(f.match[v],"");break}}}}if(!w){w=e.getElementsByTagName("*")}return{set:w,expr:x}};b.filter=function(B,A,E,u){var s=B,G=[],y=A,w,e,x=A&&A[0]&&b.isXML(A[0]);while(B&&A.length){for(var z in f.filter){if((w=f.leftMatch[z].exec(B))!=null&&w[2]){var r=f.filter[z],F,D,t=w[1];e=false;w.splice(1,1);if(t.substr(t.length-1)==="\\"){continue}if(y===G){G=[]}if(f.preFilter[z]){w=f.preFilter[z](w,y,E,G,u,x);if(!w){e=F=true}else{if(w===true){continue}}}if(w){for(var v=0;(D=y[v])!=null;v++){if(D){F=r(D,w,v,y);var C=u^!!F;if(E&&F!=null){if(C){e=true}else{y[v]=false}}else{if(C){G.push(D);e=true}}}}}if(F!==undefined){if(!E){y=G}B=B.replace(f.match[z],"");if(!e){return[]}break}}}if(B===s){if(e==null){b.error(B)}else{break}}s=B}return y};b.error=function(e){throw"Syntax error, unrecognized expression: "+e};var f=b.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+\-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(e){return e.getAttribute("href")}},relative:{"+":function(w,r){var t=typeof r==="string",v=t&&!/\W/.test(r),x=t&&!v;if(v){r=r.toLowerCase()}for(var s=0,e=w.length,u;s<e;s++){if((u=w[s])){while((u=u.previousSibling)&&u.nodeType!==1){}w[s]=x||u&&u.nodeName.toLowerCase()===r?u||false:u===r}}if(x){b.filter(r,w,true)}},">":function(w,r){var u=typeof r==="string",v,s=0,e=w.length;if(u&&!/\W/.test(r)){r=r.toLowerCase();for(;s<e;s++){v=w[s];if(v){var t=v.parentNode;w[s]=t.nodeName.toLowerCase()===r?t:false}}}else{for(;s<e;s++){v=w[s];if(v){w[s]=u?v.parentNode:v.parentNode===r}}if(u){b.filter(r,w,true)}}},"":function(t,r,v){var s=j++,e=q,u;if(typeof r==="string"&&!/\W/.test(r)){r=r.toLowerCase();u=r;e=n}e("parentNode",r,s,t,u,v)},"~":function(t,r,v){var s=j++,e=q,u;if(typeof r==="string"&&!/\W/.test(r)){r=r.toLowerCase();u=r;e=n}e("previousSibling",r,s,t,u,v)}},find:{ID:function(r,s,t){if(typeof s.getElementById!=="undefined"&&!t){var e=s.getElementById(r[1]);return e?[e]:[]}},NAME:function(s,v){if(typeof v.getElementsByName!=="undefined"){var r=[],u=v.getElementsByName(s[1]);for(var t=0,e=u.length;t<e;t++){if(u[t].getAttribute("name")===s[1]){r.push(u[t])}}return r.length===0?null:r}},TAG:function(e,r){return r.getElementsByTagName(e[1])}},preFilter:{CLASS:function(t,r,s,e,w,x){t=" "+t[1].replace(/\\/g,"")+" ";if(x){return t}for(var u=0,v;(v=r[u])!=null;u++){if(v){if(w^(v.className&&(" "+v.className+" ").replace(/[\t\n]/g," ").indexOf(t)>=0)){if(!s){e.push(v)}}else{if(s){r[u]=false}}}}return false},ID:function(e){return e[1].replace(/\\/g,"")},TAG:function(r,e){return r[1].toLowerCase()},CHILD:function(e){if(e[1]==="nth"){var r=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(e[2]==="even"&&"2n"||e[2]==="odd"&&"2n+1"||!/\D/.test(e[2])&&"0n+"+e[2]||e[2]);e[2]=(r[1]+(r[2]||1))-0;e[3]=r[3]-0}e[0]=j++;return e},ATTR:function(u,r,s,e,v,w){var t=u[1].replace(/\\/g,"");if(!w&&f.attrMap[t]){u[1]=f.attrMap[t]}if(u[2]==="~="){u[4]=" "+u[4]+" "}return u},PSEUDO:function(u,r,s,e,v){if(u[1]==="not"){if((p.exec(u[3])||"").length>1||/^\w/.test(u[3])){u[3]=b(u[3],null,null,r)}else{var t=b.filter(u[3],r,s,true^v);if(!s){e.push.apply(e,t)}return false}}else{if(f.match.POS.test(u[0])||f.match.CHILD.test(u[0])){return true}}return u},POS:function(e){e.unshift(true);return e}},filters:{enabled:function(e){return e.disabled===false&&e.type!=="hidden"},disabled:function(e){return e.disabled===true},checked:function(e){return e.checked===true},selected:function(e){e.parentNode.selectedIndex;return e.selected===true},parent:function(e){return !!e.firstChild},empty:function(e){return !e.firstChild},has:function(s,r,e){return !!b(e[3],s).length},header:function(e){return(/h\d/i).test(e.nodeName)},text:function(e){return"text"===e.type},radio:function(e){return"radio"===e.type},checkbox:function(e){return"checkbox"===e.type},file:function(e){return"file"===e.type},password:function(e){return"password"===e.type},submit:function(e){return"submit"===e.type},image:function(e){return"image"===e.type},reset:function(e){return"reset"===e.type},button:function(e){return"button"===e.type||e.nodeName.toLowerCase()==="button"},input:function(e){return(/input|select|textarea|button/i).test(e.nodeName)}},setFilters:{first:function(r,e){return e===0},last:function(s,r,e,t){return r===t.length-1},even:function(r,e){return e%2===0},odd:function(r,e){return e%2===1},lt:function(s,r,e){return r<e[3]-0},gt:function(s,r,e){return r>e[3]-0},nth:function(s,r,e){return e[3]-0===r},eq:function(s,r,e){return e[3]-0===r}},filter:{PSEUDO:function(s,x,w,y){var e=x[1],r=f.filters[e];if(r){return r(s,w,x,y)}else{if(e==="contains"){return(s.textContent||s.innerText||b.getText([s])||"").indexOf(x[3])>=0}else{if(e==="not"){var t=x[3];for(var v=0,u=t.length;v<u;v++){if(t[v]===s){return false}}return true}else{b.error("Syntax error, unrecognized expression: "+e)}}}},CHILD:function(e,t){var w=t[1],r=e;switch(w){case"only":case"first":while((r=r.previousSibling)){if(r.nodeType===1){return false}}if(w==="first"){return true}r=e;case"last":while((r=r.nextSibling)){if(r.nodeType===1){return false}}return true;case"nth":var s=t[2],z=t[3];if(s===1&&z===0){return true}var v=t[0],y=e.parentNode;if(y&&(y.sizcache!==v||!e.nodeIndex)){var u=0;for(r=y.firstChild;r;r=r.nextSibling){if(r.nodeType===1){r.nodeIndex=++u}}y.sizcache=v}var x=e.nodeIndex-z;if(s===0){return x===0}else{return(x%s===0&&x/s>=0)}}},ID:function(r,e){return r.nodeType===1&&r.getAttribute("id")===e},TAG:function(r,e){return(e==="*"&&r.nodeType===1)||r.nodeName.toLowerCase()===e},CLASS:function(r,e){return(" "+(r.className||r.getAttribute("class"))+" ").indexOf(e)>-1},ATTR:function(v,t){var s=t[1],e=f.attrHandle[s]?f.attrHandle[s](v):v[s]!=null?v[s]:v.getAttribute(s),w=e+"",u=t[2],r=t[4];return e==null?u==="!=":u==="="?w===r:u==="*="?w.indexOf(r)>=0:u==="~="?(" "+w+" ").indexOf(r)>=0:!r?w&&e!==false:u==="!="?w!==r:u==="^="?w.indexOf(r)===0:u==="$="?w.substr(w.length-r.length)===r:u==="|="?w===r||w.substr(0,r.length+1)===r+"-":false},POS:function(u,r,s,v){var e=r[2],t=f.setFilters[e];if(t){return t(u,s,r,v)}}}};var k=f.match.POS,g=function(r,e){return"\\"+(e-0+1)};for(var m in f.match){f.match[m]=new RegExp(f.match[m].source+(/(?![^\[]*\])(?![^\(]*\))/.source));f.leftMatch[m]=new RegExp(/(^(?:.|\r|\n)*?)/.source+f.match[m].source.replace(/\\(\d+)/g,g))}var a=function(r,e){r=Array.prototype.slice.call(r,0);if(e){e.push.apply(e,r);return e}return r};try{Array.prototype.slice.call(document.documentElement.childNodes,0)[0].nodeType}catch(l){a=function(u,t){var r=t||[],s=0;if(d.call(u)==="[object Array]"){Array.prototype.push.apply(r,u)}else{if(typeof u.length==="number"){for(var e=u.length;s<e;s++){r.push(u[s])}}else{for(;u[s];s++){r.push(u[s])}}}return r}}var c;if(document.documentElement.compareDocumentPosition){c=function(r,e){if(!r.compareDocumentPosition||!e.compareDocumentPosition){if(r==e){o=true}return r.compareDocumentPosition?-1:1}var s=r.compareDocumentPosition(e)&4?-1:r===e?0:1;if(s===0){o=true}return s}}else{if("sourceIndex" in document.documentElement){c=function(r,e){if(!r.sourceIndex||!e.sourceIndex){if(r==e){o=true}return r.sourceIndex?-1:1}var s=r.sourceIndex-e.sourceIndex;if(s===0){o=true}return s}}else{if(document.createRange){c=function(t,r){if(!t.ownerDocument||!r.ownerDocument){if(t==r){o=true}return t.ownerDocument?-1:1}var s=t.ownerDocument.createRange(),e=r.ownerDocument.createRange();s.setStart(t,0);s.setEnd(t,0);e.setStart(r,0);e.setEnd(r,0);var u=s.compareBoundaryPoints(Range.START_TO_END,e);if(u===0){o=true}return u}}}}b.getText=function(e){var r="",t;for(var s=0;e[s];s++){t=e[s];if(t.nodeType===3||t.nodeType===4){r+=t.nodeValue}else{if(t.nodeType!==8){r+=b.getText(t.childNodes)}}}return r};(function(){var r=document.createElement("div"),s="script"+(new Date()).getTime();r.innerHTML="<a name='"+s+"'/>";var e=document.documentElement;e.insertBefore(r,e.firstChild);if(document.getElementById(s)){f.find.ID=function(u,v,w){if(typeof v.getElementById!=="undefined"&&!w){var t=v.getElementById(u[1]);return t?t.id===u[1]||typeof t.getAttributeNode!=="undefined"&&t.getAttributeNode("id").nodeValue===u[1]?[t]:undefined:[]}};f.filter.ID=function(v,t){var u=typeof v.getAttributeNode!=="undefined"&&v.getAttributeNode("id");return v.nodeType===1&&u&&u.nodeValue===t}}e.removeChild(r);e=r=null})();(function(){var e=document.createElement("div");e.appendChild(document.createComment(""));if(e.getElementsByTagName("*").length>0){f.find.TAG=function(r,v){var u=v.getElementsByTagName(r[1]);if(r[1]==="*"){var t=[];for(var s=0;u[s];s++){if(u[s].nodeType===1){t.push(u[s])}}u=t}return u}}e.innerHTML="<a href='#'></a>";if(e.firstChild&&typeof e.firstChild.getAttribute!=="undefined"&&e.firstChild.getAttribute("href")!=="#"){f.attrHandle.href=function(r){return r.getAttribute("href",2)}}e=null})();if(document.querySelectorAll){(function(){var e=b,s=document.createElement("div");s.innerHTML="<p class='TEST'></p>";if(s.querySelectorAll&&s.querySelectorAll(".TEST").length===0){return}b=function(w,v,t,u){v=v||document;if(!u&&v.nodeType===9&&!b.isXML(v)){try{return a(v.querySelectorAll(w),t)}catch(x){}}return e(w,v,t,u)};for(var r in e){b[r]=e[r]}s=null})()}(function(){var e=document.createElement("div");e.innerHTML="<div class='test e'></div><div class='test'></div>";if(!e.getElementsByClassName||e.getElementsByClassName("e").length===0){return}e.lastChild.className="e";if(e.getElementsByClassName("e").length===1){return}f.order.splice(1,0,"CLASS");f.find.CLASS=function(r,s,t){if(typeof s.getElementsByClassName!=="undefined"&&!t){return s.getElementsByClassName(r[1])}};e=null})();function n(r,w,v,z,x,y){for(var t=0,s=z.length;t<s;t++){var e=z[t];if(e){e=e[r];var u=false;while(e){if(e.sizcache===v){u=z[e.sizset];break}if(e.nodeType===1&&!y){e.sizcache=v;e.sizset=t}if(e.nodeName.toLowerCase()===w){u=e;break}e=e[r]}z[t]=u}}}function q(r,w,v,z,x,y){for(var t=0,s=z.length;t<s;t++){var e=z[t];if(e){e=e[r];var u=false;while(e){if(e.sizcache===v){u=z[e.sizset];break}if(e.nodeType===1){if(!y){e.sizcache=v;e.sizset=t}if(typeof w!=="string"){if(e===w){u=true;break}}else{if(b.filter(w,[e]).length>0){u=e;break}}}e=e[r]}z[t]=u}}}b.contains=document.compareDocumentPosition?function(r,e){return !!(r.compareDocumentPosition(e)&16)}:function(r,e){return r!==e&&(r.contains?r.contains(e):true)};b.isXML=function(e){var r=(e?e.ownerDocument||e:0).documentElement;return r?r.nodeName!=="HTML":false};var h=function(e,x){var t=[],u="",v,s=x.nodeType?[x]:x;while((v=f.match.PSEUDO.exec(e))){u+=v[0];e=e.replace(f.match.PSEUDO,"")}e=f.relative[e]?e+"*":e;for(var w=0,r=s.length;w<r;w++){b(e,s[w],t)}return b.filter(u,t)};window.tinymce.dom.Sizzle=b})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/dom/EventUtils.js' */
(function(d){var f=d.each,c=d.DOM,b=d.isIE,e=d.isWebKit,a;d.create("tinymce.dom.EventUtils",{EventUtils:function(){this.inits=[];this.events=[]},add:function(m,p,l,j){var g,h=this,i=h.events,k;if(p instanceof Array){k=[];f(p,function(o){k.push(h.add(m,o,l,j))});return k}if(m&&m.hasOwnProperty&&m instanceof Array){k=[];f(m,function(n){n=c.get(n);k.push(h.add(n,p,l,j))});return k}m=c.get(m);if(!m){return}g=function(n){if(h.disabled){return}n=n||window.event;if(n&&b&&!d.isIE11){if(!n.target){n.target=n.srcElement}d.extend(n,h._stoppers)}if(!j){return l(n)}return l.call(j,n)};if(p=="unload"){d.unloads.unshift({func:g});return g}if(p=="init"){if(h.domLoaded){g()}else{h.inits.push(g)}return g}i.push({obj:m,name:p,func:l,cfunc:g,scope:j});h._add(m,p,g);return l},remove:function(l,m,k){var h=this,g=h.events,i=false,j;if(l&&l.hasOwnProperty&&l instanceof Array){j=[];f(l,function(n){n=c.get(n);j.push(h.remove(n,m,k))});return j}l=c.get(l);f(g,function(o,n){if(o.obj==l&&o.name==m&&(!k||(o.func==k||o.cfunc==k))){g.splice(n,1);h._remove(l,m,o.cfunc);i=true;return false}});return i},clear:function(l){var j=this,g=j.events,h,k;if(l){l=c.get(l);for(h=g.length-1;h>=0;h--){k=g[h];if(k.obj===l){j._remove(k.obj,k.name,k.cfunc);k.obj=k.cfunc=null;g.splice(h,1)}}}},cancel:function(g){if(!g){return false}this.stop(g);return this.prevent(g)},stop:function(g){if(g.stopPropagation){g.stopPropagation()}else{g.cancelBubble=true}return false},prevent:function(g){if(g.preventDefault){g.preventDefault()}else{g.returnValue=false}return false},destroy:function(){var g=this;f(g.events,function(j,h){g._remove(j.obj,j.name,j.cfunc);j.obj=j.cfunc=null});g.events=[];g=null},_add:function(h,i,g){if(h.attachEvent){h.attachEvent("on"+i,g)}else{if(h.addEventListener){h.addEventListener(i,g,false)}else{h["on"+i]=g}}},_remove:function(i,j,h){if(i){try{if(i.detachEvent){i.detachEvent("on"+j,h)}else{if(i.removeEventListener){i.removeEventListener(j,h,false)}else{i["on"+j]=null}}}catch(g){}}},_pageInit:function(h){var g=this;if(g.domLoaded){return}g.domLoaded=true;f(g.inits,function(i){i()});g.inits=[]},_wait:function(i){var g=this,h=i.document;if(i.tinyMCE_GZ&&tinyMCE_GZ.loaded){g.domLoaded=1;return}if(h.readyState==="complete"){g._pageInit(i);return}if(h.attachEvent){h.attachEvent("onreadystatechange",function(){if(h.readyState==="complete"){h.detachEvent("onreadystatechange",arguments.callee);g._pageInit(i)}});if(h.documentElement.doScroll&&i==i.top){(function(){if(g.domLoaded){return}try{h.documentElement.doScroll("left")}catch(j){setTimeout(arguments.callee,0);return}g._pageInit(i)})()}}else{if(h.addEventListener){g._add(i,"DOMContentLoaded",function(){g._pageInit(i)})}}g._add(i,"load",function(){g._pageInit(i)})},_stoppers:{preventDefault:function(){this.returnValue=false},stopPropagation:function(){this.cancelBubble=true}}});a=d.dom.Event=new d.dom.EventUtils();a._wait(window);d.addUnload(function(){a.destroy()})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/dom/Element.js' */
(function(a){a.dom.Element=function(f,d){var b=this,e,c;b.settings=d=d||{};b.id=f;b.dom=e=d.dom||a.DOM;if(!a.isIE){c=e.get(b.id)}a.each(("getPos,getRect,getParent,add,setStyle,getStyle,setStyles,setAttrib,setAttribs,getAttrib,addClass,removeClass,hasClass,getOuterHTML,setOuterHTML,remove,show,hide,isHidden,setHTML,get").split(/,/),function(g){b[g]=function(){var h=[f],j;for(j=0;j<arguments.length;j++){h.push(arguments[j])}h=e[g].apply(e,h);b.update(g);return h}});a.extend(b,{on:function(i,h,g){return a.dom.Event.add(b.id,i,h,g)},getXY:function(){return{x:parseInt(b.getStyle("left")),y:parseInt(b.getStyle("top"))}},getSize:function(){var g=e.get(b.id);return{w:parseInt(b.getStyle("width")||g.clientWidth),h:parseInt(b.getStyle("height")||g.clientHeight)}},moveTo:function(g,h){b.setStyles({left:g,top:h})},moveBy:function(g,i){var h=b.getXY();b.moveTo(h.x+g,h.y+i)},resizeTo:function(g,i){b.setStyles({width:g,height:i})},resizeBy:function(g,j){var i=b.getSize();b.resizeTo(i.w+g,i.h+j)},update:function(h){var g;if(a.isIE6&&d.blocker){h=h||"";if(h.indexOf("get")===0||h.indexOf("has")===0||h.indexOf("is")===0){return}if(h=="remove"){e.remove(b.blocker);return}if(!b.blocker){b.blocker=e.uniqueId();g=e.add(d.container||e.getRoot(),"iframe",{id:b.blocker,style:"position:absolute;",frameBorder:0,src:'javascript:""'});e.setStyle(g,"opacity",0)}else{g=e.get(b.blocker)}e.setStyles(g,{left:b.getStyle("left",1),top:b.getStyle("top",1),width:b.getStyle("width",1),height:b.getStyle("height",1),display:b.getStyle("display",1),zIndex:parseInt(b.getStyle("zIndex",1)||0)-1})}}})}})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/dom/Selection.js' */
(function(c){function e(f){return f.replace(/[\n\r]+/g,"")}var b=c.is,a=c.isIE,d=c.each;c.create("tinymce.dom.Selection",{Selection:function(i,h,g){var f=this;f.dom=i;f.win=h;f.serializer=g;d(["onBeforeSetContent","onBeforeGetContent","onSetContent","onGetContent"],function(j){f[j]=new c.util.Dispatcher(f)});if(!f.win.getSelection){f.tridentSel=new c.dom.TridentSelection(f)}if(c.isIE&&i.boxModel){this._fixIESelection()}c.addUnload(f.destroy,f)},setCursorLocation:function(h,i){var f=this;var g=f.dom.createRng();g.setStart(h,i);g.setEnd(h,i);f.setRng(g);f.collapse(false)},getContent:function(g){var f=this,h=f.getRng(),l=f.dom.create("body"),j=f.getSel(),i,k,m;g=g||{};i=k="";g.get=true;g.format=g.format||"html";g.forced_root_block="";f.onBeforeGetContent.dispatch(f,g);if(g.format=="text"){return f.isCollapsed()?"":(h.text||(j.toString?j.toString():""))}if(h.cloneContents){m=h.cloneContents();if(m){l.appendChild(m)}}else{if(b(h.item)||b(h.htmlText)){l.innerHTML="<br>"+(h.item?h.item(0).outerHTML:h.htmlText);l.removeChild(l.firstChild)}else{l.innerHTML=h.toString()}}if(/^\s/.test(l.innerHTML)){i=" "}if(/\s+$/.test(l.innerHTML)){k=" "}g.getInner=true;g.content=f.isCollapsed()?"":i+f.serializer.serialize(l,g)+k;f.onGetContent.dispatch(f,g);return g.content},setContent:function(h,j){var o=this,f=o.getRng(),k,l=o.win.document,n,m;j=j||{format:"html"};j.set=true;h=j.content=h;if(!j.no_events){o.onBeforeSetContent.dispatch(o,j)}h=j.content;if(f.insertNode){h+='<span id="__caret">_</span>';if(f.startContainer==l&&f.endContainer==l){l.body.innerHTML=h}else{f.deleteContents();if(l.body.childNodes.length==0){l.body.innerHTML=h}else{if(f.createContextualFragment){try{f.insertNode(f.createContextualFragment(h))}catch(g){if(f.startOffset===0&&f.endOffset===0&&f.startContainer.children.length===0){n=l.createDocumentFragment();m=l.createElement("div");m.innerHTML=h;m=m.children[0];n.appendChild(m.cloneNode());while(m=m.nextSibling){n.appendChild(m.cloneNode())}f.startContainer.parentNode.insertBefore(n,f.startContainer)}else{throw (g)}}}else{n=l.createDocumentFragment();m=l.createElement("div");n.appendChild(m);m.outerHTML=h;f.insertNode(n)}}}k=o.dom.get("__caret");f=l.createRange();f.setStartBefore(k);f.setEndBefore(k);o.setRng(f);o.dom.remove("__caret");try{o.setRng(f)}catch(i){}}else{if(f.item){l.execCommand("Delete",false,null);f=o.getRng()}if(/^\s+/.test(h)){f.pasteHTML('<span id="__mce_tmp">_</span>'+h);o.dom.remove("__mce_tmp")}else{f.pasteHTML(h)}}if(!j.no_events){o.onSetContent.dispatch(o,j)}},getStart:function(){var g=this.getRng(),h,f,j,i;if(g.duplicate||g.item){if(g.item){return g.item(0)}j=g.duplicate();j.collapse(1);h=j.parentElement();f=i=g.parentElement();while(i=i.parentNode){if(i==h){h=f;break}}return h}else{h=g.startContainer;if(h.nodeType==1&&h.hasChildNodes()){h=h.childNodes[Math.min(h.childNodes.length-1,g.startOffset)]}if(h&&h.nodeType==3){return h.parentNode}return h}},getEnd:function(){var g=this,h=g.getRng(),i,f;if(h.duplicate||h.item){if(h.item){return h.item(0)}h=h.duplicate();h.collapse(0);i=h.parentElement();if(i&&i.nodeName=="BODY"){return i.lastChild||i}return i}else{i=h.endContainer;f=h.endOffset;if(i.nodeType==1&&i.hasChildNodes()){i=i.childNodes[f>0?f-1:f]}if(i&&i.nodeType==3){return i.parentNode}return i}},getBookmark:function(r,s){var v=this,m=v.dom,g,j,i,n,h,o,p,l="\uFEFF",u;function f(w,x){var t=0;d(m.select(w),function(z,y){if(z==x){t=y}});return t}if(r==2){function k(){var w=v.getRng(true),t=m.doc.body,x={};function y(B,G){var A=B[G?"startContainer":"endContainer"],F=B[G?"startOffset":"endOffset"],z=[],C,E,D=0;if(A.nodeType==3){if(s){for(C=A.previousSibling;C&&C.nodeType==3;C=C.previousSibling){F+=C.nodeValue.length}}z.push(F)}else{E=A.childNodes;if(F>=E.length&&E.length){D=1;F=Math.max(0,E.length-1)}z.push(v.dom.nodeIndex(E[F],s)+D)}for(;A&&A!=t;A=A.parentNode){z.push(v.dom.nodeIndex(A,s))}return z}x.start=y(w,true);if(!v.isCollapsed()){x.end=y(w)}return x}if(v.tridentSel){return v.tridentSel.getBookmark(r)}return k()}if(r){return{rng:v.getRng()}}g=v.getRng();i=m.uniqueId();n=tinyMCE.activeEditor.selection.isCollapsed();u="overflow:hidden;line-height:0px";if(g.duplicate||g.item){if(!g.item){j=g.duplicate();try{g.collapse();g.pasteHTML('<span data-mce-type="bookmark" id="'+i+'_start" style="'+u+'">'+l+"</span>");if(!n){j.collapse(false);g.moveToElementText(j.parentElement());if(g.compareEndPoints("StartToEnd",j)==0){j.move("character",-1)}j.pasteHTML('<span data-mce-type="bookmark" id="'+i+'_end" style="'+u+'">'+l+"</span>")}}catch(q){return null}}else{o=g.item(0);h=o.nodeName;return{name:h,index:f(h,o)}}}else{o=v.getNode();h=o.nodeName;if(h=="IMG"){return{name:h,index:f(h,o)}}j=g.cloneRange();if(!n){j.collapse(false);j.insertNode(m.create("span",{"data-mce-type":"bookmark",id:i+"_end",style:u},l))}g.collapse(true);g.insertNode(m.create("span",{"data-mce-type":"bookmark",id:i+"_start",style:u},l))}v.moveToBookmark({id:i,keep:1});return{id:i}},moveToBookmark:function(n){var r=this,l=r.dom,i,h,f,q,j,s,o,p;if(n){if(n.start){f=l.createRng();q=l.doc.body;function g(y){var t=n[y?"start":"end"],v,w,x,u;if(t){x=t[0];for(w=q,v=t.length-1;v>=1;v--){u=w.childNodes;if(t[v]>u.length-1){return}w=u[t[v]]}if(w.nodeType===3){x=Math.min(t[0],w.nodeValue.length)}if(w.nodeType===1){x=Math.min(t[0],w.childNodes.length)}if(y){f.setStart(w,x)}else{f.setEnd(w,x)}}return true}if(r.tridentSel){return r.tridentSel.moveToBookmark(n)}if(g(true)&&g()){r.setRng(f)}}else{if(n.id){function k(z){var u=l.get(n.id+"_"+z),y,t,w,x,v=n.keep;if(u){y=u.parentNode;if(z=="start"){if(!v){t=l.nodeIndex(u)}else{y=u.firstChild;t=1}j=s=y;o=p=t}else{if(!v){t=l.nodeIndex(u)}else{y=u.firstChild;t=1}s=y;p=t}if(!v){x=u.previousSibling;w=u.nextSibling;d(c.grep(u.childNodes),function(A){if(A.nodeType==3){A.nodeValue=A.nodeValue.replace(/\uFEFF/g,"")}});while(u=l.get(n.id+"_"+z)){l.remove(u,1)}if(x&&w&&x.nodeType==w.nodeType&&x.nodeType==3&&!c.isOpera){t=x.nodeValue.length;x.appendData(w.nodeValue);l.remove(w);if(z=="start"){j=s=x;o=p=t}else{s=x;p=t}}}}}function m(t){if(l.isBlock(t)&&!t.innerHTML){t.innerHTML=!a?'<br data-mce-bogus="1" />':" "}return t}k("start");k("end");if(j){f=l.createRng();f.setStart(m(j),o);f.setEnd(m(s),p);r.setRng(f)}}else{if(n.name){r.select(l.select(n.name)[n.index])}else{if(n.rng){r.setRng(n.rng)}}}}}},select:function(k,j){var i=this,l=i.dom,g=l.createRng(),f;if(k){f=l.nodeIndex(k);g.setStart(k.parentNode,f);g.setEnd(k.parentNode,f+1);if(j){function h(m,o){var n=new c.dom.TreeWalker(m,m);do{if(m.nodeType==3&&c.trim(m.nodeValue).length!=0){if(o){g.setStart(m,0)}else{g.setEnd(m,m.nodeValue.length)}return}if(m.nodeName=="BR"){if(o){g.setStartBefore(m)}else{g.setEndBefore(m)}return}}while(m=(o?n.next():n.prev()))}h(k,1);h(k)}i.setRng(g)}return k},isCollapsed:function(){var f=this,h=f.getRng(),g=f.getSel();if(!h||h.item){return false}if(h.compareEndPoints){return h.compareEndPoints("StartToEnd",h)===0}return !g||h.collapsed},collapse:function(f){var h=this,g=h.getRng(),i;if(g.item){i=g.item(0);g=h.win.document.body.createTextRange();g.moveToElementText(i)}g.collapse(!!f);h.setRng(g)},getSel:function(){var g=this,f=this.win;return f.getSelection?f.getSelection():f.document.selection},getRng:function(m){var g=this,h,i,l,k=g.win.document;if(m&&g.tridentSel){return g.tridentSel.getRangeAt(0)}try{if(h=g.getSel()){i=h.rangeCount>0?h.getRangeAt(0):(h.createRange?h.createRange():k.createRange())}}catch(f){}try{if(c.isIE&&i&&i.setStart&&k.selection&&k.selection.createRange().item){l=k.selection.createRange().item(0);i=k.createRange();i.setStartBefore(l);i.setEndAfter(l)}}catch(j){}if(!i){i=k.createRange?k.createRange():k.body.createTextRange()}if(g.selectedRange&&g.explicitRange){if(i.compareBoundaryPoints(i.START_TO_START,g.selectedRange)===0&&i.compareBoundaryPoints(i.END_TO_END,g.selectedRange)===0){i=g.explicitRange}else{g.selectedRange=null;g.explicitRange=null}}return i},setRng:function(i){var h,g=this;if(!g.tridentSel){h=g.getSel();if(h){g.explicitRange=i;try{h.removeAllRanges()}catch(f){AJS.logError("Exception occurred at tinymce setRng() - removeAllRanges(): "+f)}try{h.addRange(i)}catch(f){AJS.logError("Exception occurred at tinymce setRng() - addRange(): "+f)}g.selectedRange=h.rangeCount>0?h.getRangeAt(0):null}}else{if(i.cloneRange){try{g.tridentSel.addRange(i);return}catch(f){AJS.logError("Exception occurred at tinymce setRng() - tridentSel.addRange(): "+f)}}try{i.select()}catch(f){AJS.logError("Exception occurred at tinymce setRng() - select(): "+f)}}},setNode:function(g){var f=this;f.setContent(f.dom.getOuterHTML(g));return g},getNode:function(){var h=this,g=h.getRng(),i=h.getSel(),l,k=g.startContainer,f=g.endContainer;if(!g){return h.dom.getRoot()}if(g.setStart){l=g.commonAncestorContainer;if(!g.collapsed){if(g.startContainer==g.endContainer){if(g.endOffset-g.startOffset<2){if(g.startContainer.hasChildNodes()){l=g.startContainer.childNodes[g.startOffset]}}}if(k.nodeType===3&&f.nodeType===3){function j(p,m){var o=p;while(p&&p.nodeType===3&&p.length===0){p=m?p.nextSibling:p.previousSibling}return p||o}if(k.length===g.startOffset){k=j(k.nextSibling,true)}else{k=k.parentNode}if(g.endOffset===0){f=j(f.previousSibling,false)}else{f=f.parentNode}if(k&&k===f){return k}}}if(l&&l.nodeType==3){return l.parentNode}return l}return g.item?g.item(0):g.parentElement()},getSelectedBlocks:function(o,g){var m=this,j=m.dom,l,k,h,i=[];l=j.getParent(o||m.getStart(),j.isBlock);k=j.getParent(g||m.getEnd(),j.isBlock);if(l){i.push(l)}if(l&&k&&l!=k){h=l;var f=new c.dom.TreeWalker(l,j.getRoot());while((h=f.next())&&h!=k){if(j.isBlock(h)){i.push(h)}}}if(k&&l!=k){i.push(k)}return i},normalize:function(){var g=this,f,i;if(c.isIE){return}function h(p){var k,o,n,m=g.dom,j=m.getRoot(),l;k=f[(p?"start":"end")+"Container"];o=f[(p?"start":"end")+"Offset"];if(k.nodeType===9){k=k.body;o=0}if(k===j){if(k.hasChildNodes()){k=k.childNodes[Math.min(!p&&o>0?o-1:o,k.childNodes.length-1)];o=0;if(k.nodeName==="TABLE"){return}if(k.hasChildNodes()){l=k;n=new c.dom.TreeWalker(k,j);do{if(l.nodeType===3){o=p?0:l.nodeValue.length-1;k=l;i=true;break}if(/^(BR|IMG)$/.test(l.nodeName)){o=m.nodeIndex(l);k=l.parentNode;if(l.nodeName=="IMG"&&!p){o++}i=true;break}}while(l=(p?n.next():n.prev()))}}}if(i){f["set"+(p?"Start":"End")](k,o)}}f=g.getRng();h(true);if(f.collapsed&&i){h()}if(i){g.setRng(f)}},destroy:function(g){var f=this;f.win=null;if(!g){c.removeUnload(f.destroy)}},_fixIESelection:function(){var g=this.dom,m=g.doc,h=m.body,j,n,f;m.documentElement.unselectable=true;function i(o,r){var p=h.createTextRange();try{p.moveToPoint(o,r)}catch(q){p=null}return p}function l(p){var o;if(p.button){o=i(p.x,p.y);if(o){if(o.compareEndPoints("StartToStart",n)>0){o.setEndPoint("StartToStart",n)}else{o.setEndPoint("EndToEnd",n)}o.select()}}else{k()}}function k(){var o=m.selection?m.selection.createRange():tinyMCE.activeEditor.getBody().createTextRange();if(n&&!o.item&&o.compareEndPoints("StartToEnd",o)===0){n.select()}g.unbind(m,"mouseup",k);g.unbind(m,"mousemove",l);n=j=0}g.bind(m,["mousedown","contextmenu"],function(o){if(o.target.nodeName==="HTML"){if(j){k()}f=m.documentElement;if(f.scrollHeight>f.clientHeight){return}j=1;n=i(o.x,o.y);if(n){g.bind(m,"mouseup",k);g.bind(m,"mousemove",l);g.win.focus();n.select()}}})}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/dom/Serializer.js' */
(function(a){a.dom.Serializer=function(e,i,f){var h,b,d=a.isIE,g=a.each,c;if(!e.apply_source_formatting){e.indent=false}i=i||a.DOM;f=f||new a.html.Schema(e);e.entity_encoding=e.entity_encoding||"named";e.remove_trailing_brs="remove_trailing_brs" in e?e.remove_trailing_brs:true;h=new a.util.Dispatcher(self);b=new a.util.Dispatcher(self);c=new a.html.DomParser(e,f);c.addAttributeFilter("src,href,style",function(k,j){var o=k.length,l,q,n="data-mce-"+j,p=e.url_converter,r=e.url_converter_scope,m;while(o--){l=k[o];q=l.attributes.map[n];if(q!==m){l.attr(j,q.length>0?q:null);l.attr(n,null)}else{q=l.attributes.map[j];if(j==="style"){q=i.serializeStyle(i.parseStyle(q),l.name)}else{if(p){q=p.call(r,q,j,l.name)}}l.attr(j,q.length>0?q:null)}}});c.addAttributeFilter("class",function(j,k){var l=j.length,m,n;while(l--){m=j[l];n=m.attr("class").replace(/\s*mce(Item\w+|Selected)\s*/g,"");m.attr("class",n.length>0?n:null)}});c.addAttributeFilter("data-mce-type",function(j,l,k){var m=j.length,n;while(m--){n=j[m];if(n.attributes.map["data-mce-type"]==="bookmark"&&!k.cleanup){n.remove()}}});c.addNodeFilter("script,style",function(k,l){var m=k.length,n,o;function j(p){return p.replace(/(<!--\[CDATA\[|\]\]-->)/g,"\n").replace(/^[\r\n]*|[\r\n]*$/g,"").replace(/^\s*((<!--)?(\s*\/\/)?\s*<!\[CDATA\[|(<!--\s*)?\/\*\s*<!\[CDATA\[\s*\*\/|(\/\/)?\s*<!--|\/\*\s*<!--\s*\*\/)\s*[\r\n]*/gi,"").replace(/\s*(\/\*\s*\]\]>\s*\*\/(-->)?|\s*\/\/\s*\]\]>(-->)?|\/\/\s*(-->)?|\]\]>|\/\*\s*-->\s*\*\/|\s*-->\s*)\s*$/g,"")}while(m--){n=k[m];o=n.firstChild?n.firstChild.value:"";if(l==="script"){n.attr("type",(n.attr("type")||"text/javascript").replace(/^mce\-/,""));if(o.length>0){n.firstChild.value="// <![CDATA[\n"+j(o)+"\n// ]]>"}}else{if(o.length>0){n.firstChild.value="<!--\n"+j(o)+"\n-->"}}}});c.addNodeFilter("#comment",function(j,k){var l=j.length,m;while(l--){m=j[l];if(m.value.indexOf("[CDATA[")===0){m.name="#cdata";m.type=4;m.value=m.value.replace(/^\[CDATA\[|\]\]$/g,"")}else{if(m.value.indexOf("mce:protected ")===0){m.name="#text";m.type=3;m.raw=true;m.value=unescape(m.value).substr(14)}}}});c.addNodeFilter("xml:namespace,input",function(j,k){var l=j.length,m;while(l--){m=j[l];if(m.type===7){m.remove()}else{if(m.type===1){if(k==="input"&&!("type" in m.attributes.map)){m.attr("type","text")}}}}});if(e.fix_list_elements){c.addNodeFilter("ul,ol",function(k,l){var m=k.length,n,j;while(m--){n=k[m];j=n.parent;if(j.name==="ul"||j.name==="ol"){if(n.prev&&n.prev.name==="li"){n.prev.append(n)}}}})}c.addAttributeFilter("data-mce-src,data-mce-href,data-mce-style",function(j,k){var l=j.length;while(l--){j[l].attr(k,null)}});return{schema:f,addNodeFilter:c.addNodeFilter,addAttributeFilter:c.addAttributeFilter,onPreProcess:h,onPostProcess:b,serialize:function(o,m){var l,p,k,j,n;o=o.cloneNode(true);l=o.ownerDocument.implementation;if(l.createHTMLDocument){p=l.createHTMLDocument("");g(o.nodeName=="BODY"?o.childNodes:[o],function(q){p.body.appendChild(p.importNode(q,true))});if(o.nodeName!="BODY"){o=p.body.firstChild}else{o=p.body}k=i.doc;i.doc=p}m=m||{};m.format=m.format||"html";if(!m.no_events){m.node=o;h.dispatch(self,m)}j=new a.html.Serializer(e,f);m.content=j.serialize(c.parse(m.getInner?o.innerHTML:a.trim(i.getOuterHTML(o),m),m));if(!m.cleanup){m.content=m.content.replace(/\uFEFF|\u200B/g,"")}if(!m.no_events){b.dispatch(self,m)}if(k){i.doc=k}m.node=null;return m.content},addRules:function(j){f.addValidElements(j)},setRules:function(j){f.setValidElements(j)}}}})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/dom/ScriptLoader.js' */
(function(a){a.dom.ScriptLoader=function(h){var c=0,k=1,i=2,l={},j=[],f={},d=[],g=0,e;function b(m,v){var w=this,q=a.DOM,s,o,r,n;function p(){q.remove(n);if(s){s.onreadystatechange=s.onload=s=null}v()}function u(){AJS.log("Failed to load: "+m)}n=q.uniqueId();if(a.isIE6){o=new a.util.URI(m);r=location;if(o.host==r.hostname&&o.port==r.port&&(o.protocol+":")==r.protocol&&o.protocol.toLowerCase()!="file"){a.util.XHR.send({url:a._addVer(o.getURI()),success:function(x){var t=q.create("script",{type:"text/javascript"});t.text=x;document.getElementsByTagName("head")[0].appendChild(t);q.remove(t);p()},error:u});return}}s=q.create("script",{id:n,type:"text/javascript",src:a._addVer(m)});if(!a.isIE){s.onload=p}s.onerror=u;if(!a.isOpera){s.onreadystatechange=function(){var t=s.readyState;if(t=="complete"||t=="loaded"){p()}}}(document.getElementsByTagName("head")[0]||document.body).appendChild(s)}this.isDone=function(m){return l[m]==i};this.markDone=function(m){l[m]=i};this.add=this.load=function(m,q,n){var o,p=l[m];if(p==e){j.push(m);l[m]=c}if(q){if(!f[m]){f[m]=[]}f[m].push({func:q,scope:n||this})}};this.loadQueue=function(n,m){this.loadScripts(j,n,m)};this.loadScripts=function(m,q,p){var o;function n(r){a.each(f[r],function(s){s.func.call(s.scope)});f[r]=e}d.push({func:q,scope:p||this});o=function(){var r=a.grep(m);m.length=0;a.each(r,function(s){if(l[s]==i){n(s);return}if(l[s]!=k){l[s]=k;g++;b(s,function(){l[s]=i;g--;n(s);o()})}});if(!g){a.each(d,function(s){s.func.call(s.scope)});d.length=0}};o()}};a.ScriptLoader=new a.dom.ScriptLoader()})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/dom/TreeWalker.js' */
tinymce.dom.TreeWalker=function(a,c){var b=a;function d(i,f,e,j){var h,g;if(i){if(!j&&i[f]){return i[f]}if(i!=c){h=i[e];if(h){return h}for(g=i.parentNode;g&&g!=c;g=g.parentNode){h=g[e];if(h){return h}}}}}this.current=function(){return b};this.next=function(e){return(b=d(b,"firstChild","nextSibling",e))};this.prev=function(e){return(b=d(b,"lastChild","previousSibling",e))}};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/dom/RangeUtils.js' */
(function(a){a.dom.RangeUtils=function(c){var b="\uFEFF";this.walk=function(d,s){var i=d.startContainer,l=d.startOffset,t=d.endContainer,m=d.endOffset,j,g,o,h,r,q,e;e=c.select("td.mceSelected,th.mceSelected");if(e.length>0){a.each(e,function(u){s([u])});return}function f(u){var v;v=u[0];if(v.nodeType===3&&v===i&&l>=v.nodeValue.length){u.splice(0,1)}v=u[u.length-1];if(m===0&&u.length>0&&v===t&&v.nodeType===3){u.splice(u.length-1,1)}return u}function p(w,v,u){var x=[];for(;w&&w!=u;w=w[v]){x.push(w)}return x}function n(v,u){do{if(v.parentNode==u){return v}v=v.parentNode}while(v)}function k(w,v,x){var u=x?"nextSibling":"previousSibling";for(h=w,r=h.parentNode;h&&h!=v;h=r){r=h.parentNode;q=p(h==w?h:h[u],u);if(q.length){if(!x){q.reverse()}s(f(q))}}}if(i.nodeType==1&&i.hasChildNodes()){i=i.childNodes[l]}if(t.nodeType==1&&t.hasChildNodes()){t=t.childNodes[Math.min(m-1,t.childNodes.length-1)]}if(i==t){return s(f([i]))}j=c.findCommonAncestor(i,t);for(h=i;h;h=h.parentNode){if(h===t){return k(i,j,true)}if(h===j){break}}for(h=t;h;h=h.parentNode){if(h===i){return k(t,j)}if(h===j){break}}g=n(i,j)||i;o=n(t,j)||t;k(i,g,true);q=p(g==i?g:g.nextSibling,"nextSibling",o==t?o.nextSibling:o);if(q.length){s(f(q))}k(t,o)};this.split=function(e){var h=e.startContainer,d=e.startOffset,i=e.endContainer,g=e.endOffset;function f(j,k){return j.splitText(k)}if(h==i&&h.nodeType==3){if(d>0&&d<h.nodeValue.length){i=f(h,d);h=i.previousSibling;if(g>d){g=g-d;h=i=f(i,g).previousSibling;g=i.nodeValue.length;d=0}else{g=0}}}else{if(h.nodeType==3&&d>0&&d<h.nodeValue.length){h=f(h,d);d=0}if(i.nodeType==3&&g>0&&g<i.nodeValue.length){i=f(i,g).previousSibling;g=i.nodeValue.length}}return{startContainer:h,startOffset:d,endContainer:i,endOffset:g}}};a.dom.RangeUtils.compareRanges=function(c,b){if(c&&b){if(c.item||c.duplicate){if(c.item&&b.item&&c.item(0)===b.item(0)){return true}if(c.isEqual&&b.isEqual&&b.isEqual(c)){return true}}else{return c.startContainer==b.startContainer&&c.startOffset==b.startOffset}}return false}})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/KeyboardNavigation.js' */
(function(b){var a=b.dom.Event,c=b.each;b.create("tinymce.ui.KeyboardNavigation",{KeyboardNavigation:function(e,f){var p=this,m=e.root,l=e.items,n=e.enableUpDown,i=e.enableLeftRight||!e.enableUpDown,k=e.excludeFromTabOrder,j,h,o,d,g;f=f||b.DOM;j=function(q){g=q.target.id};h=function(q){f.setAttrib(q.target.id,"tabindex","-1")};d=function(q){var r=f.get(g);f.setAttrib(r,"tabindex","0");r.focus()};p.focus=function(){f.get(g).focus()};p.destroy=function(){c(l,function(q){f.unbind(f.get(q.id),"focus",j);f.unbind(f.get(q.id),"blur",h)});f.unbind(f.get(m),"focus",d);f.unbind(f.get(m),"keydown",o);l=f=m=p.focus=j=h=o=d=null;p.destroy=function(){}};p.moveFocus=function(u,r){var q=-1,t=p.controls,s;if(!g){return}c(l,function(w,v){if(w.id===g){q=v;return false}});q+=u;if(q<0){q=l.length-1}else{if(q>=l.length){q=0}}s=l[q];f.setAttrib(g,"tabindex","-1");f.setAttrib(s.id,"tabindex","0");f.get(s.id).focus();if(e.actOnFocus){e.onAction(s.id)}if(r){a.cancel(r)}};o=function(x){var u=37,t=39,w=38,y=40,q=27,s=14,r=13,v=32;switch(x.keyCode){case u:if(i){p.moveFocus(-1)}break;case t:if(i){p.moveFocus(1)}break;case w:if(n){p.moveFocus(-1)}break;case y:if(n){p.moveFocus(1)}break;case q:if(e.onCancel){e.onCancel();a.cancel(x)}break;case s:case r:case v:if(e.onAction){e.onAction(g);a.cancel(x)}break}};c(l,function(s,q){var r;if(!s.id){s.id=f.uniqueId("_mce_item_")}if(k){f.bind(s.id,"blur",h);r="-1"}else{r=(q===0?"0":"-1")}f.setAttrib(s.id,"tabindex",r);f.bind(f.get(s.id),"focus",j)});if(l[0]){g=l[0].id}f.setAttrib(m,"tabindex","-1");f.bind(f.get(m),"focus",d);f.bind(f.get(m),"keydown",o)}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/Control.js' */
(function(c){var b=c.DOM,a=c.is;c.create("tinymce.ui.Control",{Control:function(f,e,d){this.id=f;this.settings=e=e||{};this.rendered=false;this.onRender=new c.util.Dispatcher(this);this.classPrefix="";this.scope=e.scope||this;this.disabled=0;this.active=0;this.editor=d},setAriaProperty:function(f,e){var d=b.get(this.id+"_aria")||b.get(this.id);if(d){b.setAttrib(d,"aria-"+f,!!e)}},focus:function(){b.get(this.id).focus()},setDisabled:function(d){if(d!=this.disabled){this.setAriaProperty("disabled",d);this.setState("Disabled",d);this.setState("Enabled",!d);this.disabled=d}},isDisabled:function(){return this.disabled},setActive:function(d){if(d!=this.active){this.setState("Active",d);this.active=d;this.setAriaProperty("pressed",d)}},isActive:function(){return this.active},setState:function(f,d){var e=b.get(this.id);f=this.classPrefix+f;if(d){b.addClass(e,f)}else{b.removeClass(e,f)}},isRendered:function(){return this.rendered},renderHTML:function(){},renderTo:function(d){b.setHTML(d,this.renderHTML())},postRender:function(){var e=this,d;if(a(e.disabled)){d=e.disabled;e.disabled=-1;e.setDisabled(d)}if(a(e.active)){d=e.active;e.active=-1;e.setActive(d)}},remove:function(){b.remove(this.id);this.destroy()},destroy:function(){c.dom.Event.clear(this.id)}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/Container.js' */
tinymce.create("tinymce.ui.Container:tinymce.ui.Control",{Container:function(c,b,a){this.parent(c,b,a);this.controls=[];this.lookup={}},add:function(a){this.lookup[a.id]=a;this.controls.push(a);return a},get:function(a){return this.lookup[a]}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/Separator.js' */
tinymce.create("tinymce.ui.Separator:tinymce.ui.Control",{Separator:function(b,a){this.parent(b,a);this.classPrefix="mceSeparator";this.setDisabled(true)},renderHTML:function(){return tinymce.DOM.createHTML("span",{"class":this.classPrefix,role:"separator","aria-orientation":"vertical",tabindex:"-1"})}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/MenuItem.js' */
(function(d){var c=d.is,b=d.DOM,e=d.each,a=d.walk;d.create("tinymce.ui.MenuItem:tinymce.ui.Control",{MenuItem:function(g,f){this.parent(g,f);this.classPrefix="mceMenuItem"},setSelected:function(f){this.setState("Selected",f);this.setAriaProperty("checked",!!f);this.selected=f},isSelected:function(){return this.selected},postRender:function(){var f=this;f.parent();if(c(f.selected)){f.setSelected(f.selected)}}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/Menu.js' */
(function(d){var c=d.is,b=d.DOM,e=d.each,a=d.walk;d.create("tinymce.ui.Menu:tinymce.ui.MenuItem",{Menu:function(h,g){var f=this;f.parent(h,g);f.items={};f.collapsed=false;f.menuCount=0;f.onAddItem=new d.util.Dispatcher(this)},expand:function(g){var f=this;if(g){a(f,function(h){if(h.expand){h.expand()}},"items",f)}f.collapsed=false},collapse:function(g){var f=this;if(g){a(f,function(h){if(h.collapse){h.collapse()}},"items",f)}f.collapsed=true},isCollapsed:function(){return this.collapsed},add:function(f){if(!f.settings){f=new d.ui.MenuItem(f.id||b.uniqueId(),f)}this.onAddItem.dispatch(this,f);return this.items[f.id]=f},addSeparator:function(){return this.add({separator:true})},addMenu:function(f){if(!f.collapse){f=this.createMenu(f)}this.menuCount++;return this.add(f)},hasMenus:function(){return this.menuCount!==0},remove:function(f){delete this.items[f.id]},removeAll:function(){var f=this;a(f,function(g){if(g.removeAll){g.removeAll()}else{g.remove()}g.destroy()},"items",f);f.items={}},createMenu:function(g){var f=new d.ui.Menu(g.id||b.uniqueId(),g);f.onAddItem.add(this.onAddItem.dispatch,this.onAddItem);return f}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/DropMenu.js' */
(function(e){var d=e.is,c=e.DOM,f=e.each,a=e.dom.Event,b=e.dom.Element;e.create("tinymce.ui.DropMenu:tinymce.ui.Menu",{DropMenu:function(h,g){g=g||{};g.container=g.container||c.doc.body;g.offset_x=g.offset_x||0;g.offset_y=g.offset_y||0;g.vp_offset_x=g.vp_offset_x||0;g.vp_offset_y=g.vp_offset_y||0;if(d(g.icons)&&!g.icons){g["class"]+=" mceNoIcons"}this.parent(h,g);this.onShowMenu=new e.util.Dispatcher(this);this.onHideMenu=new e.util.Dispatcher(this);this.classPrefix="mceMenu"},createMenu:function(j){var h=this,i=h.settings,g;j.container=j.container||i.container;j.parent=h;j.constrain=j.constrain||i.constrain;j["class"]=j["class"]||i["class"];j.vp_offset_x=j.vp_offset_x||i.vp_offset_x;j.vp_offset_y=j.vp_offset_y||i.vp_offset_y;j.keyboard_focus=i.keyboard_focus;g=new e.ui.DropMenu(j.id||c.uniqueId(),j);g.onAddItem.add(h.onAddItem.dispatch,h.onAddItem);return g},focus:function(){var g=this;if(g.keyboardNav){g.keyboardNav.focus()}},update:function(){var i=this,j=i.settings,g=c.get("menu_"+i.id+"_tbl"),l=c.get("menu_"+i.id+"_co"),h,k;h=j.max_width?Math.min(g.clientWidth,j.max_width):g.clientWidth;k=j.max_height?Math.min(g.clientHeight,j.max_height):g.clientHeight;if(!c.boxModel){i.element.setStyles({width:h+2,height:k+2})}else{i.element.setStyles({width:h,height:k})}if(j.max_width){c.setStyle(l,"width",h)}if(j.max_height){c.setStyle(l,"height",k);if(g.clientHeight<j.max_height){c.setStyle(l,"overflow","hidden")}}},showMenu:function(p,n,r){var z=this,A=z.settings,o,g=c.getViewPort(),u,l,v,q,i=2,k,j,m=z.classPrefix;z.collapse(1);if(z.isMenuVisible){return}if(!z.rendered){o=c.add(z.settings.container,z.renderNode());f(z.items,function(h){h.postRender()});z.element=new b("menu_"+z.id,{blocker:1,container:A.container})}else{o=c.get("menu_"+z.id)}if(!e.isOpera){c.setStyles(o,{left:-65535,top:-65535})}c.show(o);z.update();p+=A.offset_x||0;n+=A.offset_y||0;g.w-=4;g.h-=4;if(A.constrain){u=o.clientWidth-i;l=o.clientHeight-i;v=g.x+g.w;q=g.y+g.h;if((p+A.vp_offset_x+u)>v){p=r?r-u:Math.max(0,(v-A.vp_offset_x)-u)}if((n+A.vp_offset_y+l)>q){n=Math.max(0,(q-A.vp_offset_y)-l)}}c.setStyles(o,{left:p,top:n});z.element.update();z.isMenuVisible=1;z.mouseClickFunc=a.add(o,"click",function(s){var h;s=s.target;if(s&&(s=c.getParent(s,"tr"))&&!c.hasClass(s,m+"ItemSub")){h=z.items[s.id];if(h.isDisabled()){return}k=z;while(k){if(k.hideMenu){k.hideMenu()}k=k.settings.parent}if(h.settings.onclick){h.settings.onclick(s)}return a.cancel(s)}});if(z.hasMenus()){z.mouseOverFunc=a.add(o,"mouseover",function(w){var h,t,s;w=w.target;if(w&&(w=c.getParent(w,"tr"))){h=z.items[w.id];if(z.lastMenu){z.lastMenu.collapse(1)}if(h.isDisabled()){return}if(w&&c.hasClass(w,m+"ItemSub")){t=c.getRect(w);h.showMenu((t.x+t.w-i),t.y-i,t.x);z.lastMenu=h;c.addClass(c.get(h.id).firstChild,m+"ItemActive")}}})}a.add(o,"keydown",z._keyHandler,z);z.onShowMenu.dispatch(z);if(A.keyboard_focus){z._setupKeyboardNav()}},hideMenu:function(j){var g=this,i=c.get("menu_"+g.id),h;if(!g.isMenuVisible){return}if(g.keyboardNav){g.keyboardNav.destroy()}a.remove(i,"mouseover",g.mouseOverFunc);a.remove(i,"click",g.mouseClickFunc);a.remove(i,"keydown",g._keyHandler);c.hide(i);g.isMenuVisible=0;if(!j){g.collapse(1)}if(g.element){g.element.hide()}if(h=c.get(g.id)){c.removeClass(h.firstChild,g.classPrefix+"ItemActive")}g.onHideMenu.dispatch(g)},add:function(i){var g=this,h;i=g.parent(i);if(g.isRendered&&(h=c.get("menu_"+g.id))){g._add(c.select("tbody",h)[0],i)}return i},collapse:function(g){this.parent(g);this.hideMenu(1)},remove:function(g){c.remove(g.id);this.destroy();return this.parent(g)},destroy:function(){var g=this,h=c.get("menu_"+g.id);if(g.keyboardNav){g.keyboardNav.destroy()}a.remove(h,"mouseover",g.mouseOverFunc);a.remove(c.select("a",h),"focus",g.mouseOverFunc);a.remove(h,"click",g.mouseClickFunc);a.remove(h,"keydown",g._keyHandler);if(g.element){g.element.remove()}c.remove(h)},renderNode:function(){var i=this,j=i.settings,l,h,k,g;g=c.create("div",{role:"listbox",id:"menu_"+i.id,"class":j["class"],style:"position:absolute;left:0;top:0;z-index:200000;outline:0"});if(i.settings.parent){c.setAttrib(g,"aria-parent","menu_"+i.settings.parent.id)}k=c.add(g,"div",{role:"presentation",id:"menu_"+i.id+"_co","class":i.classPrefix+(j["class"]?" "+j["class"]:"")});i.element=new b("menu_"+i.id,{blocker:1,container:j.container});if(j.menu_line){c.add(k,"span",{"class":i.classPrefix+"Line"})}l=c.add(k,"table",{role:"presentation",id:"menu_"+i.id+"_tbl",border:0,cellPadding:0,cellSpacing:0});h=c.add(l,"tbody");f(i.items,function(m){i._add(h,m)});i.rendered=true;return g},_setupKeyboardNav:function(){var i,h,g=this;i=c.get("menu_"+g.id);h=c.select("a[role=option]","menu_"+g.id);h.splice(0,0,i);g.keyboardNav=new e.ui.KeyboardNavigation({root:"menu_"+g.id,items:h,onCancel:function(){g.hideMenu()},enableUpDown:true});i.focus()},_keyHandler:function(g){var h=this,i;switch(g.keyCode){case 37:if(h.settings.parent){h.hideMenu();h.settings.parent.focus();a.cancel(g)}break;case 39:if(h.mouseOverFunc){h.mouseOverFunc(g)}break}},_add:function(j,h){var i,q=h.settings,p,l,k,m=this.classPrefix,g;if(q.separator){l=c.add(j,"tr",{id:h.id,"class":m+"ItemSeparator"});c.add(l,"td",{"class":m+"ItemSeparator"});if(i=l.previousSibling){c.addClass(i,"mceLast")}return}i=l=c.add(j,"tr",{id:h.id,"class":m+"Item "+m+"ItemEnabled"});i=k=c.add(i,q.titleItem?"th":"td");i=p=c.add(i,"a",{id:h.id+"_aria",role:q.titleItem?"presentation":"option",href:"javascript:;",onclick:"return false;",onmousedown:"return false;"});if(q.parent){c.setAttrib(p,"aria-haspopup","true");c.setAttrib(p,"aria-owns","menu_"+h.id)}c.addClass(k,q["class"]);g=c.add(i,"span",{"class":"mceIcon"+(q.icon?" mce_"+q.icon:"")});if(q.icon_src){c.add(g,"img",{src:q.icon_src})}i=c.add(i,q.element||"span",{"class":"mceText",title:h.settings.title},h.settings.title);if(h.settings.style){c.setAttrib(i,"style",h.settings.style)}if(j.childNodes.length==1){c.addClass(l,"mceFirst")}if((i=l.previousSibling)&&c.hasClass(i,m+"ItemSeparator")){c.addClass(l,"mceFirst")}if(h.collapse){c.addClass(l,m+"ItemSub")}if(i=l.previousSibling){c.removeClass(i,"mceLast")}c.addClass(l,"mceLast")}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/Button.js' */
(function(b){var a=b.DOM;b.create("tinymce.ui.Button:tinymce.ui.Control",{Button:function(e,d,c){this.parent(e,d,c);this.classPrefix="mceButton"},renderHTML:function(){var f=this.classPrefix,e=this.settings,d,c;c=a.encode(e.label||"");d='<a role="button" id="'+this.id+'" href="javascript:;" class="'+f+" "+f+"Enabled "+e["class"]+(c?" "+f+"Labeled":"")+'" onmousedown="return false;" onclick="return false;" aria-labelledby="'+this.id+'_voice" title="'+a.encode(e.title)+'">';if(e.image&&!(this.editor&&this.editor.forcedHighContrastMode)){d+='<img class="mceIcon" src="'+e.image+'" alt="'+a.encode(e.title)+'" />'+c}else{d+='<span class="mceIcon '+e["class"]+'"></span>'+(c?'<span class="'+f+'Label">'+c+"</span>":"")}d+='<span class="mceVoiceLabel mceIconOnly" style="display: none;" id="'+this.id+'_voice">'+e.title+"</span>";d+="</a>";return d},postRender:function(){var d=this,e=d.settings,c;if(b.isIE&&d.editor){b.dom.Event.add(d.id,"mousedown",function(f){var g=d.editor.selection.getNode().nodeName;c=g==="IMG"?d.editor.selection.getBookmark():null})}b.dom.Event.add(d.id,"click",function(f){if(!d.isDisabled()){if(b.isIE&&d.editor&&c!==null){d.editor.selection.moveToBookmark(c)}return e.onclick.call(e.scope,f)}});b.dom.Event.add(d.id,"keyup",function(f){if(!d.isDisabled()&&f.keyCode==b.VK.SPACEBAR){return e.onclick.call(e.scope,f)}})}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/ListBox.js' */
(function(d){var c=d.DOM,b=d.dom.Event,e=d.each,a=d.util.Dispatcher;d.create("tinymce.ui.ListBox:tinymce.ui.Control",{ListBox:function(i,h,f){var g=this;g.parent(i,h,f);g.items=[];g.onChange=new a(g);g.onPostRender=new a(g);g.onAdd=new a(g);g.onRenderMenu=new d.util.Dispatcher(this);g.classPrefix="mceListBox"},select:function(h){var g=this,j,i;if(h==undefined){return g.selectByIndex(-1)}if(h&&typeof(h)=="function"){i=h}else{i=function(f){return f==h}}if(h!=g.selectedValue){e(g.items,function(k,f){if(i(k.value)){j=1;g.selectByIndex(f);return false}});if(!j){g.selectByIndex(-1)}}},selectByIndex:function(f){var h=this,i,j,g;if(f!=h.selectedIndex){i=c.get(h.id+"_text");g=c.get(h.id+"_voiceDesc");j=h.items[f];if(j){h.selectedValue=j.value;h.selectedIndex=f;c.setHTML(i,c.encode(j.title));c.setHTML(g,h.settings.title+" - "+j.title);c.removeClass(i,"mceTitle");c.setAttrib(h.id,"aria-valuenow",j.title)}else{c.setHTML(i,c.encode(h.settings.title));c.setHTML(g,c.encode(h.settings.title));c.addClass(i,"mceTitle");h.selectedValue=h.selectedIndex=null;c.setAttrib(h.id,"aria-valuenow",h.settings.title)}i=0}},add:function(i,f,h){var g=this;h=h||{};h=d.extend(h,{title:i,value:f});g.items.push(h);g.onAdd.dispatch(g,h)},getLength:function(){return this.items.length},renderHTML:function(){var i="",f=this,g=f.settings,j=f.classPrefix;i='<span role="listbox" aria-haspopup="true" aria-labelledby="'+f.id+'_voiceDesc" aria-describedby="'+f.id+'_voiceDesc"><table role="presentation" tabindex="0" id="'+f.id+'" cellpadding="0" cellspacing="0" class="'+j+" "+j+"Enabled"+(g["class"]?(" "+g["class"]):"")+'"><tbody><tr>';i+="<td>"+c.createHTML("span",{id:f.id+"_voiceDesc","class":"voiceLabel",style:"display:none;"},f.settings.title);i+=c.createHTML("a",{id:f.id+"_text",tabindex:-1,href:"javascript:;","class":"mceText",onclick:"return false;",onmousedown:"return false;"},c.encode(f.settings.title))+"</td>";i+="<td>"+c.createHTML("a",{id:f.id+"_open",tabindex:-1,href:"javascript:;","class":"mceOpen",onclick:"return false;",onmousedown:"return false;"},'<span><span style="display:none;" class="mceIconOnly" aria-hidden="true">\u25BC</span></span>')+"</td>";i+="</tr></tbody></table></span>";return i},showMenu:function(){var g=this,i,h=c.get(this.id),f;if(g.isDisabled()||g.items.length==0){return}if(g.menu&&g.menu.isMenuVisible){return g.hideMenu()}if(!g.isMenuRendered){g.renderMenu();g.isMenuRendered=true}i=c.getPos(h);f=g.menu;f.settings.offset_x=i.x;f.settings.offset_y=i.y;f.settings.keyboard_focus=!d.isOpera;if(g.oldID){f.items[g.oldID].setSelected(0)}e(g.items,function(j){if(j.value===g.selectedValue){f.items[j.id].setSelected(1);g.oldID=j.id}});f.showMenu(0,h.clientHeight);b.add(c.doc,"mousedown",g.hideMenu,g);c.addClass(g.id,g.classPrefix+"Selected")},hideMenu:function(g){var f=this;if(f.menu&&f.menu.isMenuVisible){c.removeClass(f.id,f.classPrefix+"Selected");if(g&&g.type=="mousedown"&&(g.target.id==f.id+"_text"||g.target.id==f.id+"_open")){return}if(!g||!c.getParent(g.target,".mceMenu")){c.removeClass(f.id,f.classPrefix+"Selected");b.remove(c.doc,"mousedown",f.hideMenu,f);f.menu.hideMenu()}}},renderMenu:function(){var g=this,f;f=g.settings.control_manager.createDropMenu(g.id+"_menu",{menu_line:1,"class":g.classPrefix+"Menu mceNoIcons",max_width:150,max_height:150});f.onHideMenu.add(function(){g.hideMenu();g.focus()});f.add({title:g.settings.title,"class":"mceMenuItemTitle",onclick:function(){if(g.settings.onselect("")!==false){g.select("")}}});e(g.items,function(h){if(h.value===undefined){f.add({title:h.title,role:"option","class":"mceMenuItemTitle",onclick:function(){if(g.settings.onselect("")!==false){g.select("")}}})}else{h.id=c.uniqueId();h.role="option";h.onclick=function(){if(g.settings.onselect(h.value)!==false){g.select(h.value)}};f.add(h)}});g.onRenderMenu.dispatch(g,f);g.menu=f},postRender:function(){var f=this,g=f.classPrefix;b.add(f.id,"click",f.showMenu,f);b.add(f.id,"keydown",function(h){if(h.keyCode==32){f.showMenu(h);b.cancel(h)}});b.add(f.id,"focus",function(){if(!f._focused){f.keyDownHandler=b.add(f.id,"keydown",function(h){if(h.keyCode==40){f.showMenu();b.cancel(h)}});f.keyPressHandler=b.add(f.id,"keypress",function(i){var h;if(i.keyCode==13){h=f.selectedValue;f.selectedValue=null;b.cancel(i);f.settings.onselect(h)}})}f._focused=1});b.add(f.id,"blur",function(){b.remove(f.id,"keydown",f.keyDownHandler);b.remove(f.id,"keypress",f.keyPressHandler);f._focused=0});if(d.isIE6||!c.boxModel){b.add(f.id,"mouseover",function(){if(!c.hasClass(f.id,g+"Disabled")){c.addClass(f.id,g+"Hover")}});b.add(f.id,"mouseout",function(){if(!c.hasClass(f.id,g+"Disabled")){c.removeClass(f.id,g+"Hover")}})}f.onPostRender.dispatch(f,c.get(f.id))},destroy:function(){this.parent();b.clear(this.id+"_text");b.clear(this.id+"_open")}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/NativeListBox.js' */
(function(d){var c=d.DOM,b=d.dom.Event,e=d.each,a=d.util.Dispatcher;d.create("tinymce.ui.NativeListBox:tinymce.ui.ListBox",{NativeListBox:function(g,f){this.parent(g,f);this.classPrefix="mceNativeListBox"},setDisabled:function(f){c.get(this.id).disabled=f;this.setAriaProperty("disabled",f)},isDisabled:function(){return c.get(this.id).disabled},select:function(h){var g=this,j,i;if(h==undefined){return g.selectByIndex(-1)}if(h&&typeof(h)=="function"){i=h}else{i=function(f){return f==h}}if(h!=g.selectedValue){e(g.items,function(k,f){if(i(k.value)){j=1;g.selectByIndex(f);return false}});if(!j){g.selectByIndex(-1)}}},selectByIndex:function(f){c.get(this.id).selectedIndex=f+1;this.selectedValue=this.items[f]?this.items[f].value:null},add:function(j,g,f){var i,h=this;f=f||{};f.value=g;if(h.isRendered()){c.add(c.get(this.id),"option",f,j)}i={title:j,value:g,attribs:f};h.items.push(i);h.onAdd.dispatch(h,i)},getLength:function(){return this.items.length},renderHTML:function(){var g,f=this;g=c.createHTML("option",{value:""},"-- "+f.settings.title+" --");e(f.items,function(h){g+=c.createHTML("option",{value:h.value},h.title)});g=c.createHTML("select",{id:f.id,"class":"mceNativeListBox","aria-labelledby":f.id+"_aria"},g);g+=c.createHTML("span",{id:f.id+"_aria",style:"display: none"},f.settings.title);return g},postRender:function(){var g=this,h,i=true;g.rendered=true;function f(k){var j=g.items[k.target.selectedIndex-1];if(j&&(j=j.value)){g.onChange.dispatch(g,j);if(g.settings.onselect){g.settings.onselect(j)}}}b.add(g.id,"change",f);b.add(g.id,"keydown",function(k){var j;b.remove(g.id,"change",h);i=false;j=b.add(g.id,"blur",function(){if(i){return}i=true;b.add(g.id,"change",f);b.remove(g.id,"blur",j)});if(d.isWebKit&&(k.keyCode==37||k.keyCode==39)){return b.prevent(k)}if(k.keyCode==13||k.keyCode==32){f(k);return b.cancel(k)}});g.onPostRender.dispatch(g,c.get(g.id))}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/MenuButton.js' */
(function(c){var b=c.DOM,a=c.dom.Event,d=c.each;c.create("tinymce.ui.MenuButton:tinymce.ui.Button",{MenuButton:function(g,f,e){this.parent(g,f,e);this.onRenderMenu=new c.util.Dispatcher(this);f.menu_container=f.menu_container||b.doc.body},showMenu:function(){var g=this,j,i,h=b.get(g.id),f;if(g.isDisabled()){return}if(!g.isMenuRendered){g.renderMenu();g.isMenuRendered=true}if(g.isMenuVisible){return g.hideMenu()}j=b.getPos(g.settings.menu_container);i=b.getPos(h);f=g.menu;f.settings.offset_x=i.x;f.settings.offset_y=i.y;f.settings.vp_offset_x=i.x;f.settings.vp_offset_y=i.y;f.settings.keyboard_focus=g._focused;f.showMenu(0,h.clientHeight);a.add(b.doc,"mousedown",g.hideMenu,g);g.setState("Selected",1);g.isMenuVisible=1},renderMenu:function(){var f=this,e;e=f.settings.control_manager.createDropMenu(f.id+"_menu",{menu_line:1,"class":this.classPrefix+"Menu",icons:f.settings.icons});e.onHideMenu.add(function(){f.hideMenu();f.focus()});f.onRenderMenu.dispatch(f,e);f.menu=e},hideMenu:function(g){var f=this;if(g&&g.type=="mousedown"&&b.getParent(g.target,function(h){return h.id===f.id||h.id===f.id+"_open"})){return}if(!g||!b.getParent(g.target,".mceMenu")){f.setState("Selected",0);a.remove(b.doc,"mousedown",f.hideMenu,f);if(f.menu){f.menu.hideMenu()}}f.isMenuVisible=0},postRender:function(){var e=this,f=e.settings;a.add(e.id,"click",function(){if(!e.isDisabled()){if(f.onclick){f.onclick(e.value)}e.showMenu()}})}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/SplitButton.js' */
(function(c){var b=c.DOM,a=c.dom.Event,d=c.each;c.create("tinymce.ui.SplitButton:tinymce.ui.MenuButton",{SplitButton:function(g,f,e){this.parent(g,f,e);this.classPrefix="mceSplitButton"},renderHTML:function(){var i,f=this,g=f.settings,e;i="<tbody><tr>";if(g.image){e=b.createHTML("img ",{src:g.image,role:"presentation","class":"mceAction "+g["class"]})}else{e=b.createHTML("span",{"class":"mceAction "+g["class"]},"")}e+=b.createHTML("span",{"class":"mceVoiceLabel mceIconOnly",id:f.id+"_voice",style:"display:none;"},g.title);i+="<td >"+b.createHTML("a",{role:"button",id:f.id+"_action",tabindex:"-1",href:"javascript:;","class":"mceAction "+g["class"],onclick:"return false;",onmousedown:"return false;",title:g.title},e)+"</td>";e=b.createHTML("span",{"class":"mceOpen "+g["class"]},'<span style="display:none;" class="mceIconOnly" aria-hidden="true">\u25BC</span>');i+="<td >"+b.createHTML("a",{role:"button",id:f.id+"_open",tabindex:"-1",href:"javascript:;","class":"mceOpen "+g["class"],onclick:"return false;",onmousedown:"return false;",title:g.title},e)+"</td>";i+="</tr></tbody>";i=b.createHTML("table",{role:"presentation","class":"mceSplitButton mceSplitButtonEnabled "+g["class"],cellpadding:"0",cellspacing:"0",title:g.title},i);return b.createHTML("div",{id:f.id,role:"button",tabindex:"0","aria-labelledby":f.id+"_voice","aria-haspopup":"true"},i)},postRender:function(){var e=this,g=e.settings,f;if(g.onclick){f=function(h){if(!e.isDisabled()){g.onclick(e.value);a.cancel(h)}};a.add(e.id+"_action","click",f);a.add(e.id,["click","keydown"],function(h){var k=32,m=14,i=13,j=38,l=40;if((h.keyCode===32||h.keyCode===13||h.keyCode===14)&&!h.altKey&&!h.ctrlKey&&!h.metaKey){f();a.cancel(h)}else{if(h.type==="click"||h.keyCode===l){e.showMenu();a.cancel(h)}}})}a.add(e.id+"_open","click",function(h){e.showMenu();a.cancel(h)});a.add([e.id,e.id+"_open"],"focus",function(){e._focused=1});a.add([e.id,e.id+"_open"],"blur",function(){e._focused=0});if(c.isIE6||!b.boxModel){a.add(e.id,"mouseover",function(){if(!b.hasClass(e.id,"mceSplitButtonDisabled")){b.addClass(e.id,"mceSplitButtonHover")}});a.add(e.id,"mouseout",function(){if(!b.hasClass(e.id,"mceSplitButtonDisabled")){b.removeClass(e.id,"mceSplitButtonHover")}})}},destroy:function(){this.parent();a.clear(this.id+"_action");a.clear(this.id+"_open");a.clear(this.id)}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/ColorSplitButton.js' */
(function(d){var c=d.DOM,a=d.dom.Event,b=d.is,e=d.each;d.create("tinymce.ui.ColorSplitButton:tinymce.ui.SplitButton",{ColorSplitButton:function(i,h,f){var g=this;g.parent(i,h,f);g.settings=h=d.extend({colors:"000000,993300,333300,003300,003366,000080,333399,333333,800000,FF6600,808000,008000,008080,0000FF,666699,808080,FF0000,FF9900,99CC00,339966,33CCCC,3366FF,800080,999999,FF00FF,FFCC00,FFFF00,00FF00,00FFFF,00CCFF,993366,C0C0C0,FF99CC,FFCC99,FFFF99,CCFFCC,CCFFFF,99CCFF,CC99FF,FFFFFF",grid_width:8,default_color:"#888888"},g.settings);g.onShowMenu=new d.util.Dispatcher(g);g.onHideMenu=new d.util.Dispatcher(g);g.value=h.default_color},showMenu:function(){var f=this,g,j,i,h;if(f.isDisabled()){return}if(!f.isMenuRendered){f.renderMenu();f.isMenuRendered=true}if(f.isMenuVisible){return f.hideMenu()}i=c.get(f.id);c.show(f.id+"_menu");c.addClass(i,"mceSplitButtonSelected");h=c.getPos(i);c.setStyles(f.id+"_menu",{left:h.x,top:h.y+i.clientHeight,zIndex:200000});i=0;a.add(c.doc,"mousedown",f.hideMenu,f);f.onShowMenu.dispatch(f);if(f._focused){f._keyHandler=a.add(f.id+"_menu","keydown",function(k){if(k.keyCode==27){f.hideMenu()}});c.select("a",f.id+"_menu")[0].focus()}f.isMenuVisible=1},hideMenu:function(g){var f=this;if(f.isMenuVisible){if(g&&g.type=="mousedown"&&c.getParent(g.target,function(h){return h.id===f.id+"_open"})){return}if(!g||!c.getParent(g.target,".mceSplitButtonMenu")){c.removeClass(f.id,"mceSplitButtonSelected");a.remove(c.doc,"mousedown",f.hideMenu,f);a.remove(f.id+"_menu","keydown",f._keyHandler);c.hide(f.id+"_menu")}f.isMenuVisible=0;f.onHideMenu.dispatch()}},renderMenu:function(){var p=this,h,k=0,q=p.settings,g,j,l,o,f;o=c.add(q.menu_container,"div",{role:"listbox",id:p.id+"_menu","class":q.menu_class+" "+q["class"],style:"position:absolute;left:0;top:-1000px;"});h=c.add(o,"div",{"class":q["class"]+" mceSplitButtonMenu"});c.add(h,"span",{"class":"mceMenuLine"});g=c.add(h,"table",{role:"presentation","class":"mceColorSplitMenu"});j=c.add(g,"tbody");k=0;e(b(q.colors,"array")?q.colors:q.colors.split(","),function(m){m=m.replace(/^#/,"");if(!k--){l=c.add(j,"tr");k=q.grid_width-1}g=c.add(l,"td");var i={href:"javascript:;",style:{backgroundColor:"#"+m},title:p.editor.getLang("colors."+m,m),"data-mce-color":"#"+m};if(!d.isIE){i.role="option"}g=c.add(g,"a",i);if(p.editor.forcedHighContrastMode){g=c.add(g,"canvas",{width:16,height:16,"aria-hidden":"true"});if(g.getContext&&(f=g.getContext("2d"))){f.fillStyle="#"+m;f.fillRect(0,0,16,16)}else{c.remove(g)}}});if(q.more_colors_func){g=c.add(j,"tr");g=c.add(g,"td",{colspan:q.grid_width,"class":"mceMoreColors"});g=c.add(g,"a",{role:"option",id:p.id+"_more",href:"javascript:;",onclick:"return false;","class":"mceMoreColors"},q.more_colors_title);a.add(g,"click",function(i){q.more_colors_func.call(q.more_colors_scope||this);return a.cancel(i)})}c.addClass(h,"mceColorSplitMenu");new d.ui.KeyboardNavigation({root:p.id+"_menu",items:c.select("a",p.id+"_menu"),onCancel:function(){p.hideMenu();p.focus()}});a.add(p.id+"_menu","mousedown",function(i){return a.cancel(i)});a.add(p.id+"_menu","click",function(i){var m;i=c.getParent(i.target,"a",j);if(i&&i.nodeName.toLowerCase()=="a"&&(m=i.getAttribute("data-mce-color"))){p.setColor(m)}return a.cancel(i)});return o},setColor:function(f){this.displayColor(f);this.hideMenu();this.settings.onselect(f)},displayColor:function(g){var f=this;c.setStyle(f.id+"_preview","backgroundColor",g);f.value=g},postRender:function(){var f=this,g=f.id;f.parent();c.add(g+"_action","div",{id:g+"_preview","class":"mceColorPreview"});c.setStyle(f.id+"_preview","backgroundColor",f.value)},destroy:function(){this.parent();a.clear(this.id+"_menu");a.clear(this.id+"_more");c.remove(this.id+"_menu")}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/ToolbarGroup.js' */
(function(b){var d=b.DOM,c=b.each,a=b.dom.Event;b.create("tinymce.ui.ToolbarGroup:tinymce.ui.Container",{renderHTML:function(){var f=this,i=[],e=f.controls,j=b.each,g=f.settings;i.push('<div id="'+f.id+'" role="group" aria-labelledby="'+f.id+'_voice">');i.push("<span role='application'>");i.push('<span id="'+f.id+'_voice" class="mceVoiceLabel" style="display:none;">'+d.encode(g.name)+"</span>");j(e,function(h){i.push(h.renderHTML())});i.push("</span>");i.push("</div>");return i.join("")},focus:function(){var e=this;d.get(e.id).focus()},postRender:function(){var f=this,e=[];c(f.controls,function(g){c(g.controls,function(h){if(h.id){e.push(h)}})});f.keyNav=new b.ui.KeyboardNavigation({root:f.id,items:e,onCancel:function(){if(b.isWebKit){d.get(f.editor.id+"_ifr").focus()}f.editor.focus()},excludeFromTabOrder:!f.settings.tab_focus_toolbar})},destroy:function(){var e=this;e.parent();e.keyNav.destroy();a.clear(e.id)}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ui/Toolbar.js' */
(function(a){var c=a.DOM,b=a.each;a.create("tinymce.ui.Toolbar:tinymce.ui.Container",{renderHTML:function(){var m=this,f="",j,k,n=m.settings,e,d,g,l;l=m.controls;for(e=0;e<l.length;e++){k=l[e];d=l[e-1];g=l[e+1];if(e===0){j="mceToolbarStart";if(k.Button){j+=" mceToolbarStartButton"}else{if(k.SplitButton){j+=" mceToolbarStartSplitButton"}else{if(k.ListBox){j+=" mceToolbarStartListBox"}}}f+=c.createHTML("td",{"class":j},c.createHTML("span",null,"<!-- IE -->"))}if(d&&k.ListBox){if(d.Button||d.SplitButton){f+=c.createHTML("td",{"class":"mceToolbarEnd"},c.createHTML("span",null,"<!-- IE -->"))}}if(c.stdMode){f+='<td style="position: relative">'+k.renderHTML()+"</td>"}else{f+="<td>"+k.renderHTML()+"</td>"}if(g&&k.ListBox){if(g.Button||g.SplitButton){f+=c.createHTML("td",{"class":"mceToolbarStart"},c.createHTML("span",null,"<!-- IE -->"))}}}j="mceToolbarEnd";if(k.Button){j+=" mceToolbarEndButton"}else{if(k.SplitButton){j+=" mceToolbarEndSplitButton"}else{if(k.ListBox){j+=" mceToolbarEndListBox"}}}f+=c.createHTML("td",{"class":j},c.createHTML("span",null,"<!-- IE -->"));return c.createHTML("table",{id:m.id,"class":"mceToolbar"+(n["class"]?" "+n["class"]:""),cellpadding:"0",cellspacing:"0",align:m.settings.align||"",role:"presentation",tabindex:"-1"},"<tbody><tr>"+f+"</tr></tbody>")}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/AddOnManager.js' */
(function(b){var a=b.util.Dispatcher,c=b.each;b.create("tinymce.AddOnManager",{AddOnManager:function(){var d=this;d.items=[];d.urls={};d.lookup={};d.onAdd=new a(d)},get:function(d){if(this.lookup[d]){return this.lookup[d].instance}else{return undefined}},dependencies:function(e){var d;if(this.lookup[e]){d=this.lookup[e].dependencies}return d||[]},requireLangPack:function(e){var d=b.settings;if(d&&d.language&&d.language_load!==false){b.ScriptLoader.add(this.urls[e]+"/langs/"+d.language+".js")}},add:function(f,e,d){this.items.push(e);this.lookup[f]={instance:e,dependencies:d};this.onAdd.dispatch(this,f,e);return e},createUrl:function(d,e){if(typeof e==="object"){return e}else{return{prefix:d.prefix,resource:e,suffix:d.suffix}}},addComponents:function(f,d){var e=this.urls[f];b.each(d,function(g){b.ScriptLoader.add(e+"/"+g)})},load:function(j,f,d,h){var g=this,e=f;function i(){var k=g.dependencies(j);b.each(k,function(m){var l=g.createUrl(f,m);g.load(l.resource,l,undefined,undefined)});if(d){if(h){d.call(h)}else{d.call(b.ScriptLoader)}}}if(g.urls[j]){return}if(typeof f==="object"){e=f.prefix+f.resource+f.suffix}if(e.indexOf("/")!=0&&e.indexOf("://")==-1){e=b.baseURL+"/"+e}g.urls[j]=e.substring(0,e.lastIndexOf("/"));if(b.settings.atlassian){AJS.log("Script for ["+j+"] will not be loaded by TinyMCE. Please use Atlassian's requireResource.")}else{if(g.lookup[j]){i()}else{b.ScriptLoader.add(e,i,h)}}}});b.PluginManager=new b.AddOnManager();b.ThemeManager=new b.AddOnManager()}(tinymce));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/EditorManager.js' */
(function(j){var g=j.each,d=j.extend,k=j.DOM,i=j.dom.Event,f=j.ThemeManager,b=j.PluginManager,e=j.explode,h=j.util.Dispatcher,a,c=0;j.documentBaseURL=j.baseURL;AJS.debug("tinymce.documentBaseURL = "+j.documentBaseURL);if(!/[\/\\]$/.test(j.documentBaseURL)){j.documentBaseURL+="/"}j.baseURL=new j.util.URI(j.documentBaseURL).toAbsolute(j.baseURL);j.baseURI=new j.util.URI(j.baseURL);j.onBeforeUnload=new h(j);i.add(window,"beforeunload",function(l){j.onBeforeUnload.dispatch(j,l)});j.onAddEditor=new h(j);j.onRemoveEditor=new h(j);j.EditorManager=d(j,{editors:[],i18n:{},activeEditor:null,init:function(v){var u=this,p,o=j.ScriptLoader,r,l=[],q;function m(x,y,t){var w=x[y];if(!w){return}if(j.is(w,"string")){t=w.replace(/\.\w+$/,"");t=t?j.resolve(t):0;w=j.resolve(w)}return w.apply(t||this,Array.prototype.slice.call(arguments,2))}v=d({theme:"simple",language:"en"},v);u.settings=v;function n(){var s,w;m(v,"onpageload");switch(v.mode){case"exact":s=v.elements||"";if(s.length>0){g(e(s),function(x){if(k.get(x)){q=new j.Editor(x,v);l.push(q);q.render(1)}else{g(document.forms,function(y){g(y.elements,function(z){if(z.name===x){x="mce_editor_"+c++;k.setAttrib(z,"id",x);q=new j.Editor(x,v);l.push(q);q.render(1)}})})}})}break;case"textareas":case"specific_textareas":function t(y,x){return x.constructor===RegExp?x.test(y.className):k.hasClass(y,x)}g(k.select("textarea"),function(x){if(v.editor_deselector&&t(x,v.editor_deselector)){return}if(!v.editor_selector||t(x,v.editor_selector)){r=k.get(x.name);if(!x.id&&!r){x.id=x.name}if(!x.id||u.get(x.id)){x.id=k.uniqueId()}q=new j.Editor(x.id,v);l.push(q);q.render(1)}});break}if(v.oninit){s=w=0;g(l,function(x){w++;if(!x.initialized){x.onInit.add(function(){s++;if(s==w){m(v,"oninit")}})}else{s++}if(s==w){m(v,"oninit")}})}}if(v.atlassian){n()}else{i.add(document,"init",n)}},get:function(l){if(l===a){return this.editors}return this.editors[l]},getInstanceById:function(l){return this.get(l)},add:function(m){var l=this,n=l.editors;n[m.id]=m;n.push(m);l._setActive(m);l.onAddEditor.dispatch(l,m);if(j.adapter){j.adapter.patchEditor(m)}return m},remove:function(n){var m=this,l,o=m.editors;if(!o[n.id]){return null}delete o[n.id];for(l=0;l<o.length;l++){if(o[l]==n){o.splice(l,1);break}}if(m.activeEditor==n){m._setActive(o[0])}n.destroy();m.onRemoveEditor.dispatch(m,n);return n},execCommand:function(r,p,o){var q=this,n=q.get(o),l;switch(r){case"mceFocus":n.focus();return true;case"mceAddEditor":case"mceAddControl":if(!q.get(o)){new j.Editor(o,q.settings).render()}return true;case"mceAddFrameControl":l=o.window;l.tinyMCE=tinyMCE;l.tinymce=j;j.DOM.doc=l.document;j.DOM.win=l;n=new j.Editor(o.element_id,o);n.render();if(j.isIE){function m(){n.destroy();l.detachEvent("onunload",m);l=l.tinyMCE=l.tinymce=null}l.attachEvent("onunload",m)}o.page_window=null;return true;case"mceRemoveEditor":case"mceRemoveControl":if(n){n.remove()}return true;case"mceToggleEditor":if(!n){q.execCommand("mceAddControl",0,o);return true}if(n.isHidden()){n.show()}else{n.hide()}return true}if(q.activeEditor){return q.activeEditor.execCommand(r,p,o)}return false},execInstanceCommand:function(p,o,n,m){var l=this.get(p);if(l){return l.execCommand(o,n,m)}return false},triggerSave:function(){g(this.editors,function(l){l.save()})},addI18n:function(n,q){var l,m=this.i18n;if(!j.is(n,"string")){g(n,function(r,p){g(r,function(t,s){g(t,function(v,u){if(s==="common"){m[p+"."+u]=v}else{m[p+"."+s+"."+u]=v}})})})}else{g(q,function(r,p){m[n+"."+p]=r})}},_setActive:function(l){this.selectedInstance=this.activeEditor=l}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/Editor.js' */
(function(n){var o=n.DOM,k=n.dom.Event,f=n.extend,l=n.util.Dispatcher,i=n.each,a=n.isGecko,b=n.isIE,e=n.isWebKit,d=n.is,h=n.ThemeManager,c=n.PluginManager,p=n.inArray,m=n.grep,g=n.explode,j=n.VK;n.create("tinymce.Editor",{Editor:function(u,r){var q=this;q.id=q.editorId=u;q.execCommands={};q.queryStateCommands={};q.queryValueCommands={};q.isNotDirty=false;q.plugins={};i(["onPreInit","onBeforeRenderUI","onPostRender","onLoad","onInit","onRemove","onActivate","onDeactivate","onClick","onEvent","onMouseUp","onMouseDown","onDblClick","onKeyDown","onKeyUp","onKeyPress","onContextMenu","onSubmit","onReset","onPaste","onPreProcess","onPostProcess","onBeforeSetContent","onBeforeGetContent","onSetContent","onGetContent","onLoadContent","onSaveContent","onNodeChange","onChange","onBeforeExecCommand","onExecCommand","onUndo","onRedo","onVisualAid","onSetProgressState","onSetAttrib"],function(s){q[s]=new l(q)});q.settings=r=f({id:u,language:"en",docs_language:"en",theme:"simple",skin:"default",delta_width:0,delta_height:0,popup_css:"",plugins:"",document_base_url:n.documentBaseURL,add_form_submit_trigger:1,submit_patch:1,add_unload_trigger:1,convert_urls:1,relative_urls:1,remove_script_host:1,table_inline_editing:0,object_resizing:1,cleanup:1,accessibility_focus:1,custom_shortcuts:1,custom_undo_redo_keyboard_shortcuts:1,custom_undo_redo_restore_selection:1,custom_undo_redo:1,doctype:n.isIE6?'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">':"<!DOCTYPE html>",visual_table_class:"mceItemTable",visual:1,font_size_style_values:"xx-small,x-small,small,medium,large,x-large,xx-large",font_size_legacy_values:"xx-small,small,medium,large,x-large,xx-large,300%",apply_source_formatting:1,directionality:"ltr",forced_root_block:"p",hidden_input:1,padd_empty_editor:1,render_ui:1,init_theme:1,force_p_newlines:1,indentation:"30px",keep_styles:1,fix_table_elements:1,inline_styles:1,convert_fonts_to_spans:true,indent:"simple",indent_before:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,ul,li,area,table,thead,tfoot,tbody,tr",indent_after:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,ul,li,area,table,thead,tfoot,tbody,tr",validate:true,entity_encoding:"named",url_converter:q.convertURL,url_converter_scope:q,ie7_compat:true},r);q.documentBaseURI=new n.util.URI(r.document_base_url||n.documentBaseURL,{base_uri:tinyMCE.baseURI});q.baseURI=n.baseURI;q.contentCSS=[];q.execCallback("setup",q)},render:function(u){var v=this,w=v.settings,x=v.id,q=n.ScriptLoader;if(!w.atlassian&&!k.domLoaded){k.add(document,"init",function(){v.render()});return}tinyMCE.settings=w;if(!v.getElement()){return}if(n.isIDevice&&!n.isIOS5){return}if(!/TEXTAREA|INPUT/i.test(v.getElement().nodeName)&&w.hidden_input&&o.getParent(x,"form")){o.insertAfter(o.create("input",{type:"hidden",name:x}),x)}if(n.WindowManager){v.windowManager=new n.WindowManager(v)}if(w.encoding=="xml"){v.onGetContent.add(function(s,t){if(t.save){t.content=o.encode(t.content)}})}if(w.add_form_submit_trigger){v.onSubmit.addToTop(function(){if(v.initialized){v.save();v.isNotDirty=1}})}if(w.add_unload_trigger){v._beforeUnload=tinyMCE.onBeforeUnload.add(function(){if(v.initialized&&!v.destroyed&&!v.isHidden()){v.save({format:"raw",no_events:true})}})}n.addUnload(v.destroy,v);if(w.submit_patch){v.onBeforeRenderUI.add(function(){var s=v.getElement().form;if(!s){return}if(s._mceOldSubmit){return}if(!s.submit.nodeType&&!s.submit.length){v.formElement=s;s._mceOldSubmit=s.submit;s.submit=function(){n.triggerSave();v.isNotDirty=1;return v.formElement._mceOldSubmit(v.formElement)}}s=null})}function r(){if(w.theme&&w.theme.charAt(0)!="-"&&!h.urls[w.theme]){h.load(w.theme,"themes/"+w.theme+"/editor_template"+n.suffix+".js")}i(g(w.plugins),function(y){if(y&&!c.urls[y]){if(y.charAt(0)=="-"){y=y.substr(1,y.length);var t=c.dependencies(y);i(t,function(A){var z={prefix:"plugins/",resource:A,suffix:"/editor_plugin"+n.suffix+".js"};var A=c.createUrl(z,A);c.load(A.resource,A)})}else{if(y=="safari"){return}c.load(y,{prefix:"plugins/",resource:y,suffix:"/editor_plugin"+n.suffix+".js"})}}});function s(){if(!v.removed){v.init()}}if(w.atlassian){s()}else{q.loadQueue(s)}}r()},init:function(){var v,I=this,J=I.settings,F,B,E=I.getElement(),r,q,G,z,D,H,A,x=[];n.add(I);J.aria_label=J.aria_label||o.getAttrib(E,"aria-label",I.getLang("aria.rich_text_area"));if(J.theme){J.theme=J.theme.replace(/-/,"");r=h.get(J.theme);I.theme=new r();if(I.theme.init&&J.init_theme){I.theme.init(I,h.urls[J.theme]||n.documentBaseURL.replace(/\/$/,""))}}function C(w){var K=c.get(w),t=c.urls[w]||n.documentBaseURL.replace(/\/$/,""),s;if(K&&n.inArray(x,w)===-1){i(c.dependencies(w),function(u){C(u)});s=new K(I,t);I.plugins[w]=s;if(s.init){s.init(I,t);x.push(w)}AJS.debug("initPlugin: "+w+" initialised")}}i(g(J.plugins.replace(/\-/g,"")),C);if(J.popup_css!==false){if(J.popup_css){J.popup_css=I.documentBaseURI.toAbsolute(J.popup_css)}else{J.popup_css=I.baseURI.toAbsolute("themes/"+J.theme+"/skins/"+J.skin+"/dialog.css")}}if(J.popup_css_add){J.popup_css+=","+I.documentBaseURI.toAbsolute(J.popup_css_add)}I.controlManager=new n.ControlManager(I);if(J.custom_undo_redo){I.onBeforeExecCommand.add(function(t,w,u,K,s){if(w!="Undo"&&w!="Redo"&&w!="mceRepaint"&&(!s||!s.skip_undo)){I.undoManager.beforeChange()}});I.onExecCommand.add(function(t,w,u,K,s){if(w!="Undo"&&w!="Redo"&&w!="mceRepaint"&&(!s||!s.skip_undo)){I.undoManager.add()}})}I.onExecCommand.add(function(s,t){if(!/^(FontName|FontSize)$/.test(t)){I.nodeChanged()}});if(a){function y(s,t){if(!t||!t.initial){I.execCommand("mceRepaint")}}I.onUndo.add(y);I.onRedo.add(y);I.onSetContent.add(y)}I.onBeforeRenderUI.dispatch(I,I.controlManager);if(J.render_ui){F=J.width||E.style.width||E.offsetWidth;B=J.height||E.style.height||E.offsetHeight;I.orgDisplay=E.style.display;H=/^[0-9\.]+(|px)$/i;if(H.test(""+F)){F=Math.max(parseInt(F)+(r.deltaWidth||0),100)}if(H.test(""+B)){B=Math.max(parseInt(B)+(r.deltaHeight||0),100)}r=I.theme.renderUI({targetNode:E,width:F,height:B,deltaWidth:J.delta_width,deltaHeight:J.delta_height});I.editorContainer=r.editorContainer}if(J.content_editable){E=v=r=null;return I.setupContentEditable()}if(document.domain&&location.hostname!=document.domain){n.relaxedDomain=document.domain}o.setStyles(r.sizeContainer||r.editorContainer,{width:F,height:B});if(J.content_css){n.each(g(J.content_css),function(s){I.contentCSS.push(I.documentBaseURI.toAbsolute(s))})}if(B<100){B=100}AJS.debug("Editor:init iframe base href="+AJS.Rte.getCurrentBaseUrl());I.iframeHTML=J.doctype+'<html><head xmlns="http://www.w3.org/1999/xhtml">';if(J.document_base_url!=n.documentBaseURL){I.iframeHTML+='<base href="'+AJS.Rte.getCurrentBaseUrl()+'" />'}if(J.ie7_compat){I.iframeHTML+='<meta http-equiv="X-UA-Compatible" content="IE=7" />'}else{I.iframeHTML+='<meta http-equiv="X-UA-Compatible" content="IE=edge" />'}I.iframeHTML+='<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />';for(A=0;A<I.contentCSS.length;A++){I.iframeHTML+='<link type="text/css" rel="stylesheet" href="'+I.contentCSS[A]+'" />'}if(J.contentCssTags){I.iframeHTML+=J.contentCssTags}I.contentCSS=[];z=J.body_id||"tinymce";if(z.indexOf("=")!=-1){z=I.getParam("body_id","","hash");z=z[I.id]||z}D=J.body_class||"";if(D.indexOf("=")!=-1){D=I.getParam("body_class","","hash");D=D[I.id]||""}I.iframeHTML+='</head><body id="'+z+'" class="mceContentBody aui-theme-default '+D+'" onload="window.parent.tinyMCE.get(\''+I.id+"').onLoad.dispatch();\"><br></body></html>";if(n.relaxedDomain&&(b||(n.isOpera&&parseFloat(opera.version())<11))){G='javascript:(function(){document.open();document.domain="'+document.domain+'";var ed = window.parent.tinyMCE.get("'+I.id+'");document.write(ed.iframeHTML);document.close();ed.setupIframe();})()'}v=o.add(r.iframeContainer,"iframe",{id:I.id+"_ifr",src:G||'javascript:""',frameBorder:"0",allowTransparency:"true",title:J.aria_label,style:{width:"100%",height:B,display:"block"}});I.contentAreaContainer=r.iframeContainer;o.get(r.editorContainer).style.display=I.orgDisplay;o.get(I.id).style.display="none";o.setAttrib(I.id,"aria-hidden",true);if(!n.relaxedDomain||!G){I.setupIframe()}E=v=r=null},setupIframe:function(){var r=this,w=r.settings,x=o.get(r.id),y=r.getDoc(),v,q;if(!b||!n.relaxedDomain){y.open();y.write(r.iframeHTML);y.close();if(n.relaxedDomain){y.domain=n.relaxedDomain}}q=r.getBody();q.disabled=true;if(!w.readonly){q.contentEditable=true}q.disabled=false;r.schema=new n.html.Schema(w);r.dom=new n.dom.DOMUtils(r.getDoc(),{keep_values:true,url_converter:r.convertURL,url_converter_scope:r,hex_colors:w.force_hex_style_colors,class_filter:w.class_filter,update_styles:1,fix_ie_paragraphs:1,schema:r.schema});r.parser=new n.html.DomParser(w,r.schema);if(!r.settings.allow_html_in_named_anchor){r.parser.addAttributeFilter("name",function(s,t){var A=s.length,C,z,B,D;while(A--){D=s[A];if(D.name==="a"&&D.firstChild){B=D.parent;C=D.lastChild;do{z=C.prev;B.insert(C,D);C=z}while(C)}}})}r.parser.addAttributeFilter("src,href,style",function(s,t){var z=s.length,B,D=r.dom,C,A;while(z--){B=s[z];C=B.attr(t);A="data-mce-"+t;if(!B.attributes.map[A]){if(t==="style"){B.attr(A,D.serializeStyle(D.parseStyle(C),B.name))}else{B.attr(A,r.convertURL(C,t,B.name))}}}});r.parser.addNodeFilter("script",function(s,t){var z=s.length,A;while(z--){A=s[z];A.attr("type","mce-"+(A.attr("type")||"text/javascript"))}});r.parser.addNodeFilter("#cdata",function(s,t){var z=s.length,A;while(z--){A=s[z];A.type=8;A.name="#comment";A.value="[CDATA["+A.value+"]]"}});r.parser.addNodeFilter("p,h1,h2,h3,h4,h5,h6,div",function(t,z){var A=t.length,B,s=r.schema.getNonEmptyElements();while(A--){B=t[A];if(B.isEmpty(r.schema)){B.empty().append(new n.html.Node("br",1)).shortEnded=true}}});r.serializer=new n.dom.Serializer(w,r.dom,r.schema);r.selection=new n.dom.Selection(r.dom,r.getWin(),r.serializer);r.formatter=new n.Formatter(this);r.formatter.register({alignleft:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"left"}},{selector:"img.confluence-embedded-image",classes:"image-left"},{selector:"img,table",collapsed:false,styles:{"float":"left"}}],aligncenter:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"center"}},{selector:"img.confluence-embedded-image",classes:"image-center"},{selector:"table",collapsed:false,styles:{marginLeft:"auto",marginRight:"auto"}}],alignright:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"right"}},{selector:"img.confluence-embedded-image",classes:"image-right"},{selector:"img,table",collapsed:false,styles:{"float":"right"}}],alignfull:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"justify"}}],bold:[{inline:"strong",remove:"all"},{inline:"span",styles:{fontWeight:"bold"}},{inline:"b",remove:"all"}],italic:[{inline:"em",remove:"all"},{inline:"span",styles:{fontStyle:"italic"}},{inline:"i",remove:"all"}],underline:[{inline:"u",remove:"all"},{inline:"span",styles:{textDecoration:"underline"},exact:true}],strikethrough:[{inline:"s",remove:"all"}],forecolor:{inline:"span",styles:{color:"%value"},wrap_links:false},hilitecolor:{inline:"span",styles:{backgroundColor:"%value"},wrap_links:false},fontname:{inline:"span",styles:{fontFamily:"%value"}},fontsize:{inline:"span",styles:{fontSize:"%value"}},fontsize_class:{inline:"span",attributes:{"class":"%value"}},blockquote:{block:"blockquote",wrapper:1,remove:"all"},subscript:{inline:"sub"},superscript:{inline:"sup"},link:{inline:"a",selector:"a",remove:"all",split:true,deep:true,onmatch:function(s){return true},onformat:function(z,s,t){i(t,function(B,A){r.dom.setAttrib(z,A,B)})}},removeformat:[{selector:"b,strong,em,i,font,u,strike",remove:"all",split:true,expand:false,block_expand:true,deep:true},{selector:"span",attributes:["style","class"],remove:"empty",split:true,expand:false,deep:true},{selector:"*",attributes:["style","class"],split:false,expand:false,deep:true}]});i("p h1 h2 h3 h4 h5 h6 div address pre div code dt dd samp".split(/\s/),function(s){r.formatter.register(s,{block:s,remove:"all"})});r.formatter.register(r.settings.formats);r.undoManager=new n.UndoManager(r);r.undoManager.onAdd.add(function(t,s){if(t.hasUndo()){return r.onChange.dispatch(r,s,t)}});r.undoManager.onUndo.add(function(t,s){return r.onUndo.dispatch(r,s,t)});r.undoManager.onRedo.add(function(t,s){return r.onRedo.dispatch(r,s,t)});r.forceBlocks=new n.ForceBlocks(r,{forced_root_block:w.forced_root_block});r.editorCommands=new n.EditorCommands(r);r.serializer.onPreProcess.add(function(s,t){return r.onPreProcess.dispatch(r,t,s)});r.serializer.onPostProcess.add(function(s,t){return r.onPostProcess.dispatch(r,t,s)});AJS.debug("Editor:setupIframe: dispatch onPreInit");r.onPreInit.dispatch(r);if(!w.gecko_spellcheck){r.getBody().spellcheck=0}if(!w.readonly){r._addEvents()}AJS.debug("Editor:setupIframe: dispatch controlManager onPostRender");r.controlManager.onPostRender.dispatch(r,r.controlManager);AJS.debug("Editor:setupIframe: dispatch onPostRender");r.onPostRender.dispatch(r);r.quirks=new n.util.Quirks(this);if(w.directionality){r.getBody().dir=w.directionality}if(w.nowrap){r.getBody().style.whiteSpace="nowrap"}if(w.handle_node_change_callback){r.onNodeChange.add(function(t,s,z){r.execCallback("handle_node_change_callback",r.id,z,-1,-1,true,r.selection.isCollapsed())})}if(w.save_callback){r.onSaveContent.add(function(s,z){var t=r.execCallback("save_callback",r.id,z.content,r.getBody());if(t){z.content=t}})}if(w.onchange_callback){r.onChange.add(function(t,s){r.execCallback("onchange_callback",r,s)})}if(w.protect){r.onBeforeSetContent.add(function(s,t){if(w.protect){i(w.protect,function(z){t.content=t.content.replace(z,function(A){return"<!--mce:protected "+escape(A)+"-->"})})}})}if(w.convert_newlines_to_brs){r.onBeforeSetContent.add(function(s,t){if(t.initial){t.content=t.content.replace(/\r?\n/g,"<br />")}})}if(w.preformatted){r.onPostProcess.add(function(s,t){t.content=t.content.replace(/^\s*<pre.*?>/,"");t.content=t.content.replace(/<\/pre>\s*$/,"");if(t.set){t.content='<pre class="mceItemHidden">'+t.content+"</pre>"}})}if(w.verify_css_classes){r.serializer.attribValueFilter=function(B,z){var A,t;if(B=="class"){if(!r.classesRE){t=r.dom.getClasses();if(t.length>0){A="";i(t,function(s){A+=(A?"|":"")+s["class"]});r.classesRE=new RegExp("("+A+")","gi")}}return !r.classesRE||/(\bmceItem\w+\b|\bmceTemp\w+\b)/g.test(z)||r.classesRE.test(z)?z:""}return z}}if(w.cleanup_callback){r.onBeforeSetContent.add(function(s,t){t.content=r.execCallback("cleanup_callback","insert_to_editor",t.content,t)});r.onPreProcess.add(function(s,t){if(t.set){r.execCallback("cleanup_callback","insert_to_editor_dom",t.node,t)}if(t.get){r.execCallback("cleanup_callback","get_from_editor_dom",t.node,t)}});r.onPostProcess.add(function(s,t){if(t.set){t.content=r.execCallback("cleanup_callback","insert_to_editor",t.content,t)}if(t.get){t.content=r.execCallback("cleanup_callback","get_from_editor",t.content,t)}})}if(w.save_callback){r.onGetContent.add(function(s,t){if(t.save){t.content=r.execCallback("save_callback",r.id,t.content,r.getBody())}})}if(w.handle_event_callback){r.onEvent.add(function(s,t,z){if(r.execCallback("handle_event_callback",t,s,z)===false){k.cancel(t)}})}r.onSetContent.add(function(){r.addVisual(r.getBody())});if(w.padd_empty_editor){r.onPostProcess.add(function(s,t){t.content=t.content.replace(/^(<p[^>]*>(&nbsp;|&#160;|\s|\u00a0|)<\/p>[\r\n]*|<br \/>[\r\n]*)$/,"")})}if(a){function u(s,t){i(s.dom.select("a"),function(A){var z=A.parentNode;if(s.dom.isBlock(z)&&z.lastChild===A){s.dom.add(z,"br",{"data-mce-bogus":1})}})}r.onExecCommand.add(function(s,t){if(t==="CreateLink"){u(s)}});r.onSetContent.add(r.selection.onSetContent.add(u))}r.load({initial:true,format:"html"});r.startContent=r.getContent({format:"raw"});r.undoManager.add();r.initialized=true;AJS.debug("Editor:setupIframe: dispatch onInit");r.onInit.dispatch(r);AJS.debug("Editor:setupIframe: Callback setupcontent_callback");r.execCallback("setupcontent_callback",r.id,r.getBody(),r.getDoc());AJS.debug("Editor:setupIframe: Completed setupcontent_callback");AJS.debug("Editor:setupIframe: Callback init_instance_callback");r.execCallback("init_instance_callback",r);AJS.debug("Editor:setupIframe: Completed init_instance_callback");r.focus(true);r.nodeChanged({initial:1});i(r.contentCSS,function(s){r.dom.loadCSS(s)});if(w.auto_focus){setTimeout(function(){var s=n.get(w.auto_focus);s.selection.select(s.getBody(),1);s.selection.collapse(1);s.getBody().focus();s.getWin().focus()},100)}x=null},setupContentEditable:function(){var q=this,r=q.settings,u=q.getElement();q.contentDocument=r.content_document||document;q.contentWindow=r.content_window||window;q.bodyElement=u;r.content_document=r.content_window=null;o.hide(u);u.contentEditable=q.getParam("content_editable_state",true);o.show(u);if(!r.gecko_spellcheck){q.getDoc().body.spellcheck=0}q.dom=new n.dom.DOMUtils(q.getDoc(),{keep_values:true,url_converter:q.convertURL,url_converter_scope:q,hex_colors:r.force_hex_style_colors,class_filter:r.class_filter,root_element:q.id,fix_ie_paragraphs:1,update_styles:1});q.serializer=new n.dom.Serializer(r,q.dom,schema);q.selection=new n.dom.Selection(q.dom,q.getWin(),q.serializer);q.forceBlocks=new n.ForceBlocks(q,{forced_root_block:r.forced_root_block});q.editorCommands=new n.EditorCommands(q);q.serializer.onPreProcess.add(function(s,t){return q.onPreProcess.dispatch(q,t,s)});q.serializer.onPostProcess.add(function(s,t){return q.onPostProcess.dispatch(q,t,s)});q.onPreInit.dispatch(q);q._addEvents();q.controlManager.onPostRender.dispatch(q,q.controlManager);q.onPostRender.dispatch(q);q.onSetContent.add(function(){q.addVisual(q.getBody())});q.startContent=q.getContent({format:"raw"});q.undoManager.add({initial:true});q.initialized=true;q.onInit.dispatch(q);q.focus(true);q.nodeChanged({initial:1});if(r.content_css){i(g(r.content_css),function(s){q.dom.loadCSS(q.documentBaseURI.toAbsolute(s))})}if(b){q.dom.bind(q.getElement(),"beforedeactivate",function(){q.lastSelectionBookmark=q.selection.getBookmark(1)});q.onBeforeExecCommand.add(function(s,v,t,x,w){if(!o.getParent(s.selection.getStart(),function(y){return y==s.getBody()})){w.terminate=1}if(!o.getParent(s.selection.getEnd(),function(y){return y==s.getBody()})){w.terminate=1}})}u=null},focus:function(u){var x,B=this,A=B.selection,r=B.settings.content_editable,w,y,z=B.getDoc(),s,q;if(!u){w=A.getRng();if(w.item){y=w.item(0)}B._refreshContentEditable();if(!r){if(n.isIE){try{s=this.getWin();q=o.getViewPort(s);B.dom.getRoot().focus();s.scrollTo(q.x,q.y)}catch(v){}}else{B.getWin().focus()}}if(n.isGecko){B.getBody().focus()}if(y&&y.ownerDocument==z){w=z.body.createControlRange();w.addElement(y);w.select()}if(r){if(n.isWebKit){B.getWin().focus()}else{if(n.isIE){B.getElement().setActive()}else{B.getElement().focus()}}}}if(n.activeEditor!=B){if((x=n.activeEditor)!=null){x.onDeactivate.dispatch(x,B)}B.onActivate.dispatch(B,x)}n._setActive(B)},execCallback:function(v){var q=this,u=q.settings[v],r;if(!u){return}if(q.callbackLookup&&(r=q.callbackLookup[v])){u=r.func;r=r.scope}if(d(u,"string")){r=u.replace(/\.\w+$/,"");r=r?n.resolve(r):0;u=n.resolve(u);q.callbackLookup=q.callbackLookup||{};q.callbackLookup[v]={func:u,scope:r}}return u.apply(r||q,Array.prototype.slice.call(arguments,1))},translate:function(q){var t=this.settings.language||"en",r=n.i18n;if(!q){return""}return r[t+"."+q]||q.replace(/{\#([^}]+)\}/g,function(u,s){return r[t+"."+s]||"{#"+s+"}"})},getLang:function(r,q){return n.i18n[(this.settings.language||"en")+"."+r]||(d(q)?q:"{#"+r+"}")},getParam:function(w,s,q){var t=n.trim,r=d(this.settings[w])?this.settings[w]:s,u;if(q==="hash"){u={};if(d(r,"string")){i(r.indexOf("=")>0?r.split(/[;,](?![^=;,]*(?:[;,]|$))/):r.split(","),function(x){x=x.split("=");if(x.length>1){u[t(x[0])]=t(x[1])}else{u[t(x[0])]=t(x)}})}else{u=r}return u}return r},nodeChanged:function(u){var q=this,r=q.selection,v=r.getStart()||q.getBody();if(q.initialized){u=u||{};v=b&&v.ownerDocument!=q.getDoc()?q.getBody():v;u.parents=[];q.dom.getParent(v,function(s){if(s.nodeName=="BODY"){return true}u.parents.push(s)});q.onNodeChange.dispatch(q,u?u.controlManager||q.controlManager:q.controlManager,v,r.isCollapsed(),u)}},addButton:function(u,r){var q=this;q.buttons=q.buttons||{};q.buttons[u]=r},addCommand:function(q,s,r){this.execCommands[q]={func:s,scope:r||this}},addQueryStateHandler:function(q,s,r){this.queryStateCommands[q]={func:s,scope:r||this}},addQueryValueHandler:function(q,s,r){this.queryValueCommands[q]={func:s,scope:r||this}},addShortcut:function(s,v,q,u){var r=this,w;if(!r.settings.custom_shortcuts){return false}r.shortcuts=r.shortcuts||{};if(d(q,"string")){w=q;q=function(){r.execCommand(w,false,null)}}if(d(q,"object")){w=q;q=function(){r.execCommand(w[0],w[1],w[2])}}i(g(s),function(t){var x={func:q,scope:u||this,desc:v,alt:false,ctrl:false,shift:false};i(g(t,"+"),function(y){switch(y){case"alt":case"ctrl":case"shift":x[y]=true;break;default:x.charCode=y.charCodeAt(0);x.keyCode=y.toUpperCase().charCodeAt(0)}});r.shortcuts[(x.ctrl?"ctrl":"")+","+(x.alt?"alt":"")+","+(x.shift?"shift":"")+","+x.keyCode]=x});return true},execCommand:function(x,w,z,q){var u=this,v=0,y,r;if(!/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint|SelectAll)$/.test(x)&&(!q||!q.skip_focus)){u.focus()}q=f({},q);u.onBeforeExecCommand.dispatch(u,x,w,z,q);if(q.terminate){return false}if(u.execCallback("execcommand_callback",u.id,u.selection.getNode(),x,w,z)){u.onExecCommand.dispatch(u,x,w,z,q);return true}if(y=u.execCommands[x]){r=y.func.call(y.scope,w,z);if(r!==true){u.onExecCommand.dispatch(u,x,w,z,q);return r}}i(u.plugins,function(s){if(s.execCommand&&s.execCommand(x,w,z)){u.onExecCommand.dispatch(u,x,w,z,q);v=1;return false}});if(v){return true}if(u.theme&&u.theme.execCommand&&u.theme.execCommand(x,w,z)){u.onExecCommand.dispatch(u,x,w,z,q);return true}if(u.editorCommands.execCommand(x,w,z)){u.onExecCommand.dispatch(u,x,w,z,q);return true}u.getDoc().execCommand(x,w,z);u.onExecCommand.dispatch(u,x,w,z,q)},queryCommandState:function(v){var r=this,w,u;if(r._isHidden()){return}if(w=r.queryStateCommands[v]){u=w.func.call(w.scope);if(u!==true){return u}}w=r.editorCommands.queryCommandState(v);if(w!==-1){return w}try{return this.getDoc().queryCommandState(v)}catch(q){}},queryCommandValue:function(w){var r=this,v,u;if(r._isHidden()){return}if(v=r.queryValueCommands[w]){u=v.func.call(v.scope);if(u!==true){return u}}v=r.editorCommands.queryCommandValue(w);if(d(v)){return v}try{return this.getDoc().queryCommandValue(w)}catch(q){}},show:function(){var q=this;o.show(q.getContainer());o.hide(q.id);q.load()},hide:function(){var q=this,r=q.getDoc();if(b&&r){r.execCommand("SelectAll")}q.save();o.hide(q.getContainer());o.setStyle(q.id,"display",q.orgDisplay)},isHidden:function(){return !o.isHidden(this.id)},setProgressState:function(q,r,s){this.onSetProgressState.dispatch(this,q,r,s);return q},load:function(u){var q=this,s=q.getElement(),r;if(s){u=u||{};u.load=true;r=q.setContent(d(s.value)?s.value:s.innerHTML,u);u.element=s;if(!u.no_events){q.onLoadContent.dispatch(q,u)}u.element=s=null;return r}},save:function(v){var q=this,u=q.getElement(),r,s;if(!u||!q.initialized){return}v=v||{};v.save=true;try{if(!v.no_events){q.undoManager.typing=false;q.undoManager.add()}}catch(u){AJS.logError("editor.save() : "+u)}v.element=u;r=v.content=q.getContent(v);if(!v.no_events){q.onSaveContent.dispatch(q,v)}r=v.content;if(!/TEXTAREA|INPUT/i.test(u.nodeName)){u.innerHTML=r;if(s=o.getParent(q.id,"form")){i(s.elements,function(t){if(t.name==q.id){t.value=r;return false}})}}else{u.value=r}v.element=u=null;return r},setContent:function(v,t){var s=this,r,q=s.getBody(),u;t=t||{};t.format=t.format||"html";t.set=true;t.content=v;if(!t.no_events){s.onBeforeSetContent.dispatch(s,t)}v=t.content;if(!n.isIE&&(v.length===0||/^\s+$/.test(v))){u=s.settings.forced_root_block;if(u){v="<"+u+'><br data-mce-bogus="1"></'+u+">"}else{v='<br data-mce-bogus="1">'}q.innerHTML=v;s.selection.select(q,true);s.selection.collapse(true)}if(t.format!=="raw"){v=new n.html.Serializer({},s.schema).serialize(s.parser.parse(v))}t.content=n.trim(v);s.dom.setHTML(q,t.content);if(!t.no_events){s.onSetContent.dispatch(s,t)}s.selection.normalize();return t.content},getContent:function(r){var q=this,s;r=r||{};r.format=r.format||"html";r.get=true;if(!r.no_events){q.onBeforeGetContent.dispatch(q,r)}if(r.format=="raw"){s=q.getBody().innerHTML}else{s=q.serializer.serialize(q.getBody(),r)}r.content=n.trim(s);if(!r.no_events){q.onGetContent.dispatch(q,r)}return r.content},isDirty:function(){var q=this;return n.trim(q.startContent)!=n.trim(q.getContent({format:"raw",no_events:1}))&&!q.isNotDirty},setDirty:function(r){var q=this;q.isNotDirty=r?0:1},getContainer:function(){var q=this;if(!q.container){q.container=o.get(q.editorContainer||q.id+"_parent")}return q.container},getContentAreaContainer:function(){return this.contentAreaContainer},getElement:function(){return o.get(this.settings.content_element||this.id)},getWin:function(){var q=this,r;if(!q.contentWindow){r=o.get(q.id+"_ifr");if(r){q.contentWindow=r.contentWindow}}return q.contentWindow},getDoc:function(){var r=this,q;if(!r.contentDocument){q=r.getWin();if(q){r.contentDocument=q.document}}return r.contentDocument},getBody:function(){return this.bodyElement||this.getDoc().body},convertURL:function(q,x,w){var r=this,v=r.settings;if(v.urlconverter_callback){return r.execCallback("urlconverter_callback",q,w,true,x)}if(!v.convert_urls||(w&&w.nodeName=="LINK")||q.indexOf("file:")===0){return q}if(v.relative_urls){return r.documentBaseURI.toRelative(q)}q=r.documentBaseURI.toAbsolute(q,v.remove_script_host);return q},addVisual:function(u){var q=this,r=q.settings;u=u||q.getBody();if(!d(q.hasVisual)){q.hasVisual=r.visual}i(q.dom.select("table,a",u),function(t){var s;switch(t.nodeName){case"TABLE":s=q.dom.getAttrib(t,"border");if(!s||s=="0"){if(q.hasVisual){q.dom.addClass(t,r.visual_table_class)}else{q.dom.removeClass(t,r.visual_table_class)}}return;case"A":s=q.dom.getAttrib(t,"name");if(s){if(q.hasVisual){q.dom.addClass(t,"mceItemAnchor")}else{q.dom.removeClass(t,"mceItemAnchor")}}return}});q.onVisualAid.dispatch(q,u,q.hasVisual)},remove:function(){var q=this,r=q.getContainer();q.removed=1;q.hide();q.execCallback("remove_instance_callback",q);q.onRemove.dispatch(q);q.onExecCommand.listeners=[];n.remove(q);o.remove(r)},destroy:function(r){var q=this;if(q.destroyed){return}if(!r){n.removeUnload(q.destroy);tinyMCE.onBeforeUnload.remove(q._beforeUnload);if(q.theme&&q.theme.destroy){q.theme.destroy()}q.controlManager.destroy();q.selection.destroy();q.dom.destroy();if(!q.settings.content_editable){k.clear(q.getWin());k.clear(q.getDoc())}k.clear(q.getBody());k.clear(q.formElement)}if(q.formElement){q.formElement.submit=q.formElement._mceOldSubmit;q.formElement._mceOldSubmit=null}q.contentAreaContainer=q.formElement=q.container=q.settings.content_element=q.bodyElement=q.contentDocument=q.contentWindow=null;if(q.selection){q.selection=q.selection.win=q.selection.dom=q.selection.dom.doc=null}q.destroyed=1},_addEvents:function(){var C=this,u,D=C.settings,r=C.dom,x={mouseup:"onMouseUp",mousedown:"onMouseDown",click:"onClick",keyup:"onKeyUp",keydown:"onKeyDown",keypress:"onKeyPress",submit:"onSubmit",reset:"onReset",contextmenu:"onContextMenu",dblclick:"onDblClick",paste:"onPaste"};function q(t,F){var s=t.type;if(C.removed){return}if(C.onEvent.dispatch(C,t,F)!==false){C[x[t.fakeType||t.type]].dispatch(C,t,F)}}i(x,function(t,s){switch(s){case"contextmenu":r.bind(C.getDoc(),s,q);break;case"paste":r.bind(C.getBody(),s,function(F){q(F)});break;case"submit":case"reset":r.bind(C.getElement().form||o.getParent(C.id,"form"),s,q);break;default:r.bind(D.content_editable?C.getBody():C.getDoc(),s,q)}});r.bind(D.content_editable?C.getBody():(a?C.getDoc():C.getWin()),"focus",function(s){C.focus(true)});if(D.content_editable&&n.isOpera){function E(s){C.focus(true)}r.bind(C.getBody(),"click",E);r.bind(C.getBody(),"keydown",E)}if(n.isGecko){r.bind(C.getDoc(),"DOMNodeInserted",function(t){var s;t=t.target;if(t.nodeType===1&&t.nodeName==="IMG"&&(s=t.getAttribute("data-mce-src"))){t.src=C.documentBaseURI.toAbsolute(s)}})}if(a){function v(){var G=this,I=G.getDoc(),H=G.settings;if(a&&!H.readonly){G._refreshContentEditable();try{I.execCommand("styleWithCSS",0,false)}catch(F){if(!G._isHidden()){try{I.execCommand("useCSS",0,true)}catch(F){}}}if(!H.table_inline_editing){try{I.execCommand("enableInlineTableEditing",false,false)}catch(F){}}if(!H.object_resizing){try{I.execCommand("enableObjectResizing",false,false)}catch(F){}}}}C.onBeforeExecCommand.add(v);C.onMouseDown.add(v)}C.onMouseUp.add(C.nodeChanged);C.onKeyUp.add(function(s,t){var F=t.keyCode;if((F>=33&&F<=36)||(F>=37&&F<=40)||F==13||F==45||F==46||F==8||(n.isMac&&(F==91||F==93))||t.ctrlKey){C.nodeChanged()}});C.onKeyDown.add(function(t,F){if(F.keyCode!=j.BACKSPACE){return}var s=t.selection.getRng(true);if(!s.collapsed){return}var H=s.startContainer;var G=s.startOffset;while(H&&H.nodeType&&H.nodeType!=1&&H.parentNode){H=H.parentNode}if(H&&H.parentNode&&H.parentNode.tagName==="BLOCKQUOTE"&&H.parentNode.firstChild==H&&G===0){t.formatter.toggle("blockquote",null,H.parentNode);s.setStart(H,0);s.setEnd(H,0);t.selection.setRng(s);t.selection.collapse(false)}});C.onReset.add(function(){C.setContent(C.startContent,{format:"raw"})});if(D.custom_shortcuts){if(D.custom_undo_redo_keyboard_shortcuts){C.addShortcut("ctrl+z",C.getLang("undo_desc"),"Undo");C.addShortcut("ctrl+y",C.getLang("redo_desc"),"Redo")}C.addShortcut("ctrl+b",C.getLang("bold_desc"),"Bold");C.addShortcut("ctrl+i",C.getLang("italic_desc"),"Italic");C.addShortcut("ctrl+u",C.getLang("underline_desc"),"Underline");function w(t){var s=null;if(!t.altKey&&!t.ctrlKey&&!t.metaKey){return s}i(C.shortcuts,function(F){if(n.isMac&&(F.ctrl!=t.metaKey&&F.ctrl!=t.ctrlKey)){return}else{if(!n.isMac&&F.ctrl!=t.ctrlKey){return}}if(F.alt!=t.altKey){return}if(F.shift!=t.shiftKey){return}if(t.keyCode==F.keyCode||(t.charCode&&t.charCode==F.charCode)){s=F;return false}});return s}C.onKeyUp.add(function(s,t){var F=w(t);if(F){return k.cancel(t)}});C.onKeyPress.add(function(s,t){var F=w(t);if(F){return k.cancel(t)}});C.onKeyDown.add(function(s,t){var F=w(t);if(F){F.func.call(F.scope);return k.cancel(t)}})}if(n.isIE){r.bind(C.getDoc(),"controlselect",function(F){var t=C.resizeInfo,s;F=F.target;if(F.nodeName!=="IMG"){return}if(t){r.unbind(t.node,t.ev,t.cb)}if(!r.hasClass(F,"mceItemNoResize")){ev="resizeend";s=r.bind(F,ev,function(H){var G;H=H.target;if(G=r.getStyle(H,"width")){r.setAttrib(H,"width",G.replace(/[^0-9%]+/g,""));r.setStyle(H,"width","")}if(G=r.getStyle(H,"height")){r.setAttrib(H,"height",G.replace(/[^0-9%]+/g,""));r.setStyle(H,"height","")}})}else{ev="resizestart";s=r.bind(F,"resizestart",k.cancel,k)}t=C.resizeInfo={node:F,ev:ev,cb:s}})}if(n.isOpera){C.onClick.add(function(s,t){k.prevent(t)})}if(D.custom_undo_redo){function z(){C.undoManager.typing=false;C.undoManager.add()}var y=n.isGecko?"blur":"focusout";r.bind(C.getDoc(),y,function(s){if(!C.removed&&C.undoManager.typing){z()}});C.dom.bind(C.dom.getRoot(),"dragend",function(s){z()});C.onKeyUp.add(function(s,F){var t=F.keyCode;if((t>=33&&t<=36)||(t>=37&&t<=40)||t==13||t==45||F.ctrlKey){z()}});C.onKeyDown.add(function(s,G){var F=G.keyCode,t;if(F==8){t=C.getDoc().selection;if(t&&t.createRange&&t.createRange().item){C.undoManager.beforeChange();s.dom.remove(t.createRange().item(0));z();return k.cancel(G)}}if((F>=33&&F<=36)||(F>=37&&F<=40)||F==13||F==45){if(n.isIE&&F==13){C.undoManager.beforeChange()}if(C.undoManager.typing){z()}return}if((F<16||F>20)&&F!=224&&F!=91&&!C.undoManager.typing){C.undoManager.beforeChange();C.undoManager.typing=true;C.undoManager.add()}});C.onMouseDown.add(function(){if(C.undoManager.typing){z()}})}if(n.isGecko){function B(){var s=C.dom.getAttribs(C.selection.getStart().cloneNode(false));return function(){var t=C.selection.getStart();if(t!==C.getBody()){C.dom.setAttrib(t,"style",null);i(s,function(F){t.setAttributeNode(F.cloneNode(true))})}}}function A(){var t=C.selection;return !t.isCollapsed()&&t.getStart()!=t.getEnd()}C.onKeyPress.add(function(s,F){var t;if((F.keyCode==8||F.keyCode==46)&&A()){t=B();C.getDoc().execCommand("delete",false,null);t();return k.cancel(F)}});C.dom.bind(C.getDoc(),"cut",function(t){var s;if(A()){s=B();C.onKeyUp.addToTop(k.cancel,k);setTimeout(function(){s();C.onKeyUp.remove(k.cancel,k)},0)}})}},_refreshContentEditable:function(){var r=this,q,s;if(r._isHidden()){q=r.getBody();s=q.parentNode;s.removeChild(q);s.appendChild(q);q.focus()}},_isHidden:function(){var q;if(!a){return 0}q=this.selection.getSel();return(!q||!q.rangeCount||q.rangeCount==0)}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/EditorCommands.js' */
(function(c){var d=c.each,e,a=true,b=false;c.EditorCommands=function(n){var m=n.dom,p=n.selection,j={state:{},exec:{},value:{}},k=n.settings,q=n.formatter,o;function r(y,x,w){var v;y=y.toLowerCase();if(v=j.exec[y]){v(y,x,w);return a}return b}function l(w){var v;w=w.toLowerCase();if(v=j.state[w]){return v(w)}return -1}function h(w){var v;w=w.toLowerCase();if(v=j.value[w]){return v(w)}return b}function u(v,w){w=w||"exec";d(v,function(y,x){d(x.toLowerCase().split(","),function(z){j[w][z]=y})})}c.extend(this,{execCommand:r,queryCommandState:l,queryCommandValue:h,addCommands:u});function f(x,w,v){if(w===e){w=b}if(v===e){v=null}return n.getDoc().execCommand(x,w,v)}function t(v){return q.match(v)}function s(v,w){q.toggle(v,w?{value:w}:e)}function i(v){o=p.getBookmark(v)}function g(){p.moveToBookmark(o)}u({"mceResetDesignMode,mceBeginUndoLevel":function(){},"mceEndUndoLevel,mceAddUndoLevel":function(){n.undoManager.add()},"Cut,Copy,Paste":function(y){var x=n.getDoc(),v;try{f(y)}catch(w){v=a}if(v||!x.queryCommandSupported(y)){if(c.isGecko){n.windowManager.confirm(n.getLang("clipboard_msg"),function(z){if(z){open("http://www.mozilla.org/editor/midasdemo/securityprefs.html","_blank")}})}else{n.windowManager.alert(n.getLang("clipboard_no_support"))}}},unlink:function(v){if(p.isCollapsed()){p.select(p.getNode())}f(v);p.collapse(b)},"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull":function(x){var y=x.substring(7);n.undoManager.add();var v=p.getRng();var w=p.getNode();d("left,center,right,full".split(","),function(z){if(y!=z){q.remove("align"+z)}if(!tinyMCE.isIE&&(w.nodeName=="IMG")&&((p.getRng().startContainer.nodeName=="#document")||(p.getRng().startContainer.nodeName=="#text"))){p.setRng(v)}});s("align"+y);r("mceRepaint")},"InsertUnorderedList,InsertOrderedList":function(x){var v,w;f(x);v=m.getParent(p.getNode(),"ol,ul");if(v){w=v.parentNode;if(/^(H[1-6]|P|ADDRESS|PRE)$/.test(w.nodeName)){i();m.split(w,v);g()}}},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(v){s(v)},"ForeColor,HiliteColor,FontName":function(x,w,v){s(x,v)},FontSize:function(y,x,w){var v,z;if(w>=1&&w<=7){z=c.explode(k.font_size_style_values);v=c.explode(k.font_size_classes);if(v){w=v[w-1]||w}else{w=z[w-1]||w}}s(y,w)},RemoveFormat:function(v){q.remove(v)},mceBlockQuote:function(v){s("blockquote")},FormatBlock:function(x,w,v){return s(v||"p")},mceCleanup:function(){var v=p.getBookmark();n.setContent(n.getContent({cleanup:a}),{cleanup:a});p.moveToBookmark(v)},mceRemoveNode:function(y,x,w){var v=w||p.getNode();if(v!=n.getBody()){i();n.dom.remove(v,a);g()}},mceSelectNodeDepth:function(y,x,w){var v=0;m.getParent(p.getNode(),function(z){if(z.nodeType==1&&v++==w){p.select(z);return b}},n.getBody())},mceSelectNode:function(x,w,v){p.select(v)},mceInsertContent:function(A,H,J){var x,I,D,y,E,F,C,B,K,w,z,L,v,G;x=n.parser;I=new c.html.Serializer({},n.schema);v='<span id="mce_marker" data-mce-type="bookmark">\uFEFF</span>';F={content:J,format:"html"};p.onBeforeSetContent.dispatch(p,F);J=F.content;if(J.indexOf("{$caret}")==-1){J+="{$caret}"}J=J.replace(/\{\$caret\}/,v);if(!p.isCollapsed()&&p.getContent().length){n.execCommand("mceDelete",false,null,{skip_undo:true})}D=p.getNode();F={context:D.nodeName.toLowerCase()};E=x.parse(J,F);z=E.lastChild;if(z.attr("id")=="mce_marker"){C=z;for(z=z.prev;z;z=z.walk(true)){if(z.type==3||!m.isBlock(z.name)){z.parent.insert(C,z,z.name==="br");break}}}if(!F.invalid){J=I.serialize(E);z=D.firstChild;L=D.lastChild;if(!z||(z===L&&z.nodeName==="BR")){m.setHTML(D,J)}else{p.setContent(J)}}else{p.setContent(v);D=n.selection.getNode();y=n.getBody();if(D.nodeType==9){D=z=y}else{z=D}while(z!==y){D=z;z=z.parentNode}J=D==y?y.innerHTML:m.getOuterHTML(D);J=I.serialize(x.parse(J.replace(/<span (id="mce_marker"|id=mce_marker).+?<\/span>/i,function(){return I.serialize(E)})));if(D==y){m.setHTML(y,J)}else{m.setOuterHTML(D,J)}}C=m.get("mce_marker");B=m.getRect(C);K=m.getViewPort(n.getWin());if((B.y+B.h>K.y+K.h||B.y<K.y)||(B.x>K.x+K.w||B.x<K.x)){G=c.isIE?n.getDoc().documentElement:n.getBody();G.scrollLeft=B.x;G.scrollTop=B.y-K.h+25}w=m.createRng();z=C.previousSibling;if(z&&z.nodeType==3){w.setStart(z,z.nodeValue.length)}else{w.setStartBefore(C);w.setEndBefore(C)}m.remove(C);p.setRng(w);p.onSetContent.dispatch(p,F);n.addVisual()},mceInsertRawHTML:function(x,w,v){p.setContent("tiny_mce_marker");n.setContent(n.getContent().replace(/tiny_mce_marker/g,function(){return v}))},mceSetContent:function(x,w,v){n.setContent(v)},"Indent,Outdent":function(y){var w,v,x;w=k.indentation;v=/[a-z%]+$/i.exec(w);w=parseInt(w);if(!l("InsertUnorderedList")&&!l("InsertOrderedList")&&!l("InsertInlineTaskList")){d(p.getSelectedBlocks(),function(z){if(y=="outdent"){x=Math.max(0,parseInt(z.style.paddingLeft||0)-w);m.setStyle(z,"paddingLeft",x?x+v:"")}else{m.setStyle(z,"paddingLeft",(parseInt(z.style.paddingLeft||0)+w)+v)}})}else{f(y)}},mceRepaint:function(){var w;if(c.isGecko){try{i(a);if(p.getSel()){p.getSel().selectAllChildren(n.getBody())}p.collapse(a);g()}catch(v){}}},mceToggleFormat:function(x,w,v){q.toggle(v)},InsertHorizontalRule:function(){n.execCommand("mceInsertContent",false,"<hr />")},mceToggleVisualAid:function(){n.hasVisual=!n.hasVisual;n.addVisual()},mceReplaceContent:function(x,w,v){n.execCommand("mceInsertContent",false,v.replace(/\{\$selection\}/g,p.getContent({format:"text"})))},mceInsertLink:function(y,x,w){var v;if(typeof(w)=="string"){w={href:w}}v=m.getParent(p.getNode(),"a");w.href=w.href.replace(" ","%20");if(!v||!w.href){q.remove("link")}if(w.href){q.apply("link",w,v)}},selectAll:function(){var w=m.getRoot(),v=m.createRng();v.setStart(w,0);v.setEnd(w,w.childNodes.length);n.selection.setRng(v)}});u({"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull":function(y){var w="align"+y.substring(7);var v=p.isCollapsed()?[p.getNode()]:p.getSelectedBlocks();var x=c.map(v,function(z){return !!q.matchNode(z,w)});return c.inArray(x,a)!==-1},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(v){return t(v)},mceBlockQuote:function(){return t("blockquote")},Outdent:function(){var v;if(k.inline_styles){if((v=m.getParent(p.getStart(),m.isBlock))&&parseInt(v.style.paddingLeft)>0){return a}if((v=m.getParent(p.getEnd(),m.isBlock))&&parseInt(v.style.paddingLeft)>0){return a}}return l("InsertUnorderedList")||l("InsertOrderedList")||l("InsertInlineTaskList")||(!k.inline_styles&&!!m.getParent(p.getNode(),"BLOCKQUOTE"))},"InsertUnorderedList,InsertOrderedList,InsertInlineTaskList":function(x){var w=m.getParent(p.getNode(),"ul,ol");var v;if(!w){return false}v=w.tagName;return(v==="OL")&&(x==="insertorderedlist")||(v==="UL")&&!m.hasClass(w,"inline-task-list")&&(x==="insertunorderedlist")||(v==="UL")&&m.hasClass(w,"inline-task-list")&&(x==="insertinlinetasklist")}},"state");u({"FontSize,FontName":function(x){var w=0,v;if(v=m.getParent(p.getNode(),"span")){if(x=="fontsize"){w=v.style.fontSize}else{w=v.style.fontFamily.replace(/, /g,",").replace(/[\'\"]/g,"").toLowerCase()}}return w}},"value");if(k.custom_undo_redo){u({Undo:function(){n.undoManager.undo()},Redo:function(){n.undoManager.redo()}})}}})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/UndoManager.js' */
(function(b){var a=b.util.Dispatcher;b.UndoManager=function(f){var d,e=0,h=[],c;function g(){return b.trim(f.getContent({format:"raw",no_events:1}))}return d={typing:false,onAdd:new a(d),onUndo:new a(d),onRedo:new a(d),beforeChange:function(){c=f.selection.getBookmark(2,true)},add:function(m){var j,k=f.settings,l;m=m||{};m.content=g();l=h[e];if(l&&l.content==m.content){return null}if(h[e]){h[e].beforeBookmark=c}if(k.custom_undo_redo_levels){if(h.length>k.custom_undo_redo_levels){for(j=0;j<h.length-1;j++){h[j]=h[j+1]}h.length--;e=h.length}}m.bookmark=f.selection.getBookmark(2,true);if(e<h.length-1){h.length=e+1}h.push(m);e=h.length-1;d.onAdd.dispatch(d,m);f.isNotDirty=0;return m},undo:function(){var k,j;if(d.typing){d.add();d.typing=false}if(e>0){k=h[--e];f.setContent(k.content,{format:"raw"});f.selection.moveToBookmark(k.beforeBookmark);d.onUndo.dispatch(d,k)}return k},redo:function(){var i;if(e<h.length-1){i=h[++e];f.setContent(i.content,{format:"raw"});f.selection.moveToBookmark(i.bookmark);d.onRedo.dispatch(d,i)}return i},clear:function(){h=[];e=0;d.typing=false},hasUndo:function(){return e>0||this.typing},hasRedo:function(){return e<h.length-1&&!this.typing},ignore:function(i,k){var j=h.slice();i.call(k||f);h=j}}}})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ForceBlocks.js' */
(function(l){var j=l.dom.Event,c=l.isIE,a=l.isGecko,b=l.isOpera,i=l.each,h=l.extend,d=true,g=false;function k(o){var p,n,m;do{if(/^(SPAN|STRONG|B|EM|I|FONT|STRIKE|U)$/.test(o.nodeName)){if(p){n=o.cloneNode(false);n.appendChild(p);p=n}else{p=m=o.cloneNode(false)}p.removeAttribute("id")}}while(o=o.parentNode);if(p){return{wrapper:p,inner:m}}}function f(n,o){var m=o.ownerDocument.createRange();m.setStart(n.endContainer,n.endOffset);m.setEndAfter(o);return m.cloneContents().textContent.length==0}function e(o,q,m){var n,p;if(q.isEmpty(m)){n=q.getParent(m,"ul,ol");if(!q.getParent(n.parentNode,"ul,ol")){q.split(n,m);p=q.create("p",0,'<br data-mce-bogus="1" />');q.replace(p,m);o.select(p,1)}AJS.Rte.showSelection();return g}return d}l.create("tinymce.ForceBlocks",{ForceBlocks:function(m){var n=this,o=m.settings,p;n.editor=m;n.dom=m.dom;p=(o.forced_root_block||"p").toLowerCase();o.element=p.toUpperCase();m.onPreInit.add(n.setup,n)},setup:function(){var n=this,m=n.editor,p=m.settings,u=m.dom,o=m.selection,q=m.schema.getBlockElements();if(p.forced_root_block){function v(){var x=o.getStart(),t=u.getRoot(),C=m.getDoc().body,s,y,E,G,F,w,z,B=-16777215;function A(H){return(H&&H.nodeType===1)}if(!A(x)){return}while(x!=t){if(A(x)){if(q[x.nodeName]){return}x=x.parentNode}else{return}}s=o.getRng();if(s.setStart){y=s.startContainer;E=s.startOffset;G=s.endContainer;F=s.endOffset}else{if(s.item){s=m.getDoc().body.createTextRange();s.moveToElementText(s.item(0))}tmpRng=s.duplicate();tmpRng.collapse(true);E=tmpRng.move("character",B)*-1;if(!tmpRng.collapsed){tmpRng=s.duplicate();tmpRng.collapse(false);F=(tmpRng.move("character",B)*-1)-E}}for(x=t.firstChild;x;x){if(x.nodeType===3||(x.nodeType==1&&!q[x.nodeName])){if(!w){w=u.create(p.forced_root_block);x.parentNode.insertBefore(w,x)}z=x;x=x.nextSibling;w.appendChild(z)}else{w=null;x=x.nextSibling}}if(s.setStart){s.setStart(y,E);s.setEnd(G,F);o.setRng(s)}else{try{s=C.createTextRange();s.moveToElementText(C);s.move("character",B);s.collapse(true);s.moveStart("character",E);if(F>0){s.moveEnd("character",F)}s.select()}catch(D){}}m.nodeChanged()}m.onKeyUp.add(v);m.onKeyDown.add(v);m.onClick.add(v)}if(p.force_br_newlines){if(c){m.onKeyPress.add(function(s,t){var w;if(t.keyCode==13&&o.getNode().nodeName!="LI"){o.setContent('<br id="__" /> ',{format:"raw"});w=u.get("__");w.removeAttribute("id");o.select(w);o.collapse();return j.cancel(t)}})}}if(p.force_p_newlines){if(!c){m.onKeyPress.add(function(s,t){if(t.keyCode==13&&!t.shiftKey&&!n.insertPara(t)){j.cancel(t)}})}if(a){m.onKeyDown.add(function(s,t){if((t.keyCode==8||t.keyCode==46)&&!t.shiftKey){n.backspaceDelete(t,t.keyCode==8)}})}}if(l.isWebKit){function r(z){var s=o.getRng(),C,t=u.create("div",null," "),B,x,w=u.getViewPort(z.getWin());s.insertNode(C=u.create("br"));s.setStartAfter(C);s.setEndAfter(C);o.setRng(s);if(o.getSel().focusNode==C.previousSibling){o.select(u.insertAfter(u.doc.createTextNode("\u00a0"),C));o.collapse(d)}u.insertAfter(t,C);B=u.getPos(t).y;x=u.getSize(t).h;u.remove(t);var y=B+x;var A=w.y+w.h;if(y>A){z.getWin().scrollTo(0,y-w.h)}}m.onKeyPress.add(function(s,t){if(t.keyCode==13&&(t.shiftKey||(p.force_br_newlines&&!u.getParent(o.getNode(),"h1,h2,h3,h4,h5,h6,ol,ul")))){r(s);j.cancel(t)}})}if(c){if(p.element!="P"){m.onKeyPress.add(function(s,t){n.lastElm=o.getNode().nodeName});m.onKeyUp.add(function(t,w){var y,x=o.getNode(),s=t.getBody();if(s.childNodes.length===1&&x.nodeName=="P"){x=u.rename(x,p.element);o.select(x);o.collapse();t.nodeChanged()}else{if(w.keyCode==13&&!w.shiftKey&&n.lastElm!="P"){y=u.getParent(x,"p");if(y){u.rename(y,p.element);t.nodeChanged()}}}})}}},getParentBlock:function(o){var m=this.dom;return m.getParent(o,m.isBlock)},insertPara:function(S){var D=this,v=D.editor,N=v.dom,T=v.getDoc(),Y=v.settings,E=v.selection.getSel(),F=E.getRangeAt(0),W=T.body;var K,L,H,P,O,q,o,u,x,m,B,V,p,w,I,M=N.getViewPort(v.getWin()),A,C,z;v.undoManager.beforeChange();K=T.createRange();K.setStart(E.anchorNode,E.anchorOffset);K.collapse(d);L=T.createRange();L.setStart(E.focusNode,E.focusOffset);L.collapse(d);H=K.compareBoundaryPoints(K.START_TO_END,L)<0;P=H?E.anchorNode:E.focusNode;O=H?E.anchorOffset:E.focusOffset;q=H?E.focusNode:E.anchorNode;o=H?E.focusOffset:E.anchorOffset;var R;if(l.isWebKit&&P===q&&P.nodeType===1&&P.childNodes.length>0&&v.dom.is(R=P.childNodes[O>0?O-1:0],"table")){var X=N.create("p",0,'<br data-mce-bogus="1" />');N.insertAfter(X,R);F.setStart(X,0);v.selection.setRng(F);var G=v.dom.getPos(X).y;if(G>M.y){v.getWin().scrollTo(0,G)}v.undoManager.add();return g}if(P===q&&/^(TD|TH)$/.test(P.nodeName)){if(P.firstChild.nodeName=="BR"){N.remove(P.firstChild)}if(P.childNodes.length==0){v.dom.add(P,Y.element,null,"<br />");V=v.dom.add(P,Y.element,null,"<br />")}else{I=P.innerHTML;P.innerHTML="";v.dom.add(P,Y.element,null,I);V=v.dom.add(P,Y.element,null,"<br />")}F=T.createRange();F.selectNodeContents(V);F.collapse(1);v.selection.setRng(F);return g}if(P==W&&q==W&&W.firstChild&&v.dom.isBlock(W.firstChild)){P=q=P.firstChild;O=o=0;K=T.createRange();K.setStart(P,0);L=T.createRange();L.setStart(q,0)}if(!T.body.hasChildNodes()){T.body.appendChild(N.create("br"))}P=P.nodeName=="HTML"?T.body:P;P=P.nodeName=="BODY"?P.firstChild:P;q=q.nodeName=="HTML"?T.body:q;q=q.nodeName=="BODY"?q.firstChild:q;var J=v.dom.getRoot();if(P.nodeName==J.nodeName){P=P.firstChild;O=0}if(q.nodeName==J.nodeName){q=q.firstChild;o=0}u=D.getParentBlock(P);x=D.getParentBlock(q);m=u?u.nodeName:Y.element;if(I=D.dom.getParent(u,"li,pre")){if(I.nodeName=="LI"){return e(v.selection,D.dom,I)}return d}if(u&&(u.nodeName=="CAPTION"||/absolute|relative|fixed/gi.test(N.getStyle(u,"position",1)))){m=Y.element;u=null}if(x&&(x.nodeName=="CAPTION"||/absolute|relative|fixed/gi.test(N.getStyle(u,"position",1)))){m=Y.element;x=null}if(/(TD|TABLE|TH|CAPTION)/.test(m)||(u&&m=="DIV"&&/left|right/gi.test(N.getStyle(u,"float",1)))){m=Y.element;u=x=null}B=(u&&u.nodeName==m)?u.cloneNode(0):v.dom.create(m);V=(x&&x.nodeName==m)?x.cloneNode(0):v.dom.create(m);V.removeAttribute("id");if(/^(H[1-6])$/.test(m)&&f(F,u)){V=v.dom.create(Y.element)}I=p=P;do{if(I==W||I.nodeType==9||D.dom.isBlock(I)||/(TD|TABLE|TH|CAPTION)/.test(I.nodeName)){break}p=I}while((I=I.previousSibling?I.previousSibling:I.parentNode));I=w=q;do{if(I==W||I.nodeType==9||D.dom.isBlock(I)||/(TD|TABLE|TH|CAPTION)/.test(I.nodeName)){break}w=I}while((I=I.nextSibling?I.nextSibling:I.parentNode));if(p.nodeName==m){K.setStart(p,0)}else{K.setStartBefore(p)}K.setEnd(P,O);B.appendChild(K.cloneContents()||T.createTextNode(""));try{L.setEndAfter(w)}catch(Q){}L.setStart(q,o);V.appendChild(L.cloneContents()||T.createTextNode(""));F=T.createRange();if(!p.previousSibling&&p.parentNode.nodeName==m){F.setStartBefore(p.parentNode)}else{if(K.startContainer.nodeName==m&&K.startOffset==0){F.setStartBefore(K.startContainer)}else{F.setStart(K.startContainer,K.startOffset)}}if(!w.nextSibling&&w.parentNode.nodeName==m){F.setEndAfter(w.parentNode)}else{F.setEnd(L.endContainer,L.endOffset)}F.deleteContents();if(b){v.getWin().scrollTo(0,M.y)}if(B.firstChild&&B.firstChild.nodeName==m){B.innerHTML=B.firstChild.innerHTML}if(V.firstChild&&V.firstChild.nodeName==m){V.innerHTML=V.firstChild.innerHTML}function U(y,s){var r=[],aa,Z,t;y.innerHTML="";if(Y.keep_styles){Z=s;do{if(/^(SPAN|STRONG|B|EM|I|FONT|STRIKE|U)$/.test(Z.nodeName)){aa=Z.cloneNode(g);N.setAttrib(aa,"id","");r.push(aa)}}while(Z=Z.parentNode)}if(r.length>0){for(t=r.length-1,aa=y;t>=0;t--){aa=aa.appendChild(r[t])}r[0].innerHTML=b?"\u00a0":"<br />";return r[0]}else{y.innerHTML=b?"\u00a0":"<br />"}}if(N.isEmpty(B)){U(B,P)}if(N.isEmpty(V)){z=U(V,q)}if(b&&parseFloat(opera.version())<9.5){F.insertNode(B);F.insertNode(V)}else{F.insertNode(V);F.insertNode(B)}V.normalize();B.normalize();v.selection.select(V,true);v.selection.collapse(true);A=v.dom.getPos(V).y;if(A<M.y||A+25>M.y+M.h){v.getWin().scrollTo(0,A<M.y?A:A-M.h+25)}v.undoManager.add();return g},backspaceDelete:function(x,E){var F=this,v=F.editor,A=v.getBody(),s=v.dom,p,y=v.selection,o=y.getRng(),z=o.startContainer,p,C,D,m;var B=x.getPreventDefault?x.getPreventDefault():x.defaultPrevented;if(B){return}if(!E&&o.collapsed&&z.nodeType==1&&o.startOffset==z.childNodes.length){m=new l.dom.TreeWalker(z.lastChild,z);for(p=z.lastChild;p;p=m.prev()){if(p.nodeType==3){o.setStart(p,p.nodeValue.length);o.collapse(true);y.setRng(o);return}}}if(z&&v.dom.isBlock(z)&&!/^(TD|TH)$/.test(z.nodeName)&&E){if(z.childNodes.length==0||(z.childNodes.length==1&&z.firstChild.nodeName=="BR")){p=z;while((p=p.previousSibling)&&!v.dom.isBlock(p)){}if(p){if(z!=A.firstChild){C=v.dom.doc.createTreeWalker(p,NodeFilter.SHOW_TEXT,null,g);while(D=C.nextNode()){p=D}o=v.getDoc().createRange();o.setStart(p,p.nodeValue?p.nodeValue.length:0);o.setEnd(p,p.nodeValue?p.nodeValue.length:0);y.setRng(o);v.dom.remove(z)}return j.cancel(x)}}}if(!E&&o.collapsed&&/^(BODY)$/.test(z.nodeName)){var q=z.childNodes[o.startOffset];if(q&&v.dom.isBlock(q)&&!/^(TD|TH)$/.test(q.nodeName)){if(q.childNodes.length==0||(q.childNodes.length==1&&q.firstChild.nodeName=="BR")){p=q;var u;while((p=p.nextSibling)){if(v.dom.isBlock(p)){u=p;break}}if(u){if(q!=A.lastChild){C=v.dom.doc.createTreeWalker(u,NodeFilter.SHOW_TEXT,null,g);u=C.nextNode();o=v.getDoc().createRange();o.setStart(u,0);o.setEnd(u,0);y.setRng(o);v.dom.remove(q);return j.cancel(x)}}}}}}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/ControlManager.js' */
(function(c){var b=c.DOM,a=c.dom.Event,d=c.each,e=c.extend;c.create("tinymce.ControlManager",{ControlManager:function(f,j){var h=this,g;j=j||{};h.editor=f;h.controls={};h.onAdd=new c.util.Dispatcher(h);h.onPostRender=new c.util.Dispatcher(h);h.prefix=j.prefix||f.id+"_";h._cls={};h.onPostRender.add(function(){d(h.controls,function(i){i.postRender()})})},get:function(f){return this.controls[this.prefix+f]||this.controls[f]},setActive:function(h,f){var g=null;if(g=this.get(h)){g.setActive(f)}return g},setDisabled:function(h,f){var g=null;if(g=this.get(h)){g.setDisabled(f)}return g},add:function(g){var f=this;if(g){f.controls[g.id]=g;f.onAdd.dispatch(g,f)}return g},createControl:function(i){var h,g=this,f=g.editor;d(f.plugins,function(j){if(j.createControl){h=j.createControl(i,g);if(h){return false}}});switch(i){case"|":case"separator":return g.createSeparator()}if(!h&&f.buttons&&(h=f.buttons[i])){return g.createButton(i,h)}return g.add(h)},createDropMenu:function(f,n,h){var m=this,i=m.editor,j,g,k,l;n=e({"class":"mceDropDown",constrain:i.settings.constrain_menus},n);n["class"]=n["class"]+" "+i.getParam("skin")+"Skin";if(k=i.getParam("skin_variant")){n["class"]+=" "+i.getParam("skin")+"Skin"+k.substring(0,1).toUpperCase()+k.substring(1)}f=m.prefix+f;l=h||m._cls.dropmenu||c.ui.DropMenu;j=m.controls[f]=new l(f,n);j.onAddItem.add(function(r,q){var p=q.settings;p.title=i.getLang(p.title,p.title);if(!p.onclick){p.onclick=function(o){if(p.cmd){i.execCommand(p.cmd,p.ui||false,p.value)}}}});i.onRemove.add(function(){j.destroy()});if(c.isIE){j.onShowMenu.add(function(){i.focus();g=i.selection.getBookmark(1)});j.onHideMenu.add(function(){if(g){i.selection.moveToBookmark(g);g=0}})}return m.add(j)},createListBox:function(f,n,h){var l=this,j=l.editor,i,k,m;if(l.get(f)){return null}n.title=j.translate(n.title);n.scope=n.scope||j;if(!n.onselect){n.onselect=function(o){j.execCommand(n.cmd,n.ui||false,o||n.value)}}n=e({title:n.title,"class":"mce_"+f,scope:n.scope,control_manager:l},n);f=l.prefix+f;function g(o){return o.settings.use_accessible_selects&&!c.isGecko}if(j.settings.use_native_selects||g(j)){k=new c.ui.NativeListBox(f,n)}else{m=h||l._cls.listbox||c.ui.ListBox;k=new m(f,n,j)}l.controls[f]=k;if(c.isWebKit){k.onPostRender.add(function(p,o){a.add(o,"mousedown",function(){j.bookmark=j.selection.getBookmark(1)});a.add(o,"focus",function(){j.selection.moveToBookmark(j.bookmark);j.bookmark=null})})}if(k.hideMenu){j.onMouseDown.add(k.hideMenu,k)}return l.add(k)},createButton:function(m,i,l){var h=this,g=h.editor,j,k,f;if(h.get(m)){return null}i.title=g.translate(i.title);i.label=g.translate(i.label);i.scope=i.scope||g;if(!i.onclick&&!i.menu_button){i.onclick=function(){g.execCommand(i.cmd,i.ui||false,i.value)}}i=e({title:i.title,"class":"mce_"+m,unavailable_prefix:g.getLang("unavailable",""),scope:i.scope,control_manager:h},i);m=h.prefix+m;if(i.menu_button){f=l||h._cls.menubutton||c.ui.MenuButton;k=new f(m,i,g);g.onMouseDown.add(k.hideMenu,k)}else{f=h._cls.button||c.ui.Button;k=new f(m,i,g)}return h.add(k)},createMenuButton:function(h,f,g){f=f||{};f.menu_button=1;return this.createButton(h,f,g)},createSplitButton:function(m,i,l){var h=this,g=h.editor,j,k,f;if(h.get(m)){return null}i.title=g.translate(i.title);i.scope=i.scope||g;if(!i.onclick){i.onclick=function(n){g.execCommand(i.cmd,i.ui||false,n||i.value)}}if(!i.onselect){i.onselect=function(n){g.execCommand(i.cmd,i.ui||false,n||i.value)}}i=e({title:i.title,"class":"mce_"+m,scope:i.scope,control_manager:h},i);m=h.prefix+m;f=l||h._cls.splitbutton||c.ui.SplitButton;k=h.add(new f(m,i,g));g.onMouseDown.add(k.hideMenu,k);return k},createColorSplitButton:function(f,n,h){var l=this,j=l.editor,i,k,m,g;if(l.get(f)){return null}n.title=j.translate(n.title);n.scope=n.scope||j;if(!n.onclick){n.onclick=function(o){if(c.isIE){g=j.selection.getBookmark(1)}j.execCommand(n.cmd,n.ui||false,o||n.value)}}if(!n.onselect){n.onselect=function(o){j.execCommand(n.cmd,n.ui||false,o||n.value)}}n=e({title:n.title,"class":"mce_"+f,menu_class:j.getParam("skin")+"Skin",scope:n.scope,more_colors_title:j.getLang("more_colors")},n);f=l.prefix+f;m=h||l._cls.colorsplitbutton||c.ui.ColorSplitButton;k=new m(f,n,j);j.onMouseDown.add(k.hideMenu,k);j.onRemove.add(function(){k.destroy()});if(c.isIE){k.onShowMenu.add(function(){j.focus();g=j.selection.getBookmark(1)});k.onHideMenu.add(function(){if(g){j.selection.moveToBookmark(g);g=0}})}return l.add(k)},createToolbar:function(k,h,j){var i,g=this,f;k=g.prefix+k;f=j||g._cls.toolbar||c.ui.Toolbar;i=new f(k,h,g.editor);if(g.get(k)){return null}return g.add(i)},createToolbarGroup:function(k,h,j){var i,g=this,f;k=g.prefix+k;f=j||this._cls.toolbarGroup||c.ui.ToolbarGroup;i=new f(k,h,g.editor);if(g.get(k)){return null}return g.add(i)},createSeparator:function(g){var f=g||this._cls.separator||c.ui.Separator;return new f()},setControlType:function(g,f){return this._cls[g.toLowerCase()]=f},destroy:function(){d(this.controls,function(f){f.destroy()});this.controls=null}})})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/WindowManager.js' */
(function(d){var a=d.util.Dispatcher,e=d.each,c=d.isIE,b=d.isOpera;d.create("tinymce.WindowManager",{WindowManager:function(f){var g=this;g.editor=f;g.onOpen=new a(g);g.onClose=new a(g);g.params={};g.features={}},open:function(z,h){var v=this,k="",n,m,i=v.editor.settings.dialog_type=="modal",q,o,j,g=d.DOM.getViewPort(),r;z=z||{};h=h||{};o=b?g.w:screen.width;j=b?g.h:screen.height;z.name=z.name||"mc_"+new Date().getTime();z.width=parseInt(z.width||320);z.height=parseInt(z.height||240);z.resizable=true;z.left=z.left||parseInt(o/2)-(z.width/2);z.top=z.top||parseInt(j/2)-(z.height/2);h.inline=false;h.mce_width=z.width;h.mce_height=z.height;h.mce_auto_focus=z.auto_focus;if(i){if(c){z.center=true;z.help=false;z.dialogWidth=z.width+"px";z.dialogHeight=z.height+"px";z.scroll=z.scrollbars||false}}e(z,function(p,f){if(d.is(p,"boolean")){p=p?"yes":"no"}if(!/^(name|url)$/.test(f)){if(c&&i){k+=(k?";":"")+f+":"+p}else{k+=(k?",":"")+f+"="+p}}});v.features=z;v.params=h;v.onOpen.dispatch(v,z,h);r=z.url||z.file;r=d._addVer(r);try{if(c&&i){q=1;window.showModalDialog(r,window,k)}else{q=window.open(r,z.name,k)}}catch(l){}if(!q){alert(v.editor.getLang("popup_blocked"))}},close:function(f){f.close();this.onClose.dispatch(this)},createInstance:function(i,h,g,m,l,k){var j=d.resolve(i);return new j(h,g,m,l,k)},confirm:function(h,f,i,g){g=g||window;f.call(i||this,g.confirm(this._decode(this.editor.getLang(h,h))))},alert:function(h,f,j,g){var i=this;g=g||window;g.alert(i._decode(i.editor.getLang(h,h)));if(f){f.call(j||i)}},resizeBy:function(f,g,h){h.resizeBy(f,g)},_decode:function(f){return d.DOM.decode(f).replace(/\\n/g,"\n")}})}(tinymce));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/Formatter.js' */
(function(a){a.Formatter=function(U){var L={},O=a.each,c=U.dom,q=U.selection,t=a.dom.TreeWalker,J=new a.dom.RangeUtils(c),d=U.schema.isValidChild,E=c.isBlock,l=U.settings.forced_root_block,s=c.nodeIndex,D="\uFEFF",e=/^(src|href|style)$/,R=false,A=true,p;function y(V){return V instanceof Array}function m(W,V){return c.getParents(W,V,c.getRoot())}function b(V){return V.nodeType===1&&V.id==="_mce_caret"}function Q(V){return V?L[V]:L}function k(V,W){if(V){if(typeof(V)!=="string"){O(V,function(Y,X){k(X,Y)})}else{W=W.length?W:[W];O(W,function(X){if(X.deep===p){X.deep=!X.selector}if(X.split===p){X.split=!X.selector||X.inline}if(X.remove===p&&X.selector&&!X.inline){X.remove="none"}if(X.selector&&X.inline){X.mixed=true;X.block_expand=true}if(typeof(X.classes)==="string"){X.classes=X.classes.split(/\s+/)}});L[V]=W}}}var i=function(W){var V;U.dom.getParent(W,function(X){V=U.dom.getStyle(X,"text-decoration");return V&&V!=="none"});return V};var H=function(V){var W;if(V.nodeType===1&&V.parentNode&&V.parentNode.nodeType===1){W=i(V.parentNode);if(U.dom.getStyle(V,"color")&&W){U.dom.setStyle(V,"text-decoration",W)}else{if(U.dom.getStyle(V,"textdecoration")===W){U.dom.setStyle(V,"text-decoration",null)}}}};function S(Y,af,aa){var ab=Q(Y),ag=ab[0],ae,W,ad,ac=q.isCollapsed();function V(ak,aj){aj=aj||ag;if(ak){if(aj.onformat){aj.onformat(ak,aj,af,aa)}O(aj.styles,function(am,al){c.setStyle(ak,al,r(am,af))});O(aj.attributes,function(am,al){c.setAttrib(ak,al,r(am,af))});O(aj.classes,function(al){al=r(al,af);if(!c.hasClass(ak,al)){c.addClass(ak,al)}})}}function Z(){function al(ar,ap){var aq=new t(ap);for(aa=aq.current();aa;aa=aq.prev()){if(aa.childNodes.length>1||aa==ar){return aa}}}var ak=U.selection.getRng();var ao=ak.startContainer;var aj=ak.endContainer;if(ao!=aj&&ak.endOffset==0){var an=al(ao,aj);var am=an.nodeType==3?an.length:an.childNodes.length;ak.setEnd(an,am)}return ak}function X(am,ar,ap,ao,ak){var aj=[],al=-1,aq,au=-1,an=-1,at;O(am.childNodes,function(aw,av){if(aw.nodeName==="UL"||aw.nodeName==="OL"){al=av;aq=aw;return false}});O(am.childNodes,function(aw,av){if(aw.nodeName==="SPAN"&&c.getAttrib(aw,"data-mce-type")=="bookmark"){if(aw.id==ar.id+"_start"){au=av}else{if(aw.id==ar.id+"_end"){an=av}}}});if(al<=0||(au<al&&an>al)){O(a.grep(am.childNodes),ak);return 0}else{at=ap.cloneNode(R);O(a.grep(am.childNodes),function(aw,av){if((au<al&&av<al)||(au>al&&av>al)){aj.push(aw);aw.parentNode.removeChild(aw)}});if(au<al){am.insertBefore(at,aq)}else{if(au>al){am.insertBefore(at,aq.nextSibling)}}ao.push(at);O(aj,function(av){at.appendChild(av)});return at}}function ah(ak,am,ao){var aj=[],an,al;an=ag.inline||ag.block;al=c.create(an);V(al);J.walk(ak,function(ap){var aq;function ar(at){var aw=at.nodeName.toLowerCase(),av=at.parentNode.nodeName.toLowerCase(),au;if(g(aw,"br")){aq=0;if(ag.block){c.remove(at)}return}if(ag.wrapper&&w(at,Y,af)){aq=0;return}if(ag.block&&!ag.wrapper&&F(aw)){at=c.rename(at,an);V(at);aj.push(at);aq=0;return}if(ag.selector){O(ab,function(ax){if("collapsed" in ax&&ax.collapsed!==ac){return}if(c.is(at,ax.selector)&&!b(at)){V(at,ax);au=true}});if(!ag.inline||au){aq=0;return}}if(d(an,aw)&&d(av,an)&&!(!ao&&at.nodeType===3&&at.nodeValue.length===1&&at.nodeValue.charCodeAt(0)===65279)&&!b(at)){if(!aq){aq=al.cloneNode(R);at.parentNode.insertBefore(aq,at);aj.push(aq)}aq.appendChild(at)}else{if(aw=="li"&&am){aq=X(at,am,al,aj,ar)}else{aq=0;O(a.grep(at.childNodes),ar);aq=0}}}O(ap,ar)});if(ag.wrap_links===false){O(aj,function(ap){function aq(av){var au,at,ar;if(av.nodeName==="A"){at=al.cloneNode(R);aj.push(at);ar=a.grep(av.childNodes);for(au=0;au<ar.length;au++){at.appendChild(ar[au])}av.appendChild(at)}O(a.grep(av.childNodes),aq)}aq(ap)})}O(aj,function(ar){var ap;function at(av){var au=0;O(av.childNodes,function(aw){if(!f(aw)&&!G(aw)){au++}});return au}function aq(au){var aw,av;O(au.childNodes,function(ax){if(ax.nodeType==1&&!G(ax)&&!b(ax)){aw=ax;return R}});if(aw&&h(aw,ag)){av=aw.cloneNode(R);V(av);c.replace(av,au,A);c.remove(aw,1)}return av||au}ap=at(ar);if((aj.length>1||!E(ar))&&ap===0){c.remove(ar,1);return}if(ag.inline||ag.wrapper){if(!ag.exact&&ap===1){ar=aq(ar)}O(ab,function(au){O(c.select(au.inline,ar),function(aw){var av;if(au.wrap_links===false){av=aw.parentNode;do{if(av.nodeName==="A"){return}}while(av=av.parentNode)}T(au,af,aw,au.exact?aw:null)})});if(w(ar.parentNode,Y,af)){c.remove(ar,1);ar=0;return A}if(ag.merge_with_parents){c.getParent(ar.parentNode,function(au){if(w(au,Y,af)){c.remove(ar,1);ar=0;return A}})}if(ar&&ag.merge_siblings!==false){ar=u(B(ar),ar);ar=u(ar,B(ar,A))}}})}if(ag){if(aa){if(aa.nodeType){W=c.createRng();W.setStartBefore(aa);W.setEndAfter(aa);ah(o(W,ab),null,true)}else{ah(aa,null,true)}}else{if(!ac||!ag.inline||c.select("td.mceSelected,th.mceSelected").length){var ai=U.selection.getNode();U.selection.setRng(Z());ae=q.getBookmark();ah(o(q.getRng(A),ab),ae);if(ag.styles&&(ag.styles.color||ag.styles.textDecoration)){a.walk(ai,H,"childNodes");H(ai)}q.moveToBookmark(ae);M(q.getRng(A));U.nodeChanged()}else{P("apply",Y,af)}}}}function z(X,af,Z){var aa=Q(X),ah=aa[0],ae,ad,W;function Y(am){var al,ak,aj;al=a.grep(am.childNodes);for(ak=0,aj=aa.length;ak<aj;ak++){if(T(aa[ak],af,am,am)){break}}if(ah.deep){for(ak=0,aj=al.length;ak<aj;ak++){Y(al[ak])}}}function ab(aj){var ak;O(m(aj.parentNode).reverse(),function(al){var am;if(!ak&&al.id!="_start"&&al.id!="_end"){am=w(al,X,af);if(am&&am.split!==false){ak=al}}});return ak}function V(am,aj,ao,ar){var at,aq,ap,al,an,ak;if(am){ak=am.parentNode;for(at=aj.parentNode;at&&at!=ak;at=at.parentNode){aq=at.cloneNode(R);for(an=0;an<aa.length;an++){if(T(aa[an],af,aq,aq)){aq=0;break}}if(aq){if(ap){aq.appendChild(ap)}if(!al){al=aq}ap=aq}}if(ar&&(!ah.mixed||!E(am))){aj=c.split(am,aj)}if(ap){ao.parentNode.insertBefore(ap,ao);al.appendChild(ao)}}return aj}function ag(aj){return V(ab(aj),aj,aj,true)}function ac(al){var ak=c.get(al?"_start":"_end"),aj=ak[al?"firstChild":"lastChild"];if(G(aj)){aj=aj[al?"firstChild":"lastChild"]}c.remove(ak,true);return aj}function ai(aj){var ak,al;aj=o(aj,aa,A);if(ah.split){ak=I(aj,A);al=I(aj);if(ak!=al){ak=N(ak,"span",{id:"_start","data-mce-type":"bookmark"});al=N(al,"span",{id:"_end","data-mce-type":"bookmark"});ag(ak);ag(al);ak=ac(A);al=ac()}else{ak=al=ag(ak)}aj.startContainer=ak.parentNode;aj.startOffset=s(ak);aj.endContainer=al.parentNode;aj.endOffset=s(al)+1}J.walk(aj,function(am){O(am,function(an){Y(an);if(an.nodeType===1&&U.dom.getStyle(an,"text-decoration")==="underline"&&an.parentNode&&i(an.parentNode)==="underline"){T({deep:false,exact:true,inline:"span",styles:{textDecoration:"underline"}},null,an)}})})}if(Z){if(Z.nodeType){W=c.createRng();W.setStartBefore(Z);W.setEndAfter(Z);ai(W)}else{ai(Z)}return}if(!q.isCollapsed()||!ah.inline||c.select("td.mceSelected,th.mceSelected").length){ae=q.getBookmark();ai(q.getRng(A));q.moveToBookmark(ae);if(ah.inline&&j(X,af,q.getStart())){M(q.getRng(true))}U.nodeChanged()}else{P("remove",X,af)}if(a.isWebKit){U.execCommand("mceCleanup",false,p,{skip_undo:true})}}function C(W,Y,X){var V=Q(W);if(j(W,Y,X)&&(!("toggle" in V[0])||V[0]["toggle"])){z(W,Y,X)}else{S(W,Y,X)}}function w(W,V,ab,Z){var X=Q(V),ac,aa,Y;function ad(ah,aj,ak){var ag,ai,ae=aj[ak],af;if(aj.onmatch){return aj.onmatch(ah,aj,ak)}if(ae){if(ae.length===p){for(ag in ae){if(ae.hasOwnProperty(ag)){if(ak==="attributes"){ai=c.getAttrib(ah,ag)}else{ai=K(ah,ag)}if(Z&&!ai&&!aj.exact){return}if((!Z||aj.exact)&&!g(ai,r(ae[ag],ab))){return}}}}else{for(af=0;af<ae.length;af++){if(ak==="attributes"?c.getAttrib(ah,ae[af]):K(ah,ae[af])){return aj}}}}return aj}if(X&&W){for(aa=0;aa<X.length;aa++){ac=X[aa];if(h(W,ac)&&ad(W,ac,"attributes")&&ad(W,ac,"styles")){if(Y=ac.classes){for(aa=0;aa<Y.length;aa++){if(!c.hasClass(W,Y[aa])){return}}}return ac}}}}function j(X,Z,Y){var W;function V(aa){aa=c.getParent(aa,function(ab){return !!w(ab,X,Z,true)});return w(aa,X,Z)}if(Y){return V(Y)}Y=q.getNode();if(V(Y)){return A}W=q.getStart();if(W!=Y){if(V(W)){return A}}return R}function v(ac,ab){var Z,aa=[],Y={},X,W,V;Z=q.getStart();c.getParent(Z,function(af){var ae,ad;for(ae=0;ae<ac.length;ae++){ad=ac[ae];if(!Y[ad]&&w(af,ad,ab)){Y[ad]=true;aa.push(ad)}}});return aa}function x(Z){var ab=Q(Z),Y,X,aa,W,V;if(ab){Y=q.getStart();X=m(Y);for(W=ab.length-1;W>=0;W--){V=ab[W].selector;if(!V){return A}for(aa=X.length-1;aa>=0;aa--){if(c.is(X[aa],V)){return A}}}}return R}a.extend(this,{get:Q,register:k,apply:S,remove:z,toggle:C,match:j,matchAll:v,matchNode:w,canApply:x});function h(V,W){if(g(V,W.inline)){return A}if(g(V,W.block)){return A}if(W.selector){return c.is(V,W.selector)}}function g(W,V){W=W||"";V=V||"";W=""+(W.nodeName||W);V=""+(V.nodeName||V);return W.toLowerCase()==V.toLowerCase()}function K(W,V){var X=c.getStyle(W,V);if(V=="color"||V=="backgroundColor"){X=c.toHex(X)}if(V=="fontWeight"&&X==700){X="bold"}return""+X}function r(V,W){if(typeof(V)!="string"){V=V(W)}else{if(W){V=V.replace(/%(\w+)/g,function(Y,X){return W[X]||Y})}}return V}function f(V){return V&&V.nodeType===3&&/^([\t \r\n]+|)$/.test(V.nodeValue)}function N(X,W,V){var Y=c.create(W,V);X.parentNode.insertBefore(Y,X);Y.appendChild(X);return Y}function o(V,ah,Y){var X=V.startContainer,ac=V.startOffset,ak=V.endContainer,ae=V.endOffset,aj,ag,ab,af;function ai(aq){var al,ao,ap,an,am;al=ao=aq?X:ak;am=aq?"previousSibling":"nextSibling";root=c.getRoot();if(al.nodeType==3&&!f(al)){if(aq?ac>0:ae<al.nodeValue.length){return al}}for(;;){if(!ah[0].block_expand&&E(ao)){return ao}for(an=ao[am];an;an=an[am]){if(!G(an)&&!f(an)){return ao}}if(ao.parentNode==root){al=ao;break}ao=ao.parentNode}return al}function aa(al,am){if(am===p){am=al.nodeType===3?al.length:al.childNodes.length}while(al&&al.hasChildNodes()){al=al.childNodes[am];if(al){am=al.nodeType===3?al.length:al.childNodes.length}}return{node:al,offset:am}}if(X.nodeType==1&&X.hasChildNodes()){ag=X.childNodes.length-1;X=X.childNodes[ac>ag?ag:ac];if(X.nodeType==3){ac=0}}if(ak.nodeType==1&&ak.hasChildNodes()){ag=ak.childNodes.length-1;ak=ak.childNodes[ae>ag?ag:ae-1];if(ak.nodeType==3){ae=ak.nodeValue.length}}if(G(X.parentNode)||G(X)){X=G(X)?X:X.parentNode;X=X.nextSibling||X;if(X.nodeType==3){ac=0}}if(G(ak.parentNode)||G(ak)){ak=G(ak)?ak:ak.parentNode;ak=ak.previousSibling||ak;if(ak.nodeType==3){ae=ak.length}}if(ah[0].inline){if(V.collapsed){function ad(am,aq,at){var ap,an,ar,al;function ao(av,ax){var ay,au,aw=av.nodeValue;if(typeof(ax)=="undefined"){ax=at?aw.length:0}if(at){ay=aw.lastIndexOf(" ",ax);au=aw.lastIndexOf("\u00a0",ax);ay=ay>au?ay:au;if(ay!==-1&&!Y){ay++}}else{ay=aw.indexOf(" ",ax);au=aw.indexOf("\u00a0",ax);ay=ay!==-1&&(au===-1||ay<au)?ay:au}return ay}if(am.nodeType===3){ar=ao(am,aq);if(ar!==-1){return{container:am,offset:ar}}al=am}ap=new t(am,c.getParent(am,E)||U.getBody());while(an=ap[at?"prev":"next"]()){if(an.nodeType===3){al=an;ar=ao(an);if(ar!==-1){return{container:an,offset:ar}}}else{if(E(an)){break}}}if(al){if(at){aq=0}else{aq=al.length}return{container:al,offset:aq}}}af=ad(X,ac,true);if(af){X=af.container;ac=af.offset}af=ad(ak,ae);if(af){ak=af.container;ae=af.offset}}ab=aa(ak,ae);if(ab.node){while(ab.node&&ab.offset===0&&ab.node.previousSibling){ab=aa(ab.node.previousSibling)}if(ab.node&&ab.offset>0&&ab.node.nodeType===3&&ab.node.nodeValue.charAt(ab.offset-1)===" "){if(ab.offset>1){ak=ab.node;ak.splitText(ab.offset-1)}else{if(ab.node.previousSibling){}}}}}if(ah[0].inline||ah[0].block_expand){if(!ah[0].inline||(X.nodeType!=3||ac===0)){X=ai(true)}if(!ah[0].inline||(ak.nodeType!=3||ae===ak.nodeValue.length)){ak=ai()}}if(ah[0].selector&&ah[0].expand!==R&&!ah[0].inline){function Z(am,al){var an,ao,aq,ap;if(am.nodeType==3&&am.nodeValue.length==0&&am[al]){am=am[al]}an=m(am);for(ao=0;ao<an.length;ao++){for(aq=0;aq<ah.length;aq++){ap=ah[aq];if("collapsed" in ap&&ap.collapsed!==V.collapsed){continue}if(c.is(an[ao],ap.selector)){return an[ao]}}}return am}X=Z(X,"previousSibling");ak=Z(ak,"nextSibling")}if(ah[0].block||ah[0].selector){function W(am,al,ao){var an;if(am==c.getRoot()){return am}if(!ah[0].wrapper){an=c.getParent(am,ah[0].block)}if(!an){an=c.getParent(am.nodeType==3?am.parentNode:am,E)}if(an&&ah[0].wrapper){an=m(an,"ul,ol").reverse()[0]||an}if(!an){an=am;while(an[al]&&!E(an[al])){an=an[al];if(g(an,"br")){break}}}return an||am}X=W(X,"previousSibling");ak=W(ak,"nextSibling");if(ah[0].block){if(!E(X)){X=ai(true)}if(!E(ak)){ak=ai()}}}if(X.nodeType==1){ac=s(X);X=X.parentNode}if(ak.nodeType==1){ae=s(ak)+1;ak=ak.parentNode}return{startContainer:X,startOffset:ac,endContainer:ak,endOffset:ae}}function T(ab,aa,Y,V){var X,W,Z;if(!h(Y,ab)){return R}if(ab.remove!="all"){O(ab.styles,function(ad,ac){ad=r(ad,aa);if(typeof(ac)==="number"){ac=ad;V=0}if(!V||g(K(V,ac),ad)){c.setStyle(Y,ac,"")}Z=1});if(Z&&c.getAttrib(Y,"style")==""){Y.removeAttribute("style");Y.removeAttribute("data-mce-style")}O(ab.attributes,function(ae,ac){var ad;ae=r(ae,aa);if(typeof(ac)==="number"){ac=ae;V=0}if(!V||g(c.getAttrib(V,ac),ae)){if(ac=="class"){ae=c.getAttrib(Y,ac);if(ae){ad="";O(ae.split(/\s+/),function(af){if(/mce\w+/.test(af)){ad+=(ad?" ":"")+af}});if(ad){c.setAttrib(Y,ac,ad);return}}}if(ac=="class"){Y.removeAttribute("className")}if(e.test(ac)){Y.removeAttribute("data-mce-"+ac)}Y.removeAttribute(ac)}});O(ab.classes,function(ac){ac=r(ac,aa);if(!V||c.hasClass(V,ac)){c.removeClass(Y,ac)}});W=c.getAttribs(Y);for(X=0;X<W.length;X++){if(W[X].nodeName.indexOf("_")!==0){return R}}}if(ab.remove!="none"){n(Y,ab);return A}}function n(X,Y){var V=X.parentNode,W;if(Y.block){if(!l){function Z(ab,aa,ac){ab=B(ab,aa,ac);return !ab||(ab.nodeName=="BR"||E(ab))}if(E(X)&&!E(V)){if(!Z(X,R)&&!Z(X.firstChild,A,1)){X.insertBefore(c.create("br"),X.firstChild)}if(!Z(X,A)&&!Z(X.lastChild,R,1)){X.appendChild(c.create("br"))}}}else{if(V==c.getRoot()){if(!Y.list_block||!g(X,Y.list_block)){O(a.grep(X.childNodes),function(aa){if(d(l,aa.nodeName.toLowerCase())){if(!W){W=N(aa,l)}else{W.appendChild(aa)}}else{W=0}})}}}}if(Y.selector&&Y.inline&&!g(Y.inline,X)){return}c.remove(X,1)}function B(W,V,X){if(W){V=V?"nextSibling":"previousSibling";for(W=X?W:W[V];W;W=W[V]){if(W.nodeType==1||!f(W)){return W}}}}function G(V){return V&&V.nodeType==1&&V.getAttribute("data-mce-type")=="bookmark"}function u(Z,Y){var V,X,W;function ab(ae,ad){if(ae.nodeName!=ad.nodeName){return R}function ac(ag){var ah={};O(c.getAttribs(ag),function(ai){var aj=ai.nodeName.toLowerCase();if(aj.indexOf("_")!==0&&aj!=="style"){ah[aj]=c.getAttrib(ag,aj)}});return ah}function af(aj,ai){var ah,ag;for(ag in aj){if(aj.hasOwnProperty(ag)){ah=ai[ag];if(ah===p){return R}if(aj[ag]!=ah){return R}delete ai[ag]}}for(ag in ai){if(ai.hasOwnProperty(ag)){return R}}return A}if(!af(ac(ae),ac(ad))){return R}if(!af(c.parseStyle(c.getAttrib(ae,"style")),c.parseStyle(c.getAttrib(ad,"style")))){return R}return A}if(Z&&Y){function aa(ad,ac){for(X=ad;X;X=X[ac]){if(X.nodeType==3&&X.nodeValue.length!==0){return ad}if(X.nodeType==1&&!G(X)){return X}}return ad}Z=aa(Z,"previousSibling");Y=aa(Y,"nextSibling");if(ab(Z,Y)){for(X=Z.nextSibling;X&&X!=Y;){W=X;X=X.nextSibling;Z.appendChild(W)}c.remove(Y);O(a.grep(Y.childNodes),function(ac){Z.appendChild(ac)});return Z}}return Y}function F(V){return/^(h[1-6]|p|div|pre|address|dl|dt|dd)$/.test(V)}function I(W,aa){var V,Z,X,Y;V=W[aa?"startContainer":"endContainer"];Z=W[aa?"startOffset":"endOffset"];if(V.nodeType==1){X=V.childNodes.length-1;if(!aa&&Z){Z--}V=V.childNodes[Z>X?X:Z]}if(V.nodeType===3&&aa&&Z>=V.nodeValue.length){V=new t(V,U.getBody()).next()||V}if(V.nodeType===3&&!aa&&Z==0){V=new t(V,U.getBody()).prev()||V}return V}function P(ae,V,ac){var ah,af="_mce_caret",W=U.settings.caret_debug;ah=a.isGecko?"\u200B":D;function X(aj){var ai=c.create("span",{id:af,"data-mce-bogus":true,style:W?"color:red":""});if(aj){ai.appendChild(U.getDoc().createTextNode(ah))}return ai}function ad(aj,ai){while(aj){if((aj.nodeType===3&&aj.nodeValue!==ah)||aj.childNodes.length>1){return false}if(ai&&aj.nodeType===1){ai.push(aj)}aj=aj.firstChild}return true}function aa(ai){while(ai){if(ai.id===af){return ai}ai=ai.parentNode}}function Z(ai){var aj;if(ai){aj=new t(ai,ai);for(ai=aj.current();ai;ai=aj.next()){if(ai.nodeType===3){return ai}}}}function Y(ak,aj){var al,ai;if(!ak){ak=aa(q.getStart());if(!ak){while(ak=c.get(af)){Y(ak,false)}}}else{ai=q.getRng(true);if(ad(ak)){if(aj!==false){ai.setStartBefore(ak);ai.setEndBefore(ak)}c.remove(ak)}else{al=Z(ak);if(al.nodeValue.charAt(0)===D){al=al.deleteData(0,1)}c.remove(ak,1)}q.setRng(ai)}}function ab(){var ak,ai,ao,an,al,aj,am;ak=q.getRng(true);an=ak.startOffset;aj=ak.startContainer;am=aj.nodeValue;ai=aa(q.getStart());if(ai){ao=Z(ai)}if(am&&an>0&&an<am.length&&/\w/.test(am.charAt(an))&&/\w/.test(am.charAt(an-1))){al=q.getBookmark();ak.collapse(true);ak=o(ak,Q(V));ak=J.split(ak);S(V,ac,ak);q.moveToBookmark(al)}else{if(!ai||ao.nodeValue!==ah){ai=X(true);ao=ai.firstChild;ak.insertNode(ai);an=1;S(V,ac,ai)}else{S(V,ac,ai)}q.setCursorLocation(ao,an)}}function ag(){var ai=q.getRng(true),aj,al,ao,an,ak,ar,aq=[],am,ap;aj=ai.startContainer;al=ai.startOffset;ak=aj;if(aj.nodeType==3){if(al!=aj.nodeValue.length||aj.nodeValue===ah){an=true}ak=ak.parentNode}while(ak){if(w(ak,V,ac)){ar=ak;break}if(ak.nextSibling){an=true}aq.push(ak);ak=ak.parentNode}if(!ar){return}if(an){ao=q.getBookmark();ai.collapse(true);ai=o(ai,Q(V),true);ai=J.split(ai);z(V,ac,ai);q.moveToBookmark(ao)}else{ap=X();ak=ap;for(am=aq.length-1;am>=0;am--){ak.appendChild(aq[am].cloneNode(false));ak=ak.firstChild}ak.appendChild(c.doc.createTextNode(ah));ak=ak.firstChild;c.insertAfter(ap,ar);q.setCursorLocation(ak,1)}}if(!self._hasCaretEvents){U.onBeforeGetContent.addToTop(function(){var ai=[],aj;if(ad(aa(q.getStart()),ai)){aj=ai.length;while(aj--){c.setAttrib(ai[aj],"data-mce-bogus","1")}}});a.each("onMouseUp onKeyUp".split(" "),function(ai){U[ai].addToTop(function(){Y()})});U.onKeyDown.addToTop(function(ai,ak){var aj=ak.keyCode;if(aj==8||aj==37||aj==39){Y(aa(q.getStart()))}});self._hasCaretEvents=true}if(ae=="apply"){ab()}else{ag()}}function M(W){var V=W.startContainer,ab=W.startOffset,aa,Z,X,Y;if(V.nodeType==3&&ab>=V.nodeValue.length){V=V.parentNode;ab=s(V)+1}if(V.nodeType==1){X=V.childNodes;V=X[Math.min(ab,X.length-1)];aa=new t(V,c.getParent(V,c.isBlock));if(ab>X.length-1){aa.next()}for(Z=aa.current();Z;Z=aa.next()){if(Z.nodeType==3&&!f(Z)){Y=c.create("a",null,D);Z.parentNode.insertBefore(Y,Z);W.setStart(Z,0);q.setRng(W);c.remove(Y);return}}}}}})(tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-core', location = 'jscripts/tiny_mce/classes/LegacyInput.js' */
tinymce.onAddEditor.add(function(e,a){var d,h,g,c=a.settings;if(c.inline_styles){h=e.explode(c.font_size_legacy_values);function b(j,i){e.each(i,function(l,k){if(l){g.setStyle(j,k,l)}});g.rename(j,"span")}d={font:function(j,i){b(i,{backgroundColor:i.style.backgroundColor,color:i.color,fontFamily:i.face,fontSize:h[parseInt(i.size)-1]})},strike:function(j,i){b(i,{textDecoration:"line-through"})}};function f(i,j){g=i.dom;if(c.convert_fonts_to_spans){e.each(g.select("font,strike",j.node),function(k){d[k.nodeName.toLowerCase()](a.dom,k)})}}a.onPreProcess.add(f);a.onSetContent.add(f);a.onInit.add(function(){a.selection.onSetContent.add(f)})}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-extensions', location = 'jscripts/tiny_mce/themes/atlassian/editor_template.js' */
(function(e){var d=e.DOM,b=e.dom.Event,h=e.extend,f=e.each,a=e.util.Cookie,g,c=e.explode;e.ThemeManager.requireLangPack("advanced");e.create("tinymce.themes.AtlassianTheme",{controlHandlers:{},controls:{bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",justifyleft:"JustifyLeft",justifycenter:"JustifyCenter",justifyright:"JustifyRight",bullist:"InsertUnorderedList",numlist:"InsertOrderedList",tasklist:"InsertInlineTaskList",outdent:"Outdent",indent:"Indent",cut:"Cut",copy:"Copy",paste:"Paste",undo:"Undo",redo:"Redo",removeformat:"RemoveFormat",sub:"subscript",sup:"superscript",forecolor:"ForeColor",forecolorpicker:"mceForeColor",backcolor:"HiliteColor",backcolorpicker:"mceBackColor",charmap:"mceCharMap",visualaid:"mceToggleVisualAid",anchor:"mceInsertAnchor",newdocument:"mceNewDocument",blockquote:"mceBlockQuote"},stateControls:["bold","italic","underline","bullist","numlist","tasklist","justifyleft","justifycenter","justifyright","strikethrough","sub","sup","monospace"],init:function(j,k){var l=this,m,i,n;l.editor=j;l.url=k;l.settings=m=h({theme_advanced_toolbar_location:"bottom",theme_advanced_buttons1:"formatselect,bold,italic,underline,strikethrough,forecolor,separator,table,row_before,row_after,delete_row,col_before,col_after,delete_col,delete_table,separator,bullist,numlist,tasklist,outdent,indent,blockquote,justifyleft,justifycenter,justifyright,justifyfull,separator,sup,sub,separator,undo,redo,separator,conflink,oldlinkbrowserButton,confimage,conf_macro_browser,separator,search,code,customtoolbar, monospacep,h1,h2,h3,h4,h5,h6,pre,blockquote",theme_advanced_toolbar_align:"center",theme_advanced_fonts:"Andale Mono=andale mono,times;Arial=arial,helvetica,sans-serif;Arial Black=arial black,avant garde;Book Antiqua=book antiqua,palatino;Comic Sans MS=comic sans ms,sans-serif;Courier New=courier new,courier;Georgia=georgia,palatino;Helvetica=helvetica;Impact=impact,chicago;Symbol=symbol;Tahoma=tahoma,arial,helvetica,sans-serif;Terminal=terminal,monaco;Times New Roman=times new roman,times;Trebuchet MS=trebuchet ms,geneva;Verdana=verdana,geneva;Webdings=webdings;Wingdings=wingdings,zapf dingbats",theme_advanced_more_colors:1,theme_advanced_row_height:23,theme_advanced_resize_horizontal:1,theme_advanced_resizing_use_cookie:1,theme_advanced_font_sizes:"1,2,3,4,5,6,7",theme_advanced_font_selector:"span",theme_advanced_show_current_color:0,readonly:j.settings.readonly},j.settings);j.onInit.add(function(){if(!j.settings.readonly){j.onNodeChange.add(l.nodeChanged,l);j.onKeyUp.add(l._updateUndoStatus,l);j.onMouseUp.add(l._updateUndoStatus,l);j.dom.bind(j.dom.getRoot(),"dragend",function(){l._updateUndoStatus(j)})}})},execCommand:function(k,j,l){var i=this["_"+k];if(i){i.call(this,j,l);return true}return false},renderUI:function(j){var i;this.bindControls();return{iframeContainer:d.get("rte"),editorContainer:"wysiwyg",sizeContainer:i,deltaHeight:j.deltaHeight}},getInfo:function(){return{longname:"Atlassian theme",author:"Atlassian",authorurl:"http://tinymce.moxiecode.com",version:e.majorVersion+"."+e.minorVersion}},bindControls:function(){var i=this,j=i.settings;f(c(j.theme_advanced_buttons1),function(k){if(i.createEditorButtons(k)){return}switch(k){case"styleselect":return i._createStyleSelect();case"formatselect":return i.createBlockFormats();case"fontselect":return i._createFontSelect();case"fontsizeselect":return i._createFontSizeSelect();case"forecolor":return i.createForeColorMenu();case"backcolor":return i._createBackColorMenu()}});i.bindControlHandlers()},createEditorButtons:function(i){var j=this.editor.buttons[i];if(j){if(j.cmd){this.controls[i]=j.cmd}else{this.controls[i]=j.onclick}}else{return false}},bindControlHandlers:function(){var i=this;i.controlHandlers.buttons={};i.controlHandlers.buttons["state"]=new e.util.Dispatcher();i.controlHandlers.buttons["click"]=new e.util.Dispatcher();i.controlHandlers.buttons["click"].add(function(l){var j=i.controls[l];var k=(typeof j);if(k=="string"){i.editor.execCommand(i.controls[l])}else{if(k=="function"){j()}else{}}})},createBlockFormats:function(){var i=this;i.controlHandlers.formatselect={};i.controlHandlers.formatselect["state"]=new e.util.Dispatcher();i.controlHandlers.formatselect["click"]=new e.util.Dispatcher();i.controlHandlers.formatselect["click"].add(function(j){i.editor.execCommand("FormatBlock",false,j)})},createForeColorMenu:function(){return true},_updateUndoStatus:function(i){var j=i.undoManager;this.controlHandlers.buttons["state"].dispatch("undo","disabled",!j.hasUndo()&&!j.typing);this.controlHandlers.buttons["state"].dispatch("redo","disabled",!j.hasRedo())},nodeChanged:function(m,q,k,o,j){var r=this,i,u=r.settings;f(r.stateControls,function(n){r.controlHandlers.buttons["state"].dispatch(n,"active",!!m.queryCommandState(r.controls[n]))});function l(s){var p,n=j.parents;for(p=0;p<n.length;p++){if(s(n[p])){return n[p]}}}r._updateUndoStatus(m);r.controlHandlers.buttons["state"].dispatch("outdent","disabled",!m.queryCommandState("Outdent"));i=l(d.isBlock);if(i){r.controlHandlers.formatselect["state"].dispatch(i.nodeName.toLowerCase())}}});e.ThemeManager.add("atlassian",e.themes.AtlassianTheme)}(tinymce));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-extensions', location = 'jscripts/tiny_mce/plugins/atlassianemotions/editor_plugin_src.js' */
(function(a,b){a.create("tinymce.plugins.EmotionsPlugin",{init:function(c,d){c.addCommand("mceEmotion",function(){c.windowManager.open({file:tinyMCE.settings.editor_plugin_action_base_path+"/emotions.action",width:190+parseInt(c.getLang("emotions.delta_width",0)),height:125+parseInt(c.getLang("emotions.delta_height",0)),inline:1,id:"insert-emoticon-dialog",name:"emotions_dlg.title"},{plugin_url:d})});c.addButton("emotions",{title:"emotions.emotions_desc",cmd:"mceEmotion"});c.onClick.add(function(g,k){var l=k.target,j,f;if(l.nodeName==="IMG"){j=b(l);if(j.hasClass("emoticon")){f=g.selection.getRng(true);var i=k.offsetX||(k.layerX-l.x);var h=l.width;if(i<h/2){f.setStartBefore(l);f.setEndBefore(l)}else{f.setStartAfter(l);f.setEndAfter(l)}g.selection.setRng(f);g.selection.collapse();return a.dom.Event.prevent(k)}}})},getInfo:function(){return{longname:"Emotions",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/emotions",version:a.majorVersion+"."+a.minorVersion}}});a.PluginManager.add("emotions",a.plugins.EmotionsPlugin)})(tinymce,AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-extensions', location = 'jscripts/tiny_mce/plugins/lists/editor_plugin_src.js' */
(function(f){var o="list-style-type: none; background-image: none;";var k="a,b,i,em,strong,u,span,s,sub,sup,code,br";var d=tinymce.each,u=tinymce.dom.Event,h;function t(w,v){while(w&&(w.nodeType===8||(w.nodeType===3&&/^[ \t\n\r]*$/.test(w.nodeValue)))){w=v(w)}return w}function b(v){return t(v,function(w){return w.previousSibling})}function j(v){return t(v,function(w){return w.nextSibling})}function e(v,x,w){return v.dom.getParent(x,function(y){return tinymce.inArray(w,y)!==-1})}function q(v){return v&&(v.tagName==="OL"||v.tagName==="UL")}function c(x,y){var w,z,v;w=b(x.lastChild);while(q(w)){z=w;w=b(z.previousSibling)}if(z){v=y.create("li",{style:o});y.split(x,z);y.insertAfter(v,z);v.appendChild(z);v.appendChild(z);x=v.previousSibling}return x}function p(w,v,x){w=a(w,v,x);return r(w,v,x)}function a(x,v,y){var w=b(x.previousSibling);if(w){return i(w,x,v?w:false,y)}else{return x}}function r(x,w,y){var v=j(x.nextSibling);if(v){return i(x,v,w?v:false,y)}else{return x}}function i(x,v,w,y){if(n(x,v,!!w,y)){return g(x,v,w)}else{if(x&&x.tagName==="LI"&&q(v)){x.appendChild(v)}}return v}function n(x,w,v,y){if(!x||!w){return false}else{if(x.tagName==="LI"&&w.tagName==="LI"){return w.style.listStyleType==="none"||l(w)}else{if(q(x)){return(x.tagName===w.tagName&&x.className===w.className&&(v||x.style.listStyleType===w.style.listStyleType))||s(w)}else{return y&&x.tagName==="P"&&w.tagName==="P"}}}}function s(w){var v=j(w.firstChild),x=b(w.lastChild);return v&&x&&q(w)&&v===x&&(q(v)||v.style.listStyleType==="none"||l(v))}function l(x){var w=j(x.firstChild),v=b(x.lastChild);return w&&v&&w===v&&q(w)}function g(z,y,v){var x=b(z.lastChild),w=j(y.firstChild);if(z.tagName==="P"){z.appendChild(z.ownerDocument.createElement("br"))}while(y.firstChild){z.appendChild(y.firstChild)}if(v){z.style.listStyleType=v.style.listStyleType}y.parentNode.removeChild(y);i(x,w,false);return z}function m(w,x){var v;if(!x.is(w,"li,ol,ul")){v=x.getParent(w,"li");if(v){w=v}}return w}tinymce.create("tinymce.plugins.Lists",{init:function(D){var z="TABBING";var w="EMPTY";var N="ESCAPE";var Q="UNKNOWN";var B=Q;function H(Y){return Y.keyCode===tinymce.VK.TAB&&!(Y.altKey||Y.ctrlKey)&&(D.queryCommandState("InsertUnorderedList")||D.queryCommandState("InsertOrderedList")||D.queryCommandState("InsertInlineTaskList")||D.queryCommandState("InsertInlineTaskListNoToggle"))}function R(){var Z=D.selection.getNode();var Y=Z.tagName==="P"&&Z.parentNode.tagName==="LI"&&Z.parentNode.lastChild===Z;return D.selection.isCollapsed()&&Y&&AJS.EditorUtils.isCursorAtEndOf(Z,D.selection.getRng(true))}function A(){var Y=F();if(Y){var aa=Y.parentNode.parentNode;var Z=Y.parentNode.lastChild===Y;return Z&&!x(aa)&&T(Y)}return false}function x(Y){if(q(Y)){return Y.parentNode&&Y.parentNode.tagName==="LI"}else{return Y.tagName==="LI"}}function I(){return D.selection.isCollapsed()&&T(F())}function F(){var Y=D.selection.getStart();return(Y.tagName=="LI")?Y:D.dom.getParent(Y,"li")}function T(Y){if(Y){var ac=f(Y);var aa=ac.find("*");var Z=aa.filter(k);if(aa.length!=Z.length){return false}var ab=AJS.trim(ac.text());return ab.length===0&&Z.filter("br").length<=1}return false}function K(Y){if(Y&&(tinymce.isGecko||tinymce.isWebKit)){var aa=Y.childNodes,ab=aa.length,ac;for(var Z=(ab-1);Z>=0;Z--){ac=aa[Z];if(ac.nodeType==3&&!ac.length){D.dom.remove(ac)}}}}function X(Y){return Y.keyCode===tinymce.VK.ENTER}function E(Y){return X(Y)&&!Y.shiftKey}function L(Y){return Y.keyCode===tinymce.VK.BACKSPACE||Y.keyCode===tinymce.VK.DELETE}function P(Y){if(H(Y)){return z}else{if(E(Y)&&A()){return N}else{if(E(Y)&&I()){return w}else{return Q}}}}function G(Y,Z){if(B==z||B==w||(tinymce.isGecko||tinymce.isWebKit)&&B==N){u.cancel(Z)}}function M(){var ab=D.selection.getNode();var aa="h1,h2,h3,h4,h5,h6,p,div";var Z=D.dom.is(ab,aa)&&ab.parentNode.tagName==="LI"&&ab.parentNode.lastChild===ab;var Y=AJS.EditorUtils.isCursorAtEndOf(ab,D.selection.getRng(true));return D.selection.isCollapsed()&&Z&&Y}function O(aa,ac){if(E(ac)&&M()){aa.undoManager.beforeChange();aa.undoManager.add();var ab=aa.selection.getNode();var Z=aa.dom.create("li",{},!tinyMCE.isIE?'<br data-mce-bogus="true">':"");var Y=aa.dom.getParent(ab,"li");aa.dom.insertAfter(Z,Y);if(tinyMCE.isIE6||tinyMCE.isIE7||tinyMCE.isIE8){Z.appendChild(aa.dom.create("&nbsp;"));aa.selection.setCursorLocation(Z,1)}else{if(tinyMCE.isGecko){setTimeout(function(){aa.selection.setCursorLocation(Z,0)},0)}else{aa.selection.setCursorLocation(Z,0)}}aa.undoManager.add();ac.preventDefault()}}function y(ab,ad){var ag;if(!tinymce.isGecko){return}var Z=ab.selection.getStart();if(ad.keyCode!=tinymce.VK.BACKSPACE||Z.tagName!=="IMG"){return}function aa(ak){var al=ak.firstChild;var aj=null;do{if(!al){break}if(al.tagName==="LI"){aj=al}}while(al=al.nextSibling);return aj}function ai(ak,aj){while(ak.childNodes.length>0){aj.appendChild(ak.childNodes[0])}}ag=Z.parentNode.previousSibling;if(!ag){return}var ae;if(ag.tagName==="UL"||ag.tagName==="OL"){ae=ag}else{if(ag.previousSibling&&(ag.previousSibling.tagName==="UL"||ag.previousSibling.tagName==="OL")){ae=ag.previousSibling}else{return}}var ah=aa(ae);var Y=ab.dom.createRng();Y.setStart(ah,1);Y.setEnd(ah,1);ab.selection.setRng(Y);ab.selection.collapse(true);var ac=ab.selection.getBookmark();var af=Z.parentNode.cloneNode(true);if(af.tagName==="P"||af.tagName==="DIV"){ai(af,ah)}else{ah.appendChild(af)}Z.parentNode.parentNode.removeChild(Z.parentNode);ab.selection.moveToBookmark(ac)}function J(Y){var Z=D.dom.getParent(Y,"ol,ul");if(Z!=null){var aa=Z.lastChild;aa.appendChild(D.getDoc().createTextNode(AJS.Rte.HIDDEN_CHAR));D.selection.setCursorLocation(aa,0)}}this.ed=D;D.addCommand("Indent",this.indent,this);D.addCommand("Outdent",this.outdent,this);D.addCommand("InsertUnorderedList",function(){this.applyList("UL","OL")},this);D.addCommand("InsertOrderedList",function(){this.applyList("OL","UL")},this);D.addCommand("InsertInlineTaskList",function(){if(AJS.Rte.Support.inlineTasks()){this.applyList("UL","OL","inline-task-list",{attributesOnItems:{"data-inline-task-id":""},placeholderText:AJS.I18n.getText("tinymce.confluence.placeholder.inline.tasks")})}},this);D.addCommand("InsertInlineTaskListNoToggle",function(){if(AJS.Rte.Support.inlineTasks()){this.applyList("UL","OL","inline-task-list",{attributesOnItems:{"data-inline-task-id":""},placeholderText:AJS.I18n.getText("tinymce.confluence.placeholder.inline.tasks"),noToggle:true})}},this);D.onInit.add(function(){D.editorCommands.addCommands({outdent:function(){var Z=D.selection,aa=D.dom;function Y(ab){ab=aa.getParent(ab,aa.isBlock);return ab&&(parseInt(D.dom.getStyle(ab,"margin-left")||0,10)+parseInt(D.dom.getStyle(ab,"padding-left")||0,10))>0}return Y(Z.getStart())||Y(Z.getEnd())||D.queryCommandState("InsertOrderedList")||D.queryCommandState("InsertUnorderedList")||D.queryCommandState("InsertInlineTaskList")}},"state")});D.onKeyUp.add(function(Z,aa){if(B==z){Z.execCommand(aa.shiftKey?"Outdent":"Indent",true,null);K(F());B=Q;return u.cancel(aa)}else{if(B==w){var Y=F();var ac=Z.settings.list_outdent_on_enter===true||aa.shiftKey;Z.execCommand(ac?"Outdent":"Indent",true,null);if(tinymce.isIE){J(Y)}K(Y);AJS.Rte.showSelection();return u.cancel(aa)}else{if(B==N){if(tinymce.isIE6||tinymce.isIE7||tinymce.isIE8){var ab=Z.getDoc().createTextNode(AJS.Rte.HIDDEN_CHAR);Z.selection.getNode().appendChild(ab)}else{if(tinymce.isIE9||tinymce.isIE10||tinymce.isIE11||tinymce.isGecko||tinymce.isWebKit){Z.execCommand("Outdent");return u.cancel(aa)}}}}}});function U(Z,ad){function aa(ah,ae){var ag=[];var ai=new tinymce.dom.TreeWalker(ae,ah);for(var af=ai.current();af;af=ai.next()){if(Z.dom.is(af,"ol,ul,li")){ag.push(af)}}return ag}if(ad.keyCode==tinymce.VK.BACKSPACE){var Y=F();if(Y){var ac=Z.dom.getParent(Y,"ol,ul");if(ac&&ac.firstChild===Y){var ab=aa(ac,Y);Z.execCommand("Outdent",false,ab);Z.undoManager.add();return u.cancel(ad)}}}}function S(Z,ab){var Y=F();if(Y&&ab.keyCode===tinymce.VK.BACKSPACE&&Z.dom.is(Y,"li")&&Y.parentNode.firstChild!==Y){if(Z.dom.select("ul,ol",Y).length===1){var ad=Y.previousSibling;Z.dom.remove(Z.dom.select("br",Y));Z.dom.remove(Y,true);var aa=tinymce.grep(ad.childNodes,function(ae){return ae.nodeType===3});if(aa.length===1){var ac=aa[0];Z.selection.setCursorLocation(ac,ac.length)}Z.undoManager.add();return u.cancel(ab)}}}function W(aa,Y,ab){var Z;if(ab&&ab.nodeType==1&&aa.dom.is(ab,"li")){Z=ab.parentNode;tinymce.each(aa.dom.select("li>ul,li>ol",Z),function(ad){if(aa.dom.getAttrib(ad.parentNode,"data-mce-style")){return}var ac=ad.previousSibling;if(!ac){ad.parentNode.insertBefore(aa.dom.doc.createElement("br"),ad)}})}}function V(ac,ad){var aa=F(),ab,Z,ae;function Y(ai){var ag=ac.dom.doc.createTextNode(String.fromCharCode(160)),af=ai.previousSibling,ah=(tinymce.isIE6||tinymce.isIE7||tinymce.isIE8)?ab:ac.getDoc().createRange();if(af&&af.nodeType==3&&af.nodeValue[af.length-1]==ag.nodeValue){ah.setStart(af,af.length-1);ah.setEnd(af,af.length-1);ah.collapse(true);ac.selection.setRng(ah)}else{ae.parentNode.insertBefore(ag,ai);ah.setStartBefore(ag);ah.setEndBefore(ag);ah.collapse(true);ac.selection.setRng(ah)}}if(aa&&(E(ad)||L(ad))){ab=ac.selection.getRng(true);Z=ab.endContainer;if(Z.nodeType==3){if(ab.endOffset!==Z.length){return}ae=Z.nextSibling}else{if(Z.nodeType==1){ae=Z.childNodes[ab.endOffset]}else{return}}if(ae&&ac.dom.is(ae,"ul,ol")){if(tinymce.isIE){Y(ae)}else{ae.parentNode.insertBefore(ac.dom.create("br"),ae)}}}}function v(ab){var Z=F();if(!Z){return}var aa=Z.parentNode;function Y(ae){var ac=ae.parentNode,af=ac.previousSibling,ad;K(ac);if(ac.childNodes[0]===ae){if(ab.dom.getAttrib(ac,"data-mce-style")){return}if(ab.selection.getStart().parentNode==ae){ad=ab.selection.getRng(true);ad={startOffset:ad.startOffset,startContainer:ad.startContainer}}if(af){af.appendChild(ae)}else{af=ab.dom.create("li",{style:o});af.appendChild(ae);ac.parentNode.insertBefore(af,ac)}if(ad){ab.selection.setCursorLocation(ad.startContainer||ae.firstChild,ad.startOffset)}if(T(ac)){ab.dom.remove(ac)}}}tinymce.grep(ab.dom.select("li>ul, li>ol",aa),Y);if(ab.dom.is(aa.parentNode,"li")){Y(aa)}if(Z===aa.lastChild&&aa.nextSibling&&ab.dom.is(aa.nextSibling,"ul, ol")){tinymce.grep(ab.dom.select("li>ul, li>ol",aa.nextSibling),Y)}}D.onKeyDown.add(function(Y,Z){B=P(Z)});D.onKeyDown.add(G);D.onKeyDown.add(y);D.onKeyDown.add(O);if(tinymce.isWebKit){D.onNodeChange.add(v);D.onKeyUp.add(v)}if(!tinymce.isIE){D.onNodeChange.add(W);if(tinymce.isGecko){D.onKeyDown.add(V)}}else{D.onKeyDown.add(V)}function C(ab,ad){if(ad.keyCode==46&&!ad.shiftKey){var Y=F();if(Y&&(Y.childNodes.length==0||(Y.childNodes.length==1&&Y.firstChild.nodeName=="BR"))){var ac,ae,aa,Z;if(ac=Y.nextSibling){aa=ab.dom.doc.createTreeWalker(ac,NodeFilter.SHOW_TEXT,null,false);ae=aa.nextNode();Z=ab.getDoc().createRange();Z.setStart(ae,0);Z.setEnd(ae,0);ab.selection.setRng(Z);ab.dom.remove(Y);ab.undoManager.add();u.cancel(ad)}}}}if(tinymce.isGecko){D.onKeyDown.add(C)}},applyList:function(D,y,K,z){var L=this,F=L.ed,R=F.dom,v=[],Q=false,x=false,A=false,w=false,J,P=F.selection.getSelectedBlocks();K=K||"";z=z||{};var I=z.attributesOnItems,H=z.placeholderText,S=z.noToggle;function O(W){if(W&&W.tagName==="BR"){R.remove(W)}}function E(W){if(W&&W.tagName==="LI"){R.removeClass(W,"checked");W.removeAttribute("data-inline-task-id")}}function C(W){if(I&&W&&W.tagName==="LI"){for(var X in I){W.setAttribute(X,I[X])}}}function N(Z){var ab=R.create(D),W;if(K!=""){ab.className=K}function Y(ad){if(ad.style.marginLeft||ad.style.paddingLeft){L.adjustPaddingFunction(false)(ad)}}if(Z.tagName==="LI"){C(Z)}else{if(Z.tagName==="P"||Z.tagName==="DIV"||Z.tagName==="BODY"){V(Z,function(ae,ad){T(ae,ad,Z.tagName==="BODY"?null:ae.parentNode);W=ae.parentNode;Y(W);if(!tinymce.isChrome){O(ad)}});if(W){if(W.tagName==="LI"&&(Z.tagName==="P"||P.length>1)){if(H&&L.isEmptyElement(W)){var ac=document.createTextNode(H),aa=R.create("span");aa.appendChild(ac);W.appendChild(aa);setTimeout(function(){F.selection.select(ac)},0);if(tinymce.isIE7||tinymce.isIE8){W.appendChild(F.dom.create("br",{_mce_bogus:"1"}))}function X(ae,ad){if((ad.which||ad.keyCode)==64){if(ac.textContent==H){ac.textContent=" "}else{if(ac.data==H){ac.data=" "}}}window.setTimeout(function(){F.onKeyPress.remove(X)},0)}F.onKeyPress.addToTop(X)}R.split(W.parentNode.parentNode,W.parentNode)}p(W.parentNode,true);C(W)}return}else{W=R.create("li");C(W);R.insertAfter(W,Z);W.appendChild(Z);Y(Z);Z=W}}R.insertAfter(ab,Z);ab.appendChild(Z);p(ab,true);v.push(Z)}function T(ac,X,aa){var W,ab=ac,Z;while(!R.isBlock(ac.parentNode)&&ac.parentNode!==R.getRoot()){ac=R.split(ac.parentNode,ac.previousSibling);ac=ac.nextSibling;ab=ac}if(aa){W=aa.cloneNode(true);ac.parentNode.insertBefore(W,ac);while(W.firstChild){R.remove(W.firstChild)}W=R.rename(W,"li")}else{W=R.create("li");ac.parentNode.insertBefore(W,ac)}if(ab&&ab==X){var Y=R.create("br");R.setAttrib(Y,"data-mce-bogus",1);W.appendChild(ab);R.insertAfter(Y,ab)}while(ab&&ab!=X){Z=ab.nextSibling;W.appendChild(ab);ab=Z}if(W.childNodes.length===0){W.innerHTML='<br _mce_bogus="1" />'}N(W)}function V(ac,af){var Z,ad,aa=3,X=1,W="br,ul,ol,p,div,h1,h2,h3,h4,h5,h6,table,blockquote,address,pre,form,center,dl";function ab(aj,ag){var ah=R.createRng(),ai;h.keep=true;F.selection.moveToBookmark(h);h.keep=false;ai=F.selection.getRng(true);if(!ag){ag=aj.parentNode.lastChild}ah.setStartBefore(aj);ah.setEndAfter(ag);return !(ah.compareBoundaryPoints(aa,ai)>0||ah.compareBoundaryPoints(X,ai)<=0)}function ae(ag){if(ag.nextSibling){return ag.nextSibling}if(!R.isBlock(ag.parentNode)&&ag.parentNode!==R.getRoot()){return ae(ag.parentNode)}}Z=ac.firstChild;var Y=false;d(R.select(W,ac),function(ag){if(ag.hasAttribute&&ag.hasAttribute("_mce_bogus")){return true}if(ab(Z,ag)){R.addClass(ag,"_mce_tagged_br");Z=ae(ag)}});Y=(Z&&ab(Z,undefined));Z=ac.firstChild;d(R.select(W,ac),function(ah){var ag=ae(ah);if(ah.hasAttribute&&ah.hasAttribute("_mce_bogus")){return true}if(R.hasClass(ah,"_mce_tagged_br")){af(Z,ah,ad);ad=null}else{ad=ah}Z=ag});if(Y){af(Z,undefined,ad)}}function M(W){V(W,function(Y,X,Z){T(Y,X);O(X);O(Z)})}function G(W){E(W);if(tinymce.inArray(v,W)!==-1){return}if(W.parentNode.tagName===y||!w){R.split(W.parentNode,W);N(W);r(W.parentNode,false)}if(K!=""){W.parentNode.className=K}C(W);v.push(W)}function B(Y){E(Y);var aa,Z,X,W;if(tinymce.inArray(v,Y)!==-1){return}Y=c(Y,R);while(R.is(Y.parentNode,"ol,ul,li")){R.split(Y.parentNode,Y)}v.push(Y);Y=R.rename(Y,"p");X=p(Y,false,F.settings.force_br_newlines);if(X===Y){aa=Y.firstChild;while(aa){if(R.isBlock(aa)){aa=R.split(aa.parentNode,aa);W=true;Z=aa.nextSibling&&aa.nextSibling.firstChild}else{Z=aa.nextSibling;if(W&&aa.tagName==="BR"){R.remove(aa)}W=false}aa=Z}}}function U(X,Y){var X=m(X,Y);var W=X.tagName==="LI"?X.parentNode:X;return W}d(P,function(W){W=U(W,R);w=(W.className===K);if(W.tagName===y){x=true}else{if(W.tagName===D){Q=true}else{A=true}}});if(A&&!Q||x||!w||P.length===0){J={LI:G,H1:N,H2:N,H3:N,H4:N,H5:N,H6:N,P:N,BODY:N,DIV:P.length>1?N:M,defaultAction:M,elements:this.selectedBlocks()}}else{if(!S){J={defaultAction:B,elements:this.selectedBlocks()}}else{J={}}}this.process(J)},indent:function(){var x=this.ed,z=x.dom,A=[];function v(C){var B=z.create("li",{style:o});z.insertAfter(B,C);return B}function w(F){var B=v(F),H=z.getParent(F,"ol,ul"),G=H.tagName,I=z.getStyle(H,"list-style-type"),E=H.className||"",D={},C;if(I!==""){D.style="list-style-type: "+I+";"}C=z.create(G,D);if(E!=""){C.className=E}B.appendChild(C);return C}function y(C){if(!e(x,C,A)){C=c(C,z);var B=w(C);if(tinymce.isIE7||tinymce.isIE8){C.appendChild(x.dom.create("br",{_mce_bogus:"1"}))}B.appendChild(C);p(B.parentNode,false);p(B,false);A.push(C)}}this.process({LI:y,defaultAction:this.adjustPaddingFunction(true),elements:this.selectedBlocks()})},outdent:function(A,z){var y=this,w=y.ed,B=w.dom,v=[];function C(D){var F,E,G;if(!e(w,D,v)){if(B.getStyle(D,"margin-left")!==""||B.getStyle(D,"padding-left")!==""){return y.adjustPaddingFunction(false)(D)}G=B.getStyle(D,"text-align",true);if(G==="center"||G==="right"){B.setStyle(D,"text-align","left");return}D=c(D,B);F=D.parentNode;E=D.parentNode.parentNode;if(E.tagName==="P"){B.split(E,D.parentNode)}else{B.split(F,D);if(E.tagName==="LI"){B.split(E,D)}else{if(!B.is(E,"ol,ul")){B.rename(D,"p")}}}if(B.hasClass(D.parentNode,"inline-task-list")){if(!D.hasAttribute("data-inline-task-id")){D.setAttribute("data-inline-task-id","")}}else{D.removeAttribute("data-inline-task-id")}v.push(D)}}var x=z&&tinymce.is(z,"array")?z:this.selectedBlocks();this.process({LI:C,defaultAction:this.adjustPaddingFunction(false),elements:x});d(v,p)},isEmptyElement:function(w){var x=this.ed.dom;var v=tinymce.grep(w.childNodes,function(y){return !(y.nodeName==="BR"||y.nodeName==="SPAN"&&x.getAttrib(y,"data-mce-type")=="bookmark"||y.nodeType==3&&(y.nodeValue==String.fromCharCode(160)||y.nodeValue==""))});return v.length===0},process:function(z){var F=this,x=F.ed.selection,A=F.ed.dom,E,v;function y(H){if(tinymce.isIE7||tinymce.isIE8){f(H).find("br[_mce_bogus='1']").remove()}A.removeClass(H,"_mce_act_on");if(!H||H.nodeType!==1||E.length>1&&F.isEmptyElement(H)){return}H=m(H,A);var I=z[H.tagName];if(!I){I=z.defaultAction}I(H)}function w(H){F.splitSafeEach(H.childNodes,y)}function C(H,I){return I>=0&&H.hasChildNodes()&&I<H.childNodes.length&&H.childNodes[I].tagName==="BR"}function D(){var I=x.getNode();var H=A.getParent(I,"td");return H!==null}E=z.elements;v=x.getRng(true);if(!v.collapsed){if(C(v.endContainer,v.endOffset-1)){v.setEnd(v.endContainer,v.endOffset-1);x.setRng(v)}if(C(v.startContainer,v.startOffset)){v.setStart(v.startContainer,v.startOffset+1);x.setRng(v)}}if(tinymce.isIE7||tinymce.isIE8){var G=F.ed.selection.getNode();if(G.tagName==="LI"&&!(G.parentNode.lastChild===G)){var B=F.ed.getDoc().createTextNode(AJS.Rte.HIDDEN_CHAR);G.appendChild(B)}}h=x.getBookmark();z.OL=z.UL=w;F.splitSafeEach(E,y);x.moveToBookmark(h);h=null;if(!D()){F.ed.execCommand("mceRepaint")}},splitSafeEach:function(w,v){if(tinymce.isGecko&&(/Firefox\/[12]\.[0-9]/.test(navigator.userAgent)||/Firefox\/3\.[0-4]/.test(navigator.userAgent))){this.classBasedEach(w,v)}else{d(w,v)}},classBasedEach:function(y,x){var z=this.ed.dom,v,w;d(y,function(A){z.addClass(A,"_mce_act_on")});v=z.select("._mce_act_on");while(v.length>0){w=v.shift();z.removeClass(w,"_mce_act_on");x(w);v=z.select("._mce_act_on")}},adjustPaddingFunction:function(x){var v,y,w=this.ed;v=w.settings.indentation;y=/[a-z%]+/i.exec(v);v=parseInt(v,10);return function(z){var B,A;B=parseInt(w.dom.getStyle(z,"margin-left")||0,10)+parseInt(w.dom.getStyle(z,"padding-left")||0,10);if(x){A=B+v}else{A=B-v}w.dom.setStyle(z,"padding-left","");w.dom.setStyle(z,"margin-left",A>0?A+y:"")}},selectedBlocks:function(){var v=this.ed;var w=v.selection.getSelectedBlocks();return w.length==0?[v.dom.getRoot()]:w},getInfo:function(){return{longname:"Lists",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/lists",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("lists",tinymce.plugins.Lists)}(AJS.$));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-extensions', location = 'jscripts/jquery/jquery-column.js' */
(function(g){var f=/([\+\-]?\d*)[nN]([\+\-]?\d*)/,b,c,d=jQuery.expr.filter.PSEUDO;function h(k){var j=[],i={multiplier:0,offset:0};if(k==="even"){k="2n"}else{if(k==="odd"){k="2n+1"}else{if(/^\d*$/.test(k)){k="0n+"+k}}}j=f.exec(k);if(j!==null){i.multiplier=j[1]-0;i.offset=j[2]-0}return i}function e(k,l){var j,o,i=[],n=0,m=[];g.each(k,function(q,p){var s=0,r=0,t=p.rowSpan||1,u=p.colSpan||1;if(p.parentNode!==j){j=p.parentNode;if(j.parentNode!==o){o=j.parentNode;i=[]}n=0;if(i[j.rowIndex]===undefined){i[j.rowIndex]=[]}}for(s=0;s<i[j.rowIndex].length+1;s+=1){if(i[j.rowIndex][s]===undefined){n=s;break}}m[q]=n;for(s=j.rowIndex;s<j.rowIndex+t;s+=1){if(i[s]===undefined){i[s]=[]}for(r=n;r<n+u;r+=1){i[s][r]=true}}});return m}function a(k,j,i){var l=b[i]-(c.offset-1);if(c.multiplier===0){return l===0}else{return(l%c.multiplier===0&&l/c.multiplier>=0)}}g.extend(jQuery.fn,{nthCol:function(i){c=h(i);b=e(this);return g(this).filter(function(j){return a(this,undefined,j)})}})}(jQuery));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-extensions', location = 'jscripts/tiny_mce/plugins/table/editor_plugin_src.js' */
(function(e,g){var f=e.each,d=AJS.storageManager("atlassian.editor","tables");function c(j,k){var l=k.ownerDocument,h=l.createRange(),m;h.setStartBefore(k);h.setEnd(j.endContainer,j.endOffset);m=l.createElement("body");m.appendChild(h.cloneContents());return m.innerHTML.replace(/<(br|img|object|embed|input|textarea)[^>]*>/gi,"-").replace(/<[^>]+>/g,"").length==0}function a(j,h){return parseInt(j.getAttribute(h)||1)}function b(z,j,t){var N,m,w,M;p();M=j.getParent(t.getStart(),"th,td");if(M){m=B(M);w=I();M=k(m.x,m.y)}function F(Y,X){Y=Y.cloneNode(X);Y.removeAttribute("id");return Y}function p(){var X=0;N=[];f(["thead","tbody","tfoot"],function(Y){var Z=j.select("> "+Y+" tr",z);f(Z,function(aa,ab){ab+=X;f(j.select("> td, > th",aa),function(ah,ac){var ad,ae,af,ag;if(N[ab]){while(N[ab][ac]){ac++}}af=a(ah,"rowspan");ag=a(ah,"colspan");for(ae=ab;ae<ab+af;ae++){if(!N[ae]){N[ae]=[]}for(ad=ac;ad<ac+ag;ad++){N[ae][ad]={part:Y,real:ae==ab&&ad==ac,elm:ah,rowspan:af,colspan:ag}}}})});X+=Z.length})}function k(X,Z){var Y;Y=N[Z];if(Y){return Y[X]}}function T(Z,X,Y){if(Z){Y=parseInt(Y);if(Y===1){Z.removeAttribute(X,1)}else{Z.setAttribute(X,Y,1)}}}function U(X){return X&&(j.hasClass(X.elm,"mceSelected")||X==M)}function Q(){var X=[];f(z.rows,function(Y){f(Y.cells,function(Z){if(j.hasClass(Z,"mceSelected")||Z==M.elm){X.push(Y);return false}})});return X}function o(){var X=j.createRng();X.setStartAfter(z);X.setEndAfter(z);t.setRng(X);j.remove(z)}function C(X){var Y;e.walk(X,function(aa){var Z;if(aa.nodeType==3){f(j.getParents(aa.parentNode,null,X).reverse(),function(ab){ab=F(ab,false);if(!Y){Y=Z=ab}else{if(Z){Z.appendChild(ab)}}Z=ab});if(Z){Z.innerHTML=e.isIE?"&nbsp;":'<br data-mce-bogus="1" />'}return false}},"childNodes");X=F(X,false);T(X,"rowSpan",1);T(X,"colSpan",1);if(Y){X.appendChild(Y)}else{if(!e.isIE){X.innerHTML='<br data-mce-bogus="1" />'}}return X}function n(){var X=j.createRng();f(j.select("tr",z),function(Y){if(Y.cells.length==0){j.remove(Y)}});if(j.select("tr",z).length==0){X.setStartAfter(z);X.setEndAfter(z);t.setRng(X);j.remove(z);return}f(j.select("thead,tbody,tfoot",z),function(Y){if(Y.rows.length==0){j.remove(Y)}});K()}function K(){var Y,X;p();Y=N[Math.min(N.length-1,m.y)];if(Y){X=Y[Math.min(Y.length-1,m.x)].elm;X&&S(X)}}function S(X){if(e.isIE9||e.isIE10up){t.setCursorLocation(X,0);t.collapse(true)}else{t.select(X,true);t.collapse(true)}}function A(ad,ab,af,ac){var aa,Y,X,Z,ae;aa=N[ab][ad].elm.parentNode;for(X=1;X<=af;X++){aa=j.getNext(aa,"tr");if(aa){for(Y=ad;Y>=0;Y--){ae=N[ab+X][Y].elm;if(ae.parentNode==aa){for(Z=1;Z<=ac;Z++){j.insertAfter(C(ae),ae)}break}}if(Y==-1){for(Z=1;Z<=ac;Z++){aa.insertBefore(C(aa.cells[0]),aa.cells[0])}}}}}function G(){f(N,function(X,Y){f(X,function(aa,Z){var ad,ac,ae,ab;if(U(aa)){aa=aa.elm;ad=a(aa,"colspan");ac=a(aa,"rowspan");if(ad>1||ac>1){T(aa,"rowSpan",1);T(aa,"colSpan",1);for(ab=0;ab<ad-1;ab++){j.insertAfter(C(aa),aa)}A(Z,Y,ac-1,ad)}}})})}function L(ag,ad,aj){var aa,Z,ai,ah,af,ac,ae,X,ag,Y,ab;if(ag){pos=B(ag);aa=pos.x;Z=pos.y;ai=aa+(ad-1);ah=Z+(aj-1)}else{aa=m.x;Z=m.y;ai=w.x;ah=w.y}ae=k(aa,Z);X=k(ai,ah);if(ae&&X&&ae.part==X.part){G();p();ae=k(aa,Z).elm;T(ae,"colSpan",(ai-aa)+1);T(ae,"rowSpan",(ah-Z)+1);for(ac=Z;ac<=ah;ac++){for(af=aa;af<=ai;af++){if(!N[ac]||!N[ac][af]){continue}ag=N[ac][af].elm;if(ag!=ae){Y=e.grep(ag.childNodes);f(Y,function(ak){ae.appendChild(ak)});if(Y.length){Y=e.grep(ae.childNodes);ab=0;f(Y,function(ak){if(ak.nodeName=="BR"&&j.getAttrib(ak,"data-mce-bogus")&&ab++<Y.length-1){ae.removeChild(ak)}})}j.remove(ag)}}}n()}}function r(ad){var X,af,ac,ae,ag,ah,Y,ai,ab,aa,Z;f(N,function(aj,ak){f(aj,function(am,al){if(U(am)){am=am.elm;ag=am.parentNode;ah=F(ag,false);X=ak;if(ad){return false}}});if(ad){return !X}});for(ae=0;ae<N[0].length;ae++){if(!N[X][ae]){continue}af=N[X][ae].elm;if(af!=ac){if(!ad){ab=a(af,"rowspan");if(ab>1){T(af,"rowSpan",ab+1);continue}}else{if(X>0&&N[X-1][ae]){ai=N[X-1][ae].elm;ab=a(ai,"rowSpan");if(ab>1){T(ai,"rowSpan",ab+1);continue}}}Z=AJS.Rte.Table.isColumnHeading(g(af).closest("table"),ae+1);Y=Z?j.create("th"):j.create("td");Y.colSpan=af.colSpan;Y.width=af.width;Y.innerHTML=e.isIE9?"":(e.isIE?"&nbsp;":'<br data-mce-bogus="1" />');Y.className=af.className;if(!Z){j.removeClass(Y,e.settings.confluence_table_heading_style);j.addClass(Y,e.settings.confluence_table_cell_style)}aa=j.getAttrib(af,"data-highlight-colour");if(!AJS.Rte.Table.isColumnHighlighted(z,ae+1)){j.removeClass(Y,"highlight-"+aa)}else{j.setAttrib("data-highlight-colour",aa)}ah.appendChild(Y);ac=af}}if(ah.hasChildNodes()){if(!ad){j.insertAfter(ah,ag)}else{ag.parentNode.insertBefore(ah,ag)}}}function l(Z){var aa,X;function Y(ab){var ac;var ad=j.create(ab.tagName);ad.colSpan=ab.colSpan;ad.width=ab.width;ad.className=ab.className;ad.innerHTML=e.isIE?"&nbsp;":'<br data-mce-bogus="1"/>';ac=j.getAttrib(ab,"data-highlight-colour");if(ac){j.setAttrib(ad,"data-highlight-colour",ac)}return ad}f(N,function(ab,ac){f(ab,function(ae,ad){if(U(ae)){aa=ad;if(Z){return false}}});if(Z){return !aa}});f(N,function(ae,af){var ab,ac,ad;if(!ae[aa]){return}ab=ae[aa].elm;if(ab!=X){ad=a(ab,"colspan");ac=a(ab,"rowspan");if(ad==1){if(!Z){j.insertAfter(Y(ab),ab);A(aa,af,ac-1,ad)}else{ab.parentNode.insertBefore(Y(ab),ab);A(aa,af,ac-1,ad)}}else{T(ab,"colSpan",ab.colSpan+1)}X=ab}})}function V(){var X=[];f(N,function(Y,Z){f(Y,function(ab,aa){if(U(ab)&&e.inArray(X,aa)===-1){f(N,function(ae){if(ae[aa]){var ac=ae[aa].elm,ad;ad=a(ac,"colSpan");if(ad>1){T(ac,"colSpan",ad-1)}else{j.remove(ac)}}});X.push(aa)}})});n()}function E(){var Y;function X(ab){var aa,ac,Z;aa=j.getNext(ab,"tr");f(ab.cells,function(ad){var ae=a(ad,"rowSpan");if(ae>1){T(ad,"rowSpan",ae-1);ac=B(ad);A(ac.x,ac.y,1,1)}});ac=B(ab.cells[0]);f(N[ac.y],function(ad){var ae;ad=ad.elm;if(ad!=Z){ae=a(ad,"rowSpan");if(ae<=1){j.remove(ad)}else{T(ad,"rowSpan",ae-1)}Z=ad}})}Y=Q();if(e.isIE9||e.isIE10){s(Y[0])}f(Y.reverse(),function(Z){X(Z)});n()}function J(){var X=Q();if(e.isIE9||e.isIE10){s(X[0])}j.remove(X);n();return X}function D(){var X=Q();f(X,function(Z,Y){X[Y]=F(Z,true)});return X}function H(Z,Y){var aa=Q(),X=aa[Y?0:aa.length-1],ab=X.cells.length;f(N,function(ad){var ac;ab=0;f(ad,function(af,ae){if(af.real){ab+=af.colspan}if(af.elm.parentNode==X){ac=1}});if(ac){return false}});if(!Y){Z.reverse()}f(Z,function(ae){var ad=ae.cells.length,ac;for(i=0;i<ad;i++){ac=ae.cells[i];T(ac,"colSpan",1);T(ac,"rowSpan",1)}for(i=ad;i<ab;i++){ae.appendChild(C(ae.cells[ad-1]))}for(i=ab;i<ad;i++){j.remove(ae.cells[i])}if(Y){X.parentNode.insertBefore(ae,X)}else{j.insertAfter(ae,X)}})}function s(X){if(X&&X.parentNode){t.select(X.parentNode);t.collapse(true)}}function P(Y){var X=k(Y.x,Y.y);var Z=X.elm;if((e.isGecko||e.isIE)&&Z.firstChild){Z=Z.firstChild}if(e.isIE9||e.isIE10up){var aa=t.getRng(1);aa.setStart(Z,0);aa.setEnd(Z,0);t.setRng(aa)}else{t.select(Z,true);t.collapse(true)}}function O(){m=B(j.getParent(t.getStart(),"th,td"))}function h(){var X=v();if(!X){r(false);p();X=v()}P(X)}function v(){var X,Y=N[0].length;if(!(m.x==Y-1&&m.y==N.length-1)){if(m.x==Y-1){X={x:0,y:m.y+1}}else{X={x:m.x+1,y:m.y}}}return X}function R(){var X=q();if(!X){r(true);p();O();X=q()}P(X)}function q(){var X;if(!(m.x==0&&m.y==0)){if(m.x>0){X={x:m.x-1,y:m.y}}else{var Y=m.y-1;X={x:N[Y].length-1,y:Y}}}return X}function B(X){var Y;f(N,function(Z,aa){f(Z,function(ac,ab){if(ac.elm==X){Y={x:ab,y:aa};return false}});return !Y});return Y}function u(X){m=B(X)}function I(){var Z,Y,X;Y=X=0;f(N,function(aa,ab){f(aa,function(ad,ac){var af,ae;if(U(ad)){ad=N[ab][ac];if(ac>Y){Y=ac}if(ab>X){X=ab}if(ad.real){af=ad.colspan-1;ae=ad.rowspan-1;if(af){if(ac+af>Y){Y=ac+af}}if(ae){if(ab+ae>X){X=ab+ae}}}}})});return{x:Y,y:X}}function W(ad){var aa,Z,af,ae,Y,X,ab,ac;w=B(ad);if(m&&w){aa=Math.min(m.x,w.x);Z=Math.min(m.y,w.y);af=Math.max(m.x,w.x);ae=Math.max(m.y,w.y);Y=af;X=ae;for(y=Z;y<=X;y++){ad=N[y][aa];if(!ad.real){if(aa-(ad.colspan-1)<aa){aa-=ad.colspan-1}}}for(x=aa;x<=Y;x++){ad=N[Z][x];if(!ad.real){if(Z-(ad.rowspan-1)<Z){Z-=ad.rowspan-1}}}for(y=Z;y<=ae;y++){for(x=aa;x<=af;x++){ad=N[y][x];if(ad.real){ab=ad.colspan-1;ac=ad.rowspan-1;if(ab){if(x+ab>Y){Y=x+ab}}if(ac){if(y+ac>X){X=y+ac}}}}}j.removeClass(j.select("td.mceSelected,th.mceSelected"),"mceSelected");for(y=Z;y<=X;y++){for(x=aa;x<=Y;x++){if(N[y][x]){j.addClass(N[y][x].elm,"mceSelected")}}}}}e.extend(this,{deleteTable:o,split:G,merge:L,insertRow:r,insertCol:l,deleteCols:V,deleteRows:E,cutRows:J,copyRows:D,pasteRows:H,getPos:B,setStartCell:u,setEndCell:W,moveCaretToNextCell:h,moveCaretToPrevCell:R})}e.create("tinymce.plugins.TablePlugin",{init:function(n,j){var q,o,p=true;function k(t){var s=n.selection,r;t=t||s.getNode().parentNode;r=n.dom.getParent(t,"table");if(r){return new b(r,n.dom,s)}}function l(){n.getBody().style.webkitUserSelect="";if(p){n.dom.removeClass(n.dom.select("td.mceSelected,th.mceSelected"),"mceSelected");p=false}}f([["table","table.desc","mceInsertTable",true],["delete_table","table.del","mceTableDelete"],["delete_col","table.delete_col_desc","mceTableDeleteCol"],["delete_row","table.delete_row_desc","mceTableDeleteRow"],["col_after","table.col_after_desc","mceTableInsertColAfter"],["col_before","table.col_before_desc","mceTableInsertColBefore"],["row_after","table.row_after_desc","mceTableInsertRowAfter"],["row_before","table.row_before_desc","mceTableInsertRowBefore"],["row_props","table.row_desc","mceTableRowProps",true],["cell_props","table.cell_desc","mceTableCellProps",true],["split_cells","table.split_cells_desc","mceTableSplitCells",true],["merge_cells","table.merge_cells_desc","mceTableMergeCells",true]],function(r){n.addButton(r[0],{title:r[1],cmd:r[2],ui:r[3]})});if(!e.isIE){n.onClick.add(function(r,s){s=s.target;if(s.nodeName==="TABLE"){r.selection.select(s);r.nodeChanged()}})}n.onPreProcess.add(function(s,t){var r,u,v,z=s.dom,w;r=z.select("table",t.node);u=r.length;while(u--){v=r[u];z.setAttrib(v,"data-mce-style","");if((w=z.getAttrib(v,"width"))){z.setStyle(v,"width",w);z.setAttrib(v,"width","")}if((w=z.getAttrib(v,"height"))){z.setStyle(v,"height",w);z.setAttrib(v,"height","")}}});n.onNodeChange.add(function(s,r,u){var t;u=s.selection.getStart();t=s.dom.getParent(u,"td,th,caption");r.setActive("table",u.nodeName==="TABLE"||!!t);if(t&&t.nodeName==="CAPTION"){t=0}r.setDisabled("delete_table",!t);r.setDisabled("delete_col",!t);r.setDisabled("delete_table",!t);r.setDisabled("delete_row",!t);r.setDisabled("col_after",!t);r.setDisabled("col_before",!t);r.setDisabled("row_after",!t);r.setDisabled("row_before",!t);r.setDisabled("row_props",!t);r.setDisabled("cell_props",!t);r.setDisabled("split_cells",!t);r.setDisabled("merge_cells",!t)});n.onInit.add(function(v){var t,z,u=v.dom,A;q=v.windowManager;v.onMouseDown.add(function(C,D){if(D.button!=2){l();z=u.getParent(D.target,"td,th");t=u.getParent(z,"table")}});u.bind(v.getDoc(),"mouseover",function(G){var E,D,F=u.getParent(G.target,"td,th");if(z&&(A||F!=z)&&F){D=u.getParent(F,"table");if(D==t){if(!A){A=k(D);A.setStartCell(z);v.getBody().style.webkitUserSelect="none"}A.setEndCell(F);p=true}E=v.selection.getSel();try{if(E.removeAllRanges){E.removeAllRanges()}else{E.empty()}}catch(C){}G.preventDefault()}});v.onMouseUp.add(function(G,H){var C,D=G.selection,I,E,F,J,K;if(!z){return}I=u.select("td.mceSelected, th.mceSelected");try{if(I.length===0){return}if(e.isWebKit&&A){G.getBody().style.webkitUserSelect=""}C=u.createRng();E=I[0];F=I[I.length-1];if(e.isWebKit&&u.is(E,"tr:first-child > *:first-child")&&u.is(F,"tr:last-child > *:last-child")){J=u.getParents(E,"table",G.getBody());if(J.length===0){return}K=J[0];C.setStartBefore(K);C.setEndAfter(K)}else{C.setStartBefore(E);C.setEndAfter(F)}D.setRng(C);G.nodeChanged()}finally{z=A=t=null}});v.onUndo.add(function(D,C,E){p=D.dom.select("td.mceSelected, th.mceSelected").length>0});v.onKeyUp.add(function(C,D){l()});v.onKeyDown.add(function(C,D){r(C)});v.onMouseDown.add(function(C,D){if(D.button!=2){r(C)}});function s(H,D,E,J){var F=3,K=H.dom.getParent(D.startContainer,"TABLE"),G,C,I;if(K){G=K.parentNode}C=D.startContainer.nodeType==F&&D.startOffset==0&&D.endOffset==0&&J&&(E.nodeName=="TR"||E==G);I=(E.nodeName=="TD"||E.nodeName=="TH")&&!J;return C||I}function r(E){if(!e.isWebKit){return}var D=E.selection.getRng();var G=E.selection.getNode();var F=E.dom.getParent(D.startContainer,"TD,TH");if(!s(E,D,G,F)){return}if(!F){F=G}var C=F.lastChild;while(C.lastChild){C=C.lastChild}D.setEnd(C,C.nodeValue.length);E.selection.setRng(D)}v.plugins.table.fixTableCellSelection=r;if(v&&v.plugins.contextmenu){v.plugins.contextmenu.onContextMenu.add(function(E,C,G){var H,F=v.selection,D=F.getNode()||v.getBody();if(v.dom.getParent(G,"td")||v.dom.getParent(G,"th")||v.dom.select("td.mceSelected,th.mceSelected").length){C.removeAll();if(D.nodeName=="A"&&!v.dom.getAttrib(D,"name")){C.add({title:"advanced.link_desc",icon:"link",cmd:v.plugins.advlink?"mceAdvLink":"mceLink",ui:true});C.add({title:"advanced.unlink_desc",icon:"unlink",cmd:"UnLink"});C.addSeparator()}if(D.nodeName=="IMG"&&D.className.indexOf("mceItem")==-1){C.add({title:"advanced.image_desc",icon:"image",cmd:v.plugins.advimage?"mceAdvImage":"mceImage",ui:true});C.addSeparator()}C.add({title:"table.desc",icon:"table",cmd:"mceInsertTable",value:{action:"insert"}});C.add({title:"table.props_desc",icon:"table_props",cmd:"mceInsertTable"});C.add({title:"table.del",icon:"delete_table",cmd:"mceTableDelete"});C.addSeparator();H=C.addMenu({title:"table.cell"});H.add({title:"table.cell_desc",icon:"cell_props",cmd:"mceTableCellProps"});H.add({title:"table.split_cells_desc",icon:"split_cells",cmd:"mceTableSplitCells"});H.add({title:"table.merge_cells_desc",icon:"merge_cells",cmd:"mceTableMergeCells"});H=C.addMenu({title:"table.row"});H.add({title:"table.row_desc",icon:"row_props",cmd:"mceTableRowProps"});H.add({title:"table.row_before_desc",icon:"row_before",cmd:"mceTableInsertRowBefore"});H.add({title:"table.row_after_desc",icon:"row_after",cmd:"mceTableInsertRowAfter"});H.add({title:"table.delete_row_desc",icon:"delete_row",cmd:"mceTableDeleteRow"});H.addSeparator();H.add({title:"table.cut_row_desc",icon:"cut",cmd:"mceTableCutRow"});H.add({title:"table.copy_row_desc",icon:"copy",cmd:"mceTableCopyRow"});H.add({title:"table.paste_row_before_desc",icon:"paste",cmd:"mceTablePasteRowBefore"}).setDisabled(!o);H.add({title:"table.paste_row_after_desc",icon:"paste",cmd:"mceTablePasteRowAfter"}).setDisabled(!o);H=C.addMenu({title:"table.col"});H.add({title:"table.col_before_desc",icon:"col_before",cmd:"mceTableInsertColBefore"});H.add({title:"table.col_after_desc",icon:"col_after",cmd:"mceTableInsertColAfter"});H.add({title:"table.delete_col_desc",icon:"delete_col",cmd:"mceTableDeleteCol"})}else{C.add({title:"table.desc",icon:"table",cmd:"mceInsertTable"})}})}if(e.isWebKit){function B(G,R){var P=e.VK;var U=R.keyCode;function S(ac,Y,W){var X=ac?"previousSibling":"nextSibling";var ad=G.dom.getParent(Y,"tr");var ab=ad[X];if(ab){D(G,Y,ab,ac);e.dom.Event.cancel(W);return true}else{var ae=G.dom.getParent(ad,"table");var aa=ad.parentNode;var V=aa.nodeName.toLowerCase();if(V==="tbody"||V===(ac?"tfoot":"thead")){var Z=C(ac,ae,aa,"tbody");if(Z!==null){return O(ac,Z,Y,W)}}return Q(ac,ad,X,ae,W)}}function C(Z,X,Y,ab){var W=G.dom.select(">"+ab,X);var V=W.indexOf(Y);if(Z&&V===0||!Z&&V===W.length-1){return F(Z,X)}else{if(V===-1){var aa=Y.tagName.toLowerCase()==="thead"?0:W.length-1;return W[aa]}else{return W[V+(Z?-1:1)]}}}function F(Y,X){var W=Y?"thead":"tfoot";var V=G.dom.select(">"+W,X);return V.length!==0?V[0]:null}function O(Z,X,W,Y){var V=N(X,Z);V&&D(G,W,V,Z);e.dom.Event.cancel(Y);return true}function Q(ac,Y,V,ab,aa){var W=ab[V];if(W){J(W);return true}else{var Z=G.dom.getParent(ab,"td,th");if(Z){return S(ac,Z,aa)}else{var X=N(Y,!ac);J(X);return e.dom.Event.cancel(aa)}}}function N(W,V){var X=W&&W[V?"lastChild":"firstChild"];return X&&X.nodeName==="BR"?G.dom.getParent(X,"td,th"):X}function J(V){G.selection.setCursorLocation(V,0)}function E(){return U==P.UP||U==P.DOWN}function H(V){var X=V.selection.getNode();var W=V.dom.getParent(X,"tr");return W!==null}function T(W){var V=0;var X=W;while(X.previousSibling){X=X.previousSibling;V=V+a(X,"colspan")}return V}function I(X,V){var Y=0;var W=0;f(X.children,function(Z,aa){Y=Y+a(Z,"colspan");W=aa;if(Y>V){return false}});return W}function D(X,aa,ac,Z){var ab=T(X.dom.getParent(aa,"td,th"));var W=I(ac,ab);var V=ac.childNodes[W];var Y=N(V,Z);J(Y||V)}function L(V){var X=G.selection.getNode();var Y=G.dom.getParent(X,"td,th");var W=G.dom.getParent(V,"td,th");return Y&&Y!==W&&M(Y,W)}function M(W,V){return G.dom.getParent(W,"TABLE")===G.dom.getParent(V,"TABLE")}if(E()&&H(G)){var K=G.selection.getNode();setTimeout(function(){if(L(K)){S(!R.shiftKey&&U===P.UP,K,R)}},0)}}v.onKeyDown.add(B)}if(!e.isIE){function w(){}if(e.isGecko){v.onKeyDown.add(function(D,F){var C,E,G=D.dom;if(F.keyCode==37||F.keyCode==38){C=D.selection.getRng();E=G.getParent(C.startContainer,"table");if(E&&D.getBody().firstChild==E){if(c(C,E)){C=G.createRng();C.setStartBefore(E);C.setEndBefore(E);D.selection.setRng(C);F.preventDefault()}}}})}v.onKeyUp.add(w);v.onSetContent.add(w);v.onVisualAid.add(w);if(e.isGecko){v.onKeyDown.add(function(D,F){if(F.keyCode===e.VK.ENTER&&F.shiftKey){var E=D.selection.getRng().startContainer;var G=u.getParent(E,"td,th");if(G){var C=D.getDoc().createTextNode("\uFEFF");u.insertAfter(C,E)}}})}w();v.startContent=v.getContent({format:"raw"})}});function h(s){var u=[],r="";for(var t=0;t<s.length;t++){u.push(AJS.Rte.getEditor().serializer.serialize(s[t]))}r="<tr>"+u.join("</tr><tr>")+"</tr>";d.setItem("copied",r,(60*60)*2)}function m(){var t=[],r=d.getItem("copied")||"",s;if(r){s=n.getDoc().createElement("div");s.innerHTML="<table>"+r+"</table>";t=g(s).find("tr")}return t}f({mceTableSplitCells:function(r){r.split()},mceTableMergeCells:function(s){var t,u,r;r=n.dom.getParent(n.selection.getNode(),"th,td");if(r){t=r.rowSpan;u=r.colSpan}if(n.dom.select("td.mceSelected,th.mceSelected").length){s.merge()}},mceTableInsertRowBefore:function(r){r.insertRow(true)},mceTableInsertRowAfter:function(r){r.insertRow()},mceTableInsertColBefore:function(r){r.insertCol(true)},mceTableInsertColAfter:function(r){r.insertCol()},mceTableDeleteCol:function(r){r.deleteCols()},mceTableDeleteRow:function(r){r.deleteRows()},mceTableCutRow:function(r){o=r.cutRows();h(o)},mceTableCopyRow:function(r){o=r.copyRows();h(o)},mceTablePasteRowBefore:function(r){r.pasteRows(m(),true)},mceTablePasteRowAfter:function(r){r.pasteRows(m())},mceTableDelete:function(r){r.deleteTable()},mceTableMoveCaretToNextCell:function(r){r.moveCaretToNextCell()},mceTableMoveCaretToPrevCell:function(r){r.moveCaretToPrevCell()}},function(s,r){n.addCommand(r,function(){var t=k();if(t){s(t);n.execCommand("mceRepaint");l()}})});f({mceInsertTable:function(r){q.open({url:j+"/table.htm",width:400+parseInt(n.getLang("table.table_delta_width",0)),height:320+parseInt(n.getLang("table.table_delta_height",0)),inline:1},{plugin_url:j,action:r?r.action:0})},mceTableRowProps:function(){q.open({url:j+"/row.htm",width:400+parseInt(n.getLang("table.rowprops_delta_width",0)),height:295+parseInt(n.getLang("table.rowprops_delta_height",0)),inline:1},{plugin_url:j})},mceTableCellProps:function(){q.open({url:j+"/cell.htm",width:400+parseInt(n.getLang("table.cellprops_delta_width",0)),height:295+parseInt(n.getLang("table.cellprops_delta_height",0)),inline:1},{plugin_url:j})}},function(s,r){n.addCommand(r,function(t,u){s(u)})})}});e.PluginManager.add("table",e.plugins.TablePlugin)})(tinymce,AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-extensions', location = 'jscripts/tiny_mce/plugins/table/js/table.js' */
(function(){AJS.$.extend(tinymce.plugins.TablePlugin.prototype,{insertTable:function(J){var v=AJS.$("#tinymce-table-form")[0];var n=AJS.Rte.getEditor(),L=n.dom;var D=2,z=2,I=0,N=-1,l=-1,K,G,F,m=tinymce.settings.confluence_table_style,O,E,A,M="";var C="",H,p;p=L.getParent(n.selection.getNode(),"table");var o,j;o=v.elements.heading.checked;j=v.elements["equal-width-columns"].checked;D=v.elements.cols.value;z=v.elements.rows.value;G=AJS.$("#tinymce-table-form input[name='width']").val();C+="<table";C+=e("data-mce-new","1");if(G&&n.settings.inline_styles){if(M){M+="; "}if(/^[0-9\.]+$/.test(G)){G+="px"}M+="width: "+G}else{C+=e("width",G)}C+=e("class",m);C+=e("style",M);C+=">";for(var u=0;u<z;u++){C+="<tr>";function B(x){return x.charAt(0).toUpperCase()+x.substring(1,x.length)}for(var w=0;w<D;w++){var t,s,k;if(u==0&&o){t="th";k=tinymce.settings.confluence_table_heading_style}else{t="td";k=tinymce.settings.confluence_table_cell_style}if(j){s=' width="'+(Math.round((100/D)*100)/100)+'%"'}C+="<"+t+(s?s:"")+' class="'+k+'">';if(!tinymce.isIE||tinymce.isIE11){C+='<br data-mce-bogus="1"/>'}else{if(tinymce.isIE9){C+="&nbsp;"}}C+="</"+t+">"}C+="</tr>"}C+="</table>";if(n.settings.fix_table_elements){var r="";AJS.Rte.BookmarkManager.restoreBookmark();n.selection.setContent('<br class="_mce_marker" />');tinymce.each("h1,h2,h3,h4,h5,h6,p".split(","),function(x){if(r){r+=","}r+=x+" ._mce_marker"});tinymce.each(n.dom.select(r),function(x){n.dom.split(n.dom.getParent(x,"h1,h2,h3,h4,h5,h6,p"),x)});var q=L.select("br._mce_marker")[0];n.selection.select(q);n.selection.setContent(C);n.dom.remove(q)}else{n.execCommand("mceInsertContent",false,C)}tinymce.each(L.select("table[data-mce-new]"),function(Q){var y=o?"th":"td",x=L.select(y,Q);try{n.selection.setCursorLocation(x[0],0)}catch(P){}L.setAttrib(Q,"data-mce-new","")});n.addVisual();n.execCommand("mceEndUndoLevel",false,{},{skip_undo:true})}});function e(m,l){var k=document.forms[0];var j=k.elements[m];if(typeof(l)=="undefined"||l==null){l="";if(j){l=j.value}}if(l==""){return""}l=l.replace(/&/g,"&amp;");l=l.replace(/\"/g,"&quot;");l=l.replace(/</g,"&lt;");l=l.replace(/>/g,"&gt;");return" "+m+'="'+l+'"'}function g(){tinyMCEPopup.resizeToInnerSize();document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table");document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table");document.getElementById("bordercolor_pickcontainer").innerHTML=getColorPickerHTML("bordercolor_pick","bordercolor");document.getElementById("bgcolor_pickcontainer").innerHTML=getColorPickerHTML("bgcolor_pick","bgcolor");var s=2,r=2,z=tinyMCEPopup.getParam("table_default_border","0"),G=tinyMCEPopup.getParam("table_default_cellpadding",""),k=tinyMCEPopup.getParam("table_default_cellspacing","");var A="",y="",v="",D="",j="",l="";var w="",o="",E="",x="",H="",F="",j="",D="",q="",u="";var m=tinyMCEPopup.editor,C=m.dom;var p=document.forms[0];var n=C.getParent(m.selection.getNode(),"table");action=tinyMCEPopup.getWindowArg("action");if(!action){action=n?"update":"insert"}if(n&&action!="insert"){var t=n.rows;var s=0;for(var B=0;B<t.length;B++){if(t[B].cells.length>s){s=t[B].cells.length}}s=s;r=t.length;st=C.parseStyle(C.getAttrib(n,"style"));z=trimSize(getStyle(n,"border","borderWidth"));G=C.getAttrib(n,"cellpadding","");k=C.getAttrib(n,"cellspacing","");y=trimSize(getStyle(n,"width","width"));v=trimSize(getStyle(n,"height","height"));D=convertRGBToHex(getStyle(n,"bordercolor","borderLeftColor"));j=convertRGBToHex(getStyle(n,"bgcolor","backgroundColor"));A=C.getAttrib(n,"align",A);u=C.getAttrib(n,"frame");q=C.getAttrib(n,"rules");l=tinymce.trim(C.getAttrib(n,"class").replace(/mceItem.+/g,""));w=C.getAttrib(n,"id");o=C.getAttrib(n,"summary");E=C.serializeStyle(st);x=C.getAttrib(n,"dir");H=C.getAttrib(n,"lang");F=getStyle(n,"background","backgroundImage").replace(new RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1");p.caption.checked=n.getElementsByTagName("caption").length>0;orgTableWidth=y;orgTableHeight=v;action="update";p.insert.value=m.getLang("update")}addClassesToList("class","table_styles");TinyMCE_EditableSelects.init();selectByValue(p,"align",A);selectByValue(p,"tframe",u);selectByValue(p,"rules",q);selectByValue(p,"class",l,true,true);p.cols.value=s;p.rows.value=r;p.border.value=z;p.cellpadding.value=G;p.cellspacing.value=k;p.width.value=y;p.height.value=v;p.bordercolor.value=D;p.bgcolor.value=j;p.id.value=w;p.summary.value=o;p.style.value=E;p.dir.value=x;p.lang.value=H;p.backgroundimage.value=F;updateColor("bordercolor_pick","bordercolor");updateColor("bgcolor_pick","bgcolor");if(isVisible("backgroundimagebrowser")){document.getElementById("backgroundimage").style.width="180px"}if(action=="update"){p.cols.disabled=true;p.rows.disabled=true}}function c(){var k=document.forms[0];var l=dom.parseStyle(k.style.value);var j=k.height.value;if(j!=""){l.height=getCSSSize(j)}else{l.height=""}k.style.value=dom.serializeStyle(l)}function f(j){return/^[0-9.]+(%|in|cm|mm|em|ex|pt|pc|px)$/.test(j)}function b(k,j){k=tinymce.trim(k||j);if(!f(k)){return parseInt(k,10)+"px"}return k}function h(){var j=document.forms[0];var k=dom.parseStyle(j.style.value);k["background-image"]="url('"+j.backgroundimage.value+"')";j.style.value=dom.serializeStyle(k)}function i(){var j=document.forms[0];var k=dom.parseStyle(j.style.value);if(j.border.value!=""&&(f(j.border.value)||j.bordercolor.value!="")){k["border-width"]=b(j.border.value)}else{if(!j.border.value){k.border="";k["border-width"]=""}}j.style.value=dom.serializeStyle(k)}function a(){var j=document.forms[0];var k=dom.parseStyle(j.style.value);k["background-color"]=j.bgcolor.value;if(j.bordercolor.value!=""){k["border-color"]=j.bordercolor.value;if(!k["border-width"]){k["border-width"]=b(j.border.value,1)}}j.style.value=dom.serializeStyle(k)}function d(){var j=document.forms[0];var k=dom.parseStyle(j.style.value);if(k["background-image"]){j.backgroundimage.value=k["background-image"].replace(new RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1")}else{j.backgroundimage.value=""}if(k.width){j.width.value=trimSize(k.width)}if(k.height){j.height.value=trimSize(k.height)}if(k["background-color"]){j.bgcolor.value=k["background-color"];updateColor("bgcolor_pick","bgcolor")}if(k["border-color"]){j.bordercolor.value=k["border-color"];updateColor("bordercolor_pick","bordercolor")}}})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-extensions', location = 'jscripts/tiny_mce/plugins/autoresize/editor_plugin_src.js' */
(function(a){tinymce.create("tinymce.plugins.AutoResizePlugin",{init:function(b,d){var e=this,f=0;if(b.getParam("fullscreen_is_enabled")){return}function c(){var k,j=b.getDoc(),g=j.body,m=j.documentElement,i=tinymce.DOM,l=e.autoresize_min_height,h;h=AJS.$(j).height();if(h>e.autoresize_min_height){l=h}if(e.autoresize_max_height&&h>e.autoresize_max_height){l=e.autoresize_max_height;g.style.overflowY="auto";m.style.overflowY="auto"}else{g.style.overflowY="hidden";m.style.overflowY="hidden";g.scrollTop=0}if(l!==f){k=l-f;i.setStyle(i.get(b.id+"_ifr"),"height",l+"px");f=l;if(tinymce.isWebKit&&k<0){c()}}}e.editor=b;e.autoresize_min_height=parseInt(b.getParam("autoresize_min_height",b.getElement().offsetHeight));e.autoresize_max_height=parseInt(b.getParam("autoresize_max_height",0));b.onChange.add(c);b.onSetContent.add(c);b.onPaste.add(c);b.onKeyUp.add(c);b.onPostRender.add(c);if(b.getParam("autoresize_on_init",true)){b.onLoad.add(c);b.onLoadContent.add(c)}b.addCommand("mceAutoResize",c)},getInfo:function(){return{longname:"Auto Resize",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/autoresize",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("autoresize",tinymce.plugins.AutoResizePlugin)})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-extensions', location = 'jscripts/tiny_mce/plugins/confluencepaste/editor_plugin_src.js' */
(function(d){var c=tinymce.each,a={paste_auto_cleanup_on_paste:true,paste_enable_default_filters:true,paste_block_drop:false,paste_retain_style_properties:"none",paste_strip_class_attributes:"mso",paste_remove_spans:false,paste_remove_styles:false,paste_remove_styles_if_webkit:false,paste_convert_middot_lists:true,paste_convert_headers_to_strong:false,paste_dialog_width:"450",paste_dialog_height:"400",paste_text_use_dialog:false,paste_text_sticky:false,paste_text_sticky_default:false,paste_text_notifyalways:false,paste_text_linebreaktype:"combined",paste_text_replacements:[[/\u2026/g,"..."],[/[\x93\x94\u201c\u201d]/g,'"'],[/[\x60\x91\x92\u2018\u2019]/g,"'"]]};function b(f,g){return f.getParam(g,a[g])}function e(g,f){if(g.is("ul.inline-task-list")){f.each(function(){var h=d(this);if(!h.attr("data-inline-task-id")){h.attr("data-inline-task-id","")}})}else{f.removeAttr("data-inline-task-id").removeAttr("data-pasted-task")}}tinymce.create("tinymce.plugins.ConfluencePastePlugin",{init:function(f,h){var i=this;i.editor=f;i.url=h;i.onPreProcess=new tinymce.util.Dispatcher(i);i.onPostProcess=new tinymce.util.Dispatcher(i);i.onPreProcess.add(i._preProcess);i.onPostProcess.add(i._postProcess);i.onPreProcess.add(function(l,m){f.execCallback("paste_preprocess",l,m)});i.onPostProcess.add(function(l,m){f.execCallback("paste_postprocess",l,m)});f.onKeyDown.addToTop(function(l,m){if(((tinymce.isMac?m.metaKey:m.ctrlKey)&&!m.shiftKey&&m.keyCode==86)||(m.shiftKey&&m.keyCode==45)){return false}});f.pasteAsPlainText=b(f,"paste_text_sticky_default");function k(p,m){var n=f.dom,l;i.onPreProcess.dispatch(i,p);p.node=n.create("div",0,p.content);if(tinymce.isGecko){l=f.selection.getRng(true);if(l.startContainer==l.endContainer&&l.startContainer.nodeType==3){if(p.node.childNodes.length===1&&/^(p|h[1-6]|pre)$/i.test(p.node.firstChild.nodeName)&&p.content.indexOf("__MCE_ITEM__")===-1){n.remove(p.node.firstChild,true)}}}i.onPostProcess.dispatch(i,p);p.content=f.serializer.serialize(p.node,{getInner:1,forced_root_block:""});if((!m)&&(f.pasteAsPlainText)){i._insertPlainText(p.content);if(!b(f,"paste_text_sticky")){f.pasteAsPlainText=false;f.controlManager.setActive("pastetext",false)}}else{i._insert(p.content)}tinymce.isGecko&&f.dom.getRoot().focus()}f.addCommand("mceInsertClipboardContent",function(l,m){k(m,true)});if(!b(f,"paste_text_use_dialog")){f.addCommand("mcePasteText",function(m,l){var n=tinymce.util.Cookie;f.pasteAsPlainText=!f.pasteAsPlainText;f.controlManager.setActive("pastetext",f.pasteAsPlainText);if((f.pasteAsPlainText)&&(!n.get("tinymcePasteText"))){if(b(f,"paste_text_sticky")){f.windowManager.alert(f.translate("paste.plaintext_mode_sticky"))}else{f.windowManager.alert(f.translate("paste.plaintext_mode"))}if(!b(f,"paste_text_notifyalways")){n.set("tinymcePasteText","1",new Date(new Date().getFullYear()+1,12,31))}}})}f.addButton("pastetext",{title:"paste.paste_text_desc",cmd:"mcePasteText"});f.addButton("selectall",{title:"paste.selectall_desc",cmd:"selectall"});function g(l){if(!l){return}var m=l.firstChild;if(m&&m.nodeName=="DIV"&&m.style.marginTop&&m.style.backgroundColor){f.dom.remove(m,1)}tinymce.isWebKit&&c(f.dom.select("span.Apple-style-span",l),function(n){f.dom.removeClass(n,"Apple-style-span")});tinymce.isWebKit&&c(f.dom.select("br.Apple-interchange-newline",l),function(n){f.dom.remove(n)});c(f.dom.select("br[data-mce-bogus]",l),function(n){f.dom.remove(n)});c(f.dom.select("meta[charset]",l),function(n){f.dom.remove(n)})}function j(x){var q,t,m,y,p=f.selection,s=f.dom,v=f.getBody(),l,w;f.undoManager.add();function u(B){if(!B.clipboardData||d.inArray("text/html",B.clipboardData.types||[])==-1){return false}var A=B.clipboardData.getData("text/html"),z;if(!A||!d.browser.webkit){return false}z=AJS.ClipboardHelper.repair(A);if(z==A){return false}var n=AJS.ClipboardHelper.parse(z,f.getDoc()),C=d("<div></div>");C.append(n);g(C[0]);k({content:C.html()});return true}if(u(x)){d.Event(x).preventDefault();return}if(x.clipboardData||s.doc.dataTransfer){w=(x.clipboardData||s.doc.dataTransfer).getData("Text");if(f.pasteAsPlainText){x.preventDefault();k({content:s.encode(w).replace(/\r?\n/g,"<br />")});return}}if(s.get("_mcePaste")){return}var o=v;if(v.contentEditable!="true"){o=s.getParent(f.selection.getStart(),'[contenteditable="true"]',v)}q=s.add(o,"div",{id:"_mcePaste","class":"mcePaste","data-mce-bogus":"1"},"\uFEFF\uFEFF");if(v!=f.getDoc().body){l=s.getPos(f.selection.getStart(),v).y}else{l=(function(){var n=s.getViewPort(f.getWin());return n.y+parseInt(n.h/2,10)}())}s.setStyles(q,{position:"absolute",left:tinymce.isGecko?-40:0,top:l-25,width:1,height:1,overflow:"hidden"});if(tinymce.isIE){y=p.getRng();m=s.doc.body.createTextRange();m.moveToElementText(q);m.execCommand("Paste");s.remove(q);if(q.innerHTML==="\uFEFF\uFEFF"){f.execCommand("mcePasteWord");x.preventDefault();return}p.setRng(y);p.setContent("");setTimeout(function(){k({content:q.innerHTML})},0);return tinymce.dom.Event.cancel(x)}else{function r(n){n.preventDefault()}s.bind(f.getDoc(),"mousedown",r);s.bind(f.getDoc(),"keydown",r);t=f.selection.getRng();q=q.firstChild;m=f.getDoc().createRange();m.setStart(q,0);m.setEnd(q,2);p.setRng(m);window.setTimeout(function(){var z="",n;if(!s.select("div.mcePaste > div.mcePaste").length){n=s.select("div.mcePaste");c(n,function(A){g(A);if(A.parentNode.className!="mcePaste"){z+=A.innerHTML}})}else{z="<p>"+s.encode(w).replace(/\r?\n\r?\n/g,"</p><p>").replace(/\r?\n/g,"<br />")+"</p>"}c(s.select("div.mcePaste"),function(A){s.remove(A)});if(t){p.setRng(t)}k({content:z});s.unbind(f.getDoc(),"mousedown",r);s.unbind(f.getDoc(),"keydown",r)},0)}}if(b(f,"paste_auto_cleanup_on_paste")){if(tinymce.isOpera||/Firefox\/2/.test(navigator.userAgent)){f.onKeyDown.addToTop(function(l,m){if(((tinymce.isMac?m.metaKey:m.ctrlKey)&&m.keyCode==86)||(m.shiftKey&&m.keyCode==45)){j(m)}})}else{f.onPaste.addToTop(function(l,m){return j(m)})}}f.onInit.add(function(){f.controlManager.setActive("pastetext",f.pasteAsPlainText);if(b(f,"paste_block_drop")){f.dom.bind(f.getBody(),["dragend","dragover","draggesture","dragdrop","drop","drag"],function(l){l.preventDefault();l.stopPropagation();return false})}});f.onSaveContent.add(function(l,n){var m=d("<div/>").html(n.content);d('ul.inline-task-list > li[data-pasted-task="true"]',m).each(function(){var p=d(this),o=p.attr("data-inline-task-id");if(o){var q=m.find('ul.inline-task-list > li[data-inline-task-id="'+o+'"]');if(q.size()>1){p.attr("data-inline-task-id","")}}});n.content=m.html()});i._legacySupport()},getInfo:function(){return{longname:"ConfluencePastePlugin",author:"Atlassian",authorurl:"http://www.atlassian.com",infourl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_preProcess:function(j,g){var m=this.editor,l=g.content,r=tinymce.grep,q=tinymce.explode,i=tinymce.trim,n,k;function f(h){c(h,function(o){if(o.constructor==RegExp){l=l.replace(o,"")}else{l=l.replace(o[0],o[1])}})}if(m.settings.paste_enable_default_filters==false){return}if(tinymce.isIE&&document.documentMode>=9){f([[/(?:<br>&nbsp;[\s\r\n]+|<br>)*(<\/?(h[1-6r]|p|div|address|pre|form|table|tbody|thead|tfoot|th|tr|td|li|ol|ul|caption|blockquote|center|dl|dt|dd|dir|fieldset)[^>]*>)(?:<br>&nbsp;[\s\r\n]+|<br>)*/g,"$1"]]);f([[/<br><br>/g,"<BR><BR>"],[/<br>/g," "],[/<BR><BR>/g,"<br>"]])}if(/class="?Mso|style="[^"]*\bmso-|w:WordDocument/i.test(l)||g.wordContent){g.wordContent=true;f([/^\s*(&nbsp;)+/gi,/(&nbsp;|<br[^>]*>)+\s*$/gi]);if(b(m,"paste_convert_headers_to_strong")){l=l.replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>")}if(b(m,"paste_convert_middot_lists")){f([[/<!--\[if !supportLists\]-->/gi,"$&__MCE_ITEM__"],[/(<span[^>]+(?:mso-list:|:\s*symbol)[^>]+>)/gi,"$1__MCE_ITEM__"],[/(<p[^>]+(?:MsoListParagraph)[^>]+>)/gi,"$1__MCE_ITEM__"]])}f([/<!--[\s\S]+?-->/gi,/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,[/<(\/?)s>/gi,"<$1strike>"],[/&nbsp;/gi,"\u00a0"]]);do{n=l.length;l=l.replace(/(<[a-z][^>]*\s)(?:id|name|language|type|on\w+|\w+:\w+)=(?:"[^"]*"|\w+)\s?/gi,"$1")}while(n!=l.length);if(b(m,"paste_retain_style_properties").replace(/^none$/i,"").length==0){l=l.replace(/<\/?span[^>]*>/gi,"")}else{f([[/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(o,h){return(h.length>0)?h.replace(/./," ").slice(Math.floor(h.length/2)).split("").join("\u00a0"):""}],[/(<[a-z][^>]*)\sstyle="([^"]*)"/gi,function(v,h,u){var w=[],o=0,t=q(i(u).replace(/&quot;/gi,"'"),";");c(t,function(s){var x,z,A=q(s,":");function y(B){return B+((B!=="0")&&(/\d$/.test(B)))?"px":""}if(A.length==2){x=A[0].toLowerCase();z=A[1].toLowerCase();switch(x){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-table-layout-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":w[o++]=x.replace(/^mso-|-alt$/g,"")+":"+y(z);return;case"horiz-align":w[o++]="text-align:"+z;return;case"vert-align":w[o++]="vertical-align:"+z;return;case"font-color":case"mso-foreground":w[o++]="color:"+z;return;case"mso-background":case"mso-highlight":w[o++]="background:"+z;return;case"mso-default-height":w[o++]="min-height:"+y(z);return;case"mso-default-width":w[o++]="min-width:"+y(z);return;case"mso-padding-between-alt":w[o++]="border-collapse:separate;border-spacing:"+y(z);return;case"text-line-through":if((z=="single")||(z=="double")){w[o++]="text-decoration:line-through"}return;case"mso-zero-height":if(z=="yes"){w[o++]="display:none"}return}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?!align|decor|indent|trans)|top-bar|version|vnd|word-break)/.test(x)){return}w[o++]=x+":"+A[1]}});if(o>0){return h+' style="'+w.join(";")+'"'}else{return h}}]])}}if(b(m,"paste_convert_headers_to_strong")){f([[/<h[1-6][^>]*>/gi,"<p><strong>"],[/<\/h[1-6][^>]*>/gi,"</strong></p>"]])}f([[/Version:[\d.]+\nStartHTML:\d+\nEndHTML:\d+\nStartFragment:\d+\nEndFragment:\d+/gi,""]]);k=b(m,"paste_strip_class_attributes");if(k!=="none"){function p(s,o){if(k==="all"){return""}var h=r(q(o.replace(/^(["'])(.*)\1$/,"$2")," "),function(t){return(/^(?!mso)/i.test(t))});return h.length?' class="'+h.join(" ")+'"':""}l=l.replace(/ class="([^"]+)"/gi,p);l=l.replace(/ class=([\-\w]+)/gi,p)}if(b(m,"paste_remove_spans")){l=l.replace(/<\/?span[^>]*>/gi,"")}g.content=l},_postProcess:function(i,k){var h=this,g=h.editor,j=g.dom,f;if(g.settings.paste_enable_default_filters==false){return}if(k.wordContent){c(j.select("a",k.node),function(l){if(!l.href||l.href.indexOf("#_Toc")!=-1){j.remove(l,1)}});if(b(g,"paste_convert_middot_lists")){h._convertLists(i,k)}f=b(g,"paste_retain_style_properties");if((tinymce.is(f,"string"))&&(f!=="all")&&(f!=="*")){f=tinymce.explode(f.replace(/^none$/i,""));c(j.select("*",k.node),function(o){var p={},m=0,n,q,l;if(f){for(n=0;n<f.length;n++){q=f[n];l=j.getStyle(o,q);if(l){p[q]=l;m++}}}j.setAttrib(o,"style","");if(f&&m>0){j.setStyles(o,p)}else{if(o.nodeName=="SPAN"&&!o.className){j.remove(o,true)}}})}}if(b(g,"paste_remove_styles")||(b(g,"paste_remove_styles_if_webkit")&&tinymce.isWebKit)){c(j.select("*[style]",k.node),function(l){l.removeAttribute("style");l.removeAttribute("data-mce-style")})}else{if(tinymce.isWebKit){c(j.select("*",k.node),function(l){l.removeAttribute("data-mce-style")})}}},_convertLists:function(i,g){var k=i.editor.dom,j,n,f=-1,h,p=[],m,l;c(k.select("p",g.node),function(u){var r,v="",t,s,o,q;for(r=u.firstChild;r&&r.nodeType==3;r=r.nextSibling){v+=r.nodeValue}v=u.innerHTML.replace(/<\/?\w+[^>]*>/gi,"").replace(/&nbsp;/g,"\u00a0");if(/^(__MCE_ITEM__)+[\u2022\u00b7\u00a7\u00d8o\u25CF]\s*\u00a0*/.test(v)){t="ul"}if(/^__MCE_ITEM__\s*\w+\.\s*\u00a0+/.test(v)){t="ol"}if(t){h=parseFloat(u.style.marginLeft||0);if(h>f){p.push(h)}if(!j||t!=m){j=k.create(t);k.insertAfter(j,u)}else{if(h>f){j=n.appendChild(k.create(t))}else{if(h<f){o=tinymce.inArray(p,h);q=k.getParents(j.parentNode,t);j=q[q.length-1-o]||j}}}c(k.select("span",u),function(x){var w=x.innerHTML.replace(/<\/?\w+[^>]*>/gi,"");if(t=="ul"&&/^__MCE_ITEM__[\u2022\u00b7\u00a7\u00d8o\u25CF]/.test(w)){k.remove(x)}else{if(/^__MCE_ITEM__[\s\S]*\w+\.(&nbsp;|\u00a0)*\s*/.test(w)){k.remove(x)}}});s=u.innerHTML;if(t=="ul"){s=u.innerHTML.replace(/__MCE_ITEM__/g,"").replace(/^[\u2022\u00b7\u00a7\u00d8o\u25CF]\s*(&nbsp;|\u00a0)+\s*/,"")}else{s=u.innerHTML.replace(/__MCE_ITEM__/g,"").replace(/^\s*\w+\.(&nbsp;|\u00a0)+\s*/,"")}n=j.appendChild(k.create("li",0,s));k.remove(u);f=h;m=t}else{j=f=0}});l=g.node.innerHTML;if(l.indexOf("__MCE_ITEM__")!=-1){g.node.innerHTML=l.replace(/__MCE_ITEM__/g,"")}},_insert:function(l,g){var k=this.editor,j=k.selection.getRng(true),m=this,f,i;l=m._applyOnBeforeSetContentListeners(k,l);i=AJS.ClipboardHelper.parse(l,k.getDoc());f=this._getClipboardInserter(k,j,i);if(f){f.insert(k,j,i);k.selection.onSetContent.dispatch(k.selection,{content:l,format:"html"});k.addVisual()}else{if(!k.selection.isCollapsed()&&j.startContainer!=j.endContainer){k.execCommand("mceDelete",false,null,{skip_undo:true})}k.execCommand("mceInsertContent",false,l,{skip_undo:g})}},_getClipboardInserter:function(i,h,g){var f;d.each(this.clipboardInserters,function(k,j){if(j.shouldInsert(i,h,g)){f=j;return false}});return f},clipboardInserters:[{shouldInsert:function(h,g,f){var i=function(k){var j=k.startContainer.nodeType==3?k.startContainer.parentNode:k.startContainer;return tinymce.isIE?j.nodeName=="LI"&&j.childNodes.length===0:j.nodeName=="LI"&&j.childNodes.length===1&&j.firstChild.nodeName=="BR"};return i(g)&&f.length===f.filter("ol,ul").length&&f.children("li").length>0},insert:function(i,h,g){var j=d(h.startContainer.nodeType==3?h.startContainer.parentNode:h.startContainer),f=g.children();i.undoManager.beforeChange();i.undoManager.add();e(j.parent(),f);j.replaceWith(f);i.selection.select(f.last()[0],true);i.selection.collapse();i.undoManager.add()}},{shouldInsert:function(i,h,g){var f=function(l,k){if(!k.collapsed||k.startOffset!=0){return false}var m=d(k.startContainer).closest("ol, ul",l.getBody());if(m.length===0){return false}var n=true,j=new tinymce.dom.TreeWalker(k.startContainer,m[0]).prev(n);return j===undefined||d(j).is("li")};return f(i,h)&&g.length===g.filter("ol,ul").length&&g.children("li").length>0},insert:function(i,h,g){var j=d(h.startContainer).closest("li",i.getBody()),f=g.children();i.undoManager.beforeChange();i.undoManager.add();e(j.parent(),f);j.before(f);i.selection.select(j[0],true);i.selection.collapse(true);i.undoManager.add()}},{shouldInsert:function(i,h,g){var f=function(l,k){if(!k.collapsed){return false}if(k.startContainer.nodeType==3&&k.startOffset!=k.startContainer.nodeValue.length){return false}if(k.startContainer.nodeType===1&&k.startOffset!=k.startContainer.childNodes.length){return false}var m=d(k.startContainer).closest("ol, ul",l.getBody());if(m.length===0){return false}var n=true,j=new tinymce.dom.TreeWalker(k.startContainer,m[0]).next(n);return j===undefined||d(j).is("li")};return f(i,h)&&g.length===g.filter("ol,ul").length&&g.children("li").length>0},insert:function(i,h,g){var j=d(h.startContainer).closest("li",i.getBody()),f=g.children();i.undoManager.beforeChange();i.undoManager.add();e(j.parent(),f);j.after(f);i.selection.select(f.last()[0],true);i.selection.collapse(false);i.undoManager.add()}},{shouldInsert:function(h,g,f){if(g.collapsed){return false}if(!d(g.commonAncestorContainer).is("table.confluenceTable > tbody, table.confluenceTable > tbody > tr")){return false}return f.is("table:not(.wysiwyg-macro)")},insert:function(n,l,g){var p=g.children("tbody").length>0?g.children("tbody").children("tr"):g.children("tr"),i=p.children("td, th"),q=d(".mceSelected",n.getDoc()),m=q.parent(),f,j;n.undoManager.beforeChange();n.undoManager.add();function o(r,t){for(var u=r.shift(),s=t.shift();u&&s;u=r.shift(),s=t.shift()){d(s).html(d(u).html())}}if(m.length===1){o(d.makeArray(i),d.makeArray(q))}else{f=d.makeArray(p);j=d.makeArray(m);for(var k=f.shift(),h=j.shift();k&&h;k=f.shift(),h=j.shift()){o(d.makeArray(d(k).children()),d.makeArray(d(h).children()))}}n.selection.setRng(l);n.undoManager.add()}},{shouldInsert:function(j,i,h){var g=d(i.startContainer).closest("td.confluenceTd, th.confluenceTh",".mceContent");if(g.length===0){return false}var k=g.closest("table.confluenceTable",".mceContent");if(k.length===0||k.children("tbody").length===0){return}if(!h.is("table:not(.wysiwyg-macro)")){return false}var f=false;k.find("*[colspan], *[rowspan]").each(function(l,m){if(d(m).attr("rowspan")>1||d(m).attr("colspan")>1){f=true;return false}});return !f},insert:function(n,u,h){var l=d(u.startContainer).closest("td.confluenceTd, th.confluenceTh",".mceContent"),r=l.closest("table.confluenceTable",".mceContent"),p=h.children("tbody").length>0?h.children("tbody").children("tr"):h.children("tr"),t=r.children("tbody").children("tr"),A=p.length,q=p.first().children("td, th").length,s=t.length,f=t.first().children("td, th").length,D=l.parent().index(),B=l.index();n.undoManager.beforeChange();n.undoManager.add();var o=B+q-f,g=D+A-s;o=o<0?0:o;g=g<0?0:g;t.each(function(H,J){var j=d(J),G=j.children().last();for(var I=0;I<o;I++){j.append(G.clone().html(tinymce.isIE?"":"<br/>"))}});var w=t.last(),C;for(var y=0;y<g;y++){C=d("<tr></tr>").insertAfter(w);for(var x=0;x<f+o;x++){C.append('<td class="confluenceTd">'+(tinymce.isIE?"":"<br/>")+"</td>")}w=C}var F=[];r.children("tbody").children("tr").slice(D).each(function(i,j){F.push(d.makeArray(d(j).children("th, td").slice(B)))});var z=[];p.each(function(i,j){z.push(d.makeArray(d(j).children("th, td")))});for(var E=z.shift(),k=F.shift();E&&k;E=z.shift(),k=F.shift()){for(var m=E.shift(),v=k.shift();m&&v;m=E.shift(),v=k.shift()){d(v).html(d(m).html())}}n.selection.select(l[0],1);n.selection.collapse(true);n.undoManager.add()}}],_applyOnBeforeSetContentListeners:function(h,f){var g={content:f,format:"html"};h.selection.onBeforeSetContent.dispatch(h.selection,g);return g.content},_insertPlainText:function(i){var f=this.editor,g=b(f,"paste_text_linebreaktype"),k=b(f,"paste_text_replacements"),h=tinymce.is;function j(l){c(l,function(m){if(m.constructor==RegExp){i=i.replace(m,"")}else{i=i.replace(m[0],m[1])}})}if((typeof(i)==="string")&&(i.length>0)){if(/<(?:p|br|h[1-6]|ul|ol|dl|table|t[rdh]|div|blockquote|fieldset|pre|address|center)[^>]*>/i.test(i)){j([/[\n\r]+/g])}else{j([/\r+/g])}j([[/<\/(?:p|h[1-6]|ul|ol|dl|table|div|blockquote|fieldset|pre|address|center)>/gi,"\n\n"],[/<br[^>]*>|<\/tr>/gi,"\n"],[/<\/t[dh]>\s*<t[dh][^>]*>/gi,"\t"],/<[a-z!\/?][^>]*>/gi,[/&nbsp;/gi," "],[/(?:(?!\n)\s)*(\n+)(?:(?!\n)\s)*/gi,"$1"],[/\n{3,}/g,"\n\n"]]);i=f.dom.decode(tinymce.html.Entities.encodeRaw(i));if(h(k,"array")){j(k)}else{if(h(k,"string")){j(new RegExp(k,"gi"))}}if(g=="none"){j([[/\n+/g," "]])}else{if(g=="br"){j([[/\n/g,"<br />"]])}else{if(g=="p"){j([[/\n+/g,"</p><p>"],[/^(.*<\/p>)(<p>)$/,"<p>$1"]])}else{j([[/\n\n/g,"</p><p>"],[/^(.*<\/p>)(<p>)$/,"<p>$1"],[/\n/g,"<br />"]])}}}f.execCommand("mceInsertContent",false,i)}},_legacySupport:function(){var g=this,f=g.editor;f.addCommand("mcePasteWord",function(){f.windowManager.open({file:g.url+"/pasteword.htm",width:parseInt(b(f,"paste_dialog_width")),height:parseInt(b(f,"paste_dialog_height")),inline:1})});if(b(f,"paste_text_use_dialog")){f.addCommand("mcePasteText",function(){f.windowManager.open({file:g.url+"/pastetext.htm",width:parseInt(b(f,"paste_dialog_width")),height:parseInt(b(f,"paste_dialog_height")),inline:1})})}f.addButton("pasteword",{title:"paste.paste_word_desc",cmd:"mcePasteWord"})}});tinymce.PluginManager.add("confluencepaste",tinymce.plugins.ConfluencePastePlugin)})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-extensions', location = 'jscripts/tiny_mce/plugins/confcharmap/editor_plugin_src.js' */
(function(a){tinymce.create("tinymce.plugins.ConfCharmapPlugin",{init:function(b,c){b.addCommand("confCharmap",function(){b.windowManager.open({id:"insert-char-dialog",url:tinyMCE.settings.editor_plugin_action_base_path+"/charmap.action",width:600+parseInt(b.getLang("advanced.charmap_delta_width",0)),height:290+parseInt(b.getLang("advanced.charmap_delta_height",0)),inline:true,name:"advanced.charmap_desc"})})},getInfo:function(){return{longname:"Confluence Charmap Plugin",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("confcharmap",tinymce.plugins.ConfCharmapPlugin)})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.plugins.tinymce:atlassian-rte-javascript-tinymce-extensions', location = 'jscripts/tiny_mce/plugins/confluencelist/editor_plugin_src.js' */
(function(a){tinymce.create("tinymce.plugins.ConfluenceListPlugin",{init:function(b,c){!tinymce.isIE8&&b.onKeyDown.add(function(k,l){if(l.keyCode!=8){return}var j=k.selection.getRng(true),i=a(j.startContainer).closest("li",k.getBody());if(i.length===0){return}if(!AJS.EditorUtils.isCursorAtStartOf(i[0],j)){return}var g=i.prev("li"),f,m=i[0],h;if(g.length>0){f=g[0];h=a(m.firstChild);if(tinymce.isIE9&&h.length===0){h=a("<br/>").appendTo(i)}else{if(h.is("p")){h=h.contents().first()}}function d(e){if(!e||!e.lastChild){return}if(!k.dom.isBlock(e.lastChild)&&!a(e.lastChild).is("br")){a(e).append("<br/>")}}k.undoManager.beforeChange();k.undoManager.add();if(a(f.lastChild).is("p")&&!k.dom.isBlock(m.firstChild)){d(f.lastChild);i.contents().each(function(e,n){if(k.dom.isBlock(n)){return false}a(f.lastChild).append(a(n).detach())})}else{if(a(m.firstChild).is("p")&&!k.dom.isBlock(f.lastChild)){d(f);a.each(a.makeArray(g.contents()).reverse(),function(e,n){if(k.dom.isBlock(n)){return false}a(m.firstChild).prepend(a(n).detach())})}else{d(f)}}g.append(i.detach().contents());if(h[0]){AJS.EditorUtils.setCursorAtStartOfContents(h[0])}k.undoManager.add();return tinymce.dom.Event.cancel(l)}})},getInfo:function(){return{longname:"Confluence List Plugin",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("confluencelist",tinymce.plugins.ConfluenceListPlugin)})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/flextofullsize/editor_plugin_src.js' */
(function(e){var h,k,b,d,l,c,f,i,a,g=5;var j=function(o){var m=e("#wysiwyg").is(":hidden")?e("#preview"):e("#wysiwyg");d=m.find("iframe"),$headerPrecursor=e("#header-precursor");var p=e(window).height();var n=$headerPrecursor.offset().top+$headerPrecursor.height()+e("#header").height();e("#content.edit").height(p-n);setTimeout(function(){if(e("#preview").is(":hidden")){d.height(0).height(m.height())}else{e("#content.edit").height("auto");var r=e("#savebar-container").height();n+=e("#editor-precursor").height()+e("#conflict-wrapper").height();var q=4;d.height(p-n-r-q)}},1)};tinymce.create("tinymce.plugins.flextofullsizeplugin",{init:function(m,n){m.onInit.add(function(q,o){var r,p;if(tinymce.isIE||tinymce.isOpera){r=m.getWin();b=e(r.parent);p=e(r.parent.document);e("body").css({overflow:"hidden"});b.bind("resize.resizeplugin",function(){j()});p.bind("messageClose",function(s){setTimeout(j,0)});p.bind("resize.resizeplugin",function(t,s){j(s&&s.height)});p.bind("mode-changed",function(t,s){j()});m.onChange.add(function(){j()});m.onInit.add(function(){j()})}})},getInfo:function(){return{longname:"flex editor to full size plugin",description:"adjusts height of editor so it always occupies the right space in between the toolbars",author:"Atlassian",authorurl:"http://www.atlassian.com",version:"1.0"}}});tinymce.PluginManager.add("flextofullsize",tinymce.plugins.flextofullsizeplugin)})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/atlassian/tinyMce-translations.i18n.js' */
TinyMCELang={popup_blocked:"\u6D4F\u89C8\u5668\u963B\u6B62\u4E86\u7F16\u8F91\u5668\u6253\u5F00\u7684\u5F39\u51FA\u6846\u3002",ctrl_key:"Ctrl",shift_key:"Shift",searchreplace:{search_desc:"\u67E5\u627E",replace_desc:"\u67E5\u627E\/\u66FF\u6362"},searchreplace_dlg:{allreplacedplural:"\u5B8C\u6210{0}\u6B21\u66FF\u6362",allreplacedsingular:"\u5B8C\u62101\u6B21\u66FF\u6362",notfound:"\u672A\u53D1\u751F\u66FF\u6362",findlabel:"\u67E5\u627E",replacelabel:"\u66FF\u6362\u4E3A",findnext:"\u4E0B\u4E00\u4E2A",findprevious:"\u4E0A\u4E00\u4E2A",replace:"\u66FF\u6362",replaceall:"\u5168\u90E8\u66FF\u6362",close:"Close"},advhr:{advhr_desc:"tinymce.advhr.advhr_desc"},emotions:{emotions_desc:"\u8868\u60C5\u7B26\u53F7"},emotions_dlg:{title:"\u63D2\u5165\u8868\u60C5\u7B26\u53F7",desc:"\u8868\u60C5\u7B26\u53F7",smile:"\u5FAE\u7B11 :)",sad:"\u60B2\u4F24 :(",tongue:"\u5410\u820C :p",biggrin:"\u5927\u7B11 :D",wink:"\u7728\u773C ;)",thumbs_up:"\u8D5E\u540C (y)",thumbs_down:"\u5426\u5B9A (n)",information:"\u4FE1\u606F (i)",check:"\u6253\u52FE (\/)",error:"\u9519\u8BEF (x)",warning:"\u8B66\u544A (!)",add:"\u52A0 (+)",forbidden:"\u51CF (-)",help_16:"\u95EE\u53F7 (?)",lightbulb_on:"\u706F\u4EAE (on)",lightbulb:"\u706F\u706D (off)",star_yellow:"\u9EC4\u661F (*y)",star_red:"\u7EA2\u661F (*r)",star_green:"\u7EFF\u661F (*g)",star_blue:"\u84DD\u661F (*b)",heart:"Heart \u003c3",broken_heart:"Broken heart \u003c\/3"},confluence:{conf_macro_browser:"\u5B8F",conf_macro_browser_desc:"\u63D2\u5165\u5B8F",conf_image:"\u56FE\u7247",confimage_desc:"\u63D2\u5165\u56FE\u7247",conf_link:"\u94FE\u63A5",conflink_desc:"\u63D2\u5165\u94FE\u63A5",conf_table:"\u8868\u683C",conf_attachment:"\u9644\u4EF6",conf_wikimarkup:"Wiki\u6807\u8BB0",conf_wikimarkup_desc:"\u63D2\u5165Wiki\u6807\u8BB0",conf_wikimarkup_errors:"Wiki\u6807\u8BB0\u8F6C\u6362\u9519\u8BEF",conf_wikimarkup_timeout:"\u670D\u52A1\u5668\u5904\u7406wiki\u6807\u8BB0\u65F6\u95F4\u8FC7\u957F\uFF0C\u4E5F\u8BB8\u662F\u5076\u53D1\u95EE\u9898\uFF0C\u53EF\u4EE5\u7A0D\u540E\u518D\u8BD5\u3002",conf_wikimarkup_hint:"\u63D0\u793A: \u53EF\u4EE5\u5728\u7F16\u8F91\u5668\u4E2D\u76F4\u63A5\u8F93\u5165wiki\u6807\u8BB0\uFF0C\u7CFB\u7EDF\u4F1A\u8FDB\u884C\u683C\u5F0F\u5904\u7406\u3002",conf_wikimarkup_markdown_label:"Markdown",conf_wikimarkup_confluence_label:"Confluence wiki",conf_shortcuts_help_desc:"\u952E\u76D8\u5FEB\u6377\u952E\u5E2E\u52A9",conf_insert_button_title:"\u63D2\u5165"},table:{desc:"\u63D2\u5165\u8868\u683C",row_before_desc:"\u6B64\u524D\u63D2\u5165\u884C",row_after_desc:"\u6B64\u540E\u63D2\u5165\u884C",delete_row_desc:"\u5220\u9664\u884C",col_before_desc:"\u6B64\u524D\u63D2\u5165\u5217",col_after_desc:"\u6B64\u540E\u63D2\u5165\u5217",delete_col_desc:"\u5220\u9664\u5217",split_cells_desc:"\u5206\u5272\u5408\u5E76\u7684\u5355\u5143\u683C",merge_cells_desc:"\u5408\u5E76\u5355\u5143\u683C",row_desc:"tinymce.table.row_desc",cell_desc:"tinymce.table.cell_desc",props_desc:"tinymce.table.props_desc",paste_row_before_desc:"\u7C98\u8D34\u884C",paste_row_after_desc:"\u6B64\u540E\u7C98\u8D34\u884C",cut_row_desc:"\u526A\u5207\u884C",copy_row_desc:"\u590D\u5236\u884C",del:"\u5220\u9664\u8868\u683C",row:"\u884C",col:"\u5217",cell:"\u5355\u5143\u683C",row_highlight:"\u884C\u9AD8\u4EAE",col_highlight:"\u5217\u9AD8\u4EAE",selection_highlight:"Change cell colour",invalid_table_field:"\u884C\u6570\u3001\u5217\u6570\u5FC5\u987B\u5927\u4E8E0\u3002",cut_row_desc_shortcut:"Ctrl+Shift+X",copy_row_desc_shortcut:"Ctrl+Shift+C",paste_row_before_desc_shortcut:"Ctrl+Shift+V",row_before_desc_shortcut:"Alt+\u2191",row_after_desc_shortcut:"Alt+\u2193"},advanced:{style_select:"tinymce.advanced.style_select",font_size:"tinymce.advanced.font_size",fontdefault:"tinymce.advanced.fontdefault",block:"\u683C\u5F0F",paragraph:"\u6B63\u6587",pre:"\u9884\u683C\u5F0F\u5316",h1:"\u6807\u9898 1",h2:"\u6807\u9898 2",h3:"\u6807\u9898 3",h4:"\u6807\u9898 4",h5:"\u6807\u9898 5",h6:"\u6807\u9898 6",blockquote:"\u5F15\u7528",code:"tinymce.advanced.code",samp:"tinymce.advanced.samp",dt:"tinymce.advanced.dt",dd:"tinymce.advanced.dd",bold_desc:"\u7C97\u4F53",italic_desc:"\u659C\u4F53",underline_desc:"\u4E0B\u5212\u7EBF",striketrough_desc:"\u5220\u9664\u7EBF",justifyleft_desc:"\u5DE6\u5BF9\u9F50",justifycenter_desc:"\u5C45\u4E2D",justifyright_desc:"\u53F3\u5BF9\u9F50",justifyfull_desc:"\u5145\u6EE1",bullist_desc:"\u65E0\u5E8F\u5217\u8868",numlist_desc:"\u6709\u5E8F\u5217\u8868",tasklist_desc:"Task list",outdent_desc:"\u51CF\u5C0F\u7F29\u8FDB",indent_desc:"\u589E\u5927\u7F29\u8FDB",undo_desc:"\u56DE\u9000",redo_desc:"\u91CD\u505A",link_desc:"tinymce.advanced.link_desc",unlink_desc:"\u53D6\u6D88\u94FE\u63A5",image_desc:"tinymce.advanced.image_desc",cleanup_desc:"tinymce.advanced.cleanup_desc",code_desc:"tinymce.advanced.code_desc",sub_desc:"\u4E0B\u6807",sup_desc:"\u4E0A\u6807",hr_desc:"\u6C34\u5E73\u7EBF",removeformat_desc:"tinymce.advanced.removeformat_desc",custom1_desc:"tinymce.advanced.custom1_desc",forecolor_desc:"\u9009\u62E9\u6587\u672C\u989C\u8272",backcolor_desc:"tinymce.advanced.backcolor_desc",charmap_desc:"\u7B26\u53F7",visualaid_desc:"tinymce.advanced.visualaid_desc",anchor_desc:"tinymce.advanced.anchor_desc",cut_desc:"tinymce.advanced.cut_desc",copy_desc:"tinymce.advanced.copy_desc",paste_desc:"tinymce.advanced.paste_desc",image_props_desc:"tinymce.advanced.image_props_desc",newdocument_desc:"tinymce.advanced.newdocument_desc",help_desc:"\u5E2E\u52A9",blockquote_desc:"tinymce.advanced.blockquote_desc",path:"tinymce.advanced.path",newdocument:"tinymce.advanced.newdocument",toolbar_focus:"tinymce.advanced.toolbar_focus",more_colors:"tinymce.advanced.more_colors",paragraph_shortcut:"Ctrl+0",pre_shortcut:"Ctrl+7",h1_shortcut:"Ctrl+1",h2_shortcut:"Ctrl+2",h3_shortcut:"Ctrl+3",h4_shortcut:"Ctrl+4",h5_shortcut:"Ctrl+5",h6_shortcut:"Ctrl+6",blockquote_shortcut:"Ctrl+8",bullist_shortcut:"Ctrl+Shift+B",numlist_shortcut:"Ctrl+Shift+N",tasklist_shortcut:"[ then ]",undo_shortcut:"Ctrl+Z",redo_shortcut:"Ctrl+Y"},colorpicker:{more_colors:"\u66F4\u591A\u989C\u8272",title:"\u9009\u62E9\u989C\u8272",picker_tab:"\u9009\u62E9\u5668",picker_title:"\u989C\u8272\u9009\u53D6\u5668",palette_title:"tinymce.colorpicker.palette_title",named_tab:"tinymce.colorpicker.named_tab",named_title:"tinymce.colorpicker.named_title",color:"\u989C\u8272",name:"tinymce.colorpicker.name",apply:"tinymce.colorpicker.apply"},hints:{drafts:"\u63D0\u793A: Confluence\u4F1A\u81EA\u52A8\u4FDD\u5B58\u8349\u7A3F\uFF0C\u5982\u679C\u9000\u51FA\u4E86\u7A97\u4F53\uFF0C\u53EF\u4EE5\u9009\u62E9\"\u7528\u6237\u540D -> \u8349\u7A3F\" \u83DC\u5355\u6062\u590D\u5DE5\u4F5C\u3002",dnd:"\u63D0\u793A: \u53EF\u4EE5\u5C06\u56FE\u7247\u548COffice\u6587\u4EF6\u76F4\u63A5\u62D6\u653E\u5230\u7F16\u8F91\u5668\u4E2D\u3002",insert_link_recently_viewed:"\u63D0\u793A: \u8F93\u5165 \"\u003cstrong>[\u003c\/strong>\" \u67E5\u770B\u5EFA\u8BAE\u9875\u9762\u5217\u8868\u5E76\u63D2\u5165\u94FE\u63A5\u3002",insert_link_search:"\u63D0\u793A: \u8F93\u5165 \"\u003cstrong>[\u003c\/strong>\" \u53CA\u90E8\u5206\u9875\u9762\u6807\u9898\u8FDB\u884C\u67E5\u627E\u5E76\u94FE\u63A5\u5230\u9875\u9762\u3002",insert_link_end:"\u63D0\u793A: \u5728\u4E00\u4E2A\u8BCD\u540E\u6309\u4E0B \u003cstrong>Ctrl+Shift+K\u003c\/strong> \u67E5\u627E\u5E76\u94FE\u63A5\u5230\u76F8\u5173\u9875\u9762\uFF0C\u518D\u6B21\u6309\u4E0B\u7EC4\u5408\u952E\u4F1A\u83B7\u5F97\u66F4\u591A\u5EFA\u8BAE\u3002",insert_link_newpage:"\u63D0\u793A: \u8F93\u5165 \"\u003cstrong>[\u003c\/strong>\" \u548C\u5E0C\u671B\u521B\u5EFA\u7684\u9875\u9762\u6807\u9898\uFF0C\u5C06\u4F1A\u770B\u5230\u63D2\u5165\u94FE\u63A5\u7684\u5EFA\u8BAE\u3002",insert_link_user_mention:"\u63D0\u793A: \u5728Confluence\u4E2D\u63D0\u53CA\u67D0\u4EBA\u65F6\uFF0C\u8F93\u5165 \"\u003cstrong>@\u003c\/strong>\"\u7136\u540E\u662F\u540D\u5B57\u5373\u53EF\u3002",insert_image_on_page:"\u63D0\u793A: \u8F93\u5165 \"\u003cstrong>!\u003c\/strong>\" \u67E5\u770B\u9875\u9762\u9644\u4EF6\u5E76\u9009\u62E9\u4E00\u4E2A\u63D2\u5165\u3002",insert_image_search:"\u63D0\u793A: \u8F93\u5165 \"\u003cstrong>!\u003c\/strong>\" \u53CA\u90E8\u5206\u56FE\u7247\u540D\u79F0\u8FDB\u884C\u67E5\u627E\u5E76\u63D2\u5165\u56FE\u7247\u3002",insert_image_end:"\u63D0\u793A: \u5728\u4E00\u4E2A\u8BCD\u540E\u6309\u4E0B \u003cstrong>Ctrl+Shift+M\u003c\/strong> \u67E5\u627E\u5E76\u63D2\u5165\u76F8\u5173\u56FE\u7247\u3002",insert_wikimarkup:"\u63D0\u793A: \u7F16\u8F91\u5668\u5C06\u6839\u636E\u8F93\u5165\u81EA\u52A8\u8F6C\u6362wiki\u6807\u8BB0\u3002",insert_wikimarkup_dialog:"\u63D0\u793A: \u6309\u4E0B \u003cstrong>Ctrl+Shift+D\u003c\/strong>\u6253\u5F00Wiki\u6807\u8BB0\u5BF9\u8BDD\u6846\u3002",insert_link:"\u63D0\u793A: \u6309\u4E0B \u003cstrong>Ctrl+K\u003c\/strong> \u6253\u5F00\u94FE\u63A5\u6D4F\u89C8\u5668\u3002",insert_image:"\u63D0\u793A: \u6309\u4E0B \u003cstrong>Ctrl+M\u003c\/strong> \u6253\u5F00\u56FE\u7247\u6D4F\u89C8\u5668\u3002",insert_macro:"\u63D0\u793A: \u6309\u4E0B \u003cstrong>Ctrl+Shift+A\u003c\/strong> \u6253\u5F00\u5B8F\u6D4F\u89C8\u5668\u3002",insert_macro_toc:"\u63D0\u793A: \u8BA9Confluence\u4E3A\u672C\u9875\u4EA7\u751F\u8868\u683C\u5185\u5BB9\uFF0C \u4F7F\u7528\"\u63D2\u5165 -> \u8868\u683C\u5185\u5BB9\"",insert_bullet_list:"\u63D0\u793A: \u6309\u4E0B \u003cstrong>Ctrl+Shift+B\u003c\/strong> \u5F15\u5165\u9879\u76EE\u7B26\u53F7\u5217\u8868\u3002",insert_numbered_list:"\u63D0\u793A: \u6309\u4E0B \u003cstrong>Ctrl+Shift+N\u003c\/strong> \u5F15\u5165\u6570\u5B57\u5217\u8868\u3002",insert_heading:"\u63D0\u793A: \u6309\u4E0B \u003cstrong>Ctrl+1\u003c\/strong> \u5F15\u5165\u4E00\u7EA7\u6807\u9898, \u6309\u4E0B\u003cstrong>Ctrl+2\u003c\/strong> \u5F15\u5165\u4E8C\u7EA7\u6807\u9898\uFF0C\u4EE5\u6B64\u7C7B\u63A8\u3002",insert_table:"\u63D0\u793A: \u6309\u4E0B \u003cstrong>Ctrl+Shift+I\u003c\/strong> \u63D2\u5165\u5230\u8868\u4E2D\u3002",table_rows_copy:"\u63D0\u793A: \u6309\u4E0B \u003cstrong>Ctrl+Shift+C\u003c\/strong> \u590D\u5236\u4E00\u884C\uFF0C\u518D\u6309 \u003cstrong>Ctrl+Shift+V\u003c\/strong> \u5C06\u590D\u5236\u5185\u5BB9\u7C98\u8D34\u5230\u8868\u4E2D\u3002",table_rows_cut:"\u63D0\u793A: \u6309\u4E0B \u003cstrong>Ctrl+Shift+X\u003c\/strong> \u526A\u5207\u4E00\u884C\uFF0C\u518D\u6309 \u003cstrong>Ctrl+Shift+V\u003c\/strong> \u5C06\u526A\u5207\u5185\u5BB9\u7C98\u8D34\u5230\u8868\u4E2D\u3002",insert_newline:"\u63D0\u793A: \u8F93\u5165 \u003cstrong>Shift+Enter\u003c\/strong> \u63D2\u5165\u65E0\u7F29\u8FDB\u7684\u65B0\u6BB5\u843D\u3002",autoformat_heading1:"\u63D0\u793A: \u8F93\u5165 \"\u003cstrong>h1. \u6807\u9898\u003c\/strong>\" \u5FEB\u901F\u63D2\u5165\u6807\u98981\u7C7B\u578B\u7684\u6587\u672C\u3002",autoformat_heading3:"\u63D0\u793A: \u8F93\u5165 \"\u003cstrong>h3. \u6807\u9898\u003c\/strong>\" \u5FEB\u901F\u63D2\u5165\u6807\u98981\u7C7B\u578B\u7684\u6587\u672C\u3002",autoformat_code:"\u63D0\u793A: \u8F93\u5165 \"\u003cstrong>{{code}}\u003c\/strong>\" \u5FEB\u901F\u63D2\u5165\u7B49\u5BBD\u6587\u672C\u3002"},auiwindowmanager:{cancel:"\u53D6\u6D88",ok:"\u786E\u8BA4"},propertypanel:{links_goto:"\u8F6C\u5411\u94FE\u63A5",links_edit:"\u7F16\u8F91",links_unlink:"\u53D6\u6D88\u94FE\u63A5",links_goto_disabled_tooltip:"This link goes to content on the page you are editing",links_edit_tooltip:"\u5728\u5BF9\u8BDD\u6846\u4E2D\u7F16\u8F91\u94FE\u63A5",links_unlink_tooltip:"\u7528\u94FE\u63A5\u5185\u5BB9\u66FF\u6362\u94FE\u63A5",images_small:"\u5C0F",images_medium:"\u4E2D",images_large:"\u5927",images_original:"\u539F\u59CB\u5927\u5C0F",images_border:"\u8FB9\u6846",images_link_create:"\u94FE\u63A5",images_link_edit:"\u7F16\u8F91\u94FE\u63A5",images_link_remove:"\u53D6\u6D88\u94FE\u63A5",images_link_create_tooltip:"\u56FE\u7247\u94FE\u63A5\u81F3\u5176\u4ED6\u5185\u5BB9\u3002",images_link_edit_tooltip:"\u7F16\u8F91\u56FE\u7247\u94FE\u63A5",images_link_remove_tooltip:"\u5220\u9664\u56FE\u7247\u94FE\u63A5",images_sizing_tooltip:"\u8C03\u6574\u56FE\u7247\u81F3\u7279\u5B9A\u5BBD\u5EA6",images_small_tooltip:"\u7F29\u5C0F\u56FE\u7247\u5E76\u94FE\u63A5\u5230\u539F\u59CB\u56FE\u7247",images_medium_tooltip:"\u8C03\u6574\u56FE\u7247\u5927\u5C0F\u5E76\u94FE\u63A5\u5230\u539F\u59CB\u56FE\u7247",images_large_tooltip:"\u8C03\u6574\u56FE\u7247\u81F3\u5927\u56FE\u5E76\u94FE\u63A5\u5230\u6E90\u6587\u4EF6",images_original_tooltip:"\u6062\u590D\u56FE\u7247\u539F\u59CB\u5927\u5C0F",images_thumbnail_tooltip:"tinymce.propertypanel.images.thumbnail.tooltip",images_border_tooltip:"\u5728\u56FE\u7247\u5468\u56F4\u52A0\u8FB9\u6846"}};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'com/atlassian/confluence/tinymceplugin/tinymce-confluence.js' */
tinymce.confluence=tinymce.confluence||{};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'com/atlassian/confluence/tinymceplugin/tinymce-breadcrumbs.js' */
(function(a){AJS.bind("init.rte",function(){if(AJS.Meta.get("content-type")!=="comment"){var d=a("#quickedit-breadcrumbs");if(d.length>0){a("#breadcrumbs").detach();d.attr("id","breadcrumbs");a("#breadcrumb-section").append(d)}var e=a(".edited-page-title").parent().detach();function b(){var f=a("#breadcrumbs");f.detach();if(!f.find(".edited-page-title").length&&e.length){f.append(e)}a("#editor-precursor .cell").prepend(f)}function c(){var f=a("#breadcrumbs").detach();e.detach();a("#breadcrumb-section").append(f)}b();a(document).bind("mode-changed",function(f,g){if(g==="preview"){c()}else{if(g==="richtext"){b()}}})}})})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'com/atlassian/confluence/tinymceplugin/tinymce-node-utils.js' */
(function(b){var a;tinymce.confluence.NodeUtils=a={updateNode:function(f,d){var c=tinymce.activeEditor,e=b(f,c.getDoc());var g=a.prepareNodeForUpdate(e);return a.replaceNode(e,d).fail(g).promise()},storeNodeState:function(e,f){var d={},c;for(var g=0,h=f.length;g<h;g++){c=f[g];d[c]=e.attr(c)}return function(){for(var i in d){e.attr(i,d[i])}}},prepareNodeForUpdate:function(c){var d=null;if(c.is("img")){d=a.storeNodeState(c,["width","height","src","class"]);c.addClass("image-hotswap").attr({src:Confluence.getContextPath()+"/images/border/spacer.gif",width:c.attr("width"),height:c.attr("height")})}return d},replaceNode:function(h,e){var c=tinymce.activeEditor,g=a.getDoc(),d=b(e,g),f=b(h,g);return b.Deferred(function(){var i=this;if(d.is("img")){d[0].onload=function(){AJS.debug("replaceNode: new node's src has been loaded by the browser.");this.onload=null;i.resolve(this)};if(b.browser.opera){d[0].src=d.attr("src")}g.createDocumentFragment().appendChild(d[0])}else{i.resolve(d[0])}}).done(function(i){f.replaceWith(i)}).promise()},replaceSelection:function(f){var e=tinymce.activeEditor,d=e.selection.getRng(true),h,g,c;if(b.browser.msie&&~~b.browser.version<9){c=d}else{c=e.getDoc().createRange()}h=b(f).clone(true,false)[0];d.deleteContents();if(d.startContainer.nodeType==3&&d.startContainer.nodeValue===""){d.startContainer.nodeValue=AJS.Rte.HIDDEN_CHAR}d.insertNode(h);if(b.browser.msie&&~~b.browser.version<9){g=h}else{var i=e.getDoc().createTextNode(AJS.Rte.HIDDEN_CHAR);e.dom.insertAfter(i,h);g=i}c.setStartBefore(g);c.setEndAfter(g);c.collapse(false);e.selection.setRng(c);return h},normalize:function(h){var f=tinymce.activeEditor,e=f.selection.getRng(true),g,c=[],d,j;if(!h||!h.childNodes){return}function i(l){var m=[],k=0;b.each(l.childNodes,function(n,q){var p={},o=(m[n-1]||{});p.isTextNode=(q.nodeType==3);p.textNodesBefore=((p.isTextNode&&o.isTextNode)?1:0)+~~o.textNodesBefore;p.precedingTextLength=k;k=(p.isTextNode)?k+q.nodeValue.length:0;m.push(p)});return m}if(tinymce.isWebKit){g=e}else{if(tinymce.isGecko){g=e.cloneRange();d={startIndex:b.inArray(e.startContainer,h.childNodes),startOffset:g.startOffset,endIndex:b.inArray(e.endContainer,h.childNodes),endOffset:g.endOffset};if(d.startIndex>-1||d.endIndex>-1){c=i(h)}}}h.normalize();if(tinymce.isGecko){if(j=c[d.startIndex]){d.newStartIndex=d.startIndex-j.textNodesBefore;d.newStartOffset=d.startOffset+j.precedingTextLength;g.setStart(h.childNodes[d.newStartIndex],d.newStartOffset)}if(j=c[d.endIndex]){d.newEndIndex=d.endIndex-j.textNodesBefore;d.newEndOffset=d.endOffset+j.precedingTextLength;g.setEnd(h.childNodes[d.newEndIndex],d.newEndOffset)}}g&&f.selection.setRng(g)},getDoc:function(){var c=tinymce.activeEditor;return(b.browser.mozilla||b.browser.opera)?document:c.getDoc()},isolateSelectedRange:function(){var i=tinymce.activeEditor,m=a.getDoc(),n=i.selection,c=n.getRng(true);var e=c.startContainer,j=c.startOffset,g=c.endContainer,l=c.endOffset,p;var h,d;if(c.collapsed){return c}function f(q,t,v,x){var u=null,s=null,w,r,y;x=(x)?true:false;w=(x)?"nextSibling":"previousSibling";r=(t===0);if(!r&&x){if(q.nodeType===3){r=(t===q.length)}else{r=(t===q.childNodes.length)}}if(r){u=q[w];s=q;while(u===null){if(s===v){return}else{if(s.parentNode===v){break}}s=s.parentNode;u=s[w]}}else{if(q.nodeType===3){y=q.data;q.data=y.slice(t);u=m.createTextNode(y.slice(0,t));s=q;b(u).insertBefore(s);if(x){y=s;s=u;u=y}}else{s=q.childNodes[t-(x?1:0)];u=s[w]}}return[s,u]}function o(x,q,r,u){var s,w,v,t;u=(u)?true:false;while(true){if(q===r||q.parentNode===r){break}w=q.parentNode;s=w.cloneNode(false);if(u){b(s).insertAfter(w);v=x;while(v){t=v.nextSibling;s.appendChild(v);v=t}}else{b(s).insertBefore(w);v=w.firstChild;while(v!==q){t=v.nextSibling;s.appendChild(v);v=t}}x=s;q=w}return q}function k(v,u,t){var s,r,q;s=i.dom.getParent(v,i.dom.isBlock);if(!s){s=i.getBody()}r=f(v,u,s,t);if(!r){q=undefined}else{if(!r[1]){q=r[0]}else{q=o(r[1],r[0],s,t)}}return q}if(e===g){p=l-j}h=k(e,j);h&&c.setStartBefore(h);if(e!==c.startContainer){l=p||l}d=k(g,l,true);d&&c.setEndAfter(d);n.setRng(c);return c}}}(AJS.$));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'com/atlassian/confluence/tinymceplugin/wiki-autoformat.js' */
AJS.bind("init.rte",function(e,w){AJS.Rte.autoformat={_REGEXES:{WIKI_MACRO:/(?:\s|^)(\{[^{^}]+)$/,WIKI_LINK:/(?:\s|^)(\[[^\[^\]]+)$/,WIKI_EMBED:/(?:\s|^)(![^!]{5,})$/},_REGEXES_EMOTICON:{SMILE:/\B(:-?)$/,SAD:/\B(:-?)$/,CHEEKY:/\B(:-?)$/,CHEEKY_2:/\B(:-?)$/,LAUGH:/\B(:-?)$/,WINK:/\B(;-?)$/,THUMBS_UP:/\B(\(y)$/,THUMBS_DOWN:/\B(\(n)$/,INFORMATION:/\B(\(i)$/,TICK:/\B(\(\/)$/,CROSS:/\B(\(x)$/,WARNING:/\B(\(!)$/,PLUS:/\B(\(\+)$/,MINUS:/\B(\(-)$/,QUESTION:/\B(\(\?)$/,LIGHT_ON:/\B(\(on)$/,LIGHT_OFF:/\B(\(off)$/,YELLOW_STAR:/\B(\(\*)$/,YELLOW_STAR_2:/\B(\(\*y)$/,RED_STAR:/\B(\(\*r)$/,GREEN_STAR:/\B(\(\*g)$/,BLUE_STAR:/\B(\(\*b)$/,HEART:/\B(<)$/,BROKEN_HEAR:/\B(<\/)$/}};var p;if(AJS.Meta.get("remote-user")&&AJS.Meta.get("confluence.prefs.editor.disable.autoformat")){return}function q(i){return AJS.$("<div>").append(i.cloneNode(true)).html()}function j(i,y,z){var D,B;if(!y){throw new Error("text node is null")}if(y.nodeType!=3){y=y.childNodes[z-1];z=y.length}for(var C=y,A=z;C&&C.nodeType==3;C=C.previousSibling){if(A==-1){A=C.nodeValue.length}if(A>i){return{container:C,offset:A-i}}else{if(A==i){B=0;D=C.parentNode;while(C=C.previousSibling){B++}return{container:D,offset:B}}else{i-=A;A=-1}}}return null}function o(y){var z,A;if(!y||!y.collapsed){throw new Error("range is null or not collapsed")}z=y.startContainer;A=y.startOffset;if(z.nodeType==1&&A>0){z=z.childNodes[y.startOffset-1];if(z.nodeType==3){A=z.nodeValue.length}else{return""}}else{if(z.nodeType!=3){return""}}var i=z.nodeValue.substring(0,A);for(var B=z.previousSibling;B&&B.nodeType==3;B=B.previousSibling){i=B.nodeValue+i}return i}function n(z,A,y,i){return{handles:function(D){var B=false,C=D.selection.getRng(true),E=C.commonAncestorContainer||{};if(!C.collapsed){return false}if(AJS.$(E).closest("pre,.text-placeholder").length){return false}if(i&&AJS.$(E).closest(i).length){return false}B=z.test(o(C));return B},execute:function(G,C,K){var D,B,F,H=1,E,I,J=d(C);if(J==32){G.execCommand("mceInsertContent",false,"&nbsp;")}else{G.execCommand("mceInsertContent",false,String.fromCharCode(J))}G.undoManager.beforeChange();G.undoManager.add();D=G.selection.getRng(true);B=o(D);if(B[B.length-1]=="|"){B+=" ";H=0}F=z.exec(B.substring(0,B.length-1));E=j(F[1].length+H,D.commonAncestorContainer,D.startOffset);D.setStart(E.container,E.offset);I=AJS.$(D.commonAncestorContainer);G.selection.setRng(D);if(I.closest(".wysiwyg-macro-body").length&&D.toString()==I.text()){I[0].innerHTML="<br>";G.selection.select(I[0].childNodes[0]);G.selection.collapse(true)}else{G.execCommand("delete",false,{},{skip_undo:true})}A(F,G.selection.getRng(true));p=G.selection.getRng(true);if(y){K.preventDefault();K.stopPropagation();tinymce.dom.Event.cancel(C);AJS.Rte.showElement(p.startContainer);return false}}}}function d(i){return AJS.$.browser.msie?i.keyCode:i.which}function g(){this.handlers={}}g.prototype={registerHandler:function(y,i){if(!this.handlers[y]){this.handlers[y]=[]}this.handlers[y].push(i)},executeHandlers:function(B,A,z,y){var i=true;AJS.$.each(this.handlers[B]||[],function(C,D){if(D.handles(A)){i=D.execute(A,z,y);return false}});return i}};var f=w.editor,h=new g();function k(B,F,A,C,y,i){var D=B.charCodeAt(0),z=AJS.Rte.getResourceUrlPrefix()+"/images/icons/emoticons/"+y,E;E=n(F,function(){var G=f.dom.createHTML("img",{src:z,alt:f.getLang(C),title:f.getLang(C),border:0,"class":"emoticon emoticon-"+A,"data-emoticon-name":A});f.execCommand("mceInsertContent",false,G,{skip_undo:true})},true);this.imagePath=z;h.registerHandler(D,E)}var l=[new k(")",AJS.Rte.autoformat._REGEXES_EMOTICON.SMILE,"smile","emotions_dlg.smile","smile.png"),new k("(",AJS.Rte.autoformat._REGEXES_EMOTICON.SAD,"sad","emotions_dlg.sad","sad.png"),new k("P",AJS.Rte.autoformat._REGEXES_EMOTICON.CHEEKY,"cheeky","emotions_dlg.tongue","tongue.png"),new k("p",AJS.Rte.autoformat._REGEXES_EMOTICON.CHEEKY_2,"cheeky","emotions_dlg.tongue","tongue.png"),new k("D",AJS.Rte.autoformat._REGEXES_EMOTICON.LAUGH,"laugh","emotions_dlg.biggrin","biggrin.png"),new k(")",AJS.Rte.autoformat._REGEXES_EMOTICON.WINK,"wink","emotions_dlg.wink","wink.png"),new k(")",AJS.Rte.autoformat._REGEXES_EMOTICON.THUMBS_UP,"thumbs-up","emotions_dlg.thumbs_up","thumbs_up.png"),new k(")",AJS.Rte.autoformat._REGEXES_EMOTICON.THUMBS_DOWN,"thumbs-down","emotions_dlg.thumbs_down","thumbs_down.png"),new k(")",AJS.Rte.autoformat._REGEXES_EMOTICON.INFORMATION,"information","emotions_dlg.information","information.png"),new k(")",AJS.Rte.autoformat._REGEXES_EMOTICON.TICK,"tick","emotions_dlg.check","check.png"),new k(")",AJS.Rte.autoformat._REGEXES_EMOTICON.CROSS,"cross","emotions_dlg.error","error.png"),new k(")",AJS.Rte.autoformat._REGEXES_EMOTICON.WARNING,"warning","emotions_dlg.warning","warning.png"),new k(")",AJS.Rte.autoformat._REGEXES_EMOTICON.PLUS,"plus","emotions_dlg.add","add.png"),new k(")",AJS.Rte.autoformat._REGEXES_EMOTICON.MINUS,"minus","emotions_dlg.forbidden","forbidden.png"),new k(")",AJS.Rte.autoformat._REGEXES_EMOTICON.QUESTION,"question","emotions_dlg.help_16","help_16.png"),new k(")",AJS.Rte.autoformat._REGEXES_EMOTICON.LIGHT_ON,"light-on","emotions_dlg.lightbulb_on","lightbulb_on.png"),new k(")",AJS.Rte.autoformat._REGEXES_EMOTICON.LIGHT_OFF,"light-off","emotions_dlg.lightbulb","lightbulb.png"),new k(")",AJS.Rte.autoformat._REGEXES_EMOTICON.YELLOW_STAR,"yellow-star","emotions_dlg.star_yellow","star_yellow.png"),new k(")",AJS.Rte.autoformat._REGEXES_EMOTICON.YELLOW_STAR_2,"yellow-star","emotions_dlg.star_yellow","star_yellow.png"),new k(")",AJS.Rte.autoformat._REGEXES_EMOTICON.RED_STAR,"red-star","emotions_dlg.star_red","star_red.png"),new k(")",AJS.Rte.autoformat._REGEXES_EMOTICON.GREEN_STAR,"green-star","emotions_dlg.star_green","star_green.png"),new k(")",AJS.Rte.autoformat._REGEXES_EMOTICON.BLUE_STAR,"blue-star","emotions_dlg.star_blue","star_blue.png"),new k("3",AJS.Rte.autoformat._REGEXES_EMOTICON.HEART,"heart","emotions_dlg.heart","heart.png"),new k("3",AJS.Rte.autoformat._REGEXES_EMOTICON.BROKEN_HEAR,"broken-heart","emotions_dlg.broken_heart","broken_heart.png")];var m=new Array();for(var s=0;s<l.length;s++){m[s]=new Image();m[s].src=l[s].imagePath}function c(A,y){var z=f.formatter.get(A)[0],i=f.dom.create(z.inline,{style:z.styles});i.appendChild(document.createTextNode(y+"{$caret}"));f.execCommand("mceInsertContent",false,q(i),{skip_undo:true});f.formatter.remove(A)}var x={"*":"bold",_:"italic","~":"subscript","^":"superscript","+":"underline","-":"strikethrough"};AJS.$.each(x,function(i,z){var y=new RegExp("(?:[\\s\\xA0\\u200b\\uFEFF]+|^)(\\"+i+"(?=[^\\s"+i+"])([^"+i+"]*?[^\\s]))$");h.registerHandler(i.charCodeAt(0),n(y,function(A){c(z,A[2])},true))});f.formatter.register("code",{inline:"code"});h.registerHandler("}".charCodeAt(0),n(/(?:[\s\xA0\u200b]+|^)({{(?=[^\s])([^}]*?[^\s])})$/,function(i){c("code",i[2])},true));for(var s=1;s<=6;s++){(function(i){h.registerHandler(" ".charCodeAt(0),n(new RegExp("^\\u200b?(h"+i+"\\.)$"),function(){f.execCommand("formatBlock",false,"h"+i,{skip_undo:true})},true))})(s)}h.registerHandler(" ".charCodeAt(0),n(/^\u200b?(bq\.)$/,function(){f.execCommand("formatBlock",false,"blockquote",{skip_undo:true})},true));h.registerHandler(" ".charCodeAt(0),n(/^\u200b?(\*)$/,function(){f.plugins.lists.applyList("UL","OL")},true));h.registerHandler(" ".charCodeAt(0),n(/^\u200b?(\#)$/,function(){f.plugins.lists.applyList("OL","UL")},true));h.registerHandler(" ".charCodeAt(0),n(/^\u200b?(1\.)$/,function(){f.plugins.lists.applyList("OL","UL")},true));h.registerHandler(" ".charCodeAt(0),n(/^\u200b?(\-)$/,function(){var y=f.dom,i;f.plugins.lists.applyList("UL","OL");i=y.getParent(f.selection.getNode(),"OL,UL");if(i){y.setStyles(i,{listStyleType:"square"});i.removeAttribute("data-mce-style")}},true));AJS.trigger("confluence.editor.registerHandlers",{handlerManager:h,createHandler:n,ed:f});h.registerHandler(" ".charCodeAt(0),n(/[^-]*[\s](\-\-\-?)$/,function(i){var y=i[1].length===2?"\u2013":"\u2014";f.execCommand("mceInsertContent",false,y,{skip_undo:true})},false));var v=n(/(([^\s-]+)(\-\-\-?)([^\s-]+))$/,function(i){var y=i[3].length===2?"\u2013":"\u2014";f.execCommand("mceInsertContent",false,i[2]+y+i[4],{skip_undo:true})},false);h.registerHandler(" ".charCodeAt(0),v);h.registerHandler(13,v);var b=n(/^\u200b?(\-\-\-\-)$/,function(){f.execCommand("mceInsertContent",false,"<hr />",{skip_undo:true})},true);h.registerHandler(" ".charCodeAt(0),b);h.registerHandler(13,b);h.registerHandler(13,n(/(^\u200b?\|\|\s*(?:[^|]*\s?\|\|\s?)+$)/,function(z){var C="<table class='confluenceTable'><tr>",B="",i=true,D=AJS.$(z[1].slice(2,-2).split("||")).map(function(E){E=AJS.$.trim(this);i=i&&E=="";return E});if(i){D[0]="\u9996\u4E2A\u5355\u5143\u683C"}for(var A=0,y=D.length;A<y;A++){C+="<th class='confluenceTh'>"+D[A]+"</th>";B+="<td class='confluenceTd'>"+AJS.Rte.ZERO_WIDTH_WHITESPACE+"</td>"}C+="</tr><tr>"+B+"</tr></table>";f.execCommand("mceInsertContent",false,C,{skip_undo:true});f.selection.select(AJS.$(f.selection.getRng(true).commonAncestorContainer).parents("table").find(i?"th":"td")[0].childNodes[0]);AJS.$(f.selection.getRng().startContainer).parent().closest('[contenteditable="true"]').focus()},true));h.registerHandler(13,n(/(^\u200b?\|\s?(?:[^|]*\s?\|\s?)+$)/,function(z){var B="<table class='confluenceTable'><tr>",i=true,C=AJS.$(z[1].slice(1,-1).split("|")).map(function(D){D=AJS.$.trim(this);i=i&&D=="";return D});if(i){C[0]="\u9996\u4E2A\u5355\u5143\u683C"}for(var A=0,y=C.length;A<y;A++){B+="<td class='confluenceTd'>"+C[A]+"</td>"}B+="</tr></table>";f.execCommand("mceInsertContent",false,B,{skip_undo:true});i&&f.selection.select(AJS.$(f.selection.getRng(true).commonAncestorContainer).parents("table").find("td")[0].childNodes[0]);AJS.$(f.selection.getRng().startContainer).parent().closest('[contenteditable="true"]').focus()},true));var r=n(/\b(((https?|ftp):\/\/|(www\.))[\w\.\$\-_\+!\*'\(\),/\?:@=&%#~;\[\]]+)$/,function(i){var y=i[3]?i[1]:"http://"+i[1],z=f.dom.create("a",{href:y});z.appendChild(document.createTextNode(i[1]));f.execCommand("mceInsertContent",false,q(z),{skip_undo:true});f.getDoc().execCommand("unlink",false,{})},false,"a");h.registerHandler(" ".charCodeAt(0),r);h.registerHandler(13,r);var a=n(/\b((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)$/i,function(i){var y=f.dom.create("a",{href:"mailto:"+i[1]});y.appendChild(document.createTextNode(i[1]));f.execCommand("mceInsertContent",false,q(y),{skip_undo:true});f.getDoc().execCommand("unlink",false,{})},false,"a");h.registerHandler(" ".charCodeAt(0),a);h.registerHandler(13,a);var t=n(/(?:\b|^)([Jj]ira)$/,function(){f.execCommand("mceInsertContent",false,"JIRA",{skip_undo:true})},false);h.registerHandler(" ".charCodeAt(0),t);h.registerHandler(13,t);var u={"]":AJS.Rte.autoformat._REGEXES.WIKI_LINK,"}":AJS.Rte.autoformat._REGEXES.WIKI_MACRO,"!":AJS.Rte.autoformat._REGEXES.WIKI_EMBED};AJS.$.each(u,function(i,y){h.registerHandler(i.charCodeAt(0),n(y,function(z,B){var A=z[1]+i;var C={type:"POST",contentType:"application/json; charset=utf-8",url:AJS.Meta.get("context-path")+"/rest/tinymce/1/wikixhtmlconverter",data:AJS.$.toJSON({wiki:A,entityId:AJS.Meta.get("content-id"),spaceKey:AJS.Meta.get("space-key"),suppressFirstParagraph:true}),dataType:"text",timeout:5000};if(i=="}"){tinymce.confluence.MacroUtils.insertMacro(C)}else{if(i=="!"){AJS.$.ajax(C).done(function(D){if(!A===D){tinymce.confluence.ImageUtils.insertImagePlaceholder(D)}else{f.execCommand("mceInsertContent",false,D,{skip_undo:true})}})}else{AJS.$.ajax(C).done(function(D){f.execCommand("mceInsertContent",false,D,{skip_undo:true})})}}},true))});f.onKeyPress.addToTop(function(y,i){return h.executeHandlers(d(i),y,i,e)})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/customtoolbar/tinyMce-table-toolbar.js' */
AJS.$(document).bind("initContextToolbars.Toolbar",function(g,d){var c,b=function(m){var n=d.getLang(m),e=d.getLang(m+"_shortcut","");if(e){n+=" ("+e+")"}return n},f=function(m){var e=AJS.$(m).closest("table:not(.wysiwyg-macro)");return e.length},i=function(m){function e(o,n){return parseInt(o.attr(n),10)}return m.filter(function(o){var n=AJS.$(this);return e(n,"rowspan")>1||e(n,"colspan")>1}).length>=1},l=function(m){var n=AJS.$(m).closest("td,th"),e=AJS.$(".mceSelected",n.closest("table"));if(i(n.add(e))){d.plugins.customtoolbar.enableToolbarButton("table-split-cells")}else{d.plugins.customtoolbar.disableToolbarButton("table-split-cells")}},k=AJS.storageManager("atlassian.editor","tables");d.onNodeChange.add(function(p,n,q){var m=AJS.$("body");var o=!m.hasClass("no-tools")||m.hasClass("no-tools-toolbars-visible");if((!c)&&(q.parentNode!=null)&&(q.nodeName!="BODY")){c=true;if(f(q)){AJS.$(document).trigger("createContextToolbarRow.Toolbar",{buttons:Confluence.Editor.tableToolbar.Buttons,topToolbar:true,animate:o}).trigger("enableContextToolbarRow.Toolbar");l(q)}else{AJS.$(document).trigger("disableContextToolbarRow.Toolbar",{animate:o})}c=false}});d.onUndo.add(function(n,m,o){n.nodeChanged()});function a(){var e=AJS.$("<ul/>").addClass("table-highlight-picker");var n=["grey","red","green","blue","yellow",""];var m=[false,false,false,false,false,true];AJS.$.each(n,function(p,r){var o=AJS.$("<li/>");var q=AJS.$('<a href="#"></a>');if(m[p]){q.addClass("remove-highlight").attr("data-remove-highlight",true)}else{q.addClass("highlight-"+r).attr("data-highlight-colour",r)}o.append(q);e.append(o)});return e}function h(q){var m=AJS.$(this);var p=AJS.$("#table-highlight-group");var r=p.attr("data-highlight-colour");var o=p.attr("data-remove-highlight");if(r){p.removeClass("highlight-"+r);p.removeAttr("data-highlight-colour")}p.removeClass("remove-highlight");if(o){p.removeAttr("data-remove-highlight")}var n=m.attr("data-highlight-colour");if(n){p.addClass("highlight-"+n);p.attr("data-highlight-colour",n)}if(m.attr("data-remove-highlight")){p.addClass("remove-highlight");p.attr("data-remove-highlight",true)}d.focus();d.execCommand("confTableSelectionToggleHighlight",false,{alwaysHighlight:true});q.preventDefault()}AJS.$(document).delegate("#table-highlight-colour .aui-dropdown a","click",h);var j="table-";Confluence.Editor.tableToolbar={Buttons:[new Confluence.Editor.Toolbar.Components.Group([new Confluence.Editor.Toolbar.Components.Button({text:b("table.row_before_desc"),iconClass:j+"insert-row-before",click:function(){tinyMCE.execCommand("mceTableInsertRowBefore",false,"")}}),new Confluence.Editor.Toolbar.Components.Button({text:b("table.row_after_desc"),iconClass:j+"insert-row-after",click:function(){tinyMCE.execCommand("mceTableInsertRowAfter",false,"")}}),new Confluence.Editor.Toolbar.Components.Button({text:b("table.delete_row_desc"),iconClass:j+"delete-row",click:function(){tinyMCE.execCommand("mceTableDeleteRow",false,"")}})]),new Confluence.Editor.Toolbar.Components.Group([new Confluence.Editor.Toolbar.Components.Button({text:b("table.cut_row_desc"),iconClass:j+"cut",click:function(){tinyMCE.execCommand("mceTableCutRow",false,"");d.plugins.customtoolbar.enableToolbarButton("table-paste")}}),new Confluence.Editor.Toolbar.Components.Button({text:b("table.copy_row_desc"),iconClass:j+"copy",click:function(){tinyMCE.execCommand("mceTableCopyRow",false,"");d.plugins.customtoolbar.enableToolbarButton("table-paste")}}),new Confluence.Editor.Toolbar.Components.Button({text:b("table.paste_row_before_desc"),iconClass:j+"paste",click:function(){tinyMCE.execCommand("mceTablePasteRowBefore",false,"")},disabled:!k.doesContain("copied")})]),new Confluence.Editor.Toolbar.Components.Group([new Confluence.Editor.Toolbar.Components.Button({text:b("table.col_before_desc"),iconClass:j+"insert-column-before",click:function(){tinyMCE.execCommand("mceTableInsertColBefore",false,"")}}),new Confluence.Editor.Toolbar.Components.Button({text:b("table.col_after_desc"),iconClass:j+"insert-column-after",click:function(){tinyMCE.execCommand("mceTableInsertColAfter",false,"")}}),new Confluence.Editor.Toolbar.Components.Button({text:b("table.delete_col_desc"),iconClass:j+"delete-column",click:function(){tinyMCE.execCommand("mceTableDeleteCol",false,"")}})]),new Confluence.Editor.Toolbar.Components.Group([new Confluence.Editor.Toolbar.Components.Button({text:b("table.merge_cells_desc"),iconClass:j+"merge-cells",click:function(){tinyMCE.execCommand("mceTableMergeCells",false,"")}}),new Confluence.Editor.Toolbar.Components.Button({text:b("table.split_cells_desc"),iconClass:j+"split-cells",click:function(){tinyMCE.execCommand("mceTableSplitCells",false,"")}})]),new Confluence.Editor.Toolbar.Components.Group([new Confluence.Editor.Toolbar.Components.Button({text:b("table.row_highlight"),iconClass:j+"heading-row",click:function(){tinyMCE.execCommand("confTableRowToggleHeading",false)}}),new Confluence.Editor.Toolbar.Components.Button({text:b("table.col_highlight"),iconClass:j+"heading-column",click:function(){tinyMCE.execCommand("confTableColumnToggleHeading",false)}})]),new Confluence.Editor.Toolbar.Components.SplitGroup([new Confluence.Editor.Toolbar.Components.Button({text:b("table.selection_highlight"),iconClass:j+"highlight-selection",click:function(){tinyMCE.execCommand("confTableSelectionToggleHighlight",false)}})],{id:"table-highlight-group",dropDownOptions:{id:"table-highlight-colour",dropDownContent:a(),alignment:"right"},postProcess:function(m){m.attr("data-highlight-colour","grey");m.addClass("highlight-grey");var e=AJS.$("<span>&nbsp;</span>");e.addClass("highlight-indicator");m.find(".icon.table-highlight-selection").after(e)}}),new Confluence.Editor.Toolbar.Components.Group([new Confluence.Editor.Toolbar.Components.Button({text:b("table.del"),iconClass:j+"delete-table",click:function(){tinyMCE.execCommand("mceTableDelete",false,"")}})])],Events:[]}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/customtoolbar/editor_plugin_src.js' */
(function(f){function r(){var A=f("#rte-button-source-mode");A.click(function(){if(A.hasClass("active")){Confluence.Editor.changeMode(Confluence.Editor.MODE_RICHTEXT)}else{Confluence.Editor.changeMode(Confluence.Editor.MODE_SOURCE)}})}function a(A,B){f(document).trigger("initContextToolbars.Toolbar",B);f(document).bind("createContextToolbarRow.Toolbar",s).bind("removeContextToolbarRow.Toolbar",i).bind("enableContextToolbarRow.Toolbar",j).bind("disableContextToolbarRow.Toolbar",x);A.addEventsForComponent("TableToolbar",Confluence.Editor.tableToolbar.Events)}function m(C,B){var A=function(){B&&B.hide()};f(document).bind("showLayer",function(F,D,E){if(D=="dropdown"&&E==B){C.onClick.add(A);C.onKeyUp.add(A)}}).bind("hideLayer",function(F,D,E){if(D=="dropdown"&&E==B){C.onClick.remove(A);C.onKeyUp.remove(A)}})}function t(A){A.addCallback("show",function(){if(A.$.parents(".disabled").length){A.hide()}})}function l(C){var E=f("#color-picker-control");if(!E.length){return}var F=E.find(".aui-dd-parent"),A=f("#rte-button-color"),B=A.find(".selected-color"),G=F.dropDown("Standard",{alignment:"left"})[0],D=A.attr("data-color");B.css("background-color","#"+D);E.delegate("a[data-color]","click",function(J){var I=f(this),H=I.attr("data-color");J.preventDefault();if(I.closest(".disabled").length){return}tinyMCE.execCommand("ForeColor",false,"#"+H);A.attr("data-color",H);B.css("background-color","#"+H)});t(G);c(F,G,160);m(C,G)}function h(A){AJS.Rte.TablePicker.bindToControl(A,f("#insert-table-dropdown"))}function c(C,A,D){var B=false;if(f.browser.msie&&parseInt(f.browser.version,10)==7){A.addCallback("show",function(){if(!B){var F=0,E=f(C).find(".aui-dropdown");f(E).width("auto");if(D){f(E).width(D)}else{f(E).find(".item-link").each(function(H,G){F=Math.max(F,f(this).outerWidth(true))});f(E).width(F+20)}B=true;A.show()}})}}function d(A,C,B){var F=C.attr("data-macro-name"),G=C.attr("data-command"),E=C.attr("data-format"),D=C.attr("data-control-id");if(F){tinymce.confluence.macrobrowser.macroBrowserToolbarButtonClicked({presetMacroName:F})}if(G){A.execCommand(G,false)}if(E){A.theme.controlHandlers.formatselect["click"].dispatch(E)}if(D){A.theme.controlHandlers.buttons["click"].dispatch(D)}}function j(C,A){var B=w(A);f("#"+B).removeClass("disabled")}function x(C,A){var B=w(A);f("#"+B).addClass("disabled")}function g(A){e(f("."+A.replace(".","")),true)}function p(A){e(f("."+A.replace(".","")),false)}function e(B,A){if(A){B.closest(".aui-button").prop("disabled",true).attr("aria-disabled","true")}else{B.closest(".aui-button").prop("disabled",false).removeAttr("aria-disabled")}}function u(A){var B=f("."+A.replace(".",""));return !B.closest(".aui-button").prop("disabled")}function o(A){f("."+A.replace(".","")).closest(".aui-button").focus()}function z(C){var A=w({id:C});var B=f("#"+A);if(B.length){return B[0]}else{return null}}var y=function(){var E=function(H){H=f(H).closest("PRE,BLOCKQUOTE,.text-placeholder");return function(I){return H.is(I)}},G=f("#toolbar").find("li.toolbar-item"),C=f("#insert-menu, #more-menu"),B=f("#insert-menu, #color-picker-control"),A=f("#format-dropdown"),F="disabled",D=function(H,I){G.toggleClass(F,H);C.toggleClass(F,H);B.toggleClass(F,H);A.toggleClass(F,!!I);AJS.Rte.TablePicker[H?"disable":"enable"]()};return function(J,H,O){var M=E(O),I=M("BLOCKQUOTE"),K=M("PRE"),L=M(".text-placeholder"),N;if(K){N=f(O).parents("table").is("[data-macro-body-type='PLAIN_TEXT']");D(true,N)}else{if(L){D(true)}else{if(I){H.setDisabled("justifyleft",I);H.setDisabled("justifycenter",I);H.setDisabled("justifyright",I)}else{D(false)}}}}};function w(A){var B="default";if(A&&A.id){B=A.id}return"rte-toolbar-row-"+B}function n(A){return f("#"+A).length>0}function k(A){var A=w({id:A});return n(A)&&!f("#"+A).hasClass("disabled")}var v;function i(C,B){var A=B.animate;if(A==undefined){A=true}var D=function(){f(this).remove();f(document).trigger("resize.resizeplugin");if(B.onHide){B.onHide()}};clearTimeout(v);v=setTimeout(function(){var E=w(B);var F=f("#"+E);if(A){F.slideUp(400,D)}else{F.hide();D.call(F)}},100)}function s(E,K){var F=w(K);var A=K.animate;if(A==undefined){A=true}if(n(F)){return}var J=f("<div></div>").addClass("toolbar-split toolbar-split-row toolbar-contextual"),H;J.attr("id",F);if(K.editorAdjacent){J.addClass("editor-adjacent")}var G=!K.topToolbar?f("#savebar-container .aui-toolbar"):f("#rte-toolbar.aui-toolbar");for(var D=0,B=K.buttons.length;D<B;D++){J.append(K.buttons[D].render())}J.css({display:"none"});if(K.editorAdjacent){G.append(J)}else{var C=f(".editor-adjacent",G).filter(":first");if(C.length){C.before(J)}else{G.append(J)}}J.find(".toolbar-dropdown").each(function(){b(tinymce.activeEditor,this)});var I=function(){f(document).trigger("resize.resizeplugin").trigger("shown.contextToolbar");if(K.onVisible){K.onVisible()}};clearTimeout(v);v=setTimeout(function(){if(A){J.slideDown(400,I)}else{J.show();I()}},100)}function b(A,D){var B=f(D),C=B.dropDown("Standard",{alignment:B.data("dropdown-alignment")||"left"})[0];B.find(".dropdown-item").click(function(F){var E=f(this);d(A,E,F);C.hide();F.preventDefault()});t(C);c(B,C);m(A,C)}function q(A){var D=[];for(var E in TinyMCELang.hints){D.push("hints."+E)}var C=Confluence.hintManager(D);var B=function(){f("#rte-savebar .hints-text").html(A.getLang(C.getNextHint()))};B();f("#rte-savebar a.hints-close").click(function(F){f(this).closest(".toolbar-split").addClass("hidden");F.preventDefault()});f("#rte-savebar a.hints-next").click(function(F){B();F.preventDefault()})}tinymce.create("tinymce.plugins.customtoolbar",{init:function(A){b(A,"#format-dropdown");b(A,"#more-menu .aui-dd-parent");b(A,"#insert-menu .aui-dd-parent");if(f("#pagelayout-menu").length){b(A,"#pagelayout-menu .aui-dd-parent")}if(f("#template-menu").length){b(A,"#template-menu .aui-dd-parent")}l(A);h(A);r();q(A);f("#rte-button-attachments").click(function(D){tinyMCE.activeEditor.execCommand("mceConfAttachments",false)});a(AJS.Rte.EventDelegator(A),A);var C=f("#format-dropdown"),B=C.find("span.dropdown-text");A.onBeforeExecCommand.add(function(H,F,K,E,D){f.each(["pre","blockquote"],function(){if(F=="FormatBlock"&&E==this){H.formatter.remove("alignleft");H.formatter.remove("aligncenter");H.formatter.remove("alignright")}});if(f(H.selection.getNode()).closest("pre,.text-placeholder").length){var I=["Bold","Italic","Underline","Strikethrough","InsertUnorderedList","InsertOrderedList","InsertInlineTaskList","InsertInlineTaskListNoToggle","superscript","subscript","mceConfMacroBrowser","mceConfimage","mceConfAttachments","mceEmotion","InsertWikiMarkup","mceConflink","mceInsertTable","mceConfAutocompleteLink"];var L=I.length;for(var G=0;G<L;G++){if(F==I[G]){D.terminate=true}}}if((F=="FormatBlock")&&(E=="pre")){H.undoManager.add();H.execCommand("removeFormat")}if(F=="FormatBlock"&&E=="p"){var J=C.find(".dropdown-item[data-format='blockquote']").text();if(B.text()==J){D.terminate=true;H.execCommand("FormatBlock",false,"blockquote")}}else{if(F=="FormatBlock"&&E=="removeformat"&&H.selection.isCollapsed()){D.terminate=true;AJS.debug("Not removing format for no selected text")}}});A.onExecCommand.add(function(D,G,F,I,E){if(G=="FormatBlock"){var H=C.find(".dropdown-item[data-format='"+I+"']");if(!H.length){H=C.find(".dropdown-item[data-format='p']")}B.text(H.text())}});A.onNodeChange.add(y());A.onInit.add(function(D){AJS.debug("customtoolbar: ed.onInit function");var E={};f(".aui-toolbar").find("[data-control-id]").each(function(G,F){var H,J,I;F=f(F);H=F.closest(".toolbar-item");J=F.attr("data-control-id");if(J=="formatselect"){I=D.theme.controlHandlers[J];I.state.add(function(K){if(K=="p"){var M=D.selection.getNode();if(f(M).closest("p").parent().is("blockquote")){K="blockquote"}}var L=C.find(".dropdown-item[data-format='"+K+"']").text();if(L){B.text(L)}})}else{E[J]=F}});control=D.theme.controlHandlers.buttons;control.state.add(function(J,I,F){var G=E[J];if(!G){return}var H=G.find(".icon-check");toolbarItem=G.closest(".toolbar-item");if(!H.length){toolbarItem.toggleClass(I,F)}else{H.toggleClass("hidden",!F)}});f(".aui-toolbar").delegate(".toolbar-item","click",function(H){var F=f(this);if(!F.hasClass("disabled")){var G=F.children(".toolbar-trigger[data-control-id]").attr("data-control-id");if(G){control.click.dispatch(G);H.preventDefault()}}else{H.preventDefault()}});AJS.$.support.shrinkWrapBlocks=false;AJS.debug("customtoolbar: finished ed.onInit function")})},disableToolbarButton:g,enableToolbarButton:p,focusToolbarButton:o,isToolbarRowEnabled:k,getToolbarRow:z,isToolbarButtonEnabled:u,bindDropdownMenu:b,getInfo:function(){return{longname:"customtoolbar",author:"Atlassian",authorurl:"http://www.atlassian.com",infourl:"http://www.atlassian.com/",version:"1.0"}}});tinymce.PluginManager.add("customtoolbar",tinymce.plugins.customtoolbar)})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/customtoolbar/custom-toolbar-components.js' */
Confluence.Editor.Toolbar={Components:{}};Confluence.Editor.Toolbar.Components.Button=function(b){var g=b.text;var f=b.tooltip;var e=b.triggerText;var a=b.iconClass;var d=b.click;var c=!!b.disabled;var h=b.id;this.render=function(){var j=AJS.$('<button type="button"></button>').addClass("aui-button").attr("data-tooltip",f||g);if(h){j.attr("id",h)}if(c){j.prop("disabled",true).attr("aria-disabled","true")}j.click(function(l){if(!j.prop("disabled")){d()}});if(a){var k=AJS.$("<span />");k.addClass("icon "+a);k.text(g);j.append(k)}if(e){var i=AJS.$("<span />");i.addClass("trigger-text");i.text(e);j.append(i)}return j[0]}};Confluence.Editor.Toolbar.Components.DropDownButton=function(d){var g=d.id;var f=d.text;var a=d.iconClass;var e=!!d.disabled;var c=d.dropDownContent;var b;this.render=function(){var h=AJS.$("<div></div>").addClass("toolbar-item").addClass("toolbar-dropdown").attr("data-tooltip",f);h.attr("id",g);var k=AJS.$("<div/>").addClass("aui-dd-parent");var i=AJS.$("<a href='#'></a>");i.addClass("toolbar-trigger").addClass("aui-dd-trigger");if(e){h.addClass("disabled");i.addClass("disabled")}if(a){var j=AJS.$("<span />");j.addClass("icon "+a);j.text(f);i.append(j)}var l=AJS.$("<span/>");l.addClass("icon").addClass("icon-dropdown");i.append(l);b=AJS.$("<div/>").addClass("hidden").addClass("aui-dropdown").addClass("aui-dropdown-right");if(c){b.append(c)}k.append(i);k.append(b);h.append(k);return h[0]}};Confluence.Editor.Toolbar.Components.TextButton=function(b){var f=b.text;var a=b.textClass;var d=b.click;var c=!!b.disabled;var e=b.tooltip;this.render=function(){var g=AJS.$('<button type="button"></button>').addClass("aui-button").addClass(a).text(f);if(e){g.attr("data-tooltip",e)}if(c){g.prop("disabled",true).attr("aria-disabled","true")}g.click(function(h){if(!g.prop("disabled")){d()}});return g[0]}};Confluence.Editor.Toolbar.Components.TextBox=function(c){var f=c.id;var e=c.text;var b=c.name;var d=c.keydown;var a=c.cssClass;this.render=function(){var h=AJS.$("<div></div>").addClass("toolbar-item");h.append(AJS.$("<label for='"+f+"'>"+e+"</label>"));var g=AJS.$("<input id='"+f+"' type='text' name='"+b+"' class='"+a+" text' autocomplete='off'>");g.keydown(function(i){d(i)});h.append(g);return h[0]}};Confluence.Editor.Toolbar.Components.Group=function(c,a){var b=c;this.render=function(){var f=AJS.$("<div></div>");f.addClass("aui-buttons");if(a){a.id&&f.attr("id",a.id);a.groupClass&&f.addClass(a.groupClass)}for(var d=0,e=b.length;d<e;d++){f.append(b[d].render())}return f[0]}};Confluence.Editor.Toolbar.Components.SplitGroup=function(e,b){var d=e;var a=(b&&b.dropDownOptions)||{};function c(){var g=a.id;var h=a.disabled;var f=a.dropDownContent;var l=a.title;var j=a.alignment;var o;var n=AJS.$("<div></div>").addClass("toolbar-item").addClass("toolbar-dropdown").addClass("toolbar-splitbutton");g&&n.attr("id",g);l&&n.attr({"data-tooltip":l});j&&n.data("dropdown-alignment",j);var m=AJS.$("<div/>").addClass("aui-dd-parent");var k=AJS.$("<a href='#'></a>");k.addClass("toolbar-trigger aui-dd-trigger");if(h){n.addClass("disabled");k.addClass("disabled")}var i=AJS.$("<span/>");i.addClass("icon").addClass("icon-dropdown");k.append(i);o=AJS.$("<div/>").addClass("hidden").addClass("aui-dropdown");if(f){o.append(f)}m.append(k);m.append(o);n.append(m);return n[0]}this.render=function(){var h=AJS.$("<div></div>");h.addClass("aui-buttons");if(b){b.id&&h.attr("id",b.id);b.groupClass&&h.addClass(b.groupClass)}for(var f=0,g=d.length;f<g;f++){h.append(d[f].render())}h.append(c(b));b&&b.postProcess&&b.postProcess(h);return h[0]}};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/customtoolbar/thirdpartycode/tipsy.js' */
(function(a){a.fn.tipsy.autoBounds2=function(c,b){return function(){var d={},g=a(document).scrollTop()+c,e=a(document).scrollLeft()+c,f=a(this);if(b.length>1){d.ns=b[0];d.ew=b[1]}else{if(b[0]=="e"||b[0]=="w"){d.ew=b[0]}else{d.ns=b[0]}}if(f.offset().top<g){d.ns="n"}if(f.offset().left<e){d.ew="w"}if(a(window).width()+a(document).scrollLeft()-(f.offset().left+f.width())<c){d.ew="e"}if(a(window).height()+a(document).scrollTop()-(f.offset().top+f.height())<c){d.ns="s"}if(d.ns){return d.ns+(d.ew?d.ew:"")}return d.ew}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/customtoolbar/chunky-tips.js' */
(function(a){AJS.bind("init.rte",function(){AJS.debug("Enabling Chunky Tooltip for the editor");function f(){return a(this).attr("data-tooltip")||""}var g={live:true,gravity:"n",title:f,delayIn:250,delayOut:0};var j=a.fn.tipsy.autoBounds2(50,"n");var d=a.fn.tipsy.autoBounds2(50,"s");var b=a.fn.tipsy.autoBounds2(50,"w");var l=a.extend({},g,{gravity:j});var h=a.extend({},g,{gravity:d});var e=a.extend({},g,{gravity:b});a("#rte-toolbar [data-tooltip]:not(.dropdown-item)").tooltip(l);a("#rte-toolbar .dropdown-item[data-tooltip]").tooltip(e);a("#rte-savebar [data-tooltip]").tooltip(h);a("#property-panel [data-tooltip]").tooltip(l);function c(p,n,o){if(n==="dropdown"){a(".tipsy").remove();if(o&&o.trigger&&o.trigger.jquery){var m=o.trigger.data("tipsy");if(m){m.hoverState="out"}}}}AJS.$(document).bind("showLayer",c);AJS.$(document).bind("hideLayer",c);function i(p,o,n,m){a(".tipsy").remove()}AJS.bind("created.property-panel",i);AJS.bind("destroyed.property-panel",i);var k=/\+/g;AJS.bind("register-contexts.keyboardshortcuts",function(){setTimeout(function(){AJS.$("#rte-savebar .aui-button[title]").each(function(){var m=a(this);var o=m.attr("title");m.removeAttr("title");if(tinymce.isMac){var n=o.indexOf("(");if(n>=0){o=o.substr(0,n)+o.substr(n).replace(k,"")}}m.attr("data-tooltip",o)})},0)})})})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/confluencepaste/linkify.js' */
linkify={RE_EMAIL_PATTERN:"(?:\\s|\\A|^)[\\w.-]+\\+*[\\w.-]+@(?:(?:[\\w-]+\\.)+[A-Za-z]{2,6}|(?:\\d{1,3}\\.){3}\\d{1,3})",RE_URL_SCHEME:"(?:[\\w-]{2,}):/{1,3}",RE_TLD:"(?:aero|arpa|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|travel|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|fi|fj|fk|fm|fo|fr|ga|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|qa|re|ro|ru|rw|sa|sb|sc|sd|se|sg|si|sj|sk|sl|sm|sn|so|sr|st|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw)",RE_URL_MIDCHAR:"(?:[^\\s()]+|\\((\\S+)\\))",RE_URL_ENDCHAR:"(?:\\((\\S+)\\)|[^\\s`!()\\[\\]{};:'\".,<>?«»“”‘’])",init:function(){if(this.RE_URL_ENDING){return}this.RE_URL_ENDING="(?:"+this.RE_URL_MIDCHAR+"*"+this.RE_URL_ENDCHAR+")?";this.RE_FULL_URL=this.RE_URL_SCHEME+"\\w+(?:.\\w+)"+this.RE_URL_ENDING;this.RE_OTHER_URL="\\w[\\w_-]*(?:\\.\\w[\\w_-]*)*\\."+this.RE_TLD+"(?:[\\/\\?#]"+this.RE_URL_ENDING+"|\\b)"},linkify:function(c,b,a){this.init();c=this.match_and_replace(this.RE_EMAIL_PATTERN,c,true,false,b,a);c=this.match_and_replace(this.RE_FULL_URL,c,false,false,b,a);c=this.match_and_replace(this.RE_OTHER_URL,c,false,true,b,a);return c},match_and_replace:function(x,o,e,b,n,z){var f=0;var h=0;var p=0;var j=0;var y=/<\/[aA]>/;var u=new RegExp(x,"g");var s=(z.hasOwnProperty("add_wbrs")?z.add_wbrs:null);var w=(z.hasOwnProperty("truncate_length")?z.truncate_length:100);var k=(z.hasOwnProperty("link_target")?z.link_target:"_blank");var m=(z.hasOwnProperty("link_titles")?z.link_titles:null);var l={};var i=20;var g=0;while(l=u.exec(o)){g++;if(g>i){break}f=l.index;p=l[0].length;var q=o.substring(h,f);if(q.search(/<[aA]/)>=0){y.lastIndex=h;var r=o.substring(h,o.length).search(y);if(r<0){return o}j=r+h;u.lastIndex=j+4;h=j+4;continue}var d=o.substr(f,p);var a=d.search(/&(amp|gt|lt)$/);if(a>0&&o.length>f+p&&o[f+p]==";"){var c=d.length-a;p-=c;d=o.substr(f,p);while(!d.match(this.RE_URL_ENDCHAR+"$")&&p>0){p--;d=o.substr(f,p)}}var t=d;if(b){t="http://"+t}var v="<a";if(k){v+=' target="'+k+'"'}v+=' href="';if(e){v+="mailto:"}t=t.replace(/"/g,"%22");v+=t+'"';if(m){var A=e?"Email "+t:t;v+=' title="'+A+'"'}if(w&&d.length>w){d=d.substr(0,w)+"..."}if(s){d=d.replace(new RegExp("([/=])","g"),"<wbr>$1")}v+=">"+d+"</a>";if(n){n.push(t)}o=o.slice(0,f)+v+o.slice(f+p,o.length);u.lastIndex=f+v.length;h=f+v.length}return o}};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/confluencepaste/post-paste-node-filter.js' */
(function(g,m){var l=(function(){linkify.init();var p=new RegExp(linkify.RE_FULL_URL),q=new RegExp(linkify.RE_OTHER_URL);return{exec:function(s){var r=p.exec(s);return r?r:q.exec(s)},test:function(r){return p.test(r)||q.test(r)}}})();var h=(function(){var p=new RegExp(linkify.RE_EMAIL_PATTERN);return{exec:function(r){var q=p.exec(r);if(q&&/\s/.test(q[0][0])){q[0]=q[0].replace(/\s/,"");q.index++}return q},test:function(q){return p.test(q)}}}());m=m||{};m.Editor=m.Editor||{};m.Editor.regex={URL:l,EMAIL:h};function j(t,w){var r=g(t).find("["+w+"]"),v="",q="",p="";for(var s=0,u=r.length;s<u;s++){v=g(r[s]);q=v&&["/",v.attr(w)].join("");p=v&&["/",v.attr("data-mce-"+w)].join("");if(m.getContextPath()&&q.indexOf(m.getContextPath())===0){r[s]=v.attr(w,q)}if(m.getContextPath()&&p.indexOf(m.getContextPath())===0){r[s]=v.attr("data-mce-"+w,p)}}return r}function n(x,s){var r=[],t="",v,u=x.attr("style"),p=x.attr("data-mce-style");for(var q=0,w=s.length;q<w;q++){if(u&&u.toLowerCase().indexOf(s[q])>-1){r.push(s[q]+": "+x.css(s[q])+";")}else{if(p&&p.toLowerCase().indexOf(s[q])>-1){t=new RegExp(s[q]+":.+?(?:;|$)");v=p.match(t);r.push(v[0].indexOf(";")>-1?v:v+";")}}}return r.join(" ")}function k(u,t,p){var s=[];if(p){for(var q=0,r=p.length;q<r;q++){if(u.is("["+t+"~="+p[q]+"]")){s.push(p[q])}}}return s.join(" ")}function d(s,p,v){var w=g(s).find("["+p+"]"),u="",y,q;if(w){for(var t=0,x=w.length;t<x;t++){y=g(w[t]);q=v.standard;for(var r in v){if(v.hasOwnProperty(r)&&y.is(r)){q=v[r]}}if(p.indexOf("style")>-1){u=n(y,q)}else{u=k(y,p,q)}y.removeAttr(p);if(u.length){y.attr(p,u)}}}}function c(q,p){var r={};r.standard=["text-decoration","text-align","margin-left"];r[".wysiwyg-macro"]=["background-image"];r.p=["margin-left","text-align"];r.span=["color","text-decoration"];r.pre=["margin-left"];r.td=r.th=["text-align"];if(p.indexOf("style")>-1){d(q,"style",r);d(q,"data-mce-style",r)}if(g.browser.mozilla){if(p.indexOf("src")>-1){j(q,"src")}if(p.indexOf("href")>-1){j(q,"href")}}d(q,"face",{standard:[]});d(q,"id",{standard:[]});d(q,"data-mce-href",{standard:[]});return q}function b(q,p){g(p,q).contents().unwrap()}function f(q){var r,p;r=g(q);p="<p>"+r.html().replace(/<br>/gi,"</p><p>")+"</p>";r.html(p)}function i(p){var q=g(p);return q.children("br").length&&!q.find(":not(br)").length}function o(q){var p=[".contentLayout",".contentLayout2",".columnLayout",".header",".footer",".cell",".innerCell",".panelContent",".panel",".panelHeader",".Apple-converted-space","font",".jira-status",".jira-issue",".diff-html-removed",".diff-html-added",".diff-html-changed"];g.each(p,function(s,r){b(q,r)});g("img",q).map(function(){!g(this).attr("src")&&g(this).remove()});g("dl",q).map(function(){g(this).replaceWith("<p>"+g(this).text()+"</p>")})}function a(u,p){var q,t,r,v;function s(y){var x,w;if(q.index){w=u.splitText(q.index);u&&p.push(u);u=w}x=u.splitText(q[0].length);x&&p.push(x);g(u).wrap("<a href='"+y+u.data+"'></a>")}t=h.exec(u.data);r=l.exec(u.data);if(t){q=t;v="mailto:";s(v)}else{if(r){q=r;v=q&&q[0].indexOf("://")==-1?"http://":"";s(v)}}}function e(r){var p=g.makeArray(r.childNodes),q;while(p.length){q=p.pop();if(!g(q).is("a")){if(q.nodeType==3){a(q,p)}else{if(q.nodeType==1&&q.childNodes&&q.nodeName.toLowerCase()!=="pre"){p=p.concat(g.makeArray(q.childNodes))}}}}}g(document).bind("postPaste",function(q,p,r){c(r.node,"style,src,href");o(r.node);if(!g.browser.msie){e(r.node)}if(g.browser.mozilla&&i(r.node)){f(r.node)}})})(AJS.$,Confluence);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/confluencepaste/clipboard-helper.js' */
(function(b){var a;AJS.ClipboardHelper=a=function(){var c=[{repair:function(e){var d=/<meta charset='utf-8'>(<td.*<\/td>)<br class="Apple-interchange-newline">/,f=d.exec(e);if(!f){return e}else{return'<table class="confluenceTable"><tbody><tr>'+f[1]+"</tr></tbody></table>"}}},{repair:function(d){var e=/<meta charset='utf-8'>(<tr.*<\/tr>)<br class="Apple-interchange-newline">/,f=e.exec(d);if(!f){return d}else{return'<table class="confluenceTable"><tbody>'+f[1]+"</tbody></table>"}}}];return{parse:function(d,e){if(d.charAt(0)==="<"&&d.charAt(d.length-1)===">"&&d.length>=3){return b(d,e||document)}else{return b("<div>"+d+"</div>",e||document).contents()}},repair:function(d){if(!d){return d}b.each(c,function(e,f){d=f.repair(d)});return d}}}()})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/confluencepastetable/editor_plugin_src.js' */
(function(a){tinymce.create("tinymce.plugins.ConfluencePasteTablePlugin",{init:function(b){b.onInit.add(function(){function g(j){return !j.tagName?false:j.tagName=="TABLE"?true:j.tagName=="TR"?true:j.tagName=="TH"?true:j.tagName=="TD"?true:j.tagName=="TBODY"?true:j.tagName=="THEAD"?true:j.tagName=="TFOOT"?true:j.tagName=="COL"?true:j.tagName=="COLGROUP"?true:j.tagName=="CAPTION"}function f(j){return !j.tagName?"":j.tagName=="TABLE"?"confluenceTable":j.tagName=="TH"?"confluenceTh":j.tagName=="TD"?"confluenceTd":""}function i(j){var k="";if(j&&j.getAttribute){k=j.getAttribute("class")}return !j.tagName?false:j.tagName!="TABLE"?false:!k?false:k.indexOf("wysiwyg-macro")!==-1}function e(j){var k;if(j&&j.getAttribute){k=j.getAttribute("class")}return k&&k.indexOf("table-wrap")>=0}function h(m){var q={id:true,"class":true,style:true,rowspan:true,colspan:true,"data-mce-style":true,"data-mce-bogus":true,"data-macro-name":true,"data-macro-parameters":true,"data-macro-body-type":true,"data-highlight-colour":true,"data-highlight-class":true},u=["highlight","nohighlight"],k,p=0,o=[],t,n,s=a(m);if(!m||i(m)){return m}if(e(m)){var j=a("table",m);if(j.length){a(j).unwrap();m=j[0]}else{return null}}if(g(m)&&m.attributes){while(p<=m.attributes.length){k=m.attributes[p];if(k&&k.specified===true&&!q[k.name]){m.removeAttribute(k.name)}else{p++}}f(m)&&o.push(f(m));for(var l=0,r=u.length;l<r;l++){if(u[l].exec){}else{s.hasClass(u[l])&&o.push(u[l])}}t=s.attr("data-highlight-class");t&&o.push(t);n=s.attr("data-highlight-colour");n&&o.push("highlight-"+n);s.attr("class",o.join(" "))}return m}function d(k,j){return j.parentNode===k}function c(j,m){var l=j,k="";while(true){if(!l){break}if(typeof m=="function"){l=m(l)}if(!l){break}else{if(l.firstChild&&!d(l,k)&&!i(l)){k=l;l=l.firstChild}else{if(l.nextSibling){k=l;l=l.nextSibling}else{k=l;l=l.parentNode}}}}return j}a(document).bind("postPaste",function(k,j,l){l.node=c(l.node,h)})})},getInfo:function(){return{longname:"ConfluencePasteTablePlugin",author:"Atlassian",authorurl:"http://www.atlassian.com",infourl:"http://www.atlassian.com",version:"1.0"}}});tinymce.PluginManager.add("confluencepastetableplugin",tinymce.plugins.ConfluencePasteTablePlugin)})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/confluencepastemacro/editor_plugin_src.js' */
(function(a){tinymce.create("tinymce.plugins.ConfluencePasteMacroPlugin",{init:function(b){var c=this;b.onInit.add(function(){a(document).bind("postPaste",function(i,f,j){var d=b.getDoc(),h,g;if(a(b.selection.getStart()).closest("[data-macro-body-type='PLAIN_TEXT']").length){c.bindPostSerializeHandler(b);h=c.parseHtml(b,j.node);g=d.createElement("div");g.appendChild(h);j.node=g}})})},bindPostSerializeHandler:function(d){var b=d.serializer.onPostProcess;function c(e,f){f.content=f.content.replace(/^<pre>|<\/pre>$/g,"");b.remove(c)}b.add(c)},parseHtml:function(d,f){var c=a.makeArray(f.childNodes),h,e,b=d.getDoc(),g=b.createElement("pre");while(c.length){h=c.shift();if(h.childNodes.length){tinymce.html.Schema.blockElementsMap[h.nodeName]&&c.unshift(b.createElement("br"));c=a.makeArray(h.childNodes).concat(c)}else{e=this.formatMacroContent(h,b);e&&g.appendChild(e)}}return g},formatMacroContent:function(d,b){var e,f=3,c=/\xA0/g;b=b||window.document;if(d.nodeType==f){e=b.createTextNode(a(d).text().replace(c," "))}else{if(d.nodeName=="BR"){e=b.createElement("br")}}return e},getInfo:function(){return{longname:"ConfluencePasteMacroPlugin",author:"Atlassian",authorurl:"http://www.atlassian.com",infourl:"http://www.atlassian.com",version:"1.0"}}});tinymce.PluginManager.add("confluencepastemacroplugin",tinymce.plugins.ConfluencePasteMacroPlugin)})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/confcursortarget/editor_plugin_src.js' */
(function(b){var a=".wysiwyg-macro,.placeholder,table";AJS.Rte=AJS.Rte||{};AJS.Rte.CursorTarget={addFixSelector:function(c){a+=","+c}};tinymce.create("tinymce.plugins.CursorTargetPlugin",{init:function(h,g){var t=true;var i="ol, ul, p, pre, table, blockquote, div, h1, h2, h3, h4, h5, h6";function v(y){b(a,y).each(function(z,A){e(A)})}function l(z){var y=(tinyMCE.isIE)?"&nbsp;":"<br/>";function A(B){return B&&B.childNodes&&B.childNodes.length===1&&B.childNodes[0].nodeType==3&&B.childNodes[0].nodeValue&&B.childNodes[0].nodeValue.length===1&&B.childNodes[0].nodeValue.charCodeAt(0)==160}b("p, td.confluenceTd, th.confluenceTh",z).each(function(B,C){if(A(C)){b(C).html(y)}})}function e(B){var z=b(B);function A(F){if(F.length===0){throw new Error("no paragraph element specified")}var E=F[0];if(E.childNodes.length===0){if(tinymce.isIE&&!tinymce.isIE9){E.innerHTML="&nbsp;"}else{E.innerHTML="<br />"}}return E}function C(E){return !b(E).is(i)}function y(F,E){var G=b("<p/>");if(b(F.parentNode).is("li, td, th")){while(F[E]&&C(F[E])){G[E=="previousSibling"?"prepend":"append"](F[E])}}return A(G)}if(!z.prev().length||z.prev(a).length||(b(B.parentNode).is("li, td, th")&&C(B.previousSibling))){z.before(y(B,"previousSibling"))}if(!z.next().length||z.next(a).length||(b(B.parentNode).is("li, td, th")&&C(B.nextSibling))){z.after(y(B,"nextSibling"))}function D(I){function J(K){if(K[0].nodeName=="BR"||n(K[0])){K.replaceWith(A(b("<p/>")))}}function G(L){var K=L.next();while(K.length&&!K.is(a)){var M=K[0];if(M.nodeName!="BR"&&M.nodeName!="P"){return false}K=K.next()}return true}function H(L){var K=L.prev();while(K.length&&!K.is(a)){var M=K[0];if(M.nodeName!="BR"&&M.nodeName!="P"){return false}K=K.prev()}return true}var F=I.prev();if(F.length&&H(F)){J(F)}var E=I.next();if(E.length&&G(E)){J(E)}}D(z)}function j(y){b("p",y).each(function(z,A){if(n(A)&&p(A)){b(A).attr("data-tag","marked-for-deletion")}});b("p[data-tag=marked-for-deletion]",y).remove();return y}function n(y){function z(B){var C=0,D=0;for(var F=0,A=B.childNodes.length;F<A;F++){var E=B.childNodes[F];if(E.nodeName=="BR"){if(++C>1){return false}}else{if(/^[\s|\u00A0]$/.test(E.nodeValue)){if(++D>1){return false}}else{if(E.nodeValue!==""){return false}}}}return true}return y.nodeType==1&&y.childNodes.length===0||z(y)}function p(C){if(!C||C.nodeType!=1){return false}var B=o(C,false);var A=o(C,true);var z=w(B)||b(B).is(a);var y=w(A)||b(A).is(a);var D=w(B)&&w(A);return z&&y&&!D}function w(y){if(!y){return true}else{return y.className&&/cell|header|footer/.test(y.className)}}function o(B,A){var y=".cell, .mceContentBody, td, li";var C=b(B);do{var z=(A)?C[0].nextSibling:C[0].previousSibling;if(z){return z}C=C.parent()}while(C.length>0&&!C.is(y));return null}function m(y){var z=y.startContainer;if(z.nodeType==3){var A=z.previousSibling&&(z.previousSibling.nodeType==3||b(z.previousSibling).is("br"));return !A&&y.startOffset===0}else{if(z.nodeType==1){return y.startOffset===0}}return false}function c(z){var y=h.getBody();if(y.childNodes.length){return z.collapsed&&z.startOffset===0&&y.childNodes[0]==z.startContainer}return false}function k(z){var A=z.startContainer;if(A.nodeType==3){var y=A.nextSibling&&(A.nextSibling.nodeType==3||b(A.nextSibling).is("br"));return !y&&z.endOffset==A.nodeValue.length}else{if(A.nodeType==1){var B=A.childNodes[z.startOffset];if(b(B).is("br")&&B.nextSibling==null){return true}else{return z.endOffset==A.childNodes.length}}}return false}function x(y){var A=b(y).children();var z;for(z=0;z<A.length;z++){if(n(A[z])){continue}if(b(A[z]).contents().filter(function(){return this.nodeType==3}).length||x(A[z])){return true}}return false}function u(A,y){function z(C,B){var D=B.startOffset;if(!C){D--}return D>=0&&D<B.startContainer.childNodes.length&&B.startContainer.childNodes[D].nodeName=="TABLE"}return y.startContainer==y.endContainer&&y.startContainer.nodeType==1&&z(A,y)}function s(y){if(!y.collapsed){return false}var A=y.startContainer,B;if(A.nodeType==3){B=o(A,true);return y.startOffset==A.nodeValue.length&&(B==null||b(B).is("br"))}else{if(A.nodeType===1){if(b(A).is("td, th")&&y.startOffset===0&&A.childNodes.length>0){return b(A.childNodes[0]).is("br")}else{var z=(y.startOffset===0)?0:y.startOffset-1;B=o(A.parentNode.childNodes[z],true);return B==null||b(B).is("br")}}else{return false}}}function f(y){return y&&y.childNodes.length===1&&b(y.childNodes[0]).is("br")}function d(z,y){if(tinymce.isWebKit&&u(false,y)){return true}else{if(tinymce.isGecko){if(s(y)||(p(z)&&y.startOffset===0&&f(z))){return true}}}return false}function q(z,y){if(tinymce.isWebKit&&(u(true,y)||(m(y)&&p(z))||c(y))){return true}else{if(tinymce.isGecko&&m(y)&&p(z)&&f(z)){return true}}return false}function r(y,A){var z=A.keyCode;if(z!=8&&z!=46){return true}if(!y.selection.isCollapsed()){setTimeout(function(){v(y.getBody())},100)}else{if(z==8&&q(y.selection.getNode(),y.selection.getRng(t))){tinymce.dom.Event.prevent(A)}else{if(z==46&&d(y.selection.getNode(),y.selection.getRng(t))){tinymce.dom.Event.prevent(A)}}}return true}h.onSetContent.add(function(y,z){v(y.getBody());l(y.getBody())});h.onGetContent.add(function(z,B){var D="<div class='root-node'>";var y="</div>";var E=D+B.content+y;var C=j(b(E));var A=AJS.Rte.getEditor().serializer.serialize(C[0],B);B.content=A.substring(D.length,A.length-y.length)});h.onInit.add(function(){h.selection.onSetContent.add(function(y,z){v(h.getBody())});h.dom.bind(h.getBody(),"cut",function(y){setTimeout(function(){v(h.getBody())},100)});AJS.bind("cursor-target-refresh",function(){v(h.getBody())})});if(tinymce.isGecko){h.onKeyDown.add(function(y,z){if((z.keyCode==13||z.keyCode==8||z.keyCode==46)){y.selection.normalize()}})}h.onKeyDown.add(r);h.onKeyUp.add(r);tinymce.isGecko&&h.onKeyPress.add(r);h.onPaste.add(function(y,z){v(y.getBody())});b.extend(this,{_isTextContainerEmpty:n,_processCursorTargets:j,_isCursorAtStartOfContainer:m,_isCursorAtEndOfContainer:k,_getSiblingWithinBlockDisregardingNesting:o,_doesContainerHaveNestedContent:x,isCursorBeforeAfterTable:u,isCursorTarget:p,_addCursorTargetParagraphsToContent:v,_isCursorAtEndOfBottomRightCellInTable:s,_shouldCancelDelete:d,_shouldCancelBackspace:q});AJS.Rte.Cursor=AJS.Rte.Cursor||{};b.extend(AJS.Rte.Cursor,{isTextContainerEmpty:n,fixCursorTargets:v})},getInfo:function(){return{longname:"Cursor Target plugin",author:"Atlassian",authorurl:"http://www.atlassian.com",version:"1.0"}}});tinymce.PluginManager.add("cursorTarget",tinymce.plugins.CursorTargetPlugin)})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/confcleanup/editor_plugin_src.js' */
(function(a){tinymce.create("tinymce.plugins.ConfluenceCleanupPlugin",{init:function(b){if(tinymce.isWebKit){var c={},e=function(i,g){var h=i[g];if(!h){h={};i[g]=h}return h},f=function(i){var g=c[i.css("color")],h;if(g){h=g[i.css("font-weight")];if(h){return h[i.css("font-size")]}}return null};a("#format-dropdown").find("ul.aui-dropdown li").each(function(){var k=a("a",this),i=k.css("font-size"),l=k.css("font-weight"),g=k.css("color"),h=e(c,g),j=e(h,l);if(!j[i]){j[i]=a(this).attr("data-format")}});b.onNodeChange.add(function(j,l){var m=j.dom.select("span.Apple-style-span",j.dom.doc.body),o=j.dom.select("font.Apple-style-span",j.dom.doc.body),k=m.concat(o);for(var h=0,p=k.length;h<p;h++){if(j.dom.is(k[h],'[face="mceinline"]')){break}var n=f(a(k[h]));if(n){var g=j.selection.getBookmark();n&&j.dom.remove(k[h],1);j.selection.moveToBookmark(g);j.execCommand("FormatBlock",false,n)}}})}b.onNodeChange.add(function(j){var m="file:///",h=j.dom.select("img",j.dom.doc.body),g=h.length;for(var l=0;l<g;l++){var n=a(h[l]),k=n.attr("src");if(k.substr(0,m.length)===m){j.dom.remove(h[l])}}});if(tinymce.isIE9){function d(g){if(!g.getBody().childNodes.length){g.setContent("<p>\uFEFF</p>")}}b.onNodeChange.add(d);b.onSetContent.add(d)}},getInfo:function(){return{longname:"ConfluenceCleanupPlugin",author:"Atlassian",authorurl:"http://www.atlassian.com",infourl:"http://www.atlassian.com",version:"1.0"}}});tinymce.PluginManager.add("confluencecleanupplugin",tinymce.plugins.ConfluenceCleanupPlugin)})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'com/atlassian/confluence/tinymceplugin/tinyMce-auiwindowmanager.js' */
(function(){var g=56;var b=51;var f=20;var a=tinymce.util.Dispatcher,e=tinymce.each,d=tinymce.isIE,c=tinymce.isOpera;tinymce.create("tinymce.plugins.AUIWindowManager",{init:function(h,i){h.onBeforeRenderUI.add(function(){h.windowManager=new tinymce.AUIWindowManager(h)})},getInfo:function(){return{longname:"AUIWindowManager",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.create("tinymce.AUIWindowManager:tinymce.WindowManager",{AUIWindowManager:function(h){var i=this;i.editor=h;i.onOpen=new a(i);i.onClose=new a(i);i.params={};i.features={};i.modalDialogsStack=new Array();i.dialogs={};i.count=0},open:function(j,k){var w=this,n="",q,p,r,l,h=tinymce.DOM.getViewPort(),v;j=j||{};w.initialiseSettings(j);k=k||{};r=c?h.w:screen.width;l=c?h.h:screen.height;k=this.setDefaultParameters(k);k.mce_width=j.width;k.mce_height=j.height;k.mce_auto_focus=j.auto_focus;if(d){j.center=true;j.help=false;j.dialogWidth=j.width+"px";j.dialogHeight=j.height+"px"}w.features=j;w.params=k;w.onOpen.dispatch(w,j,k);var s=j.height;if(j.name){s+=g}if(k.cancelLink||k.buttons){s+=b}s+=(2*f);if(j.popup){s=s+8}var i=j.id||tinymce.DOM.uniqueId();var o=new AJS.ConfluenceDialog({width:j.width,height:s,id:i,onCancel:function(){o.hide().remove()}});if(j.name){o.addHeader(this.editor.getLang(j.name))}this.createDialogButtons(o,k,i);j.file=j.file||j.url;if(j.file){j.file=tinymce._addVer(j.file)}this.createDialogContent(o,j,k,i);k.helpLink&&this.createHelpLink(o,k.helpLink,k.helpName,i);k.hintText&&this.createHintText(o,k.hintText,i);var m={id:i,settings:j,params:k,dialog:o};this.modalDialogsStack.push(m);this.dialogs[i]=m;this.count++;AJS.Rte.BookmarkManager.storeBookmark();o.show();if(o.takeFocus!=undefined){o.takeFocus()}if(d){AJS.$("#"+i).css("overflow","hidden");AJS.$("#"+i+" ."+k.cssClass).css("overflow","hidden")}return i},initialiseSettings:function(h){h.width=parseInt(h.width||400,10);h.height=parseInt(h.height||250,10);h.resizable=false;if(h.popup==undefined){h.popup=true}if(h.popup&&h.content!=undefined){h.popup=false}if(h.scrollbars){h.scrollbars="yes"}else{h.scrollbars="no"}},createDialogButtons:function(l,m,h){if(m.buttons){var k=0;for(k=0;k<m.buttons.length;k++){var j=m.buttons[k];l.addButton(this.editor.getLang(j.label),j.action)}}if(m.cancelLink){l.addCancel(this.editor.getLang("auiwindowmanager.cancel"),function(){return tinyMCE.activeEditor.windowManager.close(h)})}},createDialogContent:function(i,j,k,m){var l=this.createContentId(m);var h="panel_"+l;if(j.popup){i.addPanel(h,AJS.$("<iframe id='"+l+"' width='100%' height='"+j.height+"px' frameborder='0' name='auidialogiframe' src='"+j.file+"' scrolling='"+j.scrollbars+"'></iframe>"),k.cssClass);i.takeFocus=function(){AJS.$("#"+l).focus()}}else{if(j.content==undefined){i.addPanel(h,AJS.$("<div id='"+l+"'/>"),k.cssClass);AJS.$("#"+l).load(j.file)}else{i.addPanel(h,AJS.$("<div id='"+l+"'>"+j.content+"</div>"),k.cssClass)}i.takeFocus=function(){var n=AJS.$("#"+l+" :input");if(n.length){AJS.$(n[0]).focus()}else{var o=AJS.$("#"+l+" .button-panel button");if(o.length){AJS.$(o[0]).focus()}}}}i.gotoPanel(0,0)},createHintText:function(h,i,k){var j=AJS.$("<div></div>").addClass("dialog-tip");j.text(tinyMCE.activeEditor.getLang(i));AJS.$("#"+k+" .dialog-button-panel").append(j)},createHelpLink:function(j,i,k,l){var h=AJS.$("<div></div>").addClass("dialog-help-link");h.load(AJS.params.contextPath+"/plugins/tinymce/helplink.action",{linkUrlKey:i,linkNameKey:(k||"")});AJS.$("#"+l+" .dialog-components .dialog-title").prepend(h)},close:function(j,k){var h;if(typeof(j)=="string"){h=j}else{if(k){h=k}else{var i=this.modalDialogsStack.pop();if(i){h=i.id}}}if(!this.dialogs[h]){AJS.log("Couldn't find id "+h+" in dialogs array so dialog is not closed.")}else{this.count--;var i=this.dialogs[h];i.dialog.remove();this.dialogs[h]=null;tinyMCE.activeEditor.focus();AJS.Rte.BookmarkManager.restoreBookmark()}return false},alert:function(n,o,j,h){var i={content:"<p>"+n+"</p>",width:500,height:160,popup:false};var m;var k=function(){tinyMCE.activeEditor.windowManager.toggleOtherDialogs(m,true);tinyMCE.activeEditor.windowManager.close(m);if(o){o.call(j||this)}};var l={buttons:[{label:"auiwindowmanager.ok",action:k}],cancelLink:false,cssClass:"tinymce-auidialog-alert"};m=this.open(i,l);this.toggleOtherDialogs(m,false)},createInstance:function(j,i,h,n,m,l){var k=tinymce.resolve(j);return new k(i,h,n,m,l)},toggleOtherDialogs:function(l,h){var k=0;for(k=0;k<this.modalDialogsStack.length;k++){var j=this.modalDialogsStack[k];if(j.id!=l){AJS.$("#"+j.id+" .dialog-button-panel").toggle(h)}}},confirm:function(j,h,k,i){i=i||window;h.call(k||this,i.confirm(this._decode(this.editor.getLang(j,j))))},setBusy:function(h,l){var j=this.dialogs[h];if(!j){return}if(l){var o=this.createContentId(h);var k=AJS.$("#"+o);k.hide();var n=k.parent();var m=this.createBusyContentId(h);var i=AJS.$("#"+m,n);if(!i.length){n.append(AJS.$("<div id='"+m+"' class='spinner'></div>"));i=AJS.$("#"+m,n);Raphael.spinner(i[0],50,"#666")}AJS.$(".button-panel button",AJS.$("#"+h)).each(function(p,q){AJS.$(q).prop("disabled",true)});AJS.$(i[0]).show()}else{var m=this.createBusyContentId(h);var i=AJS.$("#"+m);if(i.length){AJS.$(i[0]).hide()}var o=this.createContentId(h);var k=AJS.$("#"+o);AJS.$(".button-panel button",AJS.$("#"+h)).each(function(p,q){AJS.$(q).prop("disabled",false)});AJS.$(k[0]).show()}},logMCESelection:function(j){var i=tinyMCE.activeEditor.selection;AJS.log("******************************");AJS.log("Logging TinyMCE selection title:    "+j);AJS.log("Bookmark:");AJS.log(i.getBookmark());var h=AJS.$(i.getRng().startContainer).text()||$(i.getRng().startContainer.parentNode).text();AJS.log("Range: "+h);AJS.log(i.getRng())},setDefaultParameters:function(h){h.inline=false;if(!h.cssClass){h.cssClass="tinymce-auidialog"}if(h.cancelLink!=false){h.cancelLink=true}return h},createContentId:function(h){return"content_"+h},createBusyContentId:function(h){return"content_busy_"+h}});tinymce.PluginManager.add("auiwindowmanager",tinymce.plugins.AUIWindowManager)})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'com/atlassian/confluence/tinymceplugin/tinyMceMacroBrowser.js' */
tinymce.confluence.macrobrowser=(function(a){return{storedRange:null,bookmark:null,getCurrentNode:function(){return a(tinyMCE.activeEditor.selection.getNode())},isMacroDiv:function(b){return a(b).hasClass("wysiwyg-macro")},isMacroTag:function(c){var b=a(c);return b.hasClass("wysiwyg-macro")||b.hasClass("editor-inline-macro")},isBodylessMacro:function(b){return a(b).hasClass("editor-inline-macro")},isMacroWithBody:function(b){return a(b).hasClass("wysiwyg-macro")},isMacroStartTag:function(b){return a(b).hasClass("wysiwyg-macro-starttag")},isMacroEndTag:function(b){return a(b).hasClass("wysiwyg-macro-endtag")},isMacroBody:function(b){return a(b).hasClass("wysiwyg-macro-body")},hasMacroBody:function(b){return a(b).attr("macrohasbody")=="true"},getNestingMacros:function(c){var b=a(c||this.getCurrentNode());var d=[];b.parents(".wysiwyg-macro").each(function(){d.push(a(this).attr("data-macro-name"))});return d},logMCESelection:function(d){var c=tinyMCE.activeEditor.selection;AJS.log("******************************");AJS.log("Logging TinyMCE selection title:    "+d);AJS.log("Bookmark:");AJS.log(c.getBookmark());var b=a(c.getRng().startContainer).text()||a(c.getRng().startContainer.parentNode).text();AJS.log("Range: "+b);AJS.log(c.getRng())},getSelectedMacro:function(d){var c=tinymce.confluence.macrobrowser,b=c.getCurrentNode();AJS.log("getSelectedMacro: $selectionNode="+b[0]);return c.isMacroDiv(b)?b:tinymce.confluence.MacroUtils.isInMacro(b)},openMacro:function(b){AJS.MacroBrowser.open({selectedMacro:b,onComplete:tinymce.confluence.macrobrowser.macroBrowserComplete,onCancel:tinymce.confluence.macrobrowser.macroBrowserCancel})},editMacro:function(b){var c=tinymce.confluence.macrobrowser;var d=a(b);c.editedMacroDiv=d[0];var e=AJS.Rte.getEditor().serializer.serialize(d.clone()[0],{forced_root_block:false});AJS.Rte.getEditor().selection.select(d[0]);AJS.Rte.BookmarkManager.storeBookmark();a.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:AJS.params.contextPath+"/rest/tinymce/1/macro/definition",data:AJS.$.toJSON({contentId:Confluence.getContentId(),macroHtml:e}),dataType:"text",success:function(f){c.openMacro(AJS.$.secureEvalJSON(f))}})},macroBrowserToolbarButtonClicked:function(c){var d=tinymce.confluence.macrobrowser,f=tinyMCE.activeEditor,b=d.getCurrentNode();AJS.Rte.BookmarkManager.storeBookmark();var e=a.extend({presetMacroName:null,nestingMacros:d.getNestingMacros(b),onComplete:d.macroBrowserComplete,onCancel:d.macroBrowserCancel,mode:"insert",selectedHtml:"",selectedText:""},c);if(!c.ignoreEditorSelection){e.selectedHtml=f.selection.getContent();e.selectedText=f.selection.getContent({format:"text"})}AJS.MacroBrowser.open(e)},macroBrowserComplete:function(c){var b=tinymce.confluence.macrobrowser,d={contentId:AJS.Meta.get("content-id")||"0",macro:{name:c.name,params:c.params,defaultParameterValue:c.defaultParameterValue,body:c.bodyHtml}};AJS.Rte.BookmarkManager.restoreBookmark();if(b.editedMacroDiv){tinymce.confluence.MacroUtils.insertMacro(d,b.editedMacroDiv);delete b.editedMacroDiv}else{tinymce.confluence.MacroUtils.insertMacro(d)}},macroBrowserCancel:function(){var b=tinymce.confluence.macrobrowser;AJS.Rte.BookmarkManager.restoreBookmark();b.editedMacroDiv=null;b.editedMacro=null}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'com/atlassian/confluence/tinymceplugin/tinymce-image-utils.js' */
(function(d){var f=["imagetext","src","align","border","width","height"],a=/\/download\/(thumbnails|attachments)\/([0-9]+)\//,c=function(j){var k=d(j).attr("src"),i=k.match(a);if(i&&i.length==3){return i[2]}AJS.log("ERROR: could not parse page id from image url "+k);return"0"},e=function(j){var i=j.destination;if(g.isRemoteImg(i)){return i}var l="/thumbnails/";var k="/attachments/";return(j.thumbnail)?i.replace(k,l):i.replace(l,k)},b=function(i){return i&&d.nodeName(i,"img")&&d(i).hasClass("confluence-embedded-image")},h=0,g;tinymce.confluence.ImageProperties=function(i){if(b(i)){var j=d(i);i={destination:j.attr("src"),url:j.attr("src"),border:(j.attr("class")&&j.attr("class").indexOf("confluence-content-image-border")!=-1)?1:0,width:j.prop("width"),height:j.prop("height")};if(!g.isRemoteImg(i.destination)&&(!AJS.$(j).hasClass("confluence-external-resource"))){i.pageId=c(j)}return d.extend({},i)}else{if(i.destination){i.imageFileName=i.imageFileName||i.destination;return d.extend({},i)}}return null};g=tinymce.confluence.ImageUtils={updateImageElement:function(k,j){var n=d(k);j.src=e(j);n.toggleClass("confluence-content-image-border",!!j.border);n.toggleClass("confluence-thumbnail",!!j.thumbnail);for(var m=0,o=f.length;m<o;m++){var l=f[m],p=j[l];if(p!==false&&p!=null){n.attr(l,p)}else{n.removeAttr(l)}}tinyMCE.activeEditor.undoManager.add()},insertFromProperties:function(i){AJS.$.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:AJS.params.contextPath+"/rest/tinymce/1/embed/placeholder/image",data:AJS.$.toJSON(i),dataType:"text",success:g.insertImagePlaceholder})},insertImagePlaceholder:function(j){var i=tinyMCE.activeEditor,m="_"+(+new Date),l=d("<div></div>").append(d(j).attr("id",m));i.selection.setContent(l.html());var k=i.dom.get(m);i.dom.setAttrib(k,"id","");d(k).one("load",function(){AJS.Rte.showSelection(function(){AJS.trigger("trigger.property-panel",{elem:k});i.undoManager.add()});i.onChange.dispatch()})},isRemoteImg:function(i){var j=AJS.Rte.getCurrentBaseUrl();return i.match("(https?://)")&&i.indexOf(j)==-1}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'com/atlassian/confluence/tinymceplugin/tinymce-macro-utils.js' */
(function(c){var b;function a(d){var i=tinymce.confluence.macrobrowser,g=tinymce.activeEditor,h=g.getDoc(),e,f=g.selection.getRng(true);if(i.isMacroWithBody(d)){!tinymce.isIE&&c("p, pre",d).each(function(){if(this.childNodes.length===0){this.appendChild(h.createElement("br"))}});e=g.dom.select(".wysiwyg-macro-body",d)[0].firstChild;if(e){f.setStart(e,0);f.setEnd(e,0)}else{AJS.debug("focusMacroNode: couldn't find anything to focus, cap'n!")}}else{f.setStartAfter(d);f.setEndAfter(d)}g.selection.setRng(f)}tinymce.confluence.MacroUtils=b={DEFAULT_INSERT_MACRO_TIMEOUT:5000,insertMacro:function(h,j){var g;if(h.macro&&h.contentId){g={type:"POST",url:Confluence.getContextPath()+"/rest/tinymce/1/macro/placeholder",contentType:"application/json; charset=utf-8",data:c.toJSON(h),dataType:"text"}}else{if(h.url&&h.type){g=h}else{throw new Error("illegal argument received: "+h)}}var d=c.Deferred(),e=AJS.Rte.getEditor(),i,f;if(!j){f="macro-"+(new Date()).getTime();i=e.dom.create("span",{id:f});e.selection.setNode(i);j=i=e.dom.select("#"+f)[0];d.fail(function(){c(i).remove()})}c.extend(g,{timeout:b.DEFAULT_INSERT_MACRO_TIMEOUT});AJS.debug("Insert macro timeout = "+g.timeout);Confluence.Editor.UI.setButtonsState(false);c.ajax(g).done(function(l){if(l[0]!=="<"){l=document.createTextNode(l)}function k(m){return m&&m.parentNode}if(!k(j)){AJS.logError("The node to be replaced has been already deleted from the document");d.rejectWith(this,arguments)}else{tinymce.confluence.NodeUtils.updateNode(j,l).done(function(m){d.resolve(m,l)}).fail(d.reject)}}).fail(function(k,m,l){AJS.logError("Macro placeholder request failed "+m+": '"+l+"'");d.rejectWith(this,arguments)});d.done(function(k,l){Confluence.Editor.UI.setButtonsState(true);if(tinymce.confluence.macrobrowser.isMacroWithBody(k)&&/P|H\d/.test(k.parentNode.nodeName)){e.dom.split(k.parentNode,k)}a(k);e.nodeChanged();AJS.Rte.showElement(k);e.selection.onSetContent.dispatch(e.selection,{content:l,format:"html"});tinymce.activeEditor.undoManager.add()}).fail(function(){Confluence.Editor.UI.setButtonsState(true)});return d.promise()},isInMacro:function(e){var d=e.jquery?e:c(e);return d.closest(".wysiwyg-macro").length>0}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/confluence/editor_plugin_src.js' */
(function(a){tinymce.create("tinymce.plugins.ConfluencePlugin",{init:function(b,c){b.addCommand("mceConfimage",Confluence.Editor.defaultInsertImageDialog);b.addCommand("mceConfMacroBrowser",tinymce.confluence.macrobrowser.macroBrowserToolbarButtonClicked);b.addCommand("mceConfUnlink",function(j,f){var h=AJS.Rte.getEditor(),m=h.selection,e=f||m.getNode(),i=a(e);if(e.nodeName!="A"){var l=i.closest("a");if(!l.length){return}e=l[0];i=l}var d=i.attr("href");if(!d){d="#";i.attr("href",d)}var g=function(o){var n=/(.*)[\/]$/.exec(o);return n!=null?n[1]:o};if(!i.attr("data-linked-resource-id")&&Confluence.Link.isExternalLink(d)&&i.text()==g(d)){var k=h.dom.create("span",{"class":"nolink"},d);h.dom.replace(k,e,false)}else{m.select(e);i.removeClass("createlink unresolved");h.execCommand("UnLink")}});b.addButton("confimage",{title:"confluence.confimage_desc",cmd:"mceConfimage"});b.addButton("conf_macro_browser",{title:"confluence.conf_macro_browser_desc",cmd:"mceConfMacroBrowser"})},getInfo:function(){return{longname:"Confluence TinyMCE Plugin",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("confluence",tinymce.plugins.ConfluencePlugin)})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/macroplaceholder/editor_plugin_src.js' */
(function(a){var b=tinymce.VK;tinymce.create("tinymce.plugins.MacroPlaceHolderPlugin",{init:function(d){var e=this;d.onInit.add(function(h){h.selection.onSetContent.add(function(i){tinymce.each(i.dom.select("p > .wysiwyg-macro"),function(k){var l=i.dom.getParent(k.parentNode,"p");try{i.dom.split(l,k)}catch(j){}})})});d.onSetContent.add(function(h){tinymce.each(h.dom.select('.wysiwyg-macro[data-macro-body-type="PLAIN_TEXT"] .wysiwyg-macro-body'),function(i){var j=h.dom.select("pre",i);if(!j.length){if(tinymce.isIE){h.dom.setHTML(i,"<pre></pre>")}else{h.dom.setHTML(i,"<pre><br /></pre>")}}})});d.onKeyDown.add(function(j,n){var l=j.selection,m,h;var k=[b.BACKSPACE,b.DELETE,b.ENTER,b.ESCAPE];function o(p){var q=false;if(p.charCode===0){q=(jQuery.inArray(p.keyCode,[b.SHIFT,b.CTRL,b.ALT,b.META])!=-1)}return q}if(jQuery.inArray(n.keyCode,k)!=-1||o(n)||l.isCollapsed()){return}if(n.ctrlKey||n.metaKey||(!tinymce.isMac&&n.altKey)){return}m=l.getNode();if(tinymce.confluence.macrobrowser.isMacroWithBody(m)){var i=a(".wysiwyg-macro-body",m);if(i.length>0){AJS.debug("MacroPlaceholderPlugin: Adjusting text selection to only include macro's body.");l.select(i[0],true)}}});d.onDblClick.add(function(j,l){var h=a(l.target),i=function(m){return m.closest("[data-macro-name]")},k=i(h);if(k.length){AJS.debug("Double-click triggered inside a macro.");if(k.attr("data-macro-body-type")){if(tinymce.isIE){if(h.hasClass("wysiwyg-macro-body")||h.hasClass("wysiwyg-macro")){AJS.debug("Double-click inside macro body, but its IE so its OK I guess...")}else{AJS.debug("Double-click was inside bodied macro content, even in IE. Skipping.");return}}else{if(h.closest(".wysiwyg-macro-body").length){AJS.debug("Double-click was inside bodied macro content. Skipping.");return}}}tinymce.confluence.macrobrowser.editMacro(k);if(AJS.Confluence.PropertyPanel&&AJS.Confluence.PropertyPanel.current){AJS.Confluence.PropertyPanel.destroy()}}});d.onNodeChange.addToTop(function(h){var i=h.selection.getNode();if(i.nodeName=="PRE"&&AJS.$(i).closest(".wysiwyg-macro").length){e._setTinymceControlsState(h,0)}else{e._setTinymceControlsState(h,1)}});d.addCommand("mceConfRemoveMacro",function(h){a(h).remove();if(tinymce.isGecko){AJS.Rte.getEditor().execCommand("mceRepaint",false)}});function c(h){d.onKeyDown.add(h);if(tinymce.isGecko){d.onKeyPress.add(h);d.onKeyUp.add(h)}}function g(i,h){return i&&i.childNodes.length===1&&a(i).is(h)&&a(i.firstChild).is("br")}function f(h){if(!h.collapsed){return false}var i=h.startContainer.nodeType==3?h.startContainer.parentNode:h.startContainer;if(!i||!i.parentNode){return false}while(i&&!a(i).is(".wysiwyg-macro-body")){if(i.previousSibling||i.nextSibling){return false}i=i.parentNode}return true}e._isCursorInMostNestedElement=f;(function(){(tinymce.isWebKit||tinymce.isGecko)&&c(function(i,j){if(j.keyCode==46&&h(i.selection.getRng(true))){return tinymce.dom.Event.cancel(j)}});function h(i){if(!i.collapsed){return false}var j=i.startContainer.nodeType==3?i.startContainer.parentNode:i.startContainer;return j.previousSibling&&!j.nextSibling&&g(j,"p, pre")}e._isCursorInLastParagraphOrPre=h})();(function(){tinymce.isWebKit&&c(function(j,l){if(l.keyCode!=8&&l.keyCode!=46){return true}var i=j.selection.getRng(true),k=i.startContainer.nodeType==3?i.startContainer.parentNode:i.startContainer;if(h(i)&&(l.keyCode==8?!a(k).is("li"):true)){return tinymce.dom.Event.cancel(l)}return true});function h(i){if(!i.collapsed){return false}var j=i.startContainer.nodeType==3?i.startContainer.parentNode:i.startContainer;return f(i)&&j.childNodes.length===1&&a(j.firstChild).is("br")}})();(function(){tinymce.isWebKit&&c(function(i,j){if(j.keyCode!=8){return true}if(h(i.selection.getRng(true))){i.execCommand("Outdent");return tinymce.dom.Event.cancel(j)}return true});function h(i){if(!i.collapsed){return false}var j=i.startContainer.nodeType==3?i.startContainer.parentNode:i.startContainer;return i.startOffset===0&&a(j).is(".wysiwyg-macro-body > ul > li")&&j.childNodes.length===1&&a(j.firstChild).is("br")}e._isCursorInsideMacroPlacholderInsideListItemContainingSoloBr=h})();(function(){tinymce.isWebKit&&c(function(k,n){if(n.keyCode!=46){return true}var j=k.selection.getRng(true),l=j.startContainer.nodeType==3?j.startContainer.parentNode:j.startContainer,i=a(l);if(h(j)){var m=l.nextSibling;i.remove();k.selection.select(m,true);return tinymce.dom.Event.cancel(n)}});function h(j){var k=j.startContainer.nodeType==3?j.startContainer.parentNode:j.startContainer,i=a(k);return j.startOffset===0&&g(k,"p, pre")&&i.parent().is("td.wysiwyg-macro-body")&&!k.previousSibling&&k.nextSibling&&g(k.nextSibling,"p, pre")}e._isCursorInFirstParagraphWhenThereAreTwoEmptyParagraphs=h})();(function(){tinymce.isWebKit&&c(function(k,n){if(n.keyCode!=8){return true}var j=k.selection.getRng(true),m=j.startContainer.nodeType==3?j.startContainer.parentNode:j.startContainer,i=a(m);if(h(j)){var l=m.previousSibling;i.remove();k.selection.select(l,true);return tinymce.dom.Event.cancel(n)}});function h(j){var k=j.startContainer.nodeType==3?j.startContainer.parentNode:j.startContainer,i=a(k);return j.startOffset===0&&g(k,"p, pre")&&i.parent().is("td.wysiwyg-macro-body")&&!k.nextSibling&&k.previousSibling&&!k.previousSibling.previousSibling&&g(k.previousSibling,"p, pre")}e._isCursorInSecondParagraphWhenThereAreTwoEmptyParagraphs=h})();(function(){(tinymce.isWebKit||tinymce.isGecko)&&c(function(i,j){if(j.keyCode!=8&&j.keyCode!=46){return true}if(h(i.selection.getRng(true))){return tinymce.dom.Event.cancel(j)}});function h(j){if(!j.collapsed){return false}var k=j.startContainer.nodeType==3?j.startContainer.parentNode:j.startContainer,i=a(k);if(!k||j.startOffset>0){return false}tinymce.confluence.NodeUtils.normalize(k);return k&&j.startOffset===0&&g(k,"p, pre")&&i.parent().is("td.wysiwyg-macro-body")&&!k.previousSibling&&!k.nextSibling}e._isCursorInSoloParagraphOrPreInsidePlaceholder=h})();(function(){function l(m){return m&&m.parentNode&&m.nodeName=="BR"&&m===m.parentNode.lastChild}(tinymce.isWebKit||tinymce.isGecko)&&c(function(n,p){if(p.keyCode!=8&&p.keyCode!=46){return true}var m=n.selection.getRng(true),o=m.startContainer.nodeType==3?m.startContainer.parentNode:m.startContainer;if(!a(o).closest(".wysiwyg-macro-body").size()){return true}tinymce.confluence.NodeUtils.normalize(o);if((p.keyCode==46&&(k(m)||i(m)))||(p.keyCode==8&&(h(m)||j(m)))){if(o.lastChild&&!a(o.lastChild).is("br")){a(o).append("<br/>")}a(o.firstChild).remove();n.selection.select(o,1);return tinymce.dom.Event.cancel(p)}return true});function k(m){if(!m.collapsed){return false}var n=m.startContainer;return n&&m.startOffset===0&&n.nodeType==3&&f(m)&&n.nodeValue.length===1&&!n.previousSibling&&(!n.nextSibling||l(n.nextSibling))}function h(m){if(!m.collapsed){return false}var n=m.startContainer;return n&&m.startOffset===1&&n.nodeType==3&&f(m)&&n.nodeValue.length===1&&!n.previousSibling&&(!n.nextSibling||l(n.nextSibling))}function i(m){if(!m.collapsed){return false}var n=m.startContainer;return n&&m.startOffset===0&&n.nodeType==1&&n.childNodes.length===1&&f(m)&&!n.previousSibling&&!n.nextSibling}function j(m){if(!m.collapsed){return false}var n=m.startContainer;return n&&m.startOffset===1&&n.nodeType==1&&n.childNodes.length===1&&f(m)&&!n.previousSibling&&!n.nextSibling}e._isCursorBehindOnlyCharacterInNestedElement=k;e._isCursorAfterOnlyCharacterInNestedElement=h;e._isCursorBehindOnlyChildInNestedElement=i;e._isCursorAfterOnlyChildInNestedElement=j})();(function(){tinymce.isWebKit&&c(function(n,o){if(o.keyCode!=8&&o.keyCode!=46){return true}var m=n.selection.getRng(true);if(i(m)){var l=a(m.startContainer).closest(".wysiwyg-macro-body");if(l.length>0){var k=a(l[0].firstChild).is("pre");n.undoManager.add();l.empty();var p;if(k){p=a("<pre><br/></pre>").appendTo(l)}else{p=a("<p><br/></p>").appendTo(l)}n.selection.select(p[0],true);return tinymce.dom.Event.cancel(o)}}return true});function i(k){if(k.collapsed){return false}var l=function(o){return !o.previousSibling};var m=function(o){return !o.nextSibling};return k.startOffset===0&&h(k.startContainer,l)&&j(k.endContainer,k.endOffset)&&h(k.endContainer,m)}e._isMacroBodySelected=i;function h(k,l){if(!k){return false}if(a(k).is(".wysiwyg-macro-body")){return true}do{if(!l(k)){return false}k=k.parentNode}while(k&&!a(k).is(".wysiwyg-macro-body"));return true}function j(k,l){if(!k){return false}if(k.nodeType==3){return l===k.nodeValue.length}else{if(k.nodeType===1){if(k.childNodes.length===1&&a(k.firstChild).is("br")){return l===0}else{return l===k.childNodes.length}}else{return false}}}})();(function(){tinymce.isWebKit&&c(function(i,j){if(j.keyCode==46&&h(i.selection.getRng(true))){return tinymce.dom.Event.cancel(j)}});function h(j){if(!j.collapsed){return false}var k=j.startContainer.nodeType==3?j.startContainer.parentNode:j.startContainer,i=a(k);return j.startOffset===0&&g(k,"p")&&i.next().is("table")}e._isCursorInEmptyParagraphPrecedingPlaceholder=h})();(function(){tinymce.isWebKit&&tinymce.isMac&&c(function(n,o){var l=n.selection.getRng();if((o.metaKey||o.ctrlKey)&&o.shiftKey&&o.keyCode==b.LEFT){var m=j(l);if(m!==l){n.selection.setRng(m);return tinymce.dom.Event.cancel(o)}}});function h(l){if(!l||a(l.parentNode).is(".wysiwyg-macro td")){return null}if(a(l.parentNode).is("p")){return l.parentNode}return h(l.parentNode)}function k(l){if(!l){return null}if(l.nodeType==3){return l}return k(l.firstChild)||k(l.nextSibling)}function i(l){if(!l||l.nodeName=="PRE"||l.nodeName=="TD"){return null}if(l.nodeName=="BR"){return l}return i(l.previousSibling)||i(l.parentNode)}function j(l){var m,n;if(a(l.commonAncestorContainer).closest(".wysiwyg-macro td").length>0){if(!i(l.startContainer)){m=k(h(l.startContainer))}}if((n=a(l.commonAncestorContainer).closest(".wysiwyg-macro td > pre")).length>0){if(!i(l.startContainer)){m=k(n[0])}}if(m){l=l.cloneRange();l.setStart(m,0)}return l}e._selectTillStart=j})();(function(){d.onKeyDown.add(function(i,l){if(l.keyCode!=tinymce.VK.TAB){return}var h=i.selection.getRng(1),k=h.startContainer.nodeType==3?h.startContainer.parentNode:h.startContainer;if(a(k).is(".wysiwyg-macro-body > pre")){i.undoManager.beforeChange();i.undoManager.add();var j=i.getDoc().createTextNode("\t");h.insertNode(j);i.selection.setCursorLocation(j,1);i.undoManager.add();return tinymce.dom.Event.prevent(l)}})})()},_setTinymceControlsState:function(c,d){tinymce.each(c.controlManager.controls,function(e){e.setDisabled(!d)})},getInfo:function(){return{longname:"Macro Place Holder plugin",author:"Atlassian",authorurl:"http://www.atlassian.com",version:"1.0"}}});tinymce.PluginManager.add("macroplaceholder",tinymce.plugins.MacroPlaceHolderPlugin)})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/insertwiki/editor_plugin_src.js' */
(function(d,e,b){var c=!AJS.DarkFeatures.isEnabled("editor.insert-wiki-markdown");var a={DEFAULT:null,HELP_REST_API:AJS.contextPath()+"/plugins/tinymce/helplink.action",WIKI:{CONFLUENCE:{val:"CONFLUENCE",label:"Confluence wiki",helpLink:"help.insert.wiki.markup",restApi:"/rest/tinymce/1/wikixhtmlconverter"},MARKDOWN:{val:"MARKDOWN",label:"Markdown",helpLink:"help.insert.wiki.markup.markdown",restApi:"/rest/tinymce/1/markdownxhtmlconverter"}}};var f=new Confluence.localStorageCacheManager("insert-wiki-markup-dialog");d.create("tinymce.plugins.InsertWikiMarkupPlugin",{init:function(g,h){g.addCommand("InsertWikiMarkup",function(){var k={dialog:{id:"insert-wiki-markup-dialog",content:c?Confluence.Templates.InsertWiki.wikiMarkupDialog():Confluence.Templates.InsertWiki.originalDefaultTempWikiMarkupDialog(),width:980,height:500,popup:false,name:"confluence.conf_wikimarkup_desc"},markupEditId:"insert-wiki-textarea",previewAreaId:"insert-wiki-textarea-preview",selectionMenuId:"wiki-parser-selection-tool",serverRequestTimer:300,entityId:AJS.Meta.get("content-id"),spaceKey:AJS.Meta.get("space-key")};a.DEFAULT=a.WIKI[f.get("parser")||"CONFLUENCE"];var l={getElement:function(x){l[x]=l[x]||e(x);return l[x]}};var v=null;var t=function(z){var x=e(Confluence.Templates.InsertWiki.wikiParserSelector(a)),y=l.getElement("#insert-wiki-insert-title");y.append(x);return l.getElement("#"+k.selectionMenuId)};var w=function(D){var y=e("#wysiwygTextarea_ifr").contents().find("head").html(),A=Confluence.Templates.InsertWiki.previewWikiIframeContent(),z=e("<iframe tabindex='-1' />"),B,C,x;l.getElement("#"+D).append(z);B=z.contents();C=B[0];C.open();C.write(A);C.close();B.find("head").html(y);v=B.find("body")};var r=function(){var y=l.getElement("#"+k.selectionMenuId),x=y.length?y.val():a.DEFAULT.val;return x};var n=function(){return AJS.params.contextPath+a.WIKI[r()].restApi};var i=function(y){y=y||{};if(y.setBusy){g.windowManager.setBusy(k.dialog.id,true)}var x={wiki:y.textToConvert,entityId:k.entityId,spaceKey:k.spaceKey};e.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:y.API,data:e.toJSON(x),dataType:"text",success:y.successCallback,error:y.errorCallback||function(z){AJS.logError(z)},timeout:7500})};var m=function(z){var y,x;y=e(z);y.find("img").addClass("confluence-embedded-image");x=e("<div>").append(y.clone()).html();return x};var o=function(y){var x=k.dialog.id,z=r();g.windowManager.setBusy(x,false);d.EditorManager.activeEditor.windowManager.close(x);if(c){AJS.trigger("analytics",{name:"insert-wiki-markup-dialog."+z});if(z==="MARKDOWN"){y=m(y)}}g.execCommand("mceInsertContent",false,y);q(g)};var s=function(z,B,A){g.windowManager.setBusy(k.dialog.id,false);var x={warningMessage:d.EditorManager.activeEditor.getLang("confluence.conf_wikimarkup_errors"),exceptionMessage:B==="timeout"?d.EditorManager.activeEditor.getLang("confluence.conf_wikimarkup_timeout"):AJS.escapeHtml(B)+" : "+AJS.escapeHtml(A)};var y=Confluence.Templates.InsertWiki.wikiErrorSubDialog(x);d.EditorManager.activeEditor.windowManager.alert(y)};var j=function(){var x=l.getElement("#"+k.markupEditId),y=x.val();if(!e.trim(y)){v.html(y)}else{i({API:n(),textToConvert:y,successCallback:function(z){v.html(z)},errorCallback:function(){v.html(x.val())}})}};var u=function(z){var y=l.getElement("#"+k.dialog.id).find(".dialog-help-link"),x=a.WIKI[z].helpLink;y.load(a.HELP_REST_API,{linkUrlKey:x})};var p=function(){var x=r();f.put("parser",x);u(x);j()};var q=function(x,y){d.each(x.dom.select("p > p"),function(A){try{x.dom.split(A.parentNode,A)}catch(z){AJS.logError("insertwikimarkup - splitParas()",z)}})};g.windowManager.open(k.dialog,{buttons:[{label:"confluence.conf_insert_button_title",action:function(){i({API:n(),successCallback:o,errorCallback:s,textToConvert:l.getElement("#"+k.markupEditId).val(),setBusy:true})}}],plugin_url:h,helpLink:a.DEFAULT.helpLink,hintText:"confluence.conf_wikimarkup_hint",cssClass:"insert-wiki-markup-panel"});if(c){w(k.previewAreaId);t(k.dialog.id).on("change",p);l.getElement("#"+k.markupEditId).on("keydown",b.debounce(j,k.serverRequestTimer))}});g.addButton("insertwikimarkup",{title:"confluence.conf_wikimarkup_desc",cmd:"InsertWikiMarkup"})},getInfo:function(){return{longname:"InsertWikiMarkip",author:"Atlassian",authorurl:"http://www.atlassian.com",infourl:"http://www.atlassian.com/",version:"1.1"}}});d.PluginManager.add("insertwikimarkup",d.plugins.InsertWikiMarkupPlugin)})(tinymce,AJS.$,_);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/propertypanel/editor_plugin_src.js' */
(function(b){var a=[];AJS.bind("add-handler.property-panel",function(d,c){c&&a.push(c)});tinymce.create("tinymce.plugins.PropertyPanel",{init:function(c){AJS.debug("init property panel plugin");var h,d=function(){return !!b(".toolbar-contextual").length},j=function(k){return !!k.closest("table:not(.wysiwyg-macro,.editor-inline-macro)").length},g=function(k){if(k.type!="click"){return false}if(k.which){return(k.which==3)}if(k.button){return(k.button==2)}},f=function(k){if(k.is("img")){return k[0]}var l=k.closest("a,table,.wysiwyg-macro,.editor-inline-macro,.text-placeholder");if(l.length){return l[0]}return""},e=function(o,r,n){var l={focusedEl:n,focusedNodeName:n.nodeName&&n.nodeName.toLowerCase(),ed:o,e:b.extend({},r)};var q=f(b(n)),s=j(b(n)),k=d();l.containerEl=q;AJS.trigger("user-blurred-rte-element",l);if(q&&!g(r)&&!i()&&AJS.Confluence.PropertyPanel.shouldCreate){for(var m=0,p=a.length;m<p;m++){if(a[m].canHandleElement(b(q))){if(k||!s){return a[m].handle(l)}(function(t){AJS.$(document).bind("shown.contextToolbar",function(u){t.handle(l)})})(a[m])}}}},i=function(){return !!AJS.Confluence.PropertyPanel.current};if(tinymce.isIE){c.onMouseDown.add(function(k,l){h&&h.unbind("mouseup.IEDragHandlesWorkaround");h=AJS.$(l.target);h.filter("img, table").bind("mouseup.IEDragHandlesWorkaround",function(){e(k,l,l.target)})})}AJS.bind("trigger.property-panel",function(l,k){e(c,l,k.elem)});c.onClick.add(function(k,l){e(k,l,l.target)});c.onKeyUp.addToTop(function(k,l,m){if(l.keyCode===27){return}e(k,l,k.selection.getNode())});c.onContextMenu.add(function(){AJS.Confluence.PropertyPanel.destroy()});AJS.bind("user-blurred-rte-element",function(l,k){if(i()){if(!k.containerEl||AJS.Confluence.PropertyPanel.current.hasAnchorChanged(k.containerEl)){AJS.Confluence.PropertyPanel.destroy()}else{AJS.trigger("same-anchor.property-panel")}}});AJS.bind("created.property-panel",function(l,k){setTimeout(function(){AJS.Rte.bindScroll("property-panel",function(m){AJS.Confluence.PropertyPanel.destroy()})},0);AJS.$(c.getDoc()).bind("keydown.property-panel.escape",function(m){if(m.keyCode===27&&i()){AJS.Confluence.PropertyPanel.destroy()}})});AJS.bind("destroyed.property-panel",function(l,k){AJS.Rte.unbindScroll("property-panel");AJS.$(c.getDoc()).unbind("keydown.property-panel.escape")})},getInfo:function(){return{longname:"Image, Link and Macro Property Panels",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("propertypanel",tinymce.plugins.PropertyPanel)})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/confmonospace/editor_plugin_src.js' */
(function(a){tinymce.create("tinymce.plugins.ConfMonospacePlugin",{init:function(b,c){b.addCommand("confMonospace",function(){b.formatter.toggle("monospace",undefined)});tinymce.activeEditor.onInit.add(function(d){d.formatter.register({monospace:{inline:"code"}});d.editorCommands.addCommands({confMonospace:function(){return d.formatter.match("monospace")}},"state")});b.addButton("monospace",{title:"monospace",cmd:"confMonospace"})},getInfo:function(){return{longname:"Monospace Formatting",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("confmonospace",tinymce.plugins.ConfMonospacePlugin)})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/propertypanel/js/tinyMce-property-panel-links.js' */
(function(b){var a=0;AJS.Confluence.PropertyPanel.Link={name:"link",canHandleElement:function(c){return c.is("a")&&c.attr("href")!="#"&&!c.hasClass("unresolved")},handle:function(i){var h=i.containerEl;var d=i.ed,c=function(j){return AJS.Rte.getEditor().getLang(j)},e={anchorIframe:AJS.Rte.getEditorFrame()},f=b(h).attr("href").indexOf("#")==0,g=[{className:"link-property-panel-goto-button",text:c("propertypanel.links_goto"),tooltip:f?c("propertypanel.links_goto_disabled_tooltip"):h.href,href:h.href,disabled:f,click:function(){AJS.Confluence.PropertyPanel.destroy();var j=tinymce.isIE?"_blank":"confluence-goto-link-"+AJS.params.pageId+"-"+a;var k=window.open(h.href,j);if(k){k.focus()}}},{className:"link-property-panel-edit-button",text:c("propertypanel.links_edit"),tooltip:c("propertypanel.links_edit_tooltip"),disabled:b(h).hasClass("createlink")||!h.href,click:function(){AJS.Confluence.PropertyPanel.destroy();d.selection.select(h);Confluence.Editor.LinkBrowser.open()}},{className:"link-property-panel-unlink-button",text:c("propertypanel.links_unlink"),tooltip:c("propertypanel.links_unlink_tooltip"),click:function(){AJS.Confluence.PropertyPanel.destroy();d.execCommand("mceConfUnlink",false,h);d.focus()}}];AJS.Confluence.PropertyPanel.createFromButtonModel(this.name,h,g,e);a++}}})(AJS.$);AJS.bind("init.rte",function(){AJS.trigger("add-handler.property-panel",AJS.Confluence.PropertyPanel.Link)});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/propertypanel/js/tinyMce-property-panel-images.js' */
AJS.Confluence.PropertyPanel.Image=(function(g){var o={small:100,medium:300,large:500},k={small:".image-size-small",medium:".image-size-medium",large:".image-size-large",original:".image-size-original"},i=16,d=900;function p(){var q=[];g.each(k,function(r,s){q.push(s)});AJS.Confluence.PropertyPanel.current.panel.find(q.join(", ")).removeClass("selected")}function c(){return(g("#image-size-input").val())}function l(q,s){s=j(q,s);if(s){var r=!tinymce.confluence.ImageUtils.isRemoteImg(q.destination);delete q.height;q.width=s;q.thumbnail=r&&(s<=AJS.Meta.get("max-thumb-width"));e(q);p();return true}return false}function m(q,r){if(l(q,o[r])){a(r);e(q);return true}return false}function h(q){delete q.width;delete q.height;q.thumbnail=false;p();e(q);a("original");return true}function a(r){var q=AJS.Confluence.PropertyPanel.current.panel.find(k[r]);q.addClass("selected")}function f(q){g(".image-border-toggle").toggleClass("selected",!q.border);q.border=+!q.border||false;e(q)}function e(s){var q=AJS.Confluence.PropertyPanel.current,t=g(q.anchor),r=t.attr("src"),w=t.height();q.updating=true;var u=function(){q.updating=false;q.snapToElement({animate:true,animateDuration:100})};tinymce.confluence.ImageUtils.updateImageElement(t,s);if(tinymce.isGecko){AJS.Rte.getEditor().execCommand("mceRepaint",false)}if(s.src!=r){var v=setInterval(function(){var x=t.height();if(x!=w){AJS.debug("updateImageElement : height changed after image src change - "+w+" to "+x);clearTimeout(v);v=null;u()}},10);setTimeout(function(){if(v){clearTimeout(v);v=null;u()}},1000)}else{u()}n(s)}function n(q){var r=(q.width)?q.width:g(AJS.Confluence.PropertyPanel.current.anchor).width();r=Math.floor(r);g("#image-size-input").val(r+"px")}function j(q,r){r=parseInt(r);if(!isNaN(r)){if(r<i){r=i}else{if(r>d){r=d}}return r}else{return null}}function b(q){return{setPresetSize:function(r){m(q,r)},setPixelSize:function(r){l(q,r)},setToOriginalSize:function(){h(q)},toggleBorder:function(){f(q)},getWidth:function(){return q.width},getDisplayWidth:function(){return c()},isButtonSelected:function(r){return AJS.Confluence.PropertyPanel.current.panel.find(k[r]).hasClass("selected")}}}return{pluginButtons:[],name:"image",canHandleElement:function(q){return(q.is("img")&&!q.hasClass("editor-inline-macro")&&!q.hasClass("template-variable"))},handle:function(v){if(v.nodeName=="IMG"){var w=v}else{var w=v.containerEl}var r=g(w),t=tinymce.confluence.ImageProperties(w);if(!t){return}var x=AJS.Rte.getEditor(),s=function(D){return x.getLang(D)},B=function(D){return{className:"image-size-"+D,text:s("propertypanel.images_"+D),tooltip:s("propertypanel.images_"+D+"_tooltip"),click:function(E){m(t,D)},selected:t.width==o[D]}},y=[{className:"editable",tooltip:s("propertypanel.images_sizing_tooltip"),html:'<input id="image-size-input"/>'},null,B("small"),B("medium"),B("large"),{className:"image-size-original",text:s("propertypanel.images_original"),tooltip:s("propertypanel.images_original_tooltip"),click:function(D){h(t)},selected:!t.width&&!t.height&&!t.thumbnail},null,{className:"image-border-toggle",text:s("propertypanel.images_border"),tooltip:s("propertypanel.images_border_tooltip"),click:function(D){f(t)},selected:(t.border||t.border==1)}];y.push(null);var A=r.parent();if(A.is("a[href]")){y.push({className:"image-link-edit",text:s("propertypanel.images_link_edit"),tooltip:s("propertypanel.images_link_edit_tooltip"),click:function(){AJS.Confluence.PropertyPanel.destroy();x.selection.select(A[0]);Confluence.Editor.LinkBrowser.open()}});y.push({className:"image-link-remove",text:s("propertypanel.images_link_remove"),tooltip:s("propertypanel.images_link_remove_tooltip"),click:function(){AJS.Confluence.PropertyPanel.destroy();x.execCommand("mceConfUnlink",false,w);x.focus()}})}else{y.push({className:"image-make-link",text:s("propertypanel.images_link_create"),tooltip:s("propertypanel.images_link_create_tooltip"),click:function(){AJS.Confluence.PropertyPanel.destroy();x.selection.select(w);Confluence.Editor.LinkBrowser.open()}})}var z=AJS.Confluence.PropertyPanel.Image.pluginButtons;for(var u=0;u<z.length;u++){if(z[u]===null){y.push(null)}else{var C=z[u].create(r);if(C){y.push(C)}}}AJS.Confluence.PropertyPanel.createFromButtonModel(this.name,w,y,{anchorIframe:AJS.Rte.getEditorFrame()});var q=g("#image-size-input");q.bind("focus",function(){g(this).select()});q.bind("change",function(){l(t,c())?true:n(t)});AJS.Confluence.PropertyPanel.current.imageProps=t;n(t);return b(t)}}})(AJS.$);AJS.bind("init.rte",function(){AJS.trigger("add-handler.property-panel",AJS.Confluence.PropertyPanel.Image)});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/propertypanel/js/tinyMce-property-panel-macros.js' */
AJS.Confluence.PropertyPanel.Macro=(function(e){var d=[];var c=[];var f={};var b=".property-panel";var a="__PROPERTY_PANEL_SPACER";return{name:"macro",registeredEvents:d,canHandleElement:function(g){return(g.hasClass("editor-inline-macro")||g.hasClass("wysiwyg-macro"))},handle:function(p){if(p.e.type!="click"&&p.e.type!="mouseup"){return}var g=this;var n=p.containerEl;var k=e(n);var j;var o=[];var u=!k.hasClass("editor-inline-macro");var h=k.hasClass("wysiwyg-unknown-macro");var s=[];var v={originalHeight:u&&k.height(),anchorIframe:AJS.Rte.getEditorFrame()};var i=function(w,x){return w+"-button-click"+(x?x+".macro":"")+b};if(!h){j=k.attr("data-macro-name");if(AJS.MacroBrowser.getMacroMetadata(j)){o=AJS.MacroBrowser.getMacroMetadata(j).buttons}var q="macro-placeholder-property-panel-edit-button";if(o.length>0&&o[0].key==a){q+=" last"}s.push({className:q,text:"Edit",click:function(){AJS.Confluence.PropertyPanel.destroy();tinymce.confluence.macrobrowser.editMacro(k)}});e.each(o,function(x,y){if(y.key==a){return}var w="macro-property-panel-"+y.key;if(x>0&&o[x-1].key==a){w+=" first"}if(x<(o.length-1)&&o[x+1].key==a){w+=" last"}s.push({className:w,text:y.label,parameterName:y.key,click:function(){e(document).trigger(i(y.key),k);e(document).trigger(i(y.key,j),k);AJS.Confluence.PropertyPanel.destroy()}})})}var t="macro-placeholder-property-panel-remove-button";if(o.length>0&&o[o.length-1].key==a){t+=" first"}s.push({className:t,text:"Remove",click:function(){AJS.Confluence.PropertyPanel.destroy();AJS.Rte.getEditor().execCommand("mceConfRemoveMacro",n)}});if(k.attr("data-macro-parameters")){var l=Confluence.MacroParameterSerializer.deserialize(k.attr("data-macro-parameters"));if("atlassian-macro-output-type" in l){var r=function(w){return function(x){l["atlassian-macro-output-type"]=w;k.attr("data-macro-parameters",Confluence.MacroParameterSerializer.serialize(l));if(w=="INLINE"){e(".macro-placeholder-property-panel-display-newline-button").removeClass("selected")}else{e(".macro-placeholder-property-panel-display-inline-button").removeClass("selected")}e(x).addClass("selected")}};s.push(null);s.push({className:"macro-placeholder-property-panel-display-newline-button",tooltip:"\u663E\u793A\u65B0\u884C",selected:l["atlassian-macro-output-type"]=="BLOCK",click:r("BLOCK")});s.push({className:"macro-placeholder-property-panel-display-inline-button",tooltip:"\u663E\u793A\u5185\u8054",selected:l["atlassian-macro-output-type"]=="INLINE",click:r("INLINE")})}}e.each(d,function(){if(!this.macroName||this.macroName==j){e(document).bind(i(this.id,this.macroName),this.handler)}});var m=c;if(j&&f[j]){m=m.concat(f[j])}e.each(m,function(){try{this(n,s,v)}catch(w){AJS.debug("Property panel init handler failed for : "+j+".  Is global handler : "+(AJS.$.inArray(this,c)>-1),w)}});AJS.Confluence.PropertyPanel.createFromButtonModel("macro",n,s,v)},registerButtonHandler:function(i,g,h){d.push({id:i,handler:g,macroName:h})},registerInitHandler:function(g,h){if(h){f[h]=f[h]||[];f[h].push(g)}else{c.push(g)}},yieldButtonFor:function(g,h){var i;e.each(g,function(){if(this.parameterName&&this.parameterName==h){i=this}});return i}}})(AJS.$);AJS.bind("init.rte",function(){AJS.trigger("add-handler.property-panel",AJS.Confluence.PropertyPanel.Macro)});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/conftable/editor_plugin_src.js' */
(function(a){tinymce.create("tinymce.plugins.ConfluenceTablePlugin",{init:function(b,c){!tinymce.isIE8&&b.onKeyDown.add(function(h,i){if(!i.altKey||(i.keyCode!=38&&i.keyCode!=40)){return}var g=h.selection.getRng(true),d=a(g.startContainer).closest("td.confluenceTd, th.confluenceTh",".mceContent");if(d.length===0){return}h.execCommand(i.keyCode==38?"mceTableInsertRowBefore":"mceTableInsertRowAfter");var f=d.parent()[i.keyCode==38?"prev":"next"]().find("td:first-child")[0];g.setStart(f,0);g.setEnd(f,0);h.selection.setRng(g);return tinymce.dom.Event.prevent(i)})},getInfo:function(){return{longname:"Confluence Table Plugin",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("conftable",tinymce.plugins.ConfluenceTablePlugin)})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/deletecommand/editor_plugin_src.js' */
(function(a){tinymce.create("tinymce.plugins.DeleteCommandPlugin",{init:function(b){b.addCommand("mceDelete",function(e,d){function c(){if(tinymce.isWebKit){var g=b.selection.getRng(1);if(g.collapsed){return false}var f=a(g.startContainer).closest(".wysiwyg-macro-body",b.getBody())[0];if(f&&AJS.EditorUtils.isRangeAtStartOf(f,g)&&AJS.EditorUtils.isRangeAtEndOf(f,g)){var i=a(f.firstChild).is("pre"),j=(i?"pre":"p"),h=a("<"+j+"><br data-mce-bogus='1'></"+j+">")[0];a(f).html(h);b.selection.select(h,1);return true}}return false}if(!c()){b.getDoc().execCommand("Delete",e,d)}})},getInfo:function(){return{longname:"Delete Command Plugin",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("deletecommand",tinymce.plugins.DeleteCommandPlugin)})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/draggable/editor_plugin_src.js' */
(function(w){if(w.browser.msie&&w.browser.version<=8){return}var d="img.confluence-embedded-image,img.editor-inline-macro,table.wysiwyg-macro";var D="img";var e=10;var b,L,l,s,m,E,K,i,h,z,H,C,o,u;var y=[800,800,400,400,400,300,300,300,300,300,300,300,300,300,300,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100];function I(N){var O=0;return{scrollUp:function(P){var Q;if(O===-P){return}O=-P;Q=(N.scrollTop()/P)*1000;N.stop(false,false);N.animate({scrollTop:0},{duration:Q})},scrollDown:function(Q){var R,P;if(O===Q){return}O=Q;P=N[0].scrollHeight;R=((P-N.scrollTop())/Q)*1000;N.stop(false,false);N.animate({scrollTop:P},{duration:R})},cancelScrolling:function(){O=0;N.stop(true,false)},scrollHeight:function(){return N[0].scrollHeight}}}var k="div.innerCell,div.cell";var p="body";var A="p,h1,h2,h3,h4,h5,h6,blockquote,li,td,th,img";var g="li,td,th";var M="p,h1,h2,h3,h4,h5,h6,blockquote";var c="li,td,th";function B(aj){var ag=!!s.children(".contentLayout,.contentLayout2").length;function ab(){return l.find("#move-indicator")}function ac(){return ab().length>0}function W(ak){return ak.attr("id")==="move-indicator"}function ae(){return w('<span id="move-indicator">|</span>')}function U(al,ak){var an,am;an=aa(al,ak);if(an){ai(an.target,an.before)}}function aa(al,ak){var an=w(l[0].elementFromPoint(al,ak));var am=true;if(P(an)){return{target:an,before:N(an,al,ak)}}if(X(an)){an=ah(an);if(O(an,ak)){an=an.children().first()}else{if(S(an,ak)){an=an.children().last();am=false}else{if(R(an)){return null}else{an=Y(an);am=false}}}return{target:an,before:am}}return null}function P(ak){if(ak.is(A)&&!W(ak)){if(ak.is("td.wysiwyg-macro-body")){if(ak.closest("table").attr("data-macro-body-type")==="PLAIN_TEXT"){return false}}if(ak.is("img")&&!aj.is("img")){return false}return true}return false}function X(ak){if(ag){return ak.is(k)}return ak.is(p)}function ah(ak){if(ak.is("div.cell")){return ak.children("div.innerCell").first()}return ak}function Z(al){if(al.is(g)){var ak=al.children().first();if(ak.is(M)){al=ak}}return al}function O(al,ak){return af(al.children().first(),ak)<0}function S(al,ak){return Q(al.children().last(),ak)>0}function R(ak){return ac()&&(ab().parent(ak).length>0)}function Y(al){var ak=aj.parent(A);if(!ak.length){ak=al.find(A).last()}if(!ak.length){ak=s.find(A).last()}return ak}function ai(am,al){if(W(am)){return}var ak=ab();if(am.is(g)&&am.find(ak).length){return}if(!ak.length){ak=ae()}else{ak.detach()}am=Z(am);if(!am.is("img")&&AJS.Rte.Cursor.isTextContainerEmpty(am[0])){am.prepend(ak)}else{if(am.is(c)){if(al){am.prepend(ak)}else{am.append(ak)}}else{if(al){am.before(ak)}else{am.after(ak)}}}}function N(aq,an,am){if(aq.is("img")){var ap=T(aq,an);var al=aq.width();return ap<(al/2)}var ao=af(aq,am);var ak=aq.height();return ao<(ak/2)}function af(an,al){var ao=an.offset();var am=al+l.scrollTop();var ak=am-ao.top;return ak}function T(am,ak){var ao=am.offset();var al=ak+l.scrollLeft();var an=al-ao.left;return an}function Q(ao,an){var am=af(ao,an);var ak=ao.height();var al=am-ak;return al}function ad(al){var ak=ab();if(ak.length){if(al.is(D)&&X(ak.parent())){al=w("<p></p>").append(al)}ak.replaceWith(al);AJS.Rte.showElement(al);b.selection.select(al[0]);b.selection.collapse(true)}else{AJS.debug("No cursor - abort drop");b.undoManager.undo()}AJS.Rte.Cursor.fixCursorTargets(AJS.Rte.getEditor().getBody())}function V(){var ak=ab();if(ak.length){ak.remove();AJS.Rte.Cursor.fixCursorTargets(AJS.Rte.getEditor().getBody())}}return{positionNear:U,replaceWith:ad,destroy:V}}function n(N){H=N.attr("style")||"";return N}function v(N){if(N.which!=1){return}if(N.target!=N.currentTarget){return}if(z){G(N);return}z=w(N.target);b.selection.select(N.target);N.preventDefault();l.bind({"mousemove.moveable-zone":j,"mouseup.moveable-zone":G,"keydown.moveable-zone":x,"mouseover.moveable-zone":J});var O=z.offset();i=N.pageX;h=N.pageY;E=O.top-h;K=O.left-i;C=true;z=n(z)}function x(N){if(N.keyCode==27){r(N)}}function J(){l.find(".mceSelected").removeClass("mceSelected")}function q(P){var O=Math.abs(i-P.pageX);var N=Math.abs(h-P.pageY);return O<e&&N<e}function j(P){var O,N;if(C){if(q(P)){return}AJS.Rte.BookmarkManager.storeBookmark();b.undoManager.beforeChange();b.undoManager.typing=true;b.undoManager.add();a();z.css({position:"absolute",width:z.css("width"),"max-width":"50%"});AJS.Confluence.PropertyPanel.current&&AJS.Confluence.PropertyPanel.destroy();z.detach();AJS.Rte.Cursor.fixCursorTargets(AJS.Rte.getEditor().getBody());s.append(z);u=B(z);C=false}P.preventDefault();z.hide();F(P.clientX,P.clientY);u.positionNear(P.clientX,P.clientY);O=Math.min(P.pageY+E,o.scrollHeight()-z.outerHeight());N=P.pageX+K;z.css({top:O,left:N,opacity:0.5});z.show()}function a(){var N=b.selection.getSel();N&&N.removeAllRanges&&N.removeAllRanges()}function F(Q,P){var R,O;var N=y.length;P=Math.max(P,0);if(P<N){o.scrollUp(y[P]);return}R=L.height();O=Math.max(0,R-P);if(O<N){o.scrollDown(y[O]);return}o.cancelScrolling()}function G(N){l.unbind(".moveable-zone");o.cancelScrolling();if(C){z=null;return}N.preventDefault();z.detach();z.attr("style",H);u.replaceWith(z);u.destroy();z=null;u=null;J();b.undoManager.add()}function r(N){o.cancelScrolling();l.unbind(".moveable-zone");b.undoManager.undo();b.selection.select(z[0]);b.selection.collapse(false);z=null}function t(){l.delegate(d,{mousedown:v})}function f(N){N.preventDefault()}tinymce.create("tinymce.plugins.draggable",{init:function(N,O){b=N;N.onInit.add(function(Q,P){var R;L=w(N.getWin());l=w(N.getDoc());s=w(N.getBody());m=w(L[0].parent);if(w.browser.webkit){R=s}else{R=l.find("html")}o=I(R);t()})},getInfo:function(){return{longname:"Draggable objects (images, tables, placeholders) around the document via drag and drop",author:"Atlassian",authorurl:"http://www.atlassian.com",version:"1.0"}}});tinymce.PluginManager.add("draggable",tinymce.plugins.draggable)})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/atlassian/atlassian-editor.js' */
(function(a){function b(c){c=c&&c.jquery?c[0]:c;if(!c){return false}if(c.tagName==="BR"||c.nodeType==3){c=c.parentNode}if(c&&c.nodeType==9){c=null}return c}AJS.Rte=a.extend({HIDDEN_CHAR:"\ufeff",ZERO_WIDTH_WHITESPACE:"&#x200b;",editorId:"wysiwygTextArea",getEditor:function(){return tinyMCE.activeEditor},getCurrentBaseUrl:function(){if(!this.currentBaseUrl){var c=document.location;this.currentBaseUrl=c.protocol+"//"+c.hostname+(c.port?":"+c.port:"")}return this.currentBaseUrl},showSelection:function(c){AJS.Rte.showElement(tinyMCE.activeEditor.selection.getStart(),c)},isAnyPartShown:function(g){g=b(g);if(!g){AJS.debug("AJS.Rte.isAnyPartShown: no element to find");return false}var e=a(g);var d=e.offset().top;var h=d+e.outerHeight();var c=a(AJS.Rte.getEditor().getDoc()).scrollTop();var f=c+a(AJS.Rte.getEditorFrame()).height();return h>c&&d<f},showElement:function(j,h){var k=b(j);if(!k){AJS.log("AJS.Rte.showElement: no element to show - skipping");return false}var d=a(k);var i=AJS.Rte.getEditor();var n=a(i.getDoc());var l=d.offset().top;var c=l+d.outerHeight();var f=n.scrollTop();var g=f+a(AJS.Rte.getEditorFrame()).height();var m=function(){AJS.Rte.bindScroll("AJS.Rte.showElement",function(){AJS.Rte.unbindScroll("AJS.Rte.showElement");setTimeout(h,1)})};if(l<f){AJS.Rte.scrollTo(l);h&&m()}else{if(c>g){AJS.Rte.scrollTo(Math.min(l,f+c-g));h&&m()}else{h&&h()}}},scrollTo:function(d){var c=AJS.Rte.getEditor();d=Math.ceil(d);a(c.getDoc()).scrollTop(d)},bindScroll:function(d,e){var c=AJS.Rte.getEditor();a(document).add(c.getDoc()).add(c.getWin()).bind("scroll."+d,e)},unbindScroll:function(d){var c=AJS.Rte.getEditor();a(document).add(c.getDoc()).add(c.getWin()).unbind("scroll."+d)},getMainEditor:function(){var c=tinymce.EditorManager.editors[AJS.Rte.editorId];if(!c){throw new Error("Main editor has not been initialised yet and is therefore not accessible via tinymce.EditorManager.editors")}return c},getEditorContainer:function(){return a("#wysiwyg")},getEditorFrame:function(){return a("#"+AJS.Rte.getEditor().id+"_ifr")[0]},getEditorTable:function(){return a("#"+AJS.Rte.getEditor().id+"_tbl")},webResourcePath:"/download/resources/com.atlassian.confluence.tinymceplugin%3Atinymceeditor/",getResourceUrlPrefix:function(){if(!this.resourceUrlPrefix){this.resourceUrlPrefix=this.getCurrentBaseUrl()+AJS.Meta.get("editor-plugin-resource-prefix")}return this.resourceUrlPrefix},getTinyMceBaseUrl:function(){if(!this.absoluteUrl){this.absoluteUrl=this.getResourceUrlPrefix()+this.webResourcePath+"tinymcesource/"}return this.absoluteUrl},getMinEditorHeight:function(){return +AJS.Meta.get("min-editor-height")},getTinyMceEditorMinHeight:function(d){d=d||0;var c=AJS.Rte.getMinEditorHeight(),e=0;if(c){return c}a("#editor-precursor,#header-precursor,#header").each(function(){e+=a(this).outerHeight(true)});return(a(window).height()-e-d)},fixEditorFocus:function(e){var d=AJS.Rte.getEditor(),c=d.getBody();if(!tinyMCE.isGecko){return}AJS.log("Fixing FF cursor positioning");if(c.contentEditable=="true"){c.contentEditable=false;c.contentEditable=true}}},AJS.Rte);tinymce.VK=jQuery.extend({BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESCAPE:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,META:91},tinymce.VK)})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/atlassian/atlassian-editor-content.js' */
(function(a){AJS.Rte.Content={offset:function(e){var c=a(e),i=c.offset(),h=a(AJS.Rte.getEditorFrame()),b=h.offset(),f=h[0].contentWindow.document,g=a(AJS.Rte.getEditor().getBody()),d={top:(jQuery.support.boxModel&&f.documentElement.scrollTop||g.scrollTop()),left:(jQuery.support.boxModel&&f.documentElement.scrollLeft||g.scrollLeft())};return{top:i.top-d.top+b.top,left:i.left-d.left+b.left}},getSelectedText:function(){var b=AJS.Rte.getEditor(),c=b.selection;return c.getRng().text||(c.getSel()&&c.getSel().toString&&c.getSel().toString())||""},setHtml:function(b){if(b){AJS.Rte.getEditor().setContent(b)}},getHtml:function(){return""+AJS.Rte.getEditor().getContent()},isEmpty:function(){var b=AJS.Rte.getEditor().getContent().replace("&nbsp;"," ");return !AJS.$.trim(b)},editorHasContentChanged:function(){return AJS.Rte.getEditor().isDirty()},editorResetContentChanged:function(){AJS.Rte.getEditor().setDirty(false)},getChildIndex:function(c,f){var e=c.childNodes;for(var d=0,b=e.length;d<b;d++){if(e[d]==f){return d}}return -1}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/atlassian/atlassian-editor-bookmark-manager.js' */
(function(){var a;AJS.Rte.BookmarkManager={storeBookmark:function(){var f=tinyMCE.activeEditor,c=tinyMCE.DOM.getViewPort(tinyMCE.activeEditor.getWin()),e,b,d;f.focus();e=f.selection;b=e.getRng();if(b.cloneRange&&typeof b.cloneRange=="function"){d=b.cloneRange()}else{d=b.duplicate&&b.duplicate()||b}a={scrollX:c.x,scrollY:c.y,range:d}},restoreBookmark:function(){var b=tinyMCE.activeEditor.selection,c=tinyMCE.activeEditor.getWin();if(a){c.scrollTo(a.scrollX,a.scrollY);c.focus();b.setRng(a.range)}}}})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/atlassian/atlassian-editor-support.js' */
(function(a){AJS.Rte.Support={inlineTasks:function(){var b=AJS.Meta.get("use-inline-tasks");return b==="true"||b===true}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/atlassian/tinyMce-eventDelegator.js' */
AJS.Rte.EventDelegator=function(b){var a={},d={},c=function(f,l){var h,k;for(k in a){if(a.hasOwnProperty(k)&&a[k].isEnabled){for(var g=0,j=a[k].events.length;g<j;g++){h=a[k].events[g];if(h.type.toLowerCase().indexOf(l.type)>-1){if(h.shouldTrigger(f,l)){h.callback.apply(this,[l.target])}else{h.missed&&h.missed()}}}}}};return{addEventsForComponent:function(e,g){if(!(e in a)){a[e]={};a[e].events=[];a[e].isEnabled=true}var j,k;for(var f=0,h=g.length;f<h;f++){j=null;!(g[f].type in d)&&(function(){d[g[f].type]=true;b[g[f].type].add(c)})();if(!(typeof(g[f].shouldTrigger)=="function")){(function(i){g[f].shouldTrigger=function(l,m){return m.target.tagName.toLowerCase()==i}})(g[f].shouldTrigger)}a[e].events.push(g[f])}},disableEventsForComponent:function(e){for(var f=0,g=a.length;f<g;f++){if(e in a){a[e].isEnabled=false;return true}}return false},enableEventsForComponent:function(e){for(var f=0,g=a.length;f<g;f++){if(e in a){a[e].isEnabled=true;return true}}return false}}};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/atlassian/tinymce-cursor.js' */
(function(e){function c(l){if(e(l).closest("td").length==0){return true}var k=l.parentNode;while(k.nodeName.toLowerCase()!="td"){var j=e(k).prevAll().contents().filter(function(){return this.nodeType==3});if(j.length){return false}k=k.parentNode}return true}function f(k,j,o){if(j.compareEndPoints){var n=k.getBody().createTextRange();n.moveToElementText(o);n.collapse(1);return j.compareEndPoints("StartToStart",n)===0&&c(o)}if(!k.selection.getSel().isCollapsed){return false}function l(p){return p.nodeType==3&&p.nodeValue=="\n"}var m=j.startContainer;if(m.nodeType==3){return !m.previousSibling&&j.startOffset===0&&c(m)}else{if(e(m).is("p:first-child")){return j.startOffset===0}else{if(e(m).is(".wysiwyg-macro-body")){return j.startOffset==1&&l(j.startContainer.childNodes[0])}}}}function a(k,j,m){if(j.compareEndPoints){var o=k.getBody().createTextRange();o.moveToElementText(m);o.collapse(0);return j.compareEndPoints("EndToEnd",o)===0}if(!k.selection.getSel().isCollapsed){return false}var n=j.endContainer;if(n.nodeType==3){return(n.wholeText.length==j.endOffset)}var l=n.childNodes[j.endOffset];return e(l).is(":last-child")}function h(k,j,l){var m=k.dom.create("p",0,tinymce.isIE?"&nbsp;":'<br data-mce-bogus="1" />');if(l){j.after(m)}else{j.before(m)}k.selection.select(m,true);k.selection.collapse()}function g(j){var k=j.contents();if(!k.length){return true}if(k.length==1){if(k.is("br")){return true}else{if(k.html()=="&nbsp;"||k.text().charCodeAt(0)==160){return true}else{if(k[0].nodeType==3&&k[0].nodeValue==AJS.Rte.HIDDEN_CHAR){return true}}}}return false}function d(j,k){return j.getBody().firstChild==k}function b(j,k){return j.getBody().lastChild==k}function i(){var j=AJS.Rte.getEditor();tinymce.isIE&&j.onKeyPress.add(function(k,o){var l=k.selection,n=l.getNode();if(o.keyCode==13&&n.nodeName=="P"&&k.dom.is(n,":first-child")&&tinymce.confluence.MacroUtils.isInMacro(n)){var m=k.dom.create("p","&#x200b");k.dom.insertAfter(m,n);l.select(m,1);l.collapse();return tinymce.dom.Event.cancel(o)}});tinymce.isGecko&&j.onKeyPress.add(function(l,o){var n,m,k;if(o.charCode==e.ui.keyCode.SPACE){n=l.selection.getNode();m=e(n).closest("a");k=l.selection.getRng();if(m.length&&a(l,l.selection.getRng(),n)){k.setStartAfter(m[0]);k.setEndAfter(m[0]);l.selection.setRng(k);l.selection.collapse()}}});j.onKeyPress.addToTop(function(k,o){if(o.keyCode==13&&!o.shiftKey){var m=k.selection.getNode(),n=e(m).closest("pre");if(n.length&&!tinymce.confluence.MacroUtils.isInMacro(n)&&a(k,k.selection.getRng(),m)){h(k,n,true);return tinymce.dom.Event.cancel(o)}var p=e(m).closest("blockquote");if(p.length){var l=e(m).closest("p");if(l.is(":first-child")&&f(k,k.selection.getRng(),m)){h(k,p,false);return tinymce.dom.Event.cancel(o)}if(l.is(":last-child")&&g(l)){k.dom.remove(l[0],false);h(k,p,true);return tinymce.dom.Event.cancel(o)}}}return true})}AJS.Rte=AJS.Rte||{};AJS.Rte.Cursor=AJS.Rte.Cursor||{};e.extend(AJS.Rte.Cursor,{insertParagraph:h,isCursorAtStart:f,isCursorAtEnd:a});AJS.bind("init.rte",i)})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/atlassian/plugins/showformat/editor_plugin_src.js' */
(function(c){var b="editor.showformat.show-eol-markers";var d="show-eol-markup";tinymce.create("tinymce.plugins.ShowFormat",{init:function(e){if(!AJS.DarkFeatures.isEnabled("editor.show-formatting")){return}c("#rte-show-eol-markers-button").click(a);if(AJS.Cookie.read(b)==="true"){c(a)}},getInfo:function(){return{longname:"Show Format Plugin",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});function a(){var f=c(AJS.Rte.getEditor().getBody());var e=c("#rte-show-eol-markers-button");e.toggleClass("active");if(e.hasClass("active")){f.addClass(d);AJS.Cookie.save(b,"true")}else{f.removeClass(d);AJS.Cookie.erase(b)}}tinymce.PluginManager.add("showformat",tinymce.plugins.ShowFormat)})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/atlassian/plugins/highlightnode/editor_plugin_src.js' */
(function(a){tinymce.create("tinymce.plugins.ShowCurrentNode",{init:function(c){AJS.debug("Hightlight Current Node Plugin");var d=["strong","em","u","s","sub","sup","a","code","h1","h2","h3","h4","h5","h6","pre"];var b={strong:"Bold",em:"Italic",u:"Underline",s:"Strikethrough",sub:"subscript",sup:"superscript"};c.onNodeChange.add(function(g,f,j){var i=a(j);$oldCurrentElement=a(".highlight-marker",g.getBody());var h=(a.inArray(j.nodeName.toLowerCase(),d)!=-1)&&!(j.nodeName.toLowerCase() in b&&!g.queryCommandState(b[j.nodeName.toLowerCase()]))&&!(!(j.nodeName.toLowerCase() in b)&&!g.formatter.match(j.nodeName.toLowerCase()));if(i.hasClass("highlight-marker")&&h){return}if($oldCurrentElement){$oldCurrentElement.removeClass("highlight-marker")}if(!h){return}i.addClass("highlight-marker")});var e=function(f){$highlightedElement=a(".highlight-marker",f);$highlightedElement.each(function(){a(this).removeClass("highlight-marker")})};a(document).bind("mode-changed",function(f,g){if(g==="preview"){e(a("iframe").contents().find("#content"))}});c.onSaveContent.add(function(f,g){$content=a("<div>"+g.content+"</div>");e($content);g.content=$content[0].innerHTML})},getInfo:function(){return{longname:"Atlassian Show Current Node",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});if(AJS.DarkFeatures.isEnabled("highlightnode")){tinymce.PluginManager.add("highlightnode",tinymce.plugins.ShowCurrentNode)}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/atlassian/plugins/iosediting/editor_plugin_src.js' */
(function(a){tinymce.create("tinymce.plugins.iOSEditing",{init:function(b){if(tinymce.isIDevice){setTimeout(function(){var c=a(AJS.Rte.getEditor().getBody());c.addClass("ios")},0)}},getInfo:function(){return{longname:"iOS Comments Plugin",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("iosediting",tinymce.plugins.iOSEditing)})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/atlassian/tinymce-bootstrap.js' */
(function(c){var b={atlassian:true,keep_values:true,convert_urls:true,relative_urls:false,remove_script_host:false,button_tile_map:true,gecko_spellcheck:true,apply_source_formatting:false,list_outdent_on_enter:true,visual:false,confluence_table_style:"confluenceTable",confluence_table_cell_style:"confluenceTd",confluence_table_heading_style:"confluenceTh",confluence_table_default_rows:4,confluence_table_default_cols:3,confluence_table_default_heading:true,cleanup:true,cleanup_on_startup:true,fix_list_elements:false,fix_table_elements:true,valid_elements:"@[id|class|style|title|wysiwyg|dir<ltr?rtl|lang|xml::lang|onclick|ondblclick|onmousedown|onmouseup|onmouseover|onmousemove|onmouseout|onkeypress|onkeydown|onkeyup],a[*],strong/b,em/i,s,u,#p[align|user],-ol[type|compact],-ul[type|compact],li,br,img[imagetext|longdesc|usemap|src|border|alt=|title|hspace|vspace|width|height|align],-sub,-sup,-blockquote[cite|markup],-table[*],-tr[rowspan|width|height|align|valign|bgcolor|background|bordercolor],tbody,thead,tfoot,#td[colspan|rowspan|width|height|align|valign|bgcolor|background|bordercolor|scope],#th[colspan|rowspan|width|height|align|valign|scope],caption,div[*],#span[*],-code,#pre[*],address,-h1,-h2,-h3,-h4,-h5,-h6,hr[size|noshade],-font[face|size|color],dd,dl,dt,cite,abbr,acronym,del[datetime|cite],ins[datetime|cite],object[classid|width|height|codebase|*],param[name|value],embed[type|width|height|src|*],map[name],area[shape|coords|href|alt|target],bdo,button,col[align|char|charoff|span|valign|width],colgroup[align|char|charoff|span|valign|width],dfn,fieldset,form[action|accept|accept-charset|enctype|method],input[accept|alt|checked|disabled|maxlength|name|readonly|size|src|type|value],kbd,label[for],legend,noscript,optgroup[label|disabled],option[disabled|label|selected|value],q[cite],samp,select[disabled|multiple|name|size],small,textarea[cols|rows|disabled|name|readonly],tt,var,big",extended_valid_elements:"img[*],time[class|datetime|contenteditable|onselectstart|unselectable|oncontrolselect]",formats:{removeformat:[{selector:"h1,h2,h3,h4,h5,h6,pre",remove:"all",split:true,expand:false,block_expand:true,deep:true,block:"*"},{selector:"address,article,b,big,blockquote,center,cite,code,date,dd,del,dfn,dl,dt,em,embed,font,footer,header,hgroup,i,ins,kbd,link,menu,nav,object,param,q,s,samp,script,section,small,strike,strong,style,sub,sup,time,tt,u,var",remove:"all",split:true,expand:false,block_expand:true,deep:true},{selector:"span",attributes:["style","class"],remove:"empty",split:true,expand:false,deep:true},{selector:"table",attributes:["cellpadding","cellspacing","border"],split:false,expand:false,deep:true},{selector:"*",attributes:["style","color","bgcolor","title","lang"],split:false,expand:false,deep:true}]},forced_root_block:"p",force_p_newlines:true,force_br_newlines:false,oninit:"AJS.Rte.BootstrapManager.onInit",object_resizing:false,paste_preprocess:function(d,e){c(document).trigger("prePaste",[d,e])},paste_postprocess:function(d,e){c("img",e.node).not("[data-emoticon-name]").not(".editor-inline-macro").not(".confluence-embedded-image").not(".template-variable").addClass("confluence-embedded-image confluence-external-resource");c(document).trigger("postPaste",[d,e])}};var a=function(h){if(typeof TinyMCELang==undefined){AJS.log("ERROR: could not find the TinyMCE language pack")}var g=new RegExp(TinyMCELang.ctrl_key+"\\+","g"),d=new RegExp(TinyMCELang.shift_key+"\\+","g");var i=function(k){return k.replace(g,"\u2318").replace(d,"\u21E7")};for(var f in TinyMCELang){var e=TinyMCELang[f];if(typeof e=="object"){for(var j in e){if(tinymce.isMac){e[j]=i(e[j])}}}tinymce.EditorManager.addI18n(h+"."+f,TinyMCELang[f])}if(tinymce.isMac){c("#rte-toolbar .toolbar-item, #rte-toolbar .dropdown-item, #rte-savebar .aui-button").each(function(){var l=c(this),m=l.attr("title"),k=l.attr("data-tooltip");if(m){l.attr("title",i(m))}if(k){l.attr("data-tooltip",i(k))}})}};AJS.Rte.BootstrapManager={_tinyMceHasInit:false,_beforeInitCallbacks:[],_tinymcePluginInits:[],_settings:null,isInitComplete:function(){return this._tinyMceHasInit},isEditorActive:function(){return this.isInitComplete()&&tinyMCE&&tinyMCE.activeEditor},onInit:function(){this._tinyMceHasInit=true;var i=AJS.Rte.getEditor();var h=c.browser.msie&&(parseInt(c.browser.version)==7);var e=AJS.params.contentType=="comment"&&AJS.params.editorMode=="richtext";AJS.trigger("init.rte",{editor:i});var k=AJS.Meta.get("editor-auto-focus")!==false;if(!k){AJS.debug("Bootstrap: editor-auto-focus=false. Do not focus the editor automatically.")}if(!(h&&e)&&k){setTimeout(function(){i.focus()},0)}if(tinymce.isGecko){var m=i.getDoc(),l=i.getBody(),g=i.settings;if(!g.readonly){if(l.contentEditable=="true"){if(k){var f=AJS.Rte.getEditor().selection;var d=f.getRng();d.setEnd(d.startContainer,0);f.setRng(d)}}try{m.execCommand("styleWithCSS",0,false)}catch(j){if(!i._isHidden()){try{m.execCommand("useCSS",0,true)}catch(j){}}}if(!g.table_inline_editing){try{m.execCommand("enableInlineTableEditing",false,false)}catch(j){}}if(!g.object_resizing){try{m.execCommand("enableObjectResizing",false,false)}catch(j){}}}}tinymce.dom.DOMUtils.prototype.getRoot=function(){function o(){var q=c(i.selection.getNode()).closest("div.innerCell");if(!!q.length){return q[0]}return p.doc.body}var p=i.dom,n=p.settings;return(n&&p.get(n.root_element))||o()};tinymce.dom.DOMUtils.prototype.setRoot=function(n){i.dom.settings.root_element=n}},addOnInitCallback:function(d){if(c.isFunction(d)){if(this._tinyMceHasInit){d()}else{AJS.bind("init.rte",d)}}else{throw new Error("Attempt made to register an oninit callback that is not a function. Received: "+d)}},addBeforeInitCallback:function(d){this._beforeInitCallbacks.push(d)},addTinyMcePluginInit:function(d){this._tinymcePluginInits.push(d)},preInitialise:function(d){this._settings=c.extend(b,d)},initialise:function(){if(!this._settings){AJS.log("Bootstrap:initialise: No settings found. Has preInitialise been called?");return}AJS.debug("Bootstrap:initialise: Initialising TinyMce version "+tinymce.majorVersion+"."+tinymce.minorVersion);c.each(this._beforeInitCallbacks,function(f,g){g(AJS.Rte.BootstrapManager._settings)});AJS.debug("Bootstrap:initialise: executing tinymcePluginInits");for(var d=0,e=this._tinymcePluginInits.length;d<e;d++){if(typeof this._tinymcePluginInits[d]=="function"){this._tinymcePluginInits[d](this._settings)}}AJS.debug("Bootstrap: set locale translations");a(this._settings.language);tinyMCE.init(this._settings);AJS.debug("Bootstrap:initialise: After editor TinyMCE init.");AJS.Rte.Content.editorResetContentChanged();c(AJS.Rte.getEditorFrame()).attr("tabindex",100);if(tinymce.isIE){c(AJS.Rte.getEditorFrame()).attr("hidefocus","hidefocus")}AJS.trigger("rte-ready")}};AJS.debug("AJS.Rte.BootstrapManager created")})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/atlassian/editor-utils.js' */
AJS.EditorUtils=(function(c){var a=true;function d(e){return e&&e.nodeType==3&&e.nodeValue.length===0}var b={isCursorAtStartOf:function(f,e){return e.collapsed&&b.isRangeAtStartOf(f,e)},isRangeAtStartOf:function(h,f){if(!f||!f.startContainer){throw new Error("range is invalid. received: "+f)}if(!h||!h.nodeType){throw new Error("context is invalid. received: "+h)}var g=f.startContainer,j;if(g.nodeType==3){if(f.startOffset!==0){return false}j=g}else{j=g.childNodes[f.startOffset];if(j===undefined&&g.childNodes.length>0){return false}}var i=new tinymce.dom.TreeWalker(j,h),e;do{e=i.prev(a)}while(d(e));return e===undefined},isCursorAtEndOf:function(f,e){return e.collapsed&&b.isRangeAtEndOf(f,e)},isRangeAtEndOf:function(g,f){if(!f||!f.endContainer){throw new Error("range is invalid. received: "+f)}if(!g||!g.nodeType){throw new Error("container is invalid. received: "+g)}var h=f.endContainer,e;if(h.nodeType==3){if(f.endOffset!=h.nodeValue.length){return false}e=h}else{e=h.childNodes[f.endOffset===0?f.endOffset:f.endOffset-1]}var j=new tinymce.dom.TreeWalker(e,g),i;do{i=j.next(a)}while(d(i));return i===undefined||(i.nodeName=="BR"&&j.next(a)===undefined)},setCursorAtStartOfContents:function(f){if(!f){throw new Error("element is required.")}if(f.nodeType!==1&&f.nodeType!=3){throw new Error("invalid argument: expected a DOM element or text node, got: "+f)}var g=tinymce.activeEditor,e=g.dom.createRng();if(c(f).is("br, img")){e.setStartBefore(f);e.setEndBefore(f);g.selection.setRng(e)}else{g.selection.select(f,true);g.selection.collapse(true)}}};return b})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/table/atlassian-table.js' */
(function(e){function g(){return AJS.$("#table-highlight-group").attr("data-highlight-colour")||""}function i(){return !!AJS.$("#table-highlight-group").attr("data-remove-highlight")}function f(){return !g()}function a(k){var l;b(k);if(!f()){l=g();k.attr("data-highlight-colour",l);k.addClass("highlight-"+l)}}function b(n){var o,m,k,p;for(o=0,m=n.length;o<m;o++){k=n.eq(o);p=k.attr("data-highlight-colour");if(p){k.removeClass("highlight-"+p);k.removeAttr("data-highlight-colour")}}}function j(p){var n=g();var m,k,o;for(m=0,k=p.length;m<k;m++){o=p.eq(m).attr("data-highlight-colour")||"";if(o!==n){return false}}return true}function h(k){var l=e(AJS.Rte.getEditor().selection.getNode());if(!l.length){return false}if(l[0]===k[0]){return true}return !!l.closest(k).length}function d(w,v){if(!w.length){return}var p=AJS.Rte.getEditor();var r=h(w);var o=w[0];var t=o.ownerDocument;var k=t.createElement(v);var u=o.attributes;for(var n=0,m=u.length;n<m;n++){var q=u[n];k.setAttribute(q.nodeName,q.nodeValue)}while(o.hasChildNodes()){k.appendChild(o.firstChild)}var s;o.parentNode.replaceChild(k,o);if(r){p.selection.select(k,true);p.selection.collapse()}return e(k)}AJS.Rte=AJS.Rte||{};AJS.Rte.Table={convertToNormalCells:function(k){k.filter("th").each(function(){var l=e(this);l=d(l,"td");l.removeClass("confluenceTh");l.addClass("confluenceTd")})},convertToHeadingCells:function(k){k.filter("td").each(function(){var l=e(this);l=d(l,"th");l.removeClass("confluenceTd");l.addClass("confluenceTh")})},areCellsHeadings:function(l){var m=l.filter("th");var k=m.length;return(l.length==k)},isColumnHeading:function(l,k){var n=e(l).children("tbody").children("tr");if(n.length==1){return false}var m=n.children().nthCol(k).filter("th");return(m.length===n.length)},areCellsHighlighted:function(k){var m=k.filter("td[data-highlight-colour],th[data-highlight-colour]");var l=m.length;return(k.length===l&&j(m))},isColumnHighlighted:function(s,m){var q=e(s).children("tbody").children("tr").children("th,td").nthCol(m);var r=q.filter("td[data-highlight-colour],th[data-highlight-colour]");var p=r.length;if(q.length!==p){return false}var o=q.eq(0).attr("data-highlight-colour");for(var n=1,k=q.length;n<k;n++){if(o!==q.eq(n).attr("data-highlight-colour")){return false}}return true}};function c(r,m){var s,p=m.editor,n=function(w){var u=e(w.getBody()).find("td.mceSelected,th.mceSelected");if(!u.length){u=e(w.selection.getNode())}var y=u.closest("tr"),v=y.parent(),x=v.is("tbody")?y.parent().parent():v;while(y.length!=0&&!x.is(".confluenceTable")){y=x.closest("tr");v=y.parent();x=v.is("tbody")?y.parent().parent():v}return y},q=function(u){return e(u.selection.getNode()).closest("th.confluenceTh,td.confluenceTd")},l=function(v){var u=e(v.getBody()).find("th.confluenceTh.mceSelected,td.confluenceTd.mceSelected");if(u.length){return u}return q(v)},o=function(u){return u.find("tbody > tr > td").length===0};p.addCommand("mceInsertTable",function(v,w){AJS.Rte.BookmarkManager.storeBookmark();if(!s){s=new AJS.Dialog({width:400,height:230,id:"insert-table-dialog",keypressListener:function(x){if(x.keyCode===27){s.hide()}}});s.addHeader("Insert Table");s.addPanel("Panel 1","panel1");s.getCurrentPanel().html(AJS.renderTemplate("tableForm","4","3"));e("#tinymce-table-form input[type='text']").click(function(){e(this).select()});var u=function(x){x.hide();p.plugins.table.insertTable()};e("#tinymce-table-form").keypress(function(x){if(x.keyCode==13){u(s)}});s.addButton("Insert",u,"ok");s.addCancel("Cancel",function(x){x.hide();return false},"cancel")}s.show()});p.addCommand("confTableRowToggleHeading",function(w,u){var x=n(this),y=x.children("td,th"),v=0;if(AJS.Rte.Table.areCellsHeadings(y)){if(!o(x.closest("table"))){y=y.filter(function(){var z=e(this);var A=z.closest("table");v+=z.attr("colspan")||1;return !AJS.Rte.Table.isColumnHeading(A,v)})}AJS.Rte.Table.convertToNormalCells(y)}else{AJS.Rte.Table.convertToHeadingCells(y)}});p.addCommand("confTableColumnToggleHeading",function(y,v){function x(z){var A=e([]);z.each(function(){var B=e(this);var C=B.index()+1;var D=B.closest("table.confluenceTable");var E=D.children("tbody").children("tr");A=A.add(E.children().nthCol(C))});return A}var u=l(this);var w=x(u);if(AJS.Rte.Table.areCellsHeadings(w)){if(!o(w.closest("table"))){w=w.filter(function(){var z=e(this);var C=z.parent("tr");var B=C.children();var A=B.filter("th");return B.length!==A.length})}AJS.Rte.Table.convertToNormalCells(w)}else{AJS.Rte.Table.convertToHeadingCells(w)}});p.addCommand("confTableSelectionToggleHighlight",function(y,w){var v=w&&w.alwaysHighlight;var u=l(this);var z=u.filter("td");var x=u.filter("th");if(AJS.Rte.Table.areCellsHighlighted(u)&&!v||i()){b(u)}else{a(u)}});if(tinymce.isIE8){p.onKeyDown.add(function(x,z){function y(B,A,C){while(B!=A){if(B[C]){return false}B=B.parentNode}return true}function u(A,D){var B=p.selection.getRng(true),E=B.startContainer;if(B.collapsed){var C=y(E,A,D);if(E.nodeType==3){return C&&B.startOffset==((D=="nextSibling")?E.length:0)}else{if(E==A){return B.startOffset==((D=="nextSibling")?E.childNodes.length:0)}else{return C}}}return false}if((z.keyCode==37||z.keyCode==39)&&!z.shiftKey){var w=q(this);if(w.length){var v=w[0];if(z.keyCode==37&&(u(v,"previousSibling"))){p.execCommand("mceTableMoveCaretToPrevCell");return tinymce.dom.Event.cancel(z)}else{if(z.keyCode==39&&u(v,"nextSibling")){p.execCommand("mceTableMoveCaretToNextCell");return tinymce.dom.Event.cancel(z)}}}}})}if(tinymce.isWebKit){var k=e('<style type="text/css"></style>').html(".confluenceTable th,td { white-space: pre-wrap; }");e(p.getDoc().head).append(k)}function t(){var v=p.selection.getNode();if(e(v).parents("table").is(".confluenceTable")){var u=p.dom.getParent(v,"UL,OL");return !u}return false}p.onKeyDown.add(function(u,v){if(v.keyCode==9){if(t()){var w=v.shiftKey?"mceTableMoveCaretToPrevCell":"mceTableMoveCaretToNextCell";p.execCommand(w);v.preventDefault();return false}}})}AJS.bind("init.rte",c)})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/table/atlassian-table-picker.js' */
(function(J){var A={};AJS.Rte.TablePicker={bindToControl:X,disable:d,enable:j,close:M,_internal:A};var g,B,h,s,R,T,O,N;var x,r,i,C,G,S;var u=4;var H=4;var l=15;var w=20;var z=25;var t=17;var E=20;var n=0;var e,b,D,m,P;var K=false;function X(Y){AJS.debugEnabled()&&AJS.debug("Table Picker - bind to control");g=J(document);B=g.find("body");s=J("#insert-table-dropdown");R=J("#rte-button-insert-table");T=s.find(".aui-dd-parent");O=J("#table-picker-container");x=O.find(".table-picker-box");r=O.find(".picker-cell");i=O.find(".picker-heading");C=O.find(".picker-selected-cell");G=O.find(".picker-selected-heading");S=x.find(".desc");h=J("<div></div>").attr("id","table-picker-backdrop").addClass("hidden").appendTo(s);R.click(function(Z){Z.preventDefault();if(!K){AJS.Rte.BookmarkManager.storeBookmark();k()}});h.click(o);C.click(W);G.click(W)}function L(){O.css({top:J("#insert-table-dropdown").outerHeight(true)});L=function(){}}function k(){var Y,aa,ab,Z;L();P=true;Q(1,1);V();h.removeClass("hidden");O.removeClass("hidden");F();T.addClass("active");R.focus()}function M(){if(!O.hasClass("hidden")){U();O.addClass("hidden");h.addClass("hidden");c();T.removeClass("active")}}function V(){var Y=J(AJS.Rte.getEditor().getDoc());g.bind("mousemove.atlassian-table-picker",p);g.bind("keydown.atlassian-table-picker",f);g.bind("keyup.atlassian-table-picker",f);Y.bind("keydown.atlassian-table-picker",f);Y.bind("keyup.atlassian-table-picker",f)}function U(){var Y=J(AJS.Rte.getEditor().getDoc());g.unbind(".atlassian-table-picker");Y.unbind(".atlassian-table-picker")}function d(){K=true;s.addClass("disabled")}function j(){K=false;s.removeClass("disabled")}function Q(Z,Y){AJS.debugEnabled()&&AJS.debug("setSize("+[Z,Y]+")");if(Z==D&&Y==m){return}Z=Math.max(1,Math.min(l,Z));Y=Math.max(1,Math.min(w,Y));e=Math.max(u,Z);b=Math.max(H,Y);D=Z;m=Y;x.width(e*z+1);x.height(b*t+E);a(r,e,b);a(C,D,m);a(i,e,1);a(G,D,1);y();S.text(D+" x "+m);if(!O.hasClass("hidden")){F()}}function y(){i.toggleClass("hidden",!P);G.toggleClass("hidden",!P)}function a(Z,aa,Y){Z.width(z*aa+1);Z.height(t*Y+1)}function F(){c();N=Raphael.shadow(0,0,O.width(),O.height(),{target:O[0]});N.offset(O.offset());N.css("z-index",9999)}function c(){if(N){N.remove();N=null}}function p(ah){var af=r.offset(),ag=af.top-g.scrollTop(),aa=af.left-g.scrollLeft(),aj=ag+r.outerHeight(true)+n,ae=aj-t-n,ai=aa+r.outerWidth(true)+n,Z=ai-z-n,ab=ah.clientY,ac=ah.clientX,al,ak,ad=e,Y=b;AJS.debugEnabled()&&AJS.debug("[mouseX,spLeft,spRightShrink,spRightGrow][mouseY,spTop,spBottomShrink,spBottomGrow] = "+[ac,aa,Z,ai]+"/"+[ab,ag,ae,aj]);if(ac>ai){al=ac-ai;ak=~~((al/z)+1);ad+=ak;AJS.debugEnabled()&&AJS.debug("grow: xdelta = "+ak)}else{if(ac<Z){al=ac-Z;ak=~~((al/z)-1);ad+=ak;AJS.debugEnabled()&&AJS.debug("shrink: xdelta = "+ak)}}if(ab>aj){al=ab-aj;ak=~~((al/t)+1);Y+=ak;AJS.debugEnabled()&&AJS.debug("grow: ydelta = "+ak)}else{if(ab<ae){al=ab-ae;ak=~~((al/t)-1);Y+=ak;AJS.debugEnabled()&&AJS.debug("shrink: ydelta = "+ak)}}Q(ad,Y)}function q(Y){AJS.debugEnabled()&&AJS.debug("enableHeading("+Y+")");if(Y!=P){P=Y;y()}}function I(ac){var ab=~~(ac.offsetX||ac.originalEvent.layerX),aa=~~(ac.offsetY||ac.originalEvent.layerY),Z=(~~(ab/z))+1,Y=(~~(aa/t))+1;if(Z<1||Z>l||Y<1||Y>w){return null}return{width:Z,height:Y}}function W(Z){var Y=I(Z);Z.preventDefault();AJS.debug("insertTable: size = "+(Y&&[Y.width,Y.height]));if(Y){M();v(Y.width,Y.height,P)}}function v(ab,Y,Z){var aa,ac,ad;AJS.debugEnabled()&&AJS.debug("shamefulInsertTable("+ab+","+Y+","+Z+")");aa=J("#tinymce-table-form");if(!aa.length){ac=AJS.renderTemplate("tableForm",Y,ab);ad=J("<div></div>").addClass("hidden");ad.append(ac);B.append(ad)}else{aa.find('input[name="rows"]').val(Y);aa.find('input[name="cols"]').val(ab)}J("#table-heading-checkbox").prop("checked",Z);AJS.Rte.BookmarkManager.restoreBookmark();tinymce.activeEditor.undoManager.beforeChange();tinymce.activeEditor.plugins.table.insertTable();ad&&ad.remove()}function f(Y){AJS.debugEnabled()&&AJS.debug("key: "+Y.charCode+"/"+Y.keyCode+"/"+Y.shiftKey);AJS.debug("key: "+Y.charCode+"/"+Y.keyCode+"/"+Y.shiftKey);if(J.browser.msie){if(Y.keyCode==16){q(!Y.shiftKey)}if(Y.keyCode==27){M()}}else{if(Y.charCode==0){q(!Y.shiftKey)}if(Y.keyCode==27&&Y.charCode==0){M()}}}function o(Y){M()}A.insertTable=W})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/table/atlassian-table-migration.js' */
(function(b){function a(d){d.each(function(){var g=this;var f=b(this);var e=f.attr("data-highlight-class");var h;if(f.hasClass("nohighlight")){f.removeClass("nohighlight");AJS.Rte.Table.convertToNormalCells(f);return}else{if(f.hasClass("highlight")){f.removeClass("highlight");if(!e){f.attr("data-highlight-colour","grey");f.addClass("highlight-grey")}}}if(e){f.removeClass(e);f.removeAttr("data-highlight-class");switch(e){case"warning":h="red";break;case"success":h="green";break;case"note":h="yellow";break;case"info":h="blue";break}if(h){f.addClass("highlight-"+h);f.attr("data-highlight-colour",h)}}})}function c(h){h=h||b(AJS.Rte.getEditor().getBody());var g=new Date().getTime();var d=h.find("td.highlight,th.nohighlight,td[data-highlight-class],th[data-highlight-class]");var f=new Date().getTime();a(d);var e=new Date().getTime();AJS.debug("Migration duration: selector: "+(f-g)+"ms; migration: "+(e-f)+"ms")}AJS.Rte.Migration=AJS.Rte.Migration||{};AJS.Rte.Migration.Table={migrateTables:c};b(document).bind("postPaste",function(f,d,g){AJS.Rte.Migration.Table.migrateTables()});AJS.bind("init.rte",function(){AJS.Rte.Migration.Table.migrateTables()})})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/placeholder/editor_plugin_src.js' */
(function(h){var g='<style type="text/css">.wiki-content .text-placeholder { display: inline; }</style>';var n='<style type="text/css">.wiki-content .text-placeholder { display: inline-block; }</style>';var k={click:false,keypress:true};var l=tinymce.VK;var m=tinymce.dom.Event;var b=(AJS.Meta.get("content-type")==="template");function j(){var o=h(AJS.Rte.getEditor().getDoc()).find("head");if(h.browser.msie){o.append(g)}else{o.append(n)}}function f(o){AJS.trigger("cursor-target-refresh");h("#rte-button-insert-placeholder").click(function(p){p.preventDefault();AJS.Rte.Placeholder.insertTextPlaceHolder()});o.onKeyPress.addToTop(function(p,r){if(r.keyCode==13&&!r.shiftKey){var q=p.selection.getNode(),s=h(q).closest(".text-placeholder");if(s.length&&AJS.Rte.Cursor.isCursorAtEnd(p,p.selection.getRng(),q)){AJS.Rte.Cursor.insertParagraph(p,s,true);return tinymce.dom.Event.cancel(r)}}})}var i={UL:true,OL:true,LI:true,TABLE:true,TBODY:true};function e(o){return !i[o.nodeName]}function a(o,q){var p=q.previousSibling;var r;while(q&&!p){q=q.parentNode;p=q.previousSibling}if(p){r=p;while(!e(r)){if(!r.lastChild){break}r=r.lastChild}o.selection.select(r.lastChild||r);o.selection.collapse(false);o.selection.normalize()}}function d(o,q){var p=q.nextSibling;var r;while(q&&!p){q=q.parentNode;p=q.nextSibling}if(p){r=p;while(!e(r)){if(!r.firstChild){break}r=r.firstChild}o.selection.select(r.firstChild||r);o.selection.collapse(true);o.selection.normalize()}}function c(o){function u(){var w=h(AJS.Rte.getEditor().getBody());var x=w.find(".text-placeholder.selected");if(x.length){AJS.Rte.getEditor().selection.select(x[0])}}function s(w){w.onKeyDown.addToTop(q);w.onKeyPress.addToTop(p);w.onClick.addToTop(p)}function r(w){w.onKeyDown.remove(q);w.onKeyPress.remove(p);w.onClick.remove(p)}function q(x,y){var w=h(x.getBody());var z=w.find(".text-placeholder.selected");if(!z.length){r(x);return}if(y.keyCode===l.LEFT||y.keyCode===l.UP){a(x,z[0]);return m.cancel(y)}else{if(y.keyCode===l.RIGHT||y.keyCode===l.DOWN){d(x,z[0]);return m.cancel(y)}else{if(y.keyCode===l.BACKSPACE||y.keyCode===l.DELETE){AJS.Rte.Placeholder.removePlaceholder(z);return m.cancel(y)}}}}function p(x,y){if(tinymce.isGecko&&(!y.isChar&&y.type==="keypress")){return}var w=h(x.getBody());var A=w.find(".text-placeholder.selected");if(!A.length){r(x);return}if(A.length){var z=A.attr("data-placeholder-type");if(v(z,y.type)){AJS.Rte.Placeholder.removePlaceholder(A);AJS.trigger("editor.text-placeholder.activated",{placeholderType:z||"",triggerEvent:y})}}}function v(y,x){var w=AJS.Rte.Placeholder.getPlaceholderType(y);var z=h.extend({},k,w&&w.activation);return !!z[x]}function t(x,w,y){var z=h(y).closest(".text-placeholder");h(x.getBody()).find(".text-placeholder.selected").not(z).removeClass("selected");if(z.length){if(!z.hasClass("selected")){z.addClass("selected");s(x)}setTimeout(u,0)}else{r(x)}}o.onNodeChange.addToTop(t)}tinymce.create("tinymce.plugins.TextPlaceholderPlugin",{init:function(o){o.onInit.add(function(){if(b){f(o)}else{c(o)}j()})},getInfo:function(){return{longname:"Text Placeholder Plugin",author:"Atlassian",authorurl:"http://www.atlassian.com",infourl:"http://www.atlassian.com",version:"1.0"}}});tinymce.PluginManager.add("textplaceholders",tinymce.plugins.TextPlaceholderPlugin)})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/placeholder/placeholder.js' */
(function(e){var c=[];var b={};AJS.Rte=AJS.Rte||{};AJS.Rte.Placeholder=AJS.Rte.Placeholder||{};var a;var d;if(tinymce.isIE){a="\uFEFF{$caret}";d="<p>{$caret}</p>"}else{if(tinymce.isWebKit){a="\uFEFF{$caret}<br>";d=a}else{a="\uFEFF{$caret}";d=a}}e.extend(AJS.Rte.Placeholder,{insertTextPlaceHolder:function(f){var g=e("<div></div>").append(AJS.Rte.Placeholder.Templates.textPlaceholder({content:a}));f&&g.find(".text-placeholder").html(f);AJS.Rte.getEditor().execCommand("mceInsertContent",false,g.html())},removePlaceholder:function(j){var g=AJS.Rte.getEditor();var f=e(g.getBody());var i=a;if(j.parent()[0].nodeName==="LI"){i=d}j.replaceWith('<span id="placeholder-cursor">&nbsp;</span>');var h=f.find("#placeholder-cursor")[0];g.selection.select(h.firstChild);g.execCommand("mceInsertContent",false,i);g.dom.remove(h,true)},addPlaceholderType:function(f){if(!f||!f.type){AJS.log("PlaceHolderRegister : unable to register new place holder type !");return}c.push(f);b[f.type]=f},getPlaceholderTypes:function(){return[].concat(c)},getPlaceholderType:function(f){return b[f]}})})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/placeholder/tinyMce-property-panel-text-placeholders.js' */
(function(a){AJS.Confluence.PropertyPanel.TextPlaceholder=(function(){return{name:"textplaceholder",canHandleElement:function(b){return b.hasClass("text-placeholder")},handle:function(e){if(e.e.type!="click"&&e.e.type!="mouseup"){return}var m=AJS.Rte.Placeholder.getPlaceholderTypes();var b=e.containerEl;var n=a(b);var j=n.attr("data-placeholder-type");var k=[];function o(l){if(l==="default"){n.removeAttr("data-placeholder-type")}else{n.attr("data-placeholder-type",l)}var i=a(".text-placeholder-property-panel-type-"+l);i.parent().find(".text-placeholder-property-panel-type-item").removeClass("selected");i.addClass("selected")}function f(i,p,l){return{className:"text-placeholder-property-panel-type-item text-placeholder-property-panel-type-"+i,text:p,tooltip:l,selected:j===i,click:function(){o(i)}}}var h=f("default","Text","Instructional text is replaced with empty content when a person types.");h.selected=!j;k.push(h);var g;for(var d=0,c=m.length;d<c;d++){g=m[d];k.push(f(g.type,g.label,g.tooltip))}k.push(null);k.push({className:"text-placeholder-property-panel-remove-button",text:"Remove",click:function(){AJS.Confluence.PropertyPanel.destroy();AJS.Rte.Placeholder.removePlaceholder(n)}});AJS.Confluence.PropertyPanel.createFromButtonModel("textplaceholder",b,k,{anchorIframe:AJS.Rte.getEditorFrame()})}}})()})(AJS.$);AJS.bind("init.rte",function(){if(AJS.Meta.get("content-type")==="template"){AJS.trigger("add-handler.property-panel",AJS.Confluence.PropertyPanel.TextPlaceholder)}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/placeholder/placeholder.soy' */
// This file was automatically generated from placeholder.soy.
// Please don't edit this file by hand.

if (typeof AJS == 'undefined') { var AJS = {}; }
if (typeof AJS.Rte == 'undefined') { AJS.Rte = {}; }
if (typeof AJS.Rte.Placeholder == 'undefined') { AJS.Rte.Placeholder = {}; }
if (typeof AJS.Rte.Placeholder.Templates == 'undefined') { AJS.Rte.Placeholder.Templates = {}; }


AJS.Rte.Placeholder.Templates.textPlaceholder = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<span class="text-placeholder">', opt_data.content, '</span>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'tinymce3/plugins/imageproperties/js/image-properties-dialog.js' */
Confluence.Editor.ImageProps=(function(e){var j,l,h={},m="dialog-created.image-properties",d="dialog-before-show.image-properties",a;return{init:p,registerPanel:g};function p(){if(!a){l=null;if(c().length>0){a=true;AJS.Confluence.PropertyPanel.Image.pluginButtons.push(null,{create:function(){return{className:"image-properties",text:"Properties",tooltip:"Set additional image properties",click:function(r,q){AJS.Confluence.PropertyPanel.destroy();b(q)}}}})}}}function b(q){e("#image-properties-dialog").remove();j=new AJS.ConfluenceDialog({id:"image-properties-dialog",onSubmit:i});AJS.trigger(m,{img:q});j.popup.element.attr("data-tab-default","0");j.addHeader("Image Properties");j.addSubmit("Save",i);j.addCancel("Cancel",n);o(j);AJS.trigger(d);j.show()}function o(t){var r=c();for(var s=0;s<r.length;s++){var u=r[s];var q=h[u.key];if(q){t.addPanel(u.label,q.content,q.panelClass,u.key)}}if(r.length===1){t.popup.element.find(".dialog-page-menu").show()}}function g(t,s,q,r){h[t]={content:s,panelClass:q,saveFn:r}}function c(){if(!l){l=e("#image-properties-tab-items > div").map(function(){var q=e(this);return{key:q.text(),weight:q.attr("data-weight"),label:this.title}}).sort(function(r,q){return r.weight-q.weight})}return l}function i(){k();var s=[];for(var r in h){var q=h[r];var t=q.saveFn&&q.saveFn();if(t&&t.done){s.push(t)}}var u=e.when.apply(e,s);u.done(function(){f();j.hide().remove()})}function n(){j.hide().remove()}function k(){var t=j.popup.element,q=50,r=e('<div class="image-properties-loading-blanket"><div class="loading-data"></div></div>').appendTo(t.find(".dialog-page-body")),s=r.find(".loading-data");r.css({width:r.parent().width(),height:t.height()});s.css({marginTop:-q*1.2,marginLeft:-q*1.2});s.data("spinner",Raphael.spinner(s[0],q,"#666"))}function f(){var q=j.popup.element.find(".image-properties-loading-blanket .loading-data"),r=q.data("spinner");q.css({marginTop:"",marginLeft:""});if(r){r();delete r;q.data("spinner",null)}q.closest(".image-properties-loading-blanket").remove()}})(AJS.$);AJS.toInit(Confluence.Editor.ImageProps.init);AJS.bind("quickedit.success",Confluence.Editor.ImageProps.init);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'com/atlassian/confluence/tinymceplugin/tinyMceAdapter.js' */
(function(b){function a(){AJS.debug("TinyMceAdapter: initTinyMce");var f=Confluence.getContextPath();var d="wiki-content",c="auiwindowmanager,table,emotions,confluence,macroplaceholder,customtoolbar,insertwikimarkup,propertypanel,keyboardshortcuts,confmonospace,confcharmap,lists,confluencepaste,cursorTarget,confluencecleanupplugin,conftable,confluencepastetableplugin,confluencepastemacroplugin,showformat,pagelayoutplugin,highlightnode,iosediting,searchreplace,autoconvert,confluencelist,deletecommand,draggable,confluencesortabletablesplugin,textplaceholders";var g={autoresize_min_height:"100%",width:"100%",height:"100%",document_base_url:Confluence.getBaseUrl()+"/",plugins:c,theme:"atlassian",theme_advanced_buttons1:"formatselect,bold,italic,underline,strikethrough,forecolor,separator,table,row_before,row_after,delete_row,col_before,col_after,delete_col,delete_table,separator,bullist,numlist,tasklist,outdent,indent,blockquote,justifyleft,justifycenter,justifyright,justifyfull,separator,sup,sub,separator,undo,redo,separator,confimage,conf_macro_browser,separator,code,customtoolbar,help,monospace,separator,searchreplace",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",theme_advanced_resizing:false,theme_advanced_resize_horizontal:false,theme_advanced_statusbar_location:"none",theme_advanced_path:false,theme_advanced_blockformats:"p,h1,h2,h3,h4,h5,h6,pre,blockquote",mode:"specific_textareas",editor_selector:"tinymce-editor",body_class:d,popup_css:false,content_css:false,editor_css:false,custom_undo_redo:true,custom_undo_redo_levels:20,context_path:f,plugin_action_base_path:f+"/plugins/tinymce",editor_plugin_action_base_path:f+"/plugins/editor/tinymce",page_id:AJS.Meta.get("page-id"),draft_type:null,form_name:AJS.Meta.get("form-name"),space_key:encodeURI(AJS.Meta.get("space-key")),confluence_popup_width:620,confluence_popup_height:550,editor_id:"wysiwygTextarea"};if(g.page_id==0){g.page_id=null;g.draft_type=AJS.Meta.get("draft-type")}AJS.Rte.BootstrapManager.addBeforeInitCallback(function(h){AJS.debug("RTE refresh.settings handler: Modifying settings with values derived from the editor DOM.");if(AJS.Rte.getEditorContainer().hasClass("resize")){AJS.debug("RTE refresh.settings handler: The editor container has the resize class so the Editor will grow as required.");h.plugins+=",autoresize";h.body_class+=" editor-comment"}else{AJS.debug("RTE refresh.settings handler: The Editor should be full size");h.plugins+=",flextofullsize";h.body_class+=" fullsize"}if(AJS.Meta.get("content-type")==="template"){h.body_class+=" template-editor"}h.contentCssTags=AJS.$("script[title='editor-css']").html();h.language=AJS.Meta.get("action-locale");var i=AJS.Meta.get("min-editor-height");if(i){h.autoresize_min_height=i}});AJS.Rte.BootstrapManager.preInitialise(g);var e=AJS.Meta.get("auto-start");if(e==null){e=false;AJS.debug("TinyMceAdapter: auto-start meta data was not set. Default to false.")}if(AJS.Meta.get("auto-start")){AJS.debug("TinyMceAdapter: auto-start=true. Calling AJS.Rte.BootstrapManager.initialise()");AJS.Rte.BootstrapManager.initialise()}else{AJS.debug("TinyMceAdapter: Pre-initialisation complete. auto-start=false. You can now call AJS.Rte.BootstrapManager.initialise() to activate TinyMce.")}}AJS.toInit(a)})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-javascript-resources', location = 'com/atlassian/confluence/tinymceplugin/tinymce-adapter-deprecated.js' */
(function(a){AJS.Editor.Adapter={putCursorAtPostionInElement:function(c,b,g){var e=tinyMCE.activeEditor,h=e.getDoc();var f=a(c,g||h);f=f.contents().filter(function(){return this.nodeType==3})[0];var d=e.selection.getRng(true);d.setStart(f,b);d.setEnd(f,b);e.selection.setRng(d)},storeCurrentSelectionState:AJS.Rte.BookmarkManager.storeBookmark,restoreSelectionState:AJS.Rte.BookmarkManager.restoreBookmark,insertLink:function(c,b){if(b){AJS.Rte.getEditor().selection.select(b)}Confluence.Editor.LinkAdapter.setLink(c)},getCurrentBaseUrl:AJS.Rte.getCurrentBaseUrl,addOnInitCallback:function(b){AJS.debug("Adding callback to AJS.Rte.BootstrapManager. AJS.Rte.BootstrapManager = "+AJS.Rte.BootstrapManager);AJS.Rte.BootstrapManager.addOnInitCallback(b)},bindScroll:function(b,c){AJS.Rte.bindScroll(b,c)},unbindScroll:function(b){AJS.Rte.unbindScroll(b)},getTinyMceHasInit:function(){return AJS.Rte.BootstrapManager.isInitComplete()},getEditor:AJS.Rte.getEditor,addTinyMcePluginInit:function(b){AJS.Rte.BootstrapManager.addTinyMcePluginInit(b)},isExternalLink:function(b){return Confluence.Link.isExternalLink(b)},isInMacroPlaceholder:function(b){return tinymce.confluence.MacroUtils.isInMacro(b)},initialiseTinyMce:function(){var b=AJS.Editor.Adapter;tinymce.EditorManager.preInit.apply(tinymce.EditorManager);tinymce.EditorManager.init(b.settings)},offset:function(b){AJS.Rte.Content.offset(b)},getSelectedText:function(){return AJS.Rte.Content.getSelectedText()},setEditorValue:function(b){AJS.Rte.Content.setHtml(b)},getEditorHTML:function(){return""+AJS.Rte.getEditor.getContent()},editorHasContentChanged:function(){return AJS.Rte.getEditor().isDirty()},editorResetContentChanged:function(){AJS.Rte.getEditor().setDirty(false)},getChildIndex:function(c,f){var e=c.childNodes;for(var d=0,b=e.length;d<b;d++){if(e[d]==f){return d}}return -1},getMainEditor:function(){return AJS.Rte.getMainEditor()},getEditorContainer:function(){return AJS.Rte.getEditorContainer()},getEditorFrame:function(){return AJS.Rte.getEditorFrame()},getEditorTable:function(){return AJS.Rte.getEditorTable()},webResourcePath:AJS.Rte.webResourcePath,getResourceUrlPrefix:function(){return AJS.Rte.getResourceUrlPrefix()},getTinyMceBaseUrl:function(){return AJS.Rte.getTinyMceBaseUrl()},getMinEditorHeight:function(){return AJS.Rte.getMinEditorHeight()},getTinyMceEditorMinHeight:function(b){return AJS.Rte.getTinyMceEditorMinHeight(b)}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:jiraAnalytics', location = '/jira/jiraanalytics.js' */
AJS.Editor.JiraAnalytics={events:{paste:{key:"confluence.jira.plugin.paste"},search:{key:"confluence.jira.plugin.search"},trigger:{key:"confluence.jira.plugin.trigger"},customizeColumn:{key:"confluence.jira.plugin.column.customize"}},linkTypes:{jqlDirect:"direct_jql",jql:"jql_link",xml:"xml_link",rss:"rss_link",filter:"filter_link"},getDisplayType:function(a){var b="single";if(a.container.find("#opt-table").is(":checked")){b="table"}else{if(a.container.find("#opt-total").is(":checked")){b="count"}}return b},setupAnalyticPanelActionObject:function(a,c,b){return{name:a.analyticPanelActionName,properties:this.setupPanelActionProperties(a,c,b)}},setupPanelActionProperties:function(a,d,b){var c={};if(d===AJS.Editor.JiraConnector.source.instructionalText){if(a.analyticPanelActionName==="confluence.jira.plugin.issuecreated"){c.issueType=a.container.find('select[name="issuetype"] :selected').text()}else{if(a.analyticPanelActionName==="confluence.jira.plugin.searchadded"){c.display=this.getDisplayType(a)}}c.label=b}return c},triggerPasteEvent:function(a){AJS.EventQueue=AJS.EventQueue||[];AJS.EventQueue.push({name:AJS.Editor.JiraAnalytics.events.paste.key,properties:a})},triggerPannelActionEvent:function(a){AJS.EventQueue=AJS.EventQueue||[];AJS.EventQueue.push(a)},triggerSearchEvent:function(a){AJS.EventQueue=AJS.EventQueue||[];AJS.EventQueue.push({name:AJS.Editor.JiraAnalytics.events.search.key,properties:a})},triggerMarkupEvent:function(a){this.triggerSearchEvent(a)},triggerPannelTriggerEvent:function(a){AJS.EventQueue=AJS.EventQueue||[];AJS.EventQueue.push({name:AJS.Editor.JiraAnalytics.events.trigger.key,properties:a})},triggerCustomizeColumnEvent:function(a){AJS.EventQueue=AJS.EventQueue||[];AJS.EventQueue.push({name:AJS.Editor.JiraAnalytics.events.customizeColumn.key,properties:a})}};(function(a){a.aop.before({target:AJS.MacroBrowser,method:"loadMacroInBrowser"},function(b,c){if(b&&b[0]&&b[0].pluginKey=="confluence.extra.jira"){AJS.Editor.JiraAnalytics.triggerPannelTriggerEvent({source:AJS.Editor.JiraConnector.source.macroBrowser})}});a.aop.before({target:tinymce.confluence.macrobrowser,method:"macroBrowserToolbarButtonClicked"},function(b,c){if(b&&b[0]&&b[0].presetMacroMetadata&&b[0].presetMacroMetadata.pluginKey=="confluence.extra.jira"){AJS.Editor.JiraAnalytics.triggerPannelTriggerEvent({source:AJS.Editor.JiraConnector.source.editorBraceKey})}});AJS.bind("init.rte",function(){a.aop.before({target:tinyMCE.activeEditor,method:"execCommand"},function(l,k){if(l&&l[0]=="mceInsertContent"&&l[2]){var m=l[2];var e=AJS.$("<div></div>").html(m).children().first();var c=e.attr("data-macro-name");var h=["jira","jiraissues"];if(a.inArray(c,h)==-1){return}var j=AJS.Editor.JiraAnalytics;var n={source:"wiki_markup"};if(!e.attr("data-macro-parameters")){return}var g=e.attr("data-macro-parameters").split("|");for(var f=0;f<g.length;f++){var d=a.trim(g[f]);if(d.indexOf("jql")==0||d.indexOf("jqlQuery")==0){n.type=j.linkTypes.jqlDirect;break}else{if(d.indexOf("url")==0){var b=a.trim(d.substring(d.indexOf("=")+1,d.length));n.type=AJS.JQLHelper.checkQueryType(b);break}else{if(d.indexOf("http")==0){var b=d;n.type=AJS.JQLHelper.checkQueryType(b);break}}}}if(typeof n.type==="undefined"){n.type=j.linkTypes.jqlDirect}j.triggerMarkupEvent(n)}})})})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.integration.jira.jira-integration-plugin:jira-create-issue-form', location = '/jira-create-issue-form/jira-create-issue-form.js' */
var jiraIntegration=window.jiraIntegration||{};jiraIntegration.JiraCreateIssueForm=(function(c,a){b.defaults={formClass:"jira-interation-create-issue-form",ignoreFieldsWithDefaultValue:true,excludedField:["project","issuetype","reporter"],renderSummaryAndDescription:false,get$unsupportedFieldMessage:function(d,e){return c(jiraIntegration.templates.jiraCreateIssueForm.unsupportedFieldsMessage({unsupportedFields:d,createIssueUrl:e}))},get$unexpectedError:function(d){return c(aui.message.error({content:AJS.escapeHtml(d)}))},get$unauthorizeMessage:function(d){return c(jiraIntegration.templates.jiraCreateIssueForm.authorize({extraClasses:"jira-oauth-dialog",applicationName:d}))}};function b(d){this.configuration=a.extend({},b.defaults,d);if(this.configuration.renderSummaryAndDescription){this.configuration.excludedField.push("summary","description")}this._init()}b.prototype._trigger=function(d,e){var f=this.configuration[d];if(f){f.apply(this,Array.prototype.slice.call(arguments,1))}};b.prototype._bindEventListener=function(){var d=this;this.defaultFields.server.on("change",function(f){if(this.value){d.currentServerId=this.value;d._loadProjectData(this.value)}else{jiraIntegration.JiraCreateIssueForm.FieldHelper.resetSelectField(d.defaultFields.project);d.defaultFields.project.trigger("change")}d.resetForm();d._trigger("onServerChanged",this.value)});this.defaultFields.project.on("change",function(){if(this.value){c('option[value=""]',d.defaultFields.project).remove();d._loadIssueType(d.defaultFields.server.val(),this.value)}else{jiraIntegration.JiraCreateIssueForm.FieldHelper.resetSelectField(d.defaultFields.issueType)}d.resetForm();d.defaultFields.issueType.trigger("change");d._trigger("onProjectChanged",this.value)});this.defaultFields.issueType.on("change",function(){d.resetForm();if(this.value){d._loadRequireFields()}else{d.$containerRequireField&&d.$containerRequireField.html("");c(".aui-message",this.formEl).remove()}d._trigger("onTypeChanged",this.value)})};b.prototype._init=function(){this.container=c(this.configuration.container);if(this.container.length){this._renderForm();this._bindEventListener();this._loadServerData()}else{throw new Error("container property should be defined.")}};b.prototype._renderForm=function(){this.formEl=c(jiraIntegration.templates.jiraCreateIssueForm.form({formClass:this.configuration.formClass}));if(this.configuration.renderSummaryAndDescription){this._renderSummaryAndDescription()}this.container.append(this.formEl);this.defaultFields=this._getDefaultFields();this.$containerRequireField=c(".create-issue-required-fields",this.container);this._trigger("onFormRendered")};b.prototype._renderSummaryAndDescription=function(){var d=c(".create-issue-default-fields",this.formEl);d.append(aui.form.textField({labelContent:"Summary",isRequired:true,name:"summary"}));d.append(aui.form.textareaField({labelContent:"Description",name:"description"}))};b.prototype._getDefaultFields=function(){var d=c("."+this.configuration.formClass,this.configuration.container);return{server:c(".server-select",d),project:c(".project-select",d),issueType:c(".issuetype-select",d)}};b.prototype._loadServerData=function(){var d=this;this.formIsLoading(this.defaultFields.server);c.when(jiraIntegration.JiraCreateIssueForm.Data.loadServers()).then(function(e){d.formLoadingCompleted(d.defaultFields.server);d._loadServerDataComplete(e)})};b.prototype._loadRequireFields=function(){var e=this;var d={serverId:this.defaultFields.server.val(),projectKey:this.defaultFields.project.val(),issueType:this.defaultFields.issueType.val()};this.formIsLoading(this.defaultFields.issueType);var f=jiraIntegration.JiraCreateIssueForm.Data.getFieldMetadata(d);f.done(function(j){var g=e._getValidRequiredFields(j);if(e.configuration.renderSummaryAndDescription){var h=j.fields.description;var i=!!(h&&h.required);e._setDescriptionAsRequiredField(i)}e._renderRequireFields(g,d);e.formLoadingCompleted(e.defaultFields.issueType)}).fail(a.bind(e._handlerAjaxError,this))};b.prototype._loadServerDataComplete=function(d){if(d.length){if(d.length===1){jiraIntegration.JiraCreateIssueForm.FieldHelper.hideField(this.defaultFields.server)}jiraIntegration.JiraCreateIssueForm.FieldHelper.fillSelectData(this.defaultFields.server,d,true);this._loadProjectData(d[0].id);this.currentServerId=d[0].id;this._hasMultiServer=d.length>1}else{this._handlerUnexpectedError("Don\'t have any JIRA server, please check the application link configuration.")}};b.prototype._loadProjectData=function(d){var e=this;this.formIsLoading(this.defaultFields.project);var f=jiraIntegration.JiraCreateIssueForm.Data.loadProjects(d);f.then(function(g){if(g.errors&&g.errors.length){var h=g.errors[0];if(h.authenticationUri){e._handlerAuthorizeError(h)}else{e._handlerUnexpectedError(h.message)}}else{if(g.length){jiraIntegration.JiraCreateIssueForm.FieldHelper.fillSelectData(e.defaultFields.project,g);jiraIntegration.JiraCreateIssueForm.FieldHelper.resetSelectField(e.defaultFields.issueType)}else{e._handlerUnexpectedError("You do not have permission to create issues on this JIRA server.")}}e.formLoadingCompleted(e.defaultFields.project)},a.bind(e._handlerAjaxError,this))};b.prototype._loadIssueType=function(e,d){var f=jiraIntegration.JiraCreateIssueForm.Data.getIssueTypes(e,d);jiraIntegration.JiraCreateIssueForm.FieldHelper.fillSelectData(this.defaultFields.issueType,f,true)};b.prototype._renderRequireFields=function(d,e){this.$containerRequireField.html("");var f=a.reject(d,jiraIntegration.fields.canRender);if(f.length){this._handlerUnsupportedFields(f)}else{this.$containerRequireField.html(a.map(d,function(g){return jiraIntegration.fields.renderField(null,g,null,null)}).join(""));jiraIntegration.fields.attachFieldBehaviors(this.$containerRequireField,{serverId:e.serverId,projectKey:e.projectKey},null);this._trigger("onRequiredFieldsRendered",d,f)}};b.prototype._handlerUnexpectedError=function(e){var d=this.configuration.get$unexpectedError(e);c(".aui-message",this.formEl).remove();this.formEl.prepend(d);this.formLoadingCompleted();this.formHasError()};b.prototype._handlerUnsupportedFields=function(d){d=a.map(d,function(f){return AJS.escapeHtml(f.name)});var e=this.configuration.get$unsupportedFieldMessage(d,this._getCreateJiraIssueUrl());c(".aui-message",this.formEl).remove();this.formEl.prepend(e);this._trigger("onError");this.formLoadingCompleted()};b.prototype._handlerAjaxError=function(e){var d=this;if(e.status>=500&&e.status<600){d._handlerUnexpectedError("Received the following HTTP error code from the server"+":"+e.status)}d.formHasError()};b.prototype._handlerAuthorizeError=function(f){var e=this;this.formHasError();var d=this.configuration.get$unauthorizeMessage(f.applicationName);this.formEl.append(d);c(".oauth-init",d).on("click",function(g){AppLinks.authenticateRemoteCredentials(f.authenticationUri,function(){e.resetForm();e._loadProjectData(e.currentServerId)},function(){e._handlerUnexpectedError(AJS.format("You have refused to permit access to {0}.",f.applicationName))});g.preventDefault()})};b.prototype._getCreateJiraIssueUrl=function(){var f=this.defaultFields.project.find("option:selected").val();var g=this.defaultFields.issueType.find("option:selected").val();var h=jiraIntegration.JiraCreateIssueForm.Data.getServerById(this.currentServerId).displayUrl;h=h+"/secure/CreateIssueDetails!Init.jspa?pid="+f+"&issuetype="+g;var e=this._getFieldValue("summary");if(e.length){h=h+"&summary="+encodeURIComponent(e)}var d=this._getFieldValue("description");if(d.length){h=h+"&description="+encodeURIComponent(d)}return h};b.prototype._getValidRequiredFields=function(d){var e=this;return a.filter(d.fields,function(h){var g=h.schema?(h.schema.system||h.schema.custom||h.schema.customId):h;var f=a.contains(e.configuration.excludedField,g);return(h.required&&!f&&!h.hasDefaultValue)})};b.prototype._getFieldValue=function(e){var d=c("[name='"+e+"']",this.formEl);return(d)?c.trim(d.val()):""};b.prototype._setDescriptionAsRequiredField=function(d){var e=c('.field-group [name="description"]',this.formEl).prev("label");e.find(".aui-icon.aui-icon-required").remove();if(d){e.append(aui.icons.icon({icon:"required"}))}};b.prototype.resetForm=function(){c(".aui-message",this.formEl).remove();c(".field-group",this.formEl).show();if(this.configuration.renderSummaryAndDescription){this._setDescriptionAsRequiredField(false)}if(!this._hasMultiServer){jiraIntegration.JiraCreateIssueForm.FieldHelper.hideField(this.defaultFields.server)}this.$containerRequireField.html("")};b.prototype.formHasError=function(){c(".field-group",this.formEl).hide();this.$containerRequireField.html("");jiraIntegration.JiraCreateIssueForm.FieldHelper.showField(this.defaultFields.server);jiraIntegration.JiraCreateIssueForm.FieldHelper.setFieldDisabled(c(".insert-issue-button"),true);this._trigger("onError");this.formLoadingCompleted()};b.prototype.getCurrentServer=function(){return jiraIntegration.JiraCreateIssueForm.Data.getServerById(this.currentServerId)};b.prototype.formIsLoading=function(d){if(d){jiraIntegration.JiraCreateIssueForm.FieldHelper.setIsLoading(d,true)}var e=c(".text, .select, .textarea, .multi-select",this.formEl);jiraIntegration.JiraCreateIssueForm.FieldHelper.setFieldDisabled(e,true)};b.prototype.formLoadingCompleted=function(d){if(d){jiraIntegration.JiraCreateIssueForm.FieldHelper.setIsLoading(d,false)}else{c(".aui-icon.aui-icon-wait",this.formEl).remove()}var e=c(".text, .select, .textarea, .multi-select",this.formEl);jiraIntegration.JiraCreateIssueForm.FieldHelper.setFieldDisabled(e,false)};return b})(AJS.$,window._);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.integration.jira.jira-integration-plugin:jira-create-issue-form', location = '/jira-create-issue-form/jira-create-issue-form-data.js' */
var jiraIntegration=window.jiraIntegration||{};jiraIntegration.JiraCreateIssueForm=jiraIntegration.JiraCreateIssueForm||{};jiraIntegration.JiraCreateIssueForm.Data=(function(){var h={};var d={};function b(){return $.getJSON(AJS.contextPath()+"/rest/jira-integration/1.0/servers",function(i){if(i.length){$.each(i,function(j,k){h[k.id]=k})}})}function f(i){var j=(h[i])?h[i].projects:undefined;return j?$.Deferred().resolve(j):$.getJSON(AJS.contextPath()+"/rest/jira-integration/1.0/servers/"+i+"/projects",function(k){if(k.length){$.each(k,function(l,n){var m=_.filter(n.issuetypes,function(o){return !o.subtask});n.issueTypes=m});if(!h[i]){h[i]={}}h[i].projects=k}})}function a(j,i){var k=_.find(g(j),function(l){return l.id===i});return k?k.issueTypes:[]}function c(i){var j=i.serverId+"-"+i.projectKey+"-"+i.issueType;if(!_.has(d,j)){return $.ajax({type:"GET",url:AJS.contextPath()+"/rest/jira-integration/1.0/servers/"+i.serverId+"/projects/"+i.projectKey+"/issue-types/"+i.issueType+"/fields-meta"}).pipe(function(k){d[j]=k;return d[j]})}else{return $.Deferred().resolve(d[j])}}function e(i){return h?h[i]:{}}function g(i){return h&&h[i]?h[i].projects:[]}return{loadServers:b,loadProjects:f,getIssueTypes:a,getFieldMetadata:c,getServerById:e,getProjects:g}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.integration.jira.jira-integration-plugin:jira-create-issue-form', location = '/jira-create-issue-form/jira-create-issue-form-field-helper.js' */
var jiraIntegration=window.jiraIntegration||{};jiraIntegration.JiraCreateIssueForm=jiraIntegration.JiraCreateIssueForm||{};jiraIntegration.JiraCreateIssueForm.FieldHelper=(function(c,h){function e(j,l,k){var m=k?[]:[a(j)];c.each(l,function(n,p){var o={value:p.id,text:p.name};if(k&&n===0){o.selected=true}m.push(aui.form.optionOrOptgroup(o))});j.html(m.join(""))}function b(j){j.html(a(j))}function a(j){var k=j.attr("data-placeholder");return aui.form.optionOrOptgroup({value:"",text:k})}function i(j){j.parent().hide()}function d(j){j.parent().show()}function f(k,j){return j?k.disable():k.enable()}function g(k,j){return j?k.after(aui.icons.icon({icon:"wait"})):k.next(".aui-icon.aui-icon-wait").remove()}return{fillSelectData:e,resetSelectField:b,hideField:i,showField:d,setFieldDisabled:f,setIsLoading:g}})(AJS.$,window._);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.integration.jira.jira-integration-plugin:jira-create-issue-form', location = '/jira-create-issue-form/jira-create-issue-form.soy' */
// This file was automatically generated from jira-create-issue-form.soy.
// Please don't edit this file by hand.

if (typeof jiraIntegration == 'undefined') { var jiraIntegration = {}; }
if (typeof jiraIntegration.templates == 'undefined') { jiraIntegration.templates = {}; }
if (typeof jiraIntegration.templates.jiraCreateIssueForm == 'undefined') { jiraIntegration.templates.jiraCreateIssueForm = {}; }


jiraIntegration.templates.jiraCreateIssueForm.form = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  aui.form.form({extraClasses: opt_data.formClass, method: 'post', action: '#', content: '<fieldset class="create-issue-default-fields"><div class="field-group"><label>' + soy.$$escapeHtml("Server") + '<span class="aui-icon icon-required"> required</span></label><select class="select server-select" name="server" data-placeholder="' + soy.$$escapeHtml("Select a server") + '"><option disabled selected value="">' + soy.$$escapeHtml("Select a server") + '</option></select></div><div class="field-group"><label>' + soy.$$escapeHtml("Project") + '<span class="aui-icon icon-required"> required</span></label><select class="select project-select" name="project" data-placeholder="' + soy.$$escapeHtml("Select a project") + '"><option disabled selected value="">' + soy.$$escapeHtml("Select a project") + '</option></select></div><div class="field-group"><label>' + soy.$$escapeHtml("Issue Type") + '<span class="aui-icon icon-required"> required</span></label><select class="select issuetype-select" name="issue-type" data-placeholder="' + soy.$$escapeHtml("Select an issue type") + '"><option disabled selected value="">' + soy.$$escapeHtml("Select an issue type") + '</option></select></div></fieldset><fieldset class="create-issue-required-fields"></fieldset>'}, output);
  return opt_sb ? '' : output.toString();
};


jiraIntegration.templates.jiraCreateIssueForm.unsupportedFieldsMessage = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var param28 = new soy.StringBuilder();
  if (opt_data.unsupportedFields.length == 1) {
    var field__soy31 = new soy.StringBuilder('<strong>', soy.$$escapeHtml(opt_data.unsupportedFields), '</strong>');
    field__soy31 = field__soy31.toString();
    param28.append(AJS.format("The required field {0} is not available in this form. You will need to",field__soy31));
  } else {
    var fieldList__soy38 = new soy.StringBuilder();
    jiraIntegration.templates.jiraCreateIssueForm.buildFieldList({fields: opt_data.unsupportedFields}, fieldList__soy38);
    fieldList__soy38 = fieldList__soy38.toString();
    param28.append(AJS.format("The required fields {0} are not available in this form. You will need to",fieldList__soy38));
  }
  param28.append(' <a href="', soy.$$escapeHtml(opt_data.createIssueUrl), '" target="_blank">', soy.$$escapeHtml("create your issue directly in JIRA"), '</a>.');
  aui.message.warning({content: param28.toString()}, output);
  return opt_sb ? '' : output.toString();
};


jiraIntegration.templates.jiraCreateIssueForm.buildFieldList = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var joinText__soy50 = new soy.StringBuilder((opt_data.fields.length == 2) ? ' ' + soy.$$escapeHtml("and") + ' ' : ', ');
  joinText__soy50 = joinText__soy50.toString();
  var fieldList58 = opt_data.fields;
  var fieldListLen58 = fieldList58.length;
  for (var fieldIndex58 = 0; fieldIndex58 < fieldListLen58; fieldIndex58++) {
    var fieldData58 = fieldList58[fieldIndex58];
    output.append((! (fieldIndex58 == 0)) ? soy.$$escapeHtml(joinText__soy50) : '', '<strong>', soy.$$escapeHtml(fieldData58), '</strong>');
  }
  return opt_sb ? '' : output.toString();
};


jiraIntegration.templates.jiraCreateIssueForm.authorize = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var applicationNameEscaped__soy67 = new soy.StringBuilder(soy.$$escapeHtml(opt_data.applicationName));
  applicationNameEscaped__soy67 = applicationNameEscaped__soy67.toString();
  aui.message.info({content: AJS.format("{0}Log in and approve{1} to retrieve data from {2}",'<a class="oauth-init" href="#">','</a>',applicationNameEscaped__soy67)}, output);
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:dialogsJs', location = '/jira/datatable.js' */
(function(a){AJS.DataTable=function(h,d,b){var g=null;if(h&&h.jquery){g=h}else{if(typeof h=="string"){g=a(h)}}g.addClass("data-table");if(d&&d.length){this.columns=d;var f=a("<tr></tr>").appendTo(g);f.addClass("data-table-header");for(var c=0;c<d.length;c++){var e=d[c];f.append('<th class="'+e.className+'">'+e.title+"</th>")}}this.tbl=g;this.rowIdx=0};AJS.DataTable.prototype.addRow=function(e){var f=a("<tr></tr>").appendTo(this.tbl);var c=this.columns;for(var b=0;b<this.columns.length;b++){var d=c[b];var g=a("<td></td>").appendTo(f);g.addClass(d.className);d.renderCell(g,e)}f.data("row-data",e);this._bindRowJs(f,this.rowIdx,"selected","hover");this.rowIdx+=1;f.attr("tabindex","-1")};AJS.DataTable.prototype.selectRow=function(b){var c=a("tbody tr",this.tbl)[b+1];a(c).focus()};AJS.DataTable.prototype._bindRowJs=function(f,g,c,b){var e=this;f.click(function(i){if(c){a(e.tbl).find("."+c).removeClass(c);a(this).addClass(c)}var h=f.data("row-data");e.tbl.trigger("row-select",[h])});var d=function(k){switch(k.keyCode){case 13:var j;var h=f.data("row-data");f.keyup(j=function(l){e.tbl.trigger("row-action",[h]);f.unbind("keyup",j);return AJS.stopEvent(l)});return AJS.stopEvent(k);break;case 38:if(g>0){f.prev().focus()}return AJS.stopEvent(k);case 40:var i=a("tbody tr",e.tbl).length;if(g<i-1){f.next().focus()}return AJS.stopEvent(k)}};if(a.browser.mozilla){f.keypress(d)}else{f.keydown(d)}f.focus(function(h){f.click()});if(b){f.hover(function(){a(this).addClass(b)},function(){a(this).removeClass(b)})}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:dialogsJs', location = '/jira/dialogs.js' */
(function(){tinymce.create("tinymce.plugins.JiraLink",{init:function(a){a.addCommand("mceJiralink",AJS.Editor.JiraConnector.hotKey);a.onPostRender.add(function(b){AJS.$.get(Confluence.getContextPath()+"/rest/jiraanywhere/1.0/servers",function(c){AJS.Editor.JiraConnector.servers=c});AJS.$("#jiralink").click(function(c){AJS.Editor.JiraConnector.open(AJS.Editor.JiraConnector.source.editorDropdownLink,true);return AJS.stopEvent(c)});AJS.$("#insert-menu .macro-jiralink").show();b.addShortcut("ctrl+shift+j","","mceJiralink")})},getInfo:function(){return{longname:"Confluence Jira Connector",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("jiraconnector",tinymce.plugins.JiraLink)})();AJS.Editor.Adapter.addTinyMcePluginInit(function(b){b.plugins+=",jiraconnector";var c=b.theme_advanced_buttons1;var a=c.indexOf("confimage");b.theme_advanced_buttons1=c.substring(0,a)+"jiralinkButton,"+c.substring(a)});AJS.Editor.JiraConnector=(function(j){var f="";var c="Insert JIRA Issue";var a="Insert";var h="Cancel";var l=function(){var q=navigator.platform.toLowerCase().indexOf("mac")!=-1;return q?"Cmd":"Ctrl"};var b={macroBrowser:"macro_browser",editorBraceKey:"editor_brace_key",editorHotKey:"editor_hot_key",editorDropdownLink:"editor_dropdown_link",instructionalText:"instructional text"};var p=AJS.format("Hint: type \"{0}+Shift+J\" in the editor to quickly access this dialog.",l());var n,m,d;var i=function(){var q=j("#createPageLabelsString");if(q.length>0){m=q.val().split(" ").join();AJS.Editor.JiraAnalytics.triggerPannelTriggerEvent({source:n,label:m});return}j.getJSON(AJS.Meta.get("base-url")+"/rest/ui/1.0/content/"+AJS.Meta.get("page-id")+"/labels",function(s){var r=[];j.each(s.labels,function(u,t){r.push(t.name)});m=r.join();AJS.Editor.JiraAnalytics.triggerPannelTriggerEvent({source:n,label:m})})};var g=function(q,r){if(AJS.Editor.JiraAnalytics){AJS.Editor.JiraConnector.analyticPanelActionObject=AJS.Editor.JiraAnalytics.setupAnalyticPanelActionObject(r,n,m);if(q.customizedColumn){AJS.Editor.JiraAnalytics.triggerCustomizeColumnEvent({columns:q.customizedColumn})}}};var o=function(q){q.focusForm&&q.focusForm()};var e=function(t){if(!d){d=new AJS.ConfluenceDialog({width:840,height:590,id:"jira-connector"});d.addHeader(c);var s=AJS.Editor.JiraConnector.Panels;for(var u=0;u<s.length;u++){d.addPanel(s[u].title());var w=d.getCurrentPanel();var r=s[u];r.init(w)}d.addLink("Select Macro",function(){d.hide();AJS.MacroBrowser.open(false)},"dialog-back-link");d.addHelpText(p);j("#jira-connector .dialog-tip").attr("title",p);d.addButton(a,function(){var z=d.getCurrentPanel().id;var y=s[z];var x=s[0];g(x,y);y.insertLink()},"insert-issue-button");AJS.$(".insert-issue-button").disable();d.addCancel(h,function(){AJS.Editor.JiraConnector.closePopup()});d.gotoPanel(0);if(AJS.Editor.JiraConnector.servers){for(var u=0;u<AJS.Editor.JiraConnector.servers.length;u++){var v=AJS.Editor.JiraConnector.servers[u];AppLinks.makeRequest({appId:v.id,type:"GET",url:"/rest/api/2/field",dataType:"json",serverIndex:u,success:function(x){if(x&&x.length){AJS.Editor.JiraConnector.servers[this.serverIndex].columns=x}},error:function(){AJS.log("Jira Issues Macro: unable to retrieve fields from AppLink: "+v.id)}})}}j("#jira-connector .dialog-page-menu button").click(function(){var x=AJS.Editor.JiraConnector.Panels[d.getCurrentPanel().id];x.setInsertButtonState&&x.setInsertButtonState();o(x)})}d.show();AJS.Editor.JiraConnector.Panels[0].refreshSearchForm();if(t){d.gotoPanel(1);var q=AJS.Editor.JiraConnector.Panels[1];q.setSummary(t);setTimeout(function(){o(q)},0)}else{d.gotoPanel(0)}};var k=function(){if(AJS.Editor.JiraConnector.clickConfigApplink){AJS.$.ajax({url:Confluence.getContextPath()+"/rest/jiraanywhere/1.0/servers",async:false}).done(function(q){AJS.Editor.JiraConnector.servers=q})}if(typeof(AJS.Editor.JiraConnector.servers)=="undefined"||AJS.Editor.JiraConnector.servers.length==0){AJS.Editor.JiraConnector.warningPopup(AJS.Meta.get("is-admin"));return false}AJS.Editor.JiraConnector.clickConfigApplink=false;if(AJS.Editor.JiraConnector.refreshAppLink){AJS.Editor.JiraConnector.refreshAppLink.call();AJS.Editor.JiraConnector.refreshAppLink=false}return true};return{warningPopup:function(s){var q=new AJS.ConfluenceDialog({width:600,height:400,id:"warning-applink-dialog"});var r="Connect Confluence To JIRA";q.addHeader(r);var t=Confluence.Templates.ConfluenceJiraPlugin.warningDialog({isAdministrator:s});q.addPanel("Panel 1",t);q.get("panel:0").setPadding(0);if(s){q.addButton("Set connection",function(u){AJS.Editor.JiraConnector.clickConfigApplink=true;u.hide();tinymce.confluence.macrobrowser.macroBrowserCancel();window.open(Confluence.getContextPath()+"/admin/listapplicationlinks.action")},"create-dialog-create-button app_link");q.popup.element.find(".create-dialog-create-button").removeClass("button-panel-button").addClass("aui-button aui-button-primary")}else{q.addButton("Contact admin",function(u){u.hide();tinymce.confluence.macrobrowser.macroBrowserCancel();window.open(Confluence.getContextPath()+"/wiki/contactadministrators.action")})}q.addLink("Cancel",function(u){u.hide();tinymce.confluence.macrobrowser.macroBrowserCancel()});q.show();q.gotoPanel(0)},closePopup:function(){d.hide();tinymce.confluence.macrobrowser.macroBrowserCancel()},open:function(v,w){if(!k()){return}AJS.Editor.Adapter.storeCurrentSelectionState();n=v;if(AJS.Editor.JiraAnalytics&&n){if(n===AJS.Editor.JiraConnector.source.instructionalText){i()}else{m=null;AJS.Editor.JiraAnalytics.triggerPannelTriggerEvent({source:n})}}var s=tinymce.confluence.macrobrowser,u=s.getCurrentNode();if(s.isMacroTag(u)&&"jira"==j(u).attr("data-macro-name")){tinymce.confluence.macrobrowser.editMacro(u);return}var r=w&&tinyMCE.activeEditor.selection&&tinyMCE.activeEditor.selection.getContent({format:"text"});e(r);var q=AJS.Editor.JiraConnector.Panels[0];q.setMacroParams(null)},edit:function(u){n=f;m=f;if(typeof(u.params)=="undefined"){AJS.Editor.JiraConnector.open();return}if(!k()){AJS.Editor.JiraConnector.open();return}var w=function(z){if(z.hasOwnProperty("jqlQuery")){return z.jqlQuery}var y=/^([0-9]\d*)$/;var x=["count","columns","title","renderMode","cache","width","height","server","serverId","anonymous","baseurl","showSummary"];for(var A in z){if(j.inArray(A,x)==-1&&z.hasOwnProperty(A)){if(y.test(A)){return z[A]}return A+=" = "+z[A]}}return""};var r=function(z){var A={};if(z.params.url){A.searchStr=z.params.url;return A}A.maximumIssues=z.params.maximumIssues;var x=z.defaultParameterValue||w(z.params);if(typeof(x)=="undefined"){A.searchStr=f}else{A.searchStr=x}if(typeof(z.params.server)!="undefined"){A.serverName=z.params.server}else{for(var y=0;y<AJS.Editor.JiraConnector.servers.length;y++){if(AJS.Editor.JiraConnector.servers[y].selected){A.serverName=AJS.Editor.JiraConnector.servers[y].name;break}}}return A};var t=function(z){var A=r(z);var y=z.params.count;if(typeof y==="undefined"){y="false"}A.count=y;var x=z.params.columns;if(typeof(x)!="undefined"){if(x.length){A.columns=x}}return A};var s=t(u);if(u&&!AJS.Editor.inRichTextMode()){j("#markupTextarea").selectionRange(u.startIndex,u.startIndex+u.markup.length)}e();if(s.searchStr){d.gotoPanel(0);var q=AJS.Editor.JiraConnector.Panels[0];q.setMacroParams(s);var v={searchValue:s.searchStr,serverName:s.serverName,isJqlQuery:u.params.hasOwnProperty("jqlQuery"),isAutoSearch:true};q.doSearch(v)}},source:b}})(AJS.$);AJS.MacroBrowser.setMacroJsOverride("jira",{opener:AJS.Editor.JiraConnector.edit});AJS.MacroBrowser.setMacroJsOverride("jiraissues",{opener:AJS.Editor.JiraConnector.edit});AJS.Editor.JiraConnector.Panels=[];AJS.Editor.JiraConnector.clickConfigApplink=false;AJS.Editor.JiraConnector.hotKey=function(){AJS.Editor.JiraConnector.open(AJS.Editor.JiraConnector.source.editorHotKey,true)};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:dialogsJs', location = '/jira/panelhelper.js' */
AJS.Editor.JiraConnector.Panel=function(){};AJS.Editor.JiraConnector.Panel.prototype={SHOW_MESSAGE_ON_TOP:false,insertIssueLink:function(a){this.insertIssueLinkWithParams({key:a})},insertJqlLink:function(a){this.insertIssueLinkWithParams({jqlQuery:a})},insertIssueLinkWithParams:function(e){var f=function(g){tinymce.confluence.macrobrowser.macroBrowserComplete(g)};e.server=this.selectedServer.name;e.serverId=this.selectedServer.id;if(AJS.Editor.inRichTextMode()){f({name:"jira",params:e})}else{var a="{jira:";for(var b in e){a=a+b+"="+e[b]+"|"}if(a.charAt(a.length-1)=="|"){a=a.substr(0,a.length-1)}var d=AJS.$("#markupTextarea");var c=d.selectionRange();d.selectionRange(c.start,c.end);d.selection(a);c=d.selectionRange();d.selectionRange(c.end,c.end)}if(AJS.Editor.JiraAnalytics&&AJS.Editor.JiraConnector.analyticPanelActionObject){AJS.Editor.JiraAnalytics.triggerPannelActionEvent(AJS.Editor.JiraConnector.analyticPanelActionObject);AJS.Editor.JiraConnector.analyticPanelActionObject=null}AJS.Editor.JiraConnector.closePopup()},disableInsert:function(){AJS.$(".insert-issue-button").disable()},isInsertDisabled:function(){return AJS.$(".insert-issue-button").is(":disabled")},getOAuthRealm:function(d){var b=d.getResponseHeader("WWW-Authenticate")||"";var a=/OAuth realm\=\"([^\"]+)\"/;var c=a.exec(b);if(c){return c[1]}else{return null}},enableInsert:function(){AJS.$(".insert-issue-button").enable()},handleInsertWaiting:function(b){var a=AJS.$(".insert-issue-button");return b?a.before(aui.icons.icon({icon:"wait"})):a.prev(".aui-icon.aui-icon-wait").remove()},msg:function(a,c,b){if(aui&&aui.message){try{var h=AJS.$('<div class="aui-message-container"/>');var f=c;if(c.html){f=c.html()}var i={content:f};var d;switch(b){case"error":d=aui.message.error(i);break;case"success":d=aui.message.success(i);break;case"warning":d=aui.message.warning(i);break;default:d=aui.message.info(i)}h.append(d);c=h}catch(g){if(AJS&&AJS.logError){AJS.logError("jira-connector",g)}}}a.append(c)},errorMsg:function(a,c){this.removeError(a);var b=this.SHOW_MESSAGE_ON_TOP?AJS.$('<div class="jira-error"></div>').prependTo(a):AJS.$('<div class="jira-error"></div>').appendTo(a);this.msg(b,c,"error")},warningMsg:function(a,b){this.removeError(a);var c=this.SHOW_MESSAGE_ON_TOP?AJS.$('<div class="jira-error"></div>').prependTo(a):AJS.$('<div class="jira-error"></div>').appendTo(a);this.msg(c,b,"warning")},noServerMsg:function(a,b){var d=AJS.$('<div class="data-table jiraSearchResults" ></div>').appendTo(a);var c=this.SHOW_MESSAGE_ON_TOP?AJS.$('<div class="message-panel"/>').prependTo(d):AJS.$('<div class="message-panel"/>').appendTo(d);this.msg(c,b,"info")},ajaxError:function(c,b){if(c.status==401){var a=this.getOAuthRealm(c);this.selectedServer.authUrl=a;b.call(this)}else{this.errorMsg(this.container,"Received the following HTTP error code from the server"+":"+c.status)}},removeError:function(a){AJS.$("div.jira-error",a).remove()},setActionOnEnter:function(a,c,b){a.unbind("keydown").keydown(function(d){if(d.which==13){var f=function(g){a.unbind("keyup",f);c(b);return AJS.stopEvent(g)};a.keyup(f);return AJS.stopEvent(d)}})},createOauthForm:function(e){var d=this.selectedServer;var c={onSuccess:function(){d.authUrl=null;e(d)},onFailure:function(){}};var a='<a class="oauth-init" href="#">'+"Login & Approve"+"</a> "+"to retrieve data from"+" "+AJS.escapeHtml(this.selectedServer.name);var b=AJS.$('<div class="jira-oauth-message-marker"/>');if(!(aui&&aui.message)){b.addClass("oauth-message")}this.msg(b,a,"info");AJS.$(".oauth-init",b).click(function(f){AppLinks.authenticateRemoteCredentials(d.authUrl,c.onSuccess,c.onFailure);f.preventDefault()});return b},applinkServerSelect:function(a,b){var c=AJS.Editor.JiraConnector.servers;AJS.$(c).each(function(){var d="<option ";if(this.selected){selectedServer=this;d+='selected="selected"'}d+='value="'+this.id+'"></option>';d=AJS.$(d);d.text(this.name);AJS.$(a).append(d);d.data("jiraapplink",this)});AJS.$(a).change(function(g){var d=AJS.$("option:selected",a);var f=d.data("jiraapplink");b(f)})},showSpinner:function(d,a,c,b){AJS.$.data(d,"spinner",Raphael.spinner(d,a,"#666"));if(c){AJS.$(d).css("marginLeft",-a*1.2)}if(b){AJS.$(d).css("marginTop",-a*1.2)}},hideSpinner:function(a){AJS.$(a).css("marginTop","");AJS.$(a).css("marginLeft","");var b=AJS.$.data(a,"spinner");if(b){b();delete b;AJS.$.data(a,"spinner",null)}},setSelectedIssue:function(a){this.selectedIssue=a;this.enableInsert()},insertSelected:function(){if(this.selectedIssue){this.insertIssueLink(this.selectedIssue.key)}},createIssueTableFromUrl:function(c,k,b,a,d,h,i,f,e){AJS.$("div.data-table",c).remove();var j=AJS.$('<div class="data-table jiraSearchResults" ></div>').appendTo(c);var l=AJS.$('<div class="loading-data"></div>').appendTo(j);this.removeError(c);this.showSpinner(l[0],50,true,true);var g=this;this.currentXhr=AppLinks.makeRequest({appId:k,type:"GET",url:b,dataType:"xml",success:function(q){l.remove();var r=AJS.$("item",q);AJS.$(":disabled",c).enable();if(r.length){var u=AJS.$('<table class="my-result aui"></table>');AJS.$(".jiraSearchResults",c).append(u);var o=[];if(e){var t={className:"issue-checkbox-column",title:'<input type="checkbox" name="jira-issue-all" checked/>',renderCell:function(y,w){var x=Confluence.Templates.ConfluenceJiraPlugin.issueCheckbox({issueKey:w.key});AJS.$(x).appendTo(y)}};o.push(t)}var s=[{className:"issue-key-column",title:"Key",renderCell:function(y,x){var w=Confluence.Templates.ConfluenceJiraPlugin.issueKey({issueIconUrl:x.iconUrl,issueKey:x.key});AJS.$(w).appendTo(y)}},{className:"issue-summary-column",title:"Summary",renderCell:function(x,w){x.text(w.summary)}}];o=o.concat(s);var m=new AJS.DataTable(u,o);AJS.$(r).each(function(){var w={iconUrl:AJS.$("type",this).attr("iconUrl"),key:AJS.$("key",this).text(),summary:AJS.$("summary",this).text(),url:AJS.$("link",this).text()};m.addRow(w)});u.bind("row-action",function(x,w){d.call(g,w)});u.bind("row-select",function(x,w){a.call(g,w)});m.selectRow(0);if(i){var n=AJS.$("issue",q).attr("total");i.call(g,n)}}else{if(h){h()}var v="No search results found.";var p=AJS.$('<div class="message-panel"/>');g.msg(p,v,"info");AJS.$(".jiraSearchResults",c).append(p)}},error:function(m){AJS.$(":disabled",c).enable();l.remove();f.call(g,m)}})},retrieveJson:function(c,a,d,b){AppLinks.makeRequest({appId:c,type:"GET",url:a,dataType:"json",success:d,error:b})}};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:dialogsJs', location = '/jira/searchpanel.js' */
AJS.Editor.JiraConnector.Panel.Search=function(){this.jql_operators=/=|!=|~|>|<|!~| is | in /i};AJS.Editor.JiraConnector.Select2=AJS.Editor.JiraConnector.Select2||{};AJS.Editor.JiraConnector.Select2.getKeyColumnsSelectedOptions=function(b){var a=[];var d=b.select2("data");for(var c=0;c<d.length;c++){a[c]=d[c].id}return a.join()};AJS.Editor.JiraConnector.Panel.Search.prototype=AJS.$.extend(AJS.Editor.JiraConnector.Panel.Search.prototype,AJS.Editor.JiraConnector.Panel.prototype);AJS.Editor.JiraConnector.Panel.Search.prototype=AJS.$.extend(AJS.Editor.JiraConnector.Panel.Search.prototype,{defaultColumns:"key,summary,type,created,updated,due,assignee,reporter,priority,status,resolution",DEFAULT_MAX_ISSUES_VAL:20,MAXIMUM_MAX_ISSUES_VAL:1000,MINIMUM_MAX_ISSUES_VAL:1,title:function(){return "Search"},init:function(a){a.html('<div id="my-jira-search"></div>');var f=this;var b=AJS.$("#my-jira-search");this.container=b;var h=function(){b.children(":not(div.jira-search-form)").remove()};var e=function(){AJS.$("input.text",b).enable();AJS.$("button",b).enable()};var l=function(){AJS.$("button",b).disable();AJS.$("input.text",b).disable()};var i=function(n){h();f.disableInsert();if(n){f.selectedServer=n}if(f.selectedServer.authUrl){l();var m=f.createOauthForm(function(){h();e()});b.append(m)}else{e();AJS.$(".search-help").show()}};this.authCheck=i;var g=function(x){var m=x&&x.searchValue;var o=x&&x.serverName;if(m){AJS.$("input:text",b).val(m)}if(o&&o!=this.selectedServer.name){var y=AJS.Editor.JiraConnector.servers;var q=false;for(var r=0;r<y.length;r++){if(y[r].name==o){AJS.$('option[value="'+y[r].id+'"]',b).attr("selected","selected");AJS.$("select",b).change();q=true;break}}if(!q){c(AJS.Meta.get("is-admin"));return}}if(this.currentXhr&&this.currentXhr.readyState!=4){return}var p=m||AJS.$("input",b).val();if(AJS.Editor.JiraAnalytics){var w=AJS.JQLHelper.checkQueryType(p);if(w){AJS.Editor.JiraAnalytics.triggerSearchEvent({type:w,source:"dialog"})}}var s=function(C,E,D){var B=b.find("#jiraIssueColumnSelector");var A=B.val()&&B.val().join();AJS.$("select",b).disable();l();f.lastSearch=C;f.createIssueTableFromUrl(b,f.selectedServer.id,"/sr/jira.issueviews:searchrequest-xml/temp/SearchRequest.xml?jqlQuery="+encodeURIComponent(C)+"&returnMax=true&tempMax=20&field=summary&field=type&field=link",f.selectHandler,f.insertLinkFromForm,function(){f.addDisplayOptionPanel();f.loadMacroParams(A);f.bindEventToDisplayOptionPanel(true,x);f.enableInsert()},function(F){f.addDisplayOptionPanel();f.loadMacroParams(A);f.bindEventToDisplayOptionPanel(false,x);f.updateTotalIssuesDisplay(F);f.checkAutoSelectColumns();x&&x.isAutoSearch&&f.focusForm()},function(F){f.disableInsert();if(F.status==400){if(D){D()}else{AJS.$("div.data-table",b).remove();f.warningMsg(b,AJS.format("The JIRA server didn\'\'t understand your search query. If you entered JQL, please ensure that it\'\'s correctly formed. If you entered an issue key, ensure that it exists and you have permission to view it. {0}",Confluence.Templates.ConfluenceJiraPlugin.learnMore()))}}else{AJS.$("div.data-table",b).remove();f.ajaxError(F,i)}x&&x.isAutoSearch&&f.focusForm()},true)};if(AJS.JQLHelper.isFilterUrl(p)){var n=decodeURIComponent(p);var v=AJS.JQLHelper.findServerIndexFromUrl(n,AJS.Editor.JiraConnector.servers);if(v!=-1){var t=AJS.Editor.JiraConnector.servers[v].id;AJS.$('option[value="'+t+'"]',b).attr("selected","selected");AJS.$("select",b).change();var z=AJS.JQLHelper.getFilterFromFilterUrl(n);if(z){AJS.$("input",b).val(z);s(z)}else{h();f.warningMsg(b,AJS.format("The JIRA server didn\'\'t understand your search query. If you entered JQL, please ensure that it\'\'s correctly formed. If you entered an issue key, ensure that it exists and you have permission to view it. {0}",Confluence.Templates.ConfluenceJiraPlugin.learnMore()))}}else{h();f.disableInsert();c(AJS.Meta.get("is-admin"))}}else{if(AJS.JQLHelper.isIssueUrlOrXmlUrl(p)){var n=decodeURIComponent(p);var u=AJS.JQLHelper.getJqlAndServerIndexFromUrl(n,AJS.Editor.JiraConnector.servers);if(d(u)){AJS.$("input",b).val(u.jqlQuery);s(u.jqlQuery,false,null)}}else{if(p.match(f.jql_operators)){s(p,false,null)}else{if(AJS.JQLHelper.isSingleKeyJQLExp(p)){s("key = "+p,true)}else{if(AJS.JQLHelper.isMultipleSingleKeyJQLExp(p)){s("key in ("+p+")",true)}else{s('summary ~ "'+p+'" OR description ~ "'+p+'"',false,null)}}}}}};this.doSearch=g;f.addSearchForm();var d=function(m){var n;if(m.serverIndex!=-1){AJS.$('option[value="'+AJS.Editor.JiraConnector.servers[m.serverIndex].id+'"]',b).attr("selected","selected");AJS.$("select",b).change();if(m.jqlQuery.length==0){h();f.errorMsg(b,"The JIRA server didn\'t understand your search query. If you entered JQL, please ensure that it\'s correctly formed. If you entered an issue key, ensure that it exists and you have permission to view it. {0}")}else{n=m.jqlQuery}}else{h();f.disableInsert();c(AJS.Meta.get("is-admin"))}return n};f.processJiraParams=d;var c=function(m){var o=Confluence.Templates.ConfluenceJiraPlugin.showMessageNoServer({isAdministrator:m,contextPath:Confluence.getContextPath()});f.noServerMsg(b,o);var n=AJS.$("#open_applinks");n.bind("click",function(){AJS.Editor.JiraConnector.clickConfigApplink=true;AJS.Editor.JiraConnector.refreshAppLink=function(){f.refreshSearchForm()}})};f.bindPasteEvent();AJS.$(a).select(function(){f.validate()});var k=AJS.$(".jql-display-opts-open.disabled");var j={live:true,title:function(){return AJS.$(".jql-display-opts-open.disabled").data("title")},gravity:"s",delayIn:300,delayOut:0};k.tooltip(j)},focusForm:function(){AJS.$('input[name="jiraSearch"]',this.container).focus()},addSearchForm:function(){var d=this;d.container.empty();var f=AJS.Editor.JiraConnector.servers;d.selectedServer=f[0];var a=false;if(f.length>1){a=true}var e=Confluence.Templates.ConfluenceJiraPlugin.searchForm({isMultiServer:a});var c=AJS.$(e).appendTo(d.container);if(f.length>1){var b=AJS.$('<select class="select" tabindex="0"></select>').insertAfter("div.search-input",c);d.applinkServerSelect(b,d.authCheck)}d.authCheck(d.selectedServer);AJS.$("button",d.container).click(function(){d.doSearch()});d.setActionOnEnter(AJS.$("input.text",d.container),d.doSearch)},bindPasteEvent:function(){var a=this;AJS.$("#my-jira-search input:text").bind("paste",function(){var b=this;setTimeout(function(){var d=AJS.$(b).val();if(AJS.JQLHelper.isFilterUrl(d)){a.doSearch()}else{if(AJS.JQLHelper.isIssueUrlOrXmlUrl(d)){var e=decodeURIComponent(d);var c=AJS.JQLHelper.getJqlAndServerIndexFromUrl(e,AJS.Editor.JiraConnector.servers);if(a.processJiraParams(c)){AJS.$(b).val(c.jqlQuery);a.doSearch()}}}},100)})},refreshSearchForm:function(){this.container.empty();this.addSearchForm();this.bindPasteEvent()},validate:function(e,d){var c=this.container;var f=AJS.$("input:checkbox[name=jira-issue]",c);var b=AJS.Editor.JiraConnector.Panel.Search.prototype;if(f.length||e){var a=AJS.$("input:checkbox[name=jira-issue]:checked",c).length;if(a>0||e){b.enableInsert()}else{b.disableInsert()}b.changeInsertOptionStatus(a,e,d)}else{if(AJS.$(".jira-oauth-message-marker",c).length){b.authCheck(this.selectedServer)}AJS.$("input",c).focus();b.disableInsert()}if(b.isInsertDisabled()){return}b.validateMaxIssues()},isValidMaxIssues:function(a){return AJS.$.isNumeric(a)&&(this.MINIMUM_MAX_ISSUES_VAL<=a&&a<=this.MAXIMUM_MAX_ISSUES_VAL)},validateMaxIssues:function(i){var b=AJS.$("#jira-maximum-issues");function d(){b.next("#jira-max-number-error").remove()}function f(){b.attr("disabled","disabled")}function h(){b.removeAttr("disabled")}function c(){d();b.after(Confluence.Templates.ConfluenceJiraPlugin.warningValMaxiumIssues())}switch(AJS.$("input:radio[name=insert-advanced]:checked").val()){case"insert-single":case"insert-count":d();f();break;case"insert-table":var a=AJS.Editor.JiraConnector.Panel.Search.prototype;h();var g=b.val();if(AJS.$.trim(g)===""){if(i&&i.type==="keyup"){d();break}if(i&&i.type==="blur"){g=a.MAXIMUM_MAX_ISSUES_VAL;b.val(g);break}}if(a.isValidMaxIssues(g)){d();a.enableInsert()}else{c();a.disableInsert()}break}},customizedColumn:null,parseColumnsStringToArray:function(g){var f="";var b=[];var a=null;var c=function(i,h){i=AJS.$.trim(i);if(i!=""){h.push(i)}};for(var e=0;e<g.length;e++){var d=g.charAt(e);if(d!==","&&d!=='"'&&d!=="'"){f+=d}if(d==='"'||d==="'"){if(a==null){a=d}else{if(a===d){c(f,b);f="";a=null}}}else{if(d===","){if(a==null){c(f,b);f=""}else{f+=d}}}}c(f,b);return b},parseArrayToColumnString:function(b){var a="";for(var c=0;c<b.length;c++){var d=AJS.$.trim(b[c]);if(d!=""){if(d.indexOf(",")>=0){d='"'+d+'"'}if(c!=0){a+=","}a+=d}}},checkAndSetDefaultValueMaximumIssues:function(a){if(!a){AJS.log("Cannot set default value for Maximum Issues");return}var b=a.element||AJS.$("#jira-maximum-issues");var d=a.defaultVal||this.MAXIMUM_MAX_ISSUES_VAL;var c=AJS.$.trim(b.val());if(c===""){b.val(d)}},setMacroParams:function(a){this.macroParams=a},getMacroParamsFromUserInput:function(){var e=((AJS.$("input:radio[name=insert-advanced]:checked").val()=="insert-count")?true:false);var d=[];var a=[];AJS.$("#my-jira-search .my-result.aui input:checkbox[name=jira-issue]").each(function(f){var g=AJS.$(this);if(g.is(":checked")){d[d.length]=g.val()}else{a[a.length]=g.val()}});var c={};if(e){c.count="true"}else{if(!AJS.Editor.JiraConnector.Panel.Search.jiraColumnSelectBox){c.columns=this.defaultColumns;return}c.columns=AJS.Editor.JiraConnector.Select2.getKeyColumnsSelectedOptions(AJS.Editor.JiraConnector.Panel.Search.jiraColumnSelectBox);if(!c.columns){c.columns=this.defaultColumns}}var b=AJS.$("input:radio[name=insert-advanced]:checked").val();if(b==="insert-single"){c.key=d.toString()}else{if(a.length==0){c.jqlQuery=this.lastSearch+" "}else{if(d.length==1){c.jqlQuery="key = "+d.toString()}else{c.jqlQuery="key in ("+d.toString()+")"}}}if(b==="insert-table"){c.maximumIssues=AJS.$("#jira-maximum-issues").val()}return c},insertLinkFromForm:function(){var c=this;var b=c.container;var d=AJS.$("input:checkbox[name=jira-issue]",b);if(d.length){var a=AJS.$("input:checkbox[name=jira-issue]:checked",b).length;if(a>0){c.insertLink()}}},insertLink:function(c){var a;if(c&&typeof c.insertIssueLinkWithParams==="function"){a=c}else{a=this}var b=a.getMacroParamsFromUserInput();a.insertIssueLinkWithParams(b);return true},loadMacroParams:function(a){var b=this.macroParams;if(!b){this.prepareColumnInput(a||this.defaultColumns);this.checkAndSetDefaultValueMaximumIssues({defaultVal:20})}else{b.columns=a||b.columns||this.defaultColumns;if(!b.maximumIssues){AJS.$("#jira-maximum-issues").attr("disabled","disabled")}if(b.count=="true"){AJS.$("#opt-total").prop("checked",true)}else{AJS.$("#opt-table").prop("checked",true);AJS.$("#jira-maximum-issues").removeAttr("disabled");var c=b.maximumIssues||this.DEFAULT_MAX_ISSUES_VAL;this.checkAndSetDefaultValueMaximumIssues({defaultVal:c})}this.prepareColumnInput(b.columns)}},selectHandler:function(){var a=this.container;var b=a.find("tr.selected");if(b.length){b.unbind("keydown.space").bind("keydown.space",function(c){if(c.which==32||c.keyCode==32){var d=b.find("[type=checkbox]");d.trigger("click")}})}},addDisplayOptionPanel:function(){var a=Confluence.Templates.ConfluenceJiraPlugin.displayOptsOverlayHtml;AJS.$(".jiraSearchResults").after(a());AJS.$("#jiraMacroDlg").unbind("submit").on("submit",function(b){return false})},updateTotalIssuesDisplay:function(b){var a=this.selectedServer.url+"/issues/?jql="+this.lastSearch;if(b>20){AJS.$(".my-result.aui").after(Confluence.Templates.ConfluenceJiraPlugin.viewAll({jiraIssuesLink:a}))}var c=AJS.format("{0} issues",b);AJS.$(".total-issues-text").html(c);AJS.$(".total-issues-link").attr("href",a)},prepareColumnInput:function(c){var b=c.split(/\s*,\s*/);for(var a in b){var g=b[a];if(g&&typeof g.toLowerCase==="function"){b[a]=g.toLowerCase()}}var f=this.selectedServer;var d={issuekey:"key",duedate:"due",issuetype:"type"};var e=function(j){var p=[];var s=AJS.$("#jiraIssueColumnSelector");var l="";var o="";var r;for(var k=0;k<j.length;k++){var q=j[k];if(q.navigable){if(d[q.id]){q.id=d[q.id]}if(q.custom===true){r=q.name.toLowerCase()}else{r=q.id.toLowerCase()}var n=AJS.template("<option value='{value}'>{displayValue}</option>");p[r]=q.name;if(AJS.$.inArray(r,b)<0){l+=n.fill({value:r,displayValue:q.name})}}}p.key="Key";for(var k=0;k<b.length;k++){var h=AJS.template("<option selected='true' value='{value}'>{displayValue}</option>");r=b[k].toLowerCase();if(p[r]!=null){o+=h.fill({value:r,displayValue:p[r]})}}var m=o+l;s.html(m);s.auiSelect2({width:"415px",containerCssClass:"select2-container-jira-issue-columns"});AJS.Editor.JiraConnector.Panel.Search.jiraColumnSelectBox=s};if(f.columns&&f.columns.length>0){e(f.columns);return}this.retrieveJson(f.id,"/rest/api/2/field",function(h){if(h&&h.length){f.columns=h;e(f.columns)}})},expandDisplayOptPanel:function(){var b=AJS.$(".jql-display-opts-overlay");var c=b.height();var d=40;b.css("top","");var a=-(c-d);b.css("bottom",a+"px");b.animate({bottom:0},500)},minimizeDisplayOptPanel:function(){var a=AJS.$(".jql-display-opts-overlay");a.css("top",a.position().top+"px");a.css("bottom","");a.animate({top:420},500)},disableAutoSelectColumns:function(){AJS.Editor.JiraConnector.Panel.Search.jiraColumnSelectBox.auiSelect2("enable",false)},enableAutoSelectColumns:function(){AJS.Editor.JiraConnector.Panel.Search.jiraColumnSelectBox.auiSelect2("enable",true)},checkAutoSelectColumns:function(){if(AJS.$("#opt-table").prop("checked")){this.enableAutoSelectColumns()}else{this.disableAutoSelectColumns();this.enableInsert()}},bindEventToDisplayOptionPanel:function(f,h){var d=this;var b=AJS.$(".jql-display-opts-close, .jql-display-opts-open"),c=AJS.$(".jql-display-opts-overlay"),i=AJS.$(".jql-display-opts-inner .radio"),a=AJS.$("#my-jira-search input:checkbox[name=jira-issue-all]"),e=AJS.$("#my-jira-search input:checkbox[name=jira-issue]");var g=AJS.$("#jira-maximum-issues");g.on("blur keyup",AJS.Editor.JiraConnector.Panel.Search.prototype.validateMaxIssues);c.css("top","420px");b.click(function(j){j.preventDefault();if(AJS.$(this).hasClass("disabled")){return}var k=AJS.$(this).hasClass("jql-display-opts-open");if(k){d.expandDisplayOptPanel();jQuery(this).addClass("jql-display-opts-close");jQuery(this).removeClass("jql-display-opts-open")}else{d.minimizeDisplayOptPanel();jQuery(this).removeClass("jql-display-opts-close");jQuery(this).addClass("jql-display-opts-open")}});i.change(function(){d.checkAutoSelectColumns();d.validateMaxIssues()});a.bind("click",function(){var j=AJS.$(this);if(j.prop("checked")){e.prop("checked","checked")}else{e.removeAttr("checked")}d.validate()});e.change(function(){var j=AJS.$("#my-jira-search input:checkbox[name=jira-issue]:not(:checked)").length;if(j>0){a.removeAttr("checked")}else{a.prop("checked","checked")}d.validate()});d.validate(f,h)},changeInsertOptionStatus:function(q,n,f){var r=this;var g=AJS.$("#opt-single");var d=AJS.$("#opt-total");var m=AJS.$("#opt-table");var j=AJS.$("#my-jira-search input:checkbox[name=jira-issue]:checked");var i=AJS.$("#my-jira-search input:checkbox[name=jira-issue-all]").attr("checked")==="checked";var l=j.length===1;var p=j.length>1;var h=j.length===0;var b=AJS.JQLHelper.isSingleKeyJQLExp(AJS.$("#my-jira-search input[name=jiraSearch]").val());var c=function(){if(f&&f.isJqlQuery){m.click()}else{g.click()}};var k=function(){d.attr("disabled","disabled");m.removeAttr("disabled");g.removeAttr("disabled");c();setTimeout(function(){c()},100)};var e=function(){g.attr("disabled","disabled");d.removeAttr("disabled");if(AJS.$("input[name=insert-advanced]:checked").val()==="insert-single"){setTimeout(function(){m.removeAttr("disabled").click()},100)}};var o=function(){m.removeAttr("disabled","disabled");d.removeAttr("disabled","disabled");g.removeAttr("disabled","disabled");var s=AJS.$("input:radio[name=insert-advanced]:checked").val();if(s==="insert-single"){setTimeout(function(){m.click()},100)}};var a=function(){g.attr("disabled","disabled");d.attr("disabled","disabled");m.attr("disabled","disabled");AJS.$(".jql-display-opts-close").click();AJS.$(".jql-display-opts-open").addClass("disabled")};AJS.$(".jql-display-opts-open").removeClass("disabled");g.removeAttr("disabled");d.removeAttr("disabled");m.removeAttr("disabled");if(i&&l&&b){k()}else{if(i&&l&&!b){o()}else{if(p){e()}else{if(l&&!i){k()}else{if(n){e()}else{if(h){a()}}}}}}},isInsertTableType:function(){return AJS.$("input:radio[name=insert-advanced]:checked").val()==="insert-table"},setInsertButtonState:function(){var a=AJS.$(".jql-display-opts-close, .jql-display-opts-open");var b=AJS.$("#jira-maximum-issues");if(!a.length||(a.length&&this.isInsertTableType()&&!this.isValidMaxIssues(b.val()))){this.disableInsert()}else{this.enableInsert()}},analyticPanelActionName:"confluence.jira.plugin.searchadded"});AJS.Editor.JiraConnector.Panels.push(new AJS.Editor.JiraConnector.Panel.Search());
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:dialogsJs', location = '/jira/jip_createissuepanel.js' */
AJS.Editor.JiraConnector.Panel.Create=function(){};AJS.Editor.JiraConnector.Panel.Create.prototype=AJS.$.extend(AJS.Editor.JiraConnector.Panel.Create.prototype,AJS.Editor.JiraConnector.Panel.prototype);AJS.Editor.JiraConnector.Panel.Create.prototype=AJS.$.extend(AJS.Editor.JiraConnector.Panel.Create.prototype,{DEFAULT_PROJECT_VALUE:"-1",SHOW_MESSAGE_ON_TOP:true,EXCLUDED_FIELDS:["project","issuetype","summary","description"],PROJECTS_META:{},setSummary:function(b){var a=AJS.$('.field-group [name="summary"]',this.jipForm.formEl);a.length&&a.val(b)},resetIssue:function(){AJS.$(".issue-summary",this.container).empty();AJS.$(".issue-description",this.container).empty()},focusForm:function(){var a=AJS.$("select.server-select",this.container);if(a.length){a.focus()}else{var b=AJS.$(".project-select",this.container);b.length&&b.focus()}},authCheck:function(){this.selectedServer=this.jipForm.getCurrentServer();if(this.selectedServer.authUrl){this.showOauthChallenge()}else{this.serverSelect()}},ajaxAuthCheck:function(b){var a=this;this.endLoading();this.ajaxError(b,function(){a.authCheck(a.jipForm.getCurrentServer())})},showOauthChallenge:function(){AJS.$("div.field-group",this.container).not(".servers").hide();AJS.$(".jira-oauth-message-marker",this.container).remove();var a=this;var b=this.createOauthForm(function(){a.serverSelect()});this.container.append(b)},projectOk:function(){var a=AJS.$(".project-select option:selected",this.container).val();return a&&a.length&&a!=this.DEFAULT_PROJECT_VALUE},setInsertButtonState:function(){if(this.formHasError===false&&this.projectOk()){this.enableInsert();return true}else{this.disableInsert();return false}},startLoading:function(){this.removeError(this.container);AJS.$(".loading-blanket",this.container).removeClass("hidden");AJS.$("input,select,textarea",this.container).disable();this.disableInsert();this.handleInsertWaiting(true)},endLoading:function(){AJS.$(".loading-blanket",this.container).addClass("hidden");AJS.$("input,select,textarea",this.container).enable();if(AJS.$(".project-select",this.container).val()===this.DEFAULT_PROJECT_VALUE){AJS.$(".issuetype-select",this.container).disable()}this.setInsertButtonState();this.handleInsertWaiting(false)},bindEvent:function(){var b=this;var a=AJS.$('.field-group [name="summary"]',this.jipForm.formEl);a.keyup(function(){b.setInsertButtonState()});this.container.on("focus","input[data-aui-dp-uuid]",function(){var c=AJS.$(this).attr("data-aui-dp-uuid");setTimeout(function(){AJS.$("[data-aui-dp-popup-uuid="+c+"]").parents(".aui-inline-dialog").addClass("datepicker-patch")},0)})},title:function(){return "Create New Issue"},init:function(b){var c=this;b.html('<div class="create-issue-container"></div>');this.container=AJS.$("div.create-issue-container");var a=this.container;var d=AJS.Editor.JiraConnector.servers;this.selectedServer=d[0];this.jipForm=new jiraIntegration.JiraCreateIssueForm({container:".create-issue-container",renderSummaryAndDescription:true,onError:function(){AJS.$(".field-group .error",this.container).remove();c.formHasError=true;c.disableInsert()},onServerChanged:function(){AJS.$(".field-group .error",this.container).remove();c.setInsertButtonState();c.selectedServer=this.getCurrentServer()},onRequiredFieldsRendered:function(f,e){AJS.$(".field-group .error",this.container).remove();c.formHasError=!!e.length;c.setInsertButtonState()}});b.onselect=function(){c.onselect()};this.bindEvent()},convertFormToJSON:function(b){if(!jiraIntegration){AJS.logError("Jira integration plugin is missing!");return""}var c={};c.issues=[];var a={};a.fields={project:{id:AJS.$(".project-select option:selected",b).val()},issuetype:{id:AJS.$(".issuetype-select option:selected",b).val()},summary:AJS.$('.field-group [name="summary"]',b).val(),description:AJS.$('.field-group [name="description"',b).val()};b.children(".create-issue-required-fields").children(".jira-field").children("input,select,textarea").not(".select2-input").each(function(d,e){var f=AJS.$(e);a.fields[f.attr("name")]=jiraIntegration.fields.getJSON(f)});c.issues.push(a);return JSON.stringify(c)},validateRequiredFieldInForm:function(b){var d=true;var a="placeholder" in document.createElement("input");var c=b.find(".field-group .icon-required, .field-group .aui-icon-required");c.each(function(h,l){var k=AJS.$(l).parent();var g=k.text();var i=k.nextAll("input,select,textarea");var j=AJS.$.trim(i.val());if(!j||(!a&&j==i.attr("placeholder"))){d=false;var f=k.parent();var e=AJS.format("{0} is required",g);f.append(aui.form.fieldError({message:e}))}});return d},clearFieldErrors:function(){AJS.$("form div.error",this.container).remove()},insertLink:function(){var b=this;var c=Confluence.getContextPath()+"/rest/jira-integration/1.0/issues";var a=AJS.$("div.create-issue-container form");var d=this.jipForm.getCurrentServer();b.clearFieldErrors();if(!b.validateRequiredFieldInForm(a)){return}this.startLoading();AJS.$.ajax({type:"POST",contentType:"application/json",url:c+"?applicationId="+this.selectedServer.id,data:this.convertFormToJSON(a),success:function(h){var f=h&&h.issues&&h.issues[0]&&h.issues[0].issue&&h.issues[0].issue.key;if(!f){if(!_.isEmpty(h.errors[0].elementErrors.errorMessages)){var g=h.errors[0].elementErrors.errorMessages;var i=Confluence.Templates.ConfluenceJiraPlugin.renderCreateErrorPanel({errors:g,serverUrl:d.displayUrl});b.errorMsg(AJS.$("div.create-issue-container"),i)}var e=h.errors[0].elementErrors.errors;_.each(e,function(l,k){var j=aui.form.fieldError({message:l});AJS.$(AJS.format(".field-group [name={0}]",k),a).after(j)})}else{b.insertIssueLink(f,d.displayUrl+"/browse/"+f);b.resetIssue()}b.endLoading()},error:function(f,e){b.ajaxAuthCheck(f)}})},onselect:function(){var a=!!AJS.$(".aui-message > .oauth-init",this.container).length;if(this.selectedServer&&!this.selectedServer.authUrl&&a){this.jipForm.defaultFields.server.trigger("change")}else{this.setInsertButtonState()}},analyticPanelActionName:"confluence.jira.plugin.issuecreated"});AJS.Editor.JiraConnector.Panels.push(new AJS.Editor.JiraConnector.Panel.Create());
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:dialogsJs', location = '/jira/recentlyviewedpanel.js' */
AJS.Editor.JiraConnector.Panel.Recent=function(){};AJS.Editor.JiraConnector.Panel.Recent.prototype=AJS.$.extend(AJS.Editor.JiraConnector.Panel.Recent.prototype,AJS.Editor.JiraConnector.Panel.prototype);AJS.Editor.JiraConnector.Panel.Recent.prototype=AJS.$.extend(AJS.Editor.JiraConnector.Panel.Recent.prototype,{title:function(){return "Recently Viewed"},init:function(a){var d=AJS.Editor.JiraConnector.servers;a.html('<div id="my-recent-issues" '+(d.length>1?'class="multi-server" ':"")+"></div>");var c=this;this.selectedServer=d[0];if(d.length>1){var b=AJS.$('<div class="jira-server-select"><form action="#" method="post" class="aui"><div class="field-group"><label>Server</label><select class="select" ></select></div></form></div>').appendTo("div#my-recent-issues");this.applinkServerSelect(AJS.$(".select",b),function(e){c.selectedServer=e;c.onselect()})}a.onselect=function(){c.onselect()}},insertLink:function(){this.insertSelected()},onselect:function(){var c=this;var b=AJS.$("div#my-recent-issues");this.container=b;var d=function(){b.children().not(".jira-server-select").remove()};var e;var a=function(){if(c.selectedServer.authUrl){d();var f=c.createOauthForm(function(){e()});b.append(f)}else{e()}};e=function(){if(c.currentXhr&&c.currentXhr.readyState!=4){return}var f=AJS.$(".select",b);f.disable();d();var g="key+in+issueHistory()+ORDER+BY+lastViewed+DESC";c.createIssueTableFromUrl(b,c.selectedServer.id,"/sr/jira.issueviews:searchrequest-xml/temp/SearchRequest.xml?jqlQuery="+g+"&field=summary&field=type&field=link&tempMax=50&returnMax=true",c.setSelectedIssue,c.insertLink,c.disableInsert,function(){f.length&&f.focus()},function(h){AJS.$("div.data-table",b).remove();c.ajaxError(h,a)},false)};a()},analyticPanelActionName:"confluence.jira.plugin.recentlyviewadded"});AJS.Editor.JiraConnector.Panels.push(new AJS.Editor.JiraConnector.Panel.Recent());
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:dialogsJs', location = 'templates/soy/dialog.soy' */
// This file was automatically generated from dialog.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.ConfluenceJiraPlugin == 'undefined') { Confluence.Templates.ConfluenceJiraPlugin = {}; }


Confluence.Templates.ConfluenceJiraPlugin.displayOptsHtml = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class=\'jql-display-opts-bar data-table\'><a href=\'#\' class=\'jql-display-opts-open\' data-title="', soy.$$escapeHtml("Display options panel is not available without a selection."), '"><span></span><strong>', soy.$$escapeHtml("Display options"), '</strong></a></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.displayOptsOverlayHtml = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class=\'jql-display-opts-overlay data-table\'><form id="jiraMacroDlg" class="aui" action="#"><div class=\'jql-display-opts-inner\'><a href=\'#\' class=\'jql-display-opts-open\' data-title="', soy.$$escapeHtml("Display options panel is not available without a selection."), '"><span></span><strong>', soy.$$escapeHtml("Display options"), '</strong></a><fieldset class="group"><legend><span>', soy.$$escapeHtml("Display as"), '</span></legend><div class="radio"><input type=\'radio\' class=\'radio\' name=\'insert-advanced\' id=\'opt-single\' value=\'insert-single\'><label for=\'opt-single\'>', soy.$$escapeHtml("Single issue"), '</label><div class=\'description\'>', soy.$$escapeHtml("Display the macro as a single issue."), '</div></div><div class="radio"><input type=\'radio\' class=\'radio\' name=\'insert-advanced\' id=\'opt-total\' value=\'insert-count\'><label for=\'opt-total\'>', soy.$$escapeHtml("Total issue count"), '</label><div class=\'description\'>', soy.$$escapeHtml("Display total number of issues as a link. E.g. "), '<a class=\'total-issues-link\' target=\'_blank\' href=\'#\'><span class=\'total-issues-text\'>', soy.$$escapeHtml(AJS.format("{0} issues",12)), '</span></a></div></div><div class="radio"><input type=\'radio\' class=\'radio\' checked=\'checked\' name=\'insert-advanced\' id=\'opt-table\' value=\'insert-table\'><label for=\'opt-table\'>', soy.$$escapeHtml("Table"), '</label><div class=\'description\'>', soy.$$escapeHtml("Customise your columns below."), '</div></div></fieldset><fieldset><div class="field-group"><label>', soy.$$escapeHtml("Maximum issues"), '</label><input type="text" name="jira-maximum-issues" id="jira-maximum-issues" class="text short-field" /><div class="description">', soy.$$escapeHtml("Leave empty to get all issues."), '</div></div></fieldset><fieldset><div class="field-group"><label>', soy.$$escapeHtml("Columns to display"), '</label><select id="jiraIssueColumnSelector" data-placeholder="', soy.$$escapeHtml("Start typing to see possible columns"), '" multiple="true" class="select long-field"></select></div></fieldset></div></form></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.searchForm = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class=\'jira-search-form\'><form class=\'aui\'><fieldset class=\'inline\'>', (opt_data.isMultiServer == true) ? '<div class=\'search-input\'><input type=\'text\' class=\'text search-text\' name=\'jiraSearch\'/></div>' : '<div class=\'search-input one-server\'><input type=\'text\' class=\'text one-server long-field\' name=\'jiraSearch\'/></div>', '<button type=\'button\' title="', soy.$$escapeHtml("Search"), '" class=\'button\'><span class="aui-icon aui-icon-small aui-iconfont-search"></span></button></fieldset><div class=\'search-help\'>', soy.$$escapeHtml("Search using any issue key, search URL, JIRA link, JQL or plain text"), '</div></form></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.warningDialog = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class=\'warning-body\'><p>', soy.$$escapeHtml("If you connect Confluence to JIRA you can easily link issues..."), '</p>', (opt_data.isAdministrator == false) ? '<p>' + soy.$$escapeHtml("Your administrator can set this up.") + '</p>' : '', '</div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.issueCheckbox = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<input type=\'checkbox\' name=\'jira-issue\' value=\'', soy.$$escapeHtml(opt_data.issueKey), '\' checked/>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.issueKey = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<span><img class="icon" src="', soy.$$escapeHtml(opt_data.issueIconUrl), '"/> ', soy.$$escapeHtml(opt_data.issueKey), '</span>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.showMessageNoServer = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append((opt_data.isAdministrator == true) ? soy.$$escapeHtml("No server found match with your URL.") + '<a id="open_applinks" target="_blank" href="' + soy.$$escapeHtml(opt_data.contextPath) + '/admin/listapplicationlinks.action">' + soy.$$escapeHtml("Click here to set this up") + '</a>' : soy.$$escapeHtml("No server found match with your URL. Your administrator can set this up.") + '<a id="open_applinks" target="_blank" href="' + soy.$$escapeHtml(opt_data.contextPath) + '/wiki/contactadministrators.action">' + soy.$$escapeHtml("Click here to contact your admin") + '</a>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.viewAll = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class=\'view-all\'>', soy.$$escapeHtml("Displaying first 20 results. "), '<a href=\'', soy.$$escapeHtml(opt_data.jiraIssuesLink), '\' target=\'_blank\'>', soy.$$escapeHtml("View all."), '</a></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.learnMore = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<a href="', soy.$$escapeHtml("JIRA+Issues+Macro"), '" target=\'_blank\'>', soy.$$escapeHtml("Learn More"), '</a>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.contentJiraChart = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="jira-chart-content"><div class=\'jira-chart-search\'><form class=\'aui\'><fieldset class=\'inline\'>', (opt_data.isMultiServer == true) ? '<div class=\'jira-chart-search-input\'><input type=\'text\' id="jira-chart-inputsearch" class=\'text search-text\' name=\'jiraSearch\'/></div><select id="jira-chart-servers" class="select" name="server" tabindex="0" />' : '<div class=\'jira-chart-search-input one-server\'><input type=\'text\' id="jira-chart-inputsearch" class=\'text one-server long-field\' name=\'jiraSearch\'/></div>', '<button id="jira-chart-search-button" type=\'button\' class=\'button\'>', soy.$$escapeHtml("Preview"), '</button></fieldset><div class=\'search-help\'>', soy.$$escapeHtml("Search using any issue key, search URL, JIRA link, JQL or plain text"), '</div></form></div><div class="jira-chart-img"></div><div class="jira-chart-option"><form action="#" class="aui" id="jiraChartMacroOption"><div class="jiraChartOption"><a class="jirachart-display-opts-open" href="#"><span></span><strong>', soy.$$escapeHtml("Display options"), '</strong></a><fieldset><div class="field-group"><label for="dBase">', soy.$$escapeHtml("Chart by"), '</label><select name="type" id="jira-chart-statType" class="select"><option value="statuses">', soy.$$escapeHtml("Status"), '</option><option value="priorities">', soy.$$escapeHtml("Priority"), '</option><option value="assignees">', soy.$$escapeHtml("Assignee"), '</option><option value="allFixfor">', soy.$$escapeHtml("Fix For Versions (all)"), '</option><option value="components">', soy.$$escapeHtml("Component"), '</option><option value="issuetype">', soy.$$escapeHtml("Issue Type"), '</option></select></div><div class="field-group"><label for="width">', soy.$$escapeHtml("Width"), '</label><input type="text" name="jira-chart-width" id="jira-chart-width" class="text short-field"><div class="description">', soy.$$escapeHtml("Enter a width in pixels, percent or leave blank to automatically resize"), '</div></div></fieldset><fieldset class="group"><div class="checkbox"><input type="checkbox" id="jira-chart-border" name="border" class="checkbox"><label for="jira-chart-show-border">', soy.$$escapeHtml("Show border"), '</label></div></fieldset><fieldset class="group"><div class="checkbox"><input type="checkbox" id="jira-chart-show-infor" name="jira-chart-show-infor" class="checkbox" value="checked" ><label for="jira-chart-show-infor">', soy.$$escapeHtml("Show chart information"), '</label></div></fieldset></div></form></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.showMessageRenderJiraChart = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-message-container"><div class="aui-message warning">', soy.$$escapeHtml("The JIRA server didn\x27t understand your search query. If you entered JQL, please ensure that it\x27s correctly formed. If you entered an issue key, ensure that it exists and you have permission to view it."), '<!--<a href="', soy.$$escapeHtml("#"), '" target=\'_blank\'>', soy.$$escapeHtml("Learn More"), '</a>--><span class="aui-icon icon-warning"></span></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.noServerWarning = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-message-container"><div class="aui-message warning">', (opt_data.isAdministrator == true) ? soy.$$escapeHtml("No server found match with your URL.") + '<a id="open_applinks" target="_blank" href="' + soy.$$escapeHtml(opt_data.contextPath) + '/admin/listapplicationlinks.action">' + soy.$$escapeHtml("Click here to set this up") + '</a>' : soy.$$escapeHtml("No server found match with your URL. Your administrator can set this up.") + '<a id="open_applinks" target="_blank" href="' + soy.$$escapeHtml(opt_data.contextPath) + '/wiki/contactadministrators.action">' + soy.$$escapeHtml("Click here to contact your admin") + '</a>', '<span class="aui-icon icon-warning"></span></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.addMoreToComeLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li class="page-menu-item"><span class="item-button moreToCome"><a target="_blank" href="http://go.atlassian.com/confluencejiracharts">', soy.$$escapeHtml("More to come..."), '</a></span></li>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.jqlInvalid = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-message-container"><div class="aui-message warning">', soy.$$escapeHtml("The JIRA server didn\x27t understand your search query. If you entered JQL, please ensure that it\x27s correctly formed. If you entered an issue key, ensure that it exists and you have permission to view it."), '<span class="aui-icon icon-warning"></span></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.warningValWidthColumn = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="jira-chart-macro-dialog-validation-error">', (opt_data.error == 'wrongFormat') ? soy.$$escapeHtml("The width must be in correct format") : (opt_data.error == 'wrongNumber') ? soy.$$escapeHtml("The width must be a number between 100 and 9000") : '', '</div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.warningValMaxiumIssues = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="jira-max-number-error" class="error">', soy.$$escapeHtml("Must be a number between 1 and 1000."), '</div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.showJiraUnsupportedVersion = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="jira-unsupported-version aui-message-container"><div class="aui-message warning">', soy.$$escapeHtml("JIRA Charts are not available for your version of JIRA. Upgrade to JIRA 6.1.1 or later to use this macro."), '<span class="aui-icon icon-warning"></span></div></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:dialogsJs', location = 'templates/soy/create_issues.soy' */
// This file was automatically generated from create_issues.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.ConfluenceJiraPlugin == 'undefined') { Confluence.Templates.ConfluenceJiraPlugin = {}; }


Confluence.Templates.ConfluenceJiraPlugin.createIssuesForm = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form action="#" method="post" class="aui" id="create-issues-form"><div class="loading-blanket hidden"><div class="loading-data"/></div><div class="field-group servers"><label>', soy.$$escapeHtml("Server"), '</label><select class="select server-select"></select></div><div class="field-group project-select-parent" ><label>', soy.$$escapeHtml("Project"), '</label><select class="select project-select" name="pid"></select></div><div class="field-group type-select-parent issues-type-group" ><label>', soy.$$escapeHtml("Issue Type"), '</label><select class="select type-select" name="issuetype"></select></div><div class="field-group"><label>', soy.$$escapeHtml("Summary"), '<span class="aui-icon icon-required"/></label><input class="text issue-summary" type="text" name="summary"/></div><div id="jira-required-fields-panel"></div><div class="field-group"><label>', soy.$$escapeHtml("Description"), '</label><textarea class="issue-description textarea" rows="5" name="description"/></div></form>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.renderOptions = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var optionList15 = opt_data.options;
  var optionListLen15 = optionList15.length;
  for (var optionIndex15 = 0; optionIndex15 < optionListLen15; optionIndex15++) {
    var optionData15 = optionList15[optionIndex15];
    output.append('<option value="', soy.$$escapeHtml(optionData15.id), '">', soy.$$escapeHtml(optionData15.name), '</option>');
  }
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.renderOption = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<option value="', soy.$$escapeHtml(opt_data.option.id), '" data-jira-option-key="', soy.$$escapeHtml(opt_data.option.key), '">', soy.$$escapeHtml(opt_data.option.name), '</option>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.ConfluenceJiraPlugin.renderCreateErrorPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div>', soy.$$escapeHtml("There were errors creating an issue in "), '<a target="_blank" href=', soy.$$escapeHtml(opt_data.serverUrl), '>JIRA</a></div><ul>');
  var errorList36 = opt_data.errors;
  var errorListLen36 = errorList36.length;
  for (var errorIndex36 = 0; errorIndex36 < errorListLen36; errorIndex36++) {
    var errorData36 = errorList36[errorIndex36];
    output.append('<li>', soy.$$escapeHtml(errorData36), '</li>');
  }
  output.append('</ul>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-paste:autoconvert-core', location = 'js/autoconvert/tinymce-autoconvert.js' */
(function($) {
    /***********
     * Constructor
     */
    tinymce.plugins.Autoconvert = function(ed){
        ed.onUndo.add(this.cleanLinks);
        this.editor = ed;
        this.handlers = [];
    };

    /***********
     * Instance Methods
     */
    tinymce.plugins.Autoconvert.prototype.addHandler = function (handler){
        this.handlers.push(handler)
    };
    
    tinymce.plugins.Autoconvert.prototype.cleanLinks = function(ed, level){
        $('a.atlassian-autoconvert', ed.getDoc()).removeClass('atlassian-autoconvert');
        return true;
    };

    tinymce.plugins.Autoconvert.prototype.callHandlers = function (node){
        var index = 0,
            self = this,
            originalNode = $(node),
            node = $(node).clone(),
            rawHref = node.attr('href'),
            uri = parseUri(hackAtSymbols(rawHref));
        
        /**
         * Runs handlers one at a time, this method acts as a continuation and is passed to each handler.
         */
        function run(newNode){
            if (newNode && (newNode.length !== 1 || !newNode.attr('href'))) {
                return handlersFinished(newNode);
            }

            if (newNode) {
                node = newNode;
                index = 0;
                uri = parseUri(node.attr('href'));
                callHandler(self.handlers[index], uri, node);
            } else {
                index++;
                if (index < self.handlers.length) {
                    callHandler(self.handlers[index], uri, node)
                } else {
                    return handlersFinished(node);
                }
            }
        }

        /**
         * This method ensures that a single handler can't break the event loop by never calling the continuation or by
         * calling it multiple times.
         */
        function callHandler(callback, uri, node){
            var modifiableRun = run,
                timer,
                continuation;
                
            continuation = function(){
                var localIndex = index;
                clearTimeout(timer);
                
                //actually call the next iteration of run
                modifiableRun.apply(self, arguments);
                
                //ensure a single handler can't call continuation multiple times
                modifiableRun = function(){
                    AJS.log('Autoconvert: Callback #' + localIndex + ' called the continuation multiple times.');
                }
            };
            timer = setTimeout(function(){
                AJS.log("Autoconvert: Callback #" + index + " failed to call continuation in time. If there is no subsequent log, the handler is improperly implemented and should be uninstalled.");
                modifiableRun = function(){
                    AJS.log("Autoconvert: Callback #" + index + " did eventualy return. Probably a slow async call.");
                };
                run();
            }, tinymce.plugins.Autoconvert.callbackTimeout);

            //Call the callback passing it a modified version of the continuation that allows us to prevent continuing after a timeout.
            callback(uri, node, continuation);
        }

        function handlersFinished(newNode){
            self.editor.undoManager.beforeChange();
            var selection = self.editor.selection,
                bm = self.editor.selection.getBookmark();
            
            
            //replace node that's actually in the editor with the newly modified node
            originalNode.replaceWith(newNode);
            
            selection.moveToBookmark(bm);
            self.editor.undoManager.add();
            
            
        }

        if (this.handlers.length !== 0) {
            callHandler(this.handlers[0], uri, node)
        }
    };

    /***********
     * Static properties
     */
    tinymce.plugins.Autoconvert.callbackTimeout = 5000;

    /***********
     * Static methods
     */
    tinymce.plugins.Autoconvert.convertMacroToDom = function(macro, success, error){
        var conversionData = {
            macro : macro,
            contentId :  AJS.Meta.get("content-id")
        };
        $.ajax( {
            type : "POST",
            contentType : "application/json; charset=utf-8",
            url : AJS.params.contextPath + "/rest/tinymce/1/macro/placeholder",
            data : $.toJSON(conversionData),
            dataType : "text", // if this is switched back to json be sure to use "text json". See CONFDEV-4799 for details.
            success : success,
            error : error,
            timeout: 45000
        });
    };
    
    tinymce.plugins.Autoconvert.convertMacroToDomViaWikiText = function(macro, success, error){
        var wikiTxt = ['{', macro.name];
        var firstParam = true;
        if (macro.defaultParameterValue){
            wikiTxt.push(':', macro.defaultParameterValue);
            firstParam = false;
        }
        for (var key in macro.params){
            if (firstParam){
                wikiTxt.push(':');
                firstParam = false;
            }
            else{
                wikiTxt.push('|');
            }
            wikiTxt.push(key,'=',macro.params[key]);
        }
        wikiTxt.push('}');
        tinymce.plugins.Autoconvert.getHtmlFromWikiMarkup(
            wikiTxt.join(''),
            function(data){ 
                success($(data)[0]);
            },
            function(){
                error();
            }
        );

    };
    tinymce.plugins.Autoconvert.getHtmlFromWikiMarkup = function(text, success, error){
        var conversionData = {
            wiki : text,
            entityId :  AJS.Meta.get("content-id"),
            spaceKey : AJS.Meta.get("space-key")
        };
        $.ajax( {
            type : "POST",
            contentType : "application/json; charset=utf-8",
            url : AJS.params.contextPath + "/rest/tinymce/1/wikixhtmlconverter",
            data : $.toJSON(conversionData),
            dataType : "text", // if this is switched back to json be sure to use "text json". See CONFDEV-4799 for details.
            success : success,
            error : error,
            timeout: 45000
        });
    };

    /***********
     * Private methods
     */

    // parseUri 1.2.2
    // (c) Steven Levithan <stevenlevithan.com>
    // MIT License
    function parseUri (str) {
        var o   = parseUri.options,
        m   = o.parser[o.strictMode ? "strict" : "loose"].exec(str),
        uri = {},
        i   = 14;

        while (i--) uri[o.key[i]] = m[i] || "";

        uri[o.q.name] = {};
        uri[o.key[12]].replace(o.q.parser, function ($0, $1, $2) {
            if ($1) uri[o.q.name][$1] = $2;
        });

        return uri;
    }
    parseUri.options = {
        strictMode: false,
        key: ["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],
        q:   {
            name:   "queryKey",
            parser: /(?:^|&)([^&=]*)=?([^&]*)/g
        },
        parser: {
            strict: /^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,
            loose:  /^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/
        }
    };


    /**
     * parseUri has a bug whereby it deems everything up to the first @ to be part of the "authority"
     * section of the Uri. Even in strict mode.  We should fix this properly, but for now, we're just
     * replacing the first @ with an encoded one.
     */
    function hackAtSymbols(rawHref) {
        return rawHref.replace(/^(.*?\/\/[^/]*?\/.*?)(@)/, "$1%40");
    };


    // ======== TinyMCE plugin creation ===========================================================
    // Since this process relies on tinymce.plugins.AutoConvert already existing these two separate 
    // concerns need to be included in the same source file. Otherwise you cannot create a new 
    // tinymce.plugins.Autoconvert until TinyMCE is initialised, yet you cannot initialise this 
    // TinyMCE plugin until tinymce.plugins.Autoconvert.autoConvert exists.

	tinymce.create('tinymce.plugins.AutoconvertPlugin', {
		init: function (ed){
			var autoConvert = tinymce.plugins.Autoconvert.autoConvert = new tinymce.plugins.Autoconvert(ed);
			
			ed.onInit.add(function(){
				AJS.$(document).bind('postPaste', function(e, pl, o) {
					var anchor = $(o.node).children('a');
					if ( anchor.length === 1 && anchor[0].tagName === "A" && anchor.text() === anchor.attr('href')) {
						anchor.attr('class', 'atlassian-autoconvert');
						setTimeout(function(){
							var anchor = $('a.atlassian-autoconvert', $(ed.selection.getNode().ownerDocument)).removeClass('atlassian-autoconvert');
							autoConvert.callHandlers(anchor);
						}, 0);
					}
				});

				ed.addCommand("addAutoconverter", function(ui, options) {
					autoConvert.addHandler(options);
				});
			});
		},
        getInfo: function() {
            return {
                longname: 'Atlassian Autoconvert',
                author: 'Atlassian',
                authorurl: 'http://www.atlassian.com',
                infourl: 'http://www.atlassian.com',
                version: '1.0'
            };
        }
	});
	
	tinymce.PluginManager.add('autoconvert', tinymce.plugins.AutoconvertPlugin);
})(AJS.$);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:autoconvert-jira', location = '/jira/jirapaste.js' */
(function(){AJS.bind("init.rte",function(){AJS.Editor.JiraConnector.Paste={issueKeyOnlyRegEx:/\/(i#)?browse\/([\x00-\x19\x21-\x22\x24\x27-\x3E\x40-\x7F]+-[0-9]+$)/,singleTicketXMLEx:/\/jira\.issueviews:issue-xml\/([\x00-\x19\x21-\x22\x24\x27-\x3E\x40-\x7F]+-[0-9]+)\//,issueKeyWithinRegex:/\/(i#)?browse\/([\x00-\x19\x21-\x22\x24\x27-\x3E\x40-\x7F]+-[0-9]+)(?:\?|#)/,jqlRegEx:/jqlQuery\=([^&]+)/,jqlRegExAlternateFormat:/jql\=([^&]+)/,pasteHandler:function(e,g,k){var n=AJS.Editor.JiraConnector.servers;var m=AJS.Editor.JiraAnalytics;var d={};var o;if(!n){k();return}for(var l in n){var h=n[l];if(e.source.indexOf(h.url)==0){o=h;break}}var f;if(o){var b=AJS.Editor.JiraConnector.Paste.jqlRegEx.exec(e.source)||AJS.Editor.JiraConnector.Paste.jqlRegExAlternateFormat.exec(e.source);var a=AJS.JQLHelper.isFilterUrl(e.source);var j=AJS.Editor.JiraConnector.Paste.issueKeyOnlyRegEx.exec(e.source)||AJS.Editor.JiraConnector.Paste.issueKeyWithinRegex.exec(e.source);if(j){j=j[2];if(m){d.type=m.linkTypes.jql}}else{j=AJS.Editor.JiraConnector.Paste.singleTicketXMLEx.exec(e.source);if(j){j=j[1];if(m){d.type=m.linkTypes.xml}}}if(b){d.is_single_issue=false;d.type=AJS.JQLHelper.checkQueryType(e.source);f={name:"jira",params:{server:o.name,serverId:o.id,jqlQuery:decodeURIComponent(b[1].replace(/\+/g,"%20"))}}}else{if(a){var c=e.source;d.is_single_issue=false;d.type=AJS.JQLHelper.checkQueryType(c);f={name:"jira",params:{server:o.name,serverId:o.id,jqlQuery:AJS.JQLHelper.getFilterFromFilterUrl(c)}}}else{if(j){d.is_single_issue=true;f={name:"jira",params:{server:o.name,serverId:o.id,key:j}}}}}}if(f){tinymce.plugins.Autoconvert.convertMacroToDom(f,k,k);if(m){m.triggerPasteEvent(d)}}else{k()}}};tinymce.plugins.Autoconvert.autoConvert.addHandler(AJS.Editor.JiraConnector.Paste.pasteHandler)})})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:text-placeholders-jira', location = '/jira/placeholder.js' */
(function(){AJS.bind("init.rte",function(){AJS.bind("editor.text-placeholder.activated",function(b,a){if(a&&a.placeholderType==="jira"){AJS.Editor.JiraConnector.open(AJS.Editor.JiraConnector.source.instructionalText)}});if(AJS.Rte.Placeholder&&AJS.Rte.Placeholder.addPlaceholderType){AJS.Rte.Placeholder.addPlaceholderType({type:"jira",label:"JIRA Macro",tooltip:"Instructional text is replaced with a JIRA Macro on click.",activation:{click:true,keypress:false}})}})})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:jirachart-macro', location = '/jirachart/jirachart-dialog.js' */
AJS.Editor.JiraChart=(function(w){var r=-1;var l=6109;var n=6155;var p="Insert";var y="Cancel";var m="Insert JIRA Chart";var I="";var h=I;var c;var k=/^\d+$/;var t;var g=function(){if(!t){t=new AJS.ConfluenceDialog({width:840,height:590,id:"jira-chart"});t.addHeader(m);var M=AJS.Editor.JiraChart.Panels;for(var N=0;N<M.length;N++){t.addPanel(M[N].title);var P=t.getCurrentPanel();M[N].init(P)}w("#jira-chart ul.dialog-page-menu").show().append(Confluence.Templates.ConfluenceJiraPlugin.addMoreToComeLink());var O=w("#jira-chart-content");t.addLink("Select Macro",function(){t.hide();AJS.MacroBrowser.open(false)},"dialog-back-link");t.addButton(p,function(){if(j()){var Q=a(O);if(!AJS.Editor.JiraChart.validateWidth(Q.width)){Q.width=I}v(Q);AJS.Editor.JiraChart.close()}else{s(O)}},"insert-jira-chart-macro-button");t.addCancel(y,function(){AJS.Editor.JiraChart.close()});K(O)}z(O);t.gotoPanel(0);t.show()};var K=function(N){var M=N.find(".jira-chart-search button, #jira-chart-border, #jira-chart-show-infor");M.click(function(){s(N)});D(N.find("input[type='text']"),s,N);N.find("#jira-chart-width").focusout(function(O){var P=o(this.value);if(P!=h){h=P;s(N)}});N.find("#jira-chart-inputsearch").change(function(){if(this.value!==c){z(N);A()}c=I}).bind("paste",function(){q(N)});N.find("#jira-chart-statType").change(function(O){s(N)});i(N);if(AJS.Editor.JiraConnector.servers.length>0){AJS.Editor.JiraConnector.Panel.prototype.applinkServerSelect(AJS.$("#jira-chart-servers"),function(O){z(N);if(H(O)){G(N);C(N)}else{J(N,O);b(N)}})}};var i=function(N){var O=N.find(".jira-chart-option");O.css("top","430px");var M=N.find(".jirachart-display-opts-close, .jirachart-display-opts-open");M.click(function(Q){var P=w(this);Q.preventDefault();if(P.hasClass("disabled")){return}var R=P.hasClass("jirachart-display-opts-open");if(R){L(N,true);P.addClass("jirachart-display-opts-close");P.removeClass("jirachart-display-opts-open")}else{L(N);P.removeClass("jirachart-display-opts-close");P.addClass("jirachart-display-opts-open")}})};var f=function(O){var N=a(AJS.$("#jira-chart-content"));if(N.chartType==="pie"){var M=AJS.Editor.JiraChart.Panels[0];O(M,N)}};var s=function(M){var N=AJS.$("#jira-chart-width");f(function(O,P){if(O.validate(N)){x(M)}})};var x=function(M){if(E(M)===undefined){return}var O=M.find(".jira-chart-img");O.html('<div class="loading-data"></div>');var N=O.find(".loading-data")[0];AJS.$.data(N,"spinner",Raphael.spinner(N,50,"#666"));f(function(P,Q){P.renderChart(O,Q)})};var L=function(N,Q){var M=N.find(".jira-chart-option");var P=40;var S=M.position().top+"px";var O=I;var R={top:430};if(Q){S=I;O=P-M.height()+"px";R={bottom:0}}M.css("top",S);M.css("bottom",O);M.animate(R,500)};var q=function(M){setTimeout(function(){s(M)},100)};var E=function(N){var S=AJS.Editor.JiraConnector.servers;var P;var O=N.find("#jira-chart-inputsearch").val();if(O.indexOf("http")===0){var R=AJS.JQLHelper.findServerIndexFromUrl(O,S);if(R!==-1){P=S[R].id;N.find("#jira-chart-servers").val(P)}else{var Q=Confluence.Templates.ConfluenceJiraPlugin.noServerWarning({isAdministrator:AJS.Meta.get("is-admin"),contextPath:Confluence.getContextPath()});N.find(".jira-chart-img").html(Q);return}}var M=AJS.JQLHelper.convertToJQL(O,P);if(M){N.find("#jira-chart-inputsearch").val(M)}else{N.find(".jira-chart-img").html(Confluence.Templates.ConfluenceJiraPlugin.jqlInvalid());e()}return M};var a=function(M){var N=d(M);return{jql:encodeURIComponent(M.find("#jira-chart-inputsearch").val()),statType:M.find("#jira-chart-statType").val(),width:o(M.find("#jira-chart-width").val()),border:M.find("#jira-chart-border").prop("checked"),showinfor:M.find("#jira-chart-show-infor").prop("checked"),serverId:N.id,server:N.name,isAuthenticated:!N.authUrl,chartType:"pie"}};var o=function(M){M=M.replace("px",I);if(M==="auto"){M=I}if(M.indexOf("%")>0){M=M.replace("%",I)*4}return M};var v=function(M){var N=function(O){tinymce.confluence.macrobrowser.macroBrowserComplete(O)};if(AJS.Editor.inRichTextMode()){N({name:"jirachart",params:M})}};var u=function(M){if(M.attr("id")==="jira-chart-inputsearch"){c=M.val()}};var D=function(M,N,O){M.unbind("keydown").keydown(function(P){if(P.which==13){var Q=function(R){M.unbind("keyup",Q);N(O);u(M);return AJS.stopEvent(R)};M.keyup(Q);return AJS.stopEvent(P)}})};var B=function(O,N){if(N===undefined||N.serverId===undefined){var M=w("input",O);M.filter(":text").val("");M.filter(":checked").removeAttr("checked")}else{O.find("#jira-chart-inputsearch").val(decodeURIComponent(N.jql));O.find("#jira-chart-statType").val(N.statType);O.find("#jira-chart-width").val(N.width);O.find("#jira-chart-border").attr("checked",(N.border==="true"));O.find("#jira-chart-show-infor").attr("checked",(N.showinfor==="true"));if(AJS.Editor.JiraConnector.servers.length>1){O.find("#jira-chart-servers").val(N.serverId)}}};var d=function(M){var N=AJS.Editor.JiraConnector.servers;if(N.length>1){return M.find("#jira-chart-servers option:selected").data("jiraapplink")}return N[0]};var F=function(){if(AJS.Editor.JiraConnector.servers===undefined||AJS.Editor.JiraConnector.servers.length===0){AJS.Editor.JiraConnector.warningPopup(AJS.Meta.get("is-admin"));return false}return true};var z=function(M){M=M||w("#jira-chart-content");M.find(".jira-oauth-message-marker").remove();M.find(".jira-chart-img").empty()};var e=function(){AJS.$("#jira-chart").find(".insert-jira-chart-macro-button").disable()};var A=function(){var M=AJS.$("#jira-chart").find(".insert-jira-chart-macro-button");if(M.is(":disabled")){M.enable()}};var J=function(O,N){AJS.$(".jira-oauth-message-marker",O).remove();var P={selectedServer:N,msg:AJS.Editor.JiraConnector.Panel.prototype.msg};if(N&&N.authUrl){var M=AJS.Editor.JiraConnector.Panel.prototype.createOauthForm.call(P,function(){AJS.$(".jira-oauth-message-marker",O).remove();AJS.Editor.JiraChart.search(O)});O.find("div.jira-chart-search").append(M)}};var j=function(){return w("#chart-preview-iframe").contents().find(".jira-chart-macro-img").length>0};var G=function(M){M.find(".jira-chart-img").html(Confluence.Templates.ConfluenceJiraPlugin.showJiraUnsupportedVersion())};var C=function(N){N.find("#jira-chart-inputsearch").attr("disabled","disabled");N.find("#jira-chart-search-button").attr("disabled","disabled");var M=N.find(".jirachart-display-opts-close, .jirachart-display-opts-open");if(M.hasClass("jirachart-display-opts-close")){M.click()}M.addClass("disabled");e()};var b=function(M){M.find("#jira-chart-inputsearch").removeAttr("disabled");M.find("#jira-chart-search-button").removeAttr("disabled");M.find(".jirachart-display-opts-open").removeClass("disabled");A()};var H=function(N){var M=N.buildNumber;return M==r||(M>=l&&M<n)};return{close:function(){t.hide();tinymce.confluence.macrobrowser.macroBrowserCancel()},edit:function(M){if(!F()){return}g();var O=w("#jira-chart-content");B(O,M.params);var N=d(O);if(H(N)){G(O);C(O);return}b(O);if(M.params!==undefined&&M.params.serverId!==undefined){s(O)}J(O,N)},search:s,validateWidth:function(M){return this.isNumber(M)&&M>=100&&M<=9000},isNumber:function(M){return k.test(M)},convertFormatWidth:o,disableInsert:e,enableInsert:A}})(AJS.$);AJS.Editor.JiraChart.Panels=[];AJS.MacroBrowser.setMacroJsOverride("jirachart",{opener:AJS.Editor.JiraChart.edit});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.extra.jira:jirachart-macro', location = '/jirachart/piechart-panel.js' */
AJS.Editor.JiraChart.Panels.PieChart=function(){var a="Pie Chart";var b=function(c){if(c.contents().find(".jira-chart-macro-img").length>0){AJS.Editor.JiraChart.enableInsert()}else{AJS.Editor.JiraChart.disableInsert()}};return{title:a,init:function(c){var d=Confluence.Templates.ConfluenceJiraPlugin.contentJiraChart({isMultiServer:AJS.Editor.JiraConnector.servers.length>1});c.html(d)},renderChart:function(e,g){var d=e;var c=Confluence.getContextPath()+"/rest/tinymce/1/macro/preview";var f={contentId:AJS.Meta.get("page-id"),macro:{name:"jirachart",params:{jql:g.jql,serverId:g.serverId,width:g.width,border:g.border,showinfor:g.showinfor,statType:g.statType}}};AJS.$.ajax({url:c,type:"POST",contentType:"application/json",data:JSON.stringify(f)}).done(function(h){d.html("").hide();var k=AJS.$('<iframe frameborder="0" name="macro-browser-preview-frame" id="chart-preview-iframe"></iframe>');k.appendTo(d);var j=k[0].contentWindow,i=j.document;i.open();i.write(h);i.close();k.on("load",function(){j.AJS.$("#main").addClass("chart-preview-main");d.show();b(AJS.$(this))})}).error(function(h,j,i){AJS.log("Jira Chart Macro - Fail to get data from macro preview");e.html(Confluence.Templates.ConfluenceJiraPlugin.showMessageRenderJiraChart());AJS.Editor.JiraChart.disableInsert()})},validate:function(d){AJS.$(d).next("#jira-chart-macro-dialog-validation-error").remove();var c=AJS.$(d);var e=AJS.Editor.JiraChart.convertFormatWidth(c.val());if(!AJS.Editor.JiraChart.validateWidth(e)&&e!==""){var f="wrongFormat";if(AJS.Editor.JiraChart.isNumber(e)){f="wrongNumber"}c.after(Confluence.Templates.ConfluenceJiraPlugin.warningValWidthColumn({error:f}));return false}return true}}};AJS.Editor.JiraChart.Panels.push(new AJS.Editor.JiraChart.Panels.PieChart());
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.widgetconnector:twitter-autoconvert-webresources', location = 'com/atlassian/confluence/extra/widgetconnector/js/autoconvert-twitter.js' */
(function(){AJS.bind("init.rte",function(){var A=/^\/(.*?)\/status\/([^/]+\/?$)/,C=/^\/(.*?)\/statuses\/([^/]+\/?$)/,B=function(H,G,D){var E,I,F;
if(H.host.match(/^twitter.com/)){if(E=decodeURI(H.path).match(A)){I=H.protocol+"://twitter.com/"+E[1]+"/status/"+E[2]
}else{if(E=decodeURI(H.path).match(C)){I=H.protocol+"://twitter.com/"+E[1]+"/statuses/"+E[2]
}}if(I){F={name:"widget",params:{url:I}};
tinymce.plugins.Autoconvert.convertMacroToDom(F,D,D)
}else{D()
}}else{D()
}};
tinymce.plugins.Autoconvert.autoConvert.addHandler(B)
})
})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-autocomplete-resources-only', location = 'tinymce3/plugins/autocomplete/js/tinyMce-autocomplete-settings.js' */
Confluence.Editor.Autocompleter={Settings:{},log:function(a){return function(c,e,d){var f=(d!=null&&typeof d!="object");var b=d!=null?(f?(" = "+d):" >"):"";AJS.debug(a+" - "+c+" : "+(e||null)+b);d&&!f&&AJS.debug(d)}}};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-autocomplete-resources-only', location = 'tinymce3/plugins/autocomplete/js/tinyMce-autocomplete-util.js' */
Confluence.Editor.Autocompleter.Util=(function(b){var a=function(k,d,j,f,e){var i=k.statusMessage;var g;if(i){g=[[{html:k.statusMessage,className:"error"}]]}else{var c=d?AJS.REST.makeRestMatrixFromSearchData(k):AJS.REST.makeRestMatrixFromData(k,f);g=AJS.REST.convertFromRest(c)}function h(m,l){if(e&&typeof e=="function"){e(g,m,l)}}j(g,d,h)};return{dropdownLink:function(e,d,c){return"<a href='#' class='"+(d||"")+"'><span class='icon "+(c||"")+"'></span><span>"+e+"</span></a>"},getRestData:function(e,g,k,d,j,m,h){var c=g(d),i=e.settings.cacheManager,f=i.get(d),l;if(c){l=b.ajax({type:"GET",url:c,data:k(e,d),dataType:"json",global:false,timeout:5000});l.done(function(n){i.put(d,n)});if(f){a(f,d,j,m,h)}else{l.done(function(n){a(n,d,j,m,h)});l.fail(function(o,n){if(n=="timeout"){a({statusMessage:"Timeout",query:d},d,j,m)}})}}else{j([],d)}}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-autocomplete-resources-only', location = 'tinymce3/plugins/autocomplete/js/tinyMce-autocomplete-control.js' */
(function(c){var b="autocomplete";var a="autocomplete-trigger";var d="autocomplete-search-text";Confluence.Editor.Autocompleter.Control=function(l,k){var o=Confluence.Editor.Autocompleter.log("Autocompleter.Control");var q={},K=l.selection,n=K.getRng(true),p=n.startOffset,C=n.startContainer,w=C.nodeValue,e=k.leadingChar,L=l.getDoc(),j=k.backWords||0,F=Confluence.Editor.Autocompleter.Settings[e||"["],y=(!F||typeof F.preventStartNodes==="undefined")?"div.code, a[href], img, pre":F.preventStartNodes;if(c("#"+b,L).length){AJS.debug("init","Autocomplete already exists, returning null.");return null}q.backWords=j;q.maxResults=k.maxResults||10;if(w==null&&n.collapsed&&p&&C.childNodes[p-1]){C=C.childNodes[p-1];w=C.nodeValue;p=(w&&w.length)||0}var u="";if(w!=null){u=(w+"").substring(0,p);var D=C.previousSibling;while(D&&D.nodeType==3){u=D.nodeValue+u;D=D.previousSibling}}function r(N,P){for(var O=0,M=P.length;O<M;O++){if(P[O].test(N)){return true}}return false}var m=[/([("'<\(\u201c\u2018]\[|[\ufeff\u200b\u2014\s\xa0].)$/,/(\([^!])$/,/(\/\/)$/];if(!j&&u&&!r(u+e,m)){o("init","Cursor is in wrong word location to start autocomplete, returning null.");return null}var I=AJS.$(C);if(I.closest(y).length){o("init","Cursor is in wrong node to start autocomplete, returning null.");return null}if(Confluence.PropertyPanel&&Confluence.PropertyPanel.current){Confluence.PropertyPanel.shouldCreate=false;Confluence.PropertyPanel.destroy()}if(!e&&w==null){AJS.debug("init","No text available for suggestion, range is",n);w=""}q.getContainer=function(){return c("#"+b,L)};function E(Q,S,R){var P,O;function N(Y,V,W){!V.global&&(V=new RegExp(V.source,"g"+"i".slice(0,V.ignoreCase)+"m".slice(0,V.multiLine)));if(W==null){W=Y.length}else{if(W<0){W=0}}var U=Y.substring(0,W+1),T=-1,X=0;while((result=V.exec(U))!=null){T=result.index;V.lastIndex=++X}return T}for(var M=0;M<R;M++){P=Q.nodeValue.substring(0,S);S=N(P,(/\s+/),S);while(S==-1){O=Q.previousSibling;if(O&&O.nodeType==3){Q=O;P=O.nodeValue;if(P){S=N(P,(/\s+/),P.length)}}else{M=R;break}}}return{node:Q,offset:S+1}}var s="";if(n.collapsed&&j&&w){var H=E(C,p,j);if(tinymce.isIE&&j==1){var v=K.getRng();v.moveStart("character",H.offset-p);v.select()}else{v=K.getRng(true);v.setStart(H.node,H.offset);v.setEnd(C,p);K.setRng(v)}}s=K.getContent({format:"text"}).replace("\n","");o("init","suggestionHtml",s);var g=AJS("span").attr("id",b);if(e){g.append(AJS("span").attr("id",a).text(e))}var f=AJS("span").attr("id",d);f.text(AJS.Rte.HIDDEN_CHAR);g.append(f);K.setNode(g[0]);var x=q.getContainer();q.previousSearchText="";q.settings=F;if(F.cache!==false&&!F.cacheManager){F.cacheManager=new AJS.Confluence.localStorageCacheManager(F.ch)}else{if(F.cache===false&&!F.cacheManager){F.cacheManager={get:c.noop,put:c.noop}}}var G=c("#"+d,q.getContainer()),J=c(L.createElement("span")).text(s||AJS.Rte.HIDDEN_CHAR);G.empty().append(J);K.select(J[0],true);K.collapse();var t=function(M,N){if(q.onBeforeKey&&!q.onBeforeKey(N,q.text())){tinymce.dom.Event.cancel(N);o("before","blocked by onBeforeKey: "+N.keyCode);return false}},i=function(Q,R){var M=K.getRng(true),S=q.getContainer(),O=M.startContainer,T=O.parentNode;O.nodeType===3&&(T=T.parentNode);var P=T?T.parentNode:null,U=P?P.parentNode:null,N=(T!==S[0])&&(P!==S[0])&&(U!==S[0]);if(R.keyCode==27||N){o("after","dying because of: "+(N?"outside search span":"escape pressed"));q.die()}else{if(q.onAfterKey&&!q.onAfterKey(R,q.text())){tinymce.dom.Event.cancel(R);o("after","blocked by onAfterKey: "+R.keyCode);return false}}},z=function(M,N){if(q.onKeyPress&&!q.onKeyPress(N,q.text())){tinymce.dom.Event.cancel(N);o("press","blocked by onKeyPress: "+N.keyCode);return false}},B=function(M,N){if(q.getContainer()[0]!=N.target.parentNode){o("click","Clicked outside of autocomplete, closing.");q.die()}};l.onKeyDown.addToTop(t);l.onKeyUp.addToTop(i);l.onKeyPress.addToTop(z);l.onClick.addToTop(B);q.word="";if(!k.keepAlias){q.word=s}else{o("init","No suggestion based on previous or selected text")}AJS.Rte.showElement(x[0]);function h(){var N=tinymce.DOM.getPos(x[0]),M=x.height();q.left=N.x;q.top=N.y+M}h();q.text=function(N){var M=c("#"+d,q.getContainer());if(N!=null){M.html(N);return this}else{N=AJS.escapeEntities(M.text());return N.replace(AJS.Rte.HIDDEN_CHAR,"")}};q.plainText=function(N){var M=c("#"+d,q.getContainer());if(N!=null){M.text(N);return this}else{N=M.text();return N.replace(AJS.Rte.HIDDEN_CHAR,"")}};var A=function(O,N){var M=q.getContainer();return Confluence.Editor.Autocompleter.Control.replaceWithTextAndGetRange(M,O,N)};q.replaceWithSelectedSearchText=function(){var M=q.text();o("replaceWithSelectedSearchText",M);A(M,false);return M};q.die=function(O){if(q.dying){AJS.debug("die","Already dying, returning.");return}q.dying=true;if(Confluence.PropertyPanel){Confluence.PropertyPanel.shouldCreate=true}var N=q.getContainer();if(N.length){o("die","Tearing down autocomplete, cleaning up autocompleter");var M=((O||k.backWords)?"":q.settings.ch)+q.text();n=A(M,true)}setTimeout(function(){o("die","Removing autocomplete-control keyboard listeners.");l.onKeyDown.remove(t);l.onKeyUp.remove(i);l.onClick.remove(B);l.onKeyPress.remove(z)},1);AJS.Rte.unbindScroll("autocomplete");c(document).unbind("click.autocomplete-outside");this.onDeath&&this.onDeath()};AJS.Rte.bindScroll("autocomplete",function(M){AJS.debug("scrolling:",M);if(!AJS.Rte.isAnyPartShown(x)){q.die()}else{q.onScroll()}});c(document).bind("click.autocomplete-outside",function(M){if(!c(M.target).closest("#autocomplete-dropdown, .aui-datepicker-dialog, .ui-datepicker-header").length){q.die()}});AJS.Rte.getEditor().onBeforeExecCommand.add(function(M,N){if(N=="mceConfSavePage"){q.die()}});q.update=function(M){AJS.Rte.BookmarkManager.storeBookmark();A("",true);this.settings.update(this,M)};q.removeSpan=function(){q.getContainer().remove()};return q};Confluence.Editor.Autocompleter.Control.removeOrphanedControl=function(){var g=c(AJS.Rte.getEditor().getDoc()),h=g.find("#"+b),e,f;if(!h.length){return null}e=g.find("#"+a).text();f=g.find("#"+d).text();Confluence.Editor.Autocompleter.Control.replaceWithTextAndGetRange(h,f,false);return{leadingChar:e,content:f}};Confluence.Editor.Autocompleter.Control.replaceWithTextAndGetRange=function(h,l,k){if(!h.length){AJS.log("replaceWithTextAndGetRange Error: attempting to replace a non-existent element");return}l=l||"";k=k||!l;var g=AJS.Rte.getEditor(),f;var i=h[0].parentNode,e=AJS.Rte.Content.getChildIndex(i,h[0]),j=k?1:0;f=g.selection.getRng(true);f.setStart(i,e+j);f.setEnd(i,e+1);h.before(l||AJS.Rte.HIDDEN_CHAR).remove();g.selection.setRng(f);return f}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-autocomplete-resources-only', location = 'tinymce3/plugins/autocomplete/js/tinyMce-autocomplete-manager.js' */
Confluence.Editor.Autocompleter.Manager=(function(e){var c=Confluence.Editor.Autocompleter.log("Autocompleter.Manager");var g;var f;var b=function(u){AJS.debug("startAutoComplete","Started");g=Confluence.Editor.Autocompleter.Control(AJS.Rte.getEditor(),u);if(!g){return false}var r=function(x,w){x.preventDefault();var v=AJS.$.data(w[0],"properties");if(v&&typeof v.callback=="function"){v.callback(g)}else{if(v.className!="menu-header"){AJS.debug("selectionHandler","Inserting link from dropdown selection");g.update(v)}}g.die()};var n=function(w,v){var x=AJS.dropDown.current;if(w&&w.find("a").is(".menu-header")){v=="up"?x.moveUp():x.moveDown()}};var j=AJS.$(window).width(),m,o;var p=1,t=2;var l;var i=function(w,v){if(w.below>=v){return t}else{if(w.above>=v){return p}}return w.below>w.above?t:p};var q=function(w,v){if(m==p){return w.above>=v}return w.below>=v};var s=function(E,y,x,B){var A,C,D,w;if(window.Raphael){if(f.raphaelArrow&&o!=m){f.raphaelArrow.remove&&f.raphaelArrow.remove();f.raphaelArrow=null}if(m==p){A="#ffffff";C="M0.001-1.000l6.001,6.001,6.001-6.001";D=E+x-1}else{A="#f0f0f0";C="M0.001,6.001l6.001-6.001,6.001,6.001";D=E-5}w=y+4;if(f.raphaelArrow){f.raphaelArrow.canvas.style.left=w+"px";f.raphaelArrow.canvas.style.top=D+"px"}else{var v=Raphael(w,D,16,10),z=v.path(C);z.attr({fill:A,stroke:"#bbb"});v.canvas.style.zIndex=3000;f.raphaelArrow=v;o=m;if(B&&e.support.opacity){z.clone().translate(4,4).attr({fill:"#A0A0A0",stroke:"#A0A0A0",opacity:".5",blur:"1"}).toBack()}}}};var h=function(D){var G=e("#autocomplete-dropdown"),C=g.getContainer(),y,E,z,B,F,H=10,w=0,A,x,v;if(!G.length){G=AJS("div").addClass("aui-dd-parent quick-nav-drop-down").attr("id","autocomplete-dropdown").appendTo("body")}y=AJS.Position.spaceAboveBelow(AJS.Rte.getEditorFrame(),C);D.find("ol:has(a.menu-header)").addClass("top-menu-item");D.find("ol:empty").hide();G.append(D);B=AJS.Rte.Content.offset(C);F=G.width()+B.left-j+10;z=B.left-(F>0?F:0)-w;A=D.outerHeight(true);x=A+H;if(m){if(!q(y,x)){m=null}}if(!m){m=i(y,x)}if(m==p){E=B.top-A-H;v=true}else{E=B.top+C.height()+H;v=false}G.css({position:"absolute",top:E,left:z});s(E,B.left,A,v);if(e.browser.msie&&parseInt(e.browser.version,10)<9){f.dd.show()}};f=AJS.inputDrivenDropdown({onShow:function(v){AJS.debug("onShow","Post-processing the dropdown");var w=AJS.Rte.getEditorFrame();w&&w.shim&&w.shim.hide();v.find("a.menu-header").unbind().click(function(x){x.preventDefault();g.die()});this.reset();if(g.settings.selectFirstItem&&v.find("a:not('.menu-header')").length){AJS.dropDown.current.moveDown()}},dropdownPlacement:h,onDeath:function(){e("#autocomplete-dropdown").remove();f.raphaelArrow&&f.raphaelArrow.remove&&f.raphaelArrow.remove()},ajsDropDownOptions:{selectionHandler:r,moveHandler:n,className:"autocomplete "+g.settings.dropDownClassName},getDataAndRunCallback:function(v){g&&g.settings.getDataAndRunCallback&&g.settings.getDataAndRunCallback(g,v,function(w,y,x){w.unshift([{className:"menu-header dropdown-prevent-highlight",href:"#",name:g.settings.getHeaderText(g,v)}]);w.push(g.settings.getAdditionalLinks(g,v,x));f&&f.show(w,y,[y])})},dropDownDelay:g.settings.dropDownDelay});g.onBeforeKey=function(v,w){if(v.keyCode==40||v.keyCode==38||v.keyCode==13){tinymce.dom.Event.cancel(v);return false}if(v.keyCode==27||v.keyCode==9||(v.keyCode==8&&!w)){AJS.debug("autoCompleteControl.onBeforeKey","killing autoCompleteControl and returning false");this.die(v.keyCode==8);return false}return true};g.onKeyPress=function(y,z){var w=AJS.$.browser.msie?y.keyCode:y.which,x=String.fromCharCode(w);if(y.keyCode==13){tinymce.dom.Event.cancel(y);return false}var v=AJS.indexOf(this.settings.endChars,x);if(v!=-1){AJS.debug("autoCompleteControl.onKeyPress","caught autocomplete-closing char "+x+", closing");g.die()}return true};var k=/\S{2,}/;g.onAfterKey=function(x,y){if(x.keyCode==40||x.keyCode==38||x.keyCode==13){var w=AJS.dropDown.current;if(!w){AJS.debug("autoCompleteControl.onBeforeKey","key caught before dropdown ready, ignoring");return false}if(w.getFocusIndex()==-1&&x.keyCode==13){d();return true}if(!x.which){x.which=x.keyCode}return w.moveFocus(x)}var v=(x.keyCode==8&&!y);if(v||k.test(y)){AJS.debug("onAfterKey","Changed search string to '"+y+"'");f.change(y,v)}return true};g.onDeath=function(){AJS.debug("onDeath","autoCompleteControl onDeath called");if(f){f.remove();f.closing=true}};g.onScroll=function(){if(!f.dd){return}h(f.dd.$)};f.change(g.text(),"force");return true};var d=function(){g.die();g=null};var a=function(){var h=Confluence.Editor.Autocompleter.Control.removeOrphanedControl();h&&Confluence.Editor.Autocompleter.Manager.shortcutFired(h.leadingChar)};return{getInputDrivenDropdown:function(){return f},triggerListener:function(h,k){if(k.metaKey){return true}var i=AJS.$.browser.msie?k.keyCode:k.which;f&&f.closing&&(f=null);var j=String.fromCharCode(i);if(!f&&j in Confluence.Editor.Autocompleter.Settings){AJS.debug("triggerListener","Auto-complete initiated: trigger is ",j);b({leadingChar:j})&&tinymce.dom.Event.cancel(k)}return true},shortcutFired:function(h,i){var j=i?0:1;f&&f.closing&&(f=null);if(f){j=i?0:g.backWords+1;AJS.debug("shortcutFired","autocomplete active, increasing word selection to: "+j);d()}return b({leadingChar:h,backWords:j})},reattach:a}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-autocomplete-resources-only', location = 'tinymce3/plugins/autocomplete/js/tinyMce-autocomplete-settings-links.js' */
(function(){AJS.debug("tinyMce-autocomplete-settings-links initialising");var c=Confluence.Editor.Autocompleter,a=function(d){if(d){return Confluence.getContextPath()+"/rest/prototype/1/search.json"}else{if(AJS.Meta.get("remote-user")){return Confluence.getContextPath()+"/rest/prototype/1/session/history.json"}}return null},b=function(f,e){var d={"max-results":f.maxResults};if(e){d.query=Confluence.unescapeEntities(e);d.search="name";d.preferredSpaceKey=AJS.Meta.get("space-key")}return d};Confluence.Editor.Autocompleter.Settings["["]={ch:"[",cache:false,endChars:["]"],dropDownClassName:"autocomplete-links",selectFirstItem:true,getHeaderText:function(e,d){return "\u94FE\u63A5\u5EFA\u8BAE"},getAdditionalLinks:function(j,i,f){var d;if(i){var g="\u641C\u7D22 &lsquo;{0}&rsquo;";d=AJS.format(g,i)}else{d="\u641C\u7D22"}var e=Confluence.Editor.LinkBrowser;var h=[{className:"search-for",name:d,href:"#",callback:function(l){l.replaceWithSelectedSearchText();var k=e.open({panelKey:e.SEARCH_PANEL});k.doSearch(k.getLocationPresenter().getRawLinkText())}},{className:"dropdown-insert-link",html:c.Util.dropdownLink("\u63D2\u5165Web\u94FE\u63A5","dropdown-prevent-highlight","editor-icon"),callback:function(k){k.replaceWithSelectedSearchText();e.open({panelKey:e.WEBLINK_PANEL})}}];f&&f(i,h);return h},getDataAndRunCallback:function(g,e,f){function d(h,k,j){function i(){var l=h[1];var m=l[0].restObj;if(m.type=="page"){return m.space.key==AJS.Meta.get("space-key")&&m.title.toLowerCase()==k.toLowerCase()}return false}if(k){if(h.length<2||!i()){j.push({className:"insert-create-page-link",html:c.Util.dropdownLink("\u63D2\u5165\u6DFB\u52A0\u9875\u9762\u94FE\u63A5","dropdown-prevent-highlight","editor-icon"),callback:function(n){var m=Confluence.unescapeEntities(k);var l=Confluence.Link.createLinkToNewPage(m,AJS.Meta.get("space-key"));n.update(l)}})}}}Confluence.Editor.Autocompleter.Util.getRestData(g,a,b,e,f,"content",d)},update:function(e,d){if(d.restObj){d=Confluence.Link.fromREST(d.restObj)}d.insert()}}})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-autocomplete-resources-only', location = 'tinymce3/plugins/autocomplete/js/tinyMce-autocomplete-settings-media.js' */
(function(d){AJS.debug("tinyMce-autocomplete-settings-media initialising");var b=["image","word","excel","pdf","powerpoint","multimedia"],a=function(e){var f=AJS.params.attachmentSourceContentId||AJS.Meta.get("content-id");if(e){return Confluence.getContextPath()+"/rest/prototype/1/search.json"}else{if(+f){return Confluence.getContextPath()+"/rest/prototype/1/content/"+f+"/attachments.json"}}return null},c=function(f,e){return e?{type:"attachment",attachmentType:b,search:"name","max-results":f.maxResults,query:e}:{attachmentType:b,"max-results":f.maxResults}};Confluence.Editor.Autocompleter.Settings["!"]={ch:"!",cache:false,endChars:["!"],dropDownClassName:"autocomplete-media",selectFirstItem:true,getHeaderText:function(f,e){return "\u5A92\u4F53\u5EFA\u8BAE"},getAdditionalLinks:function(f,e){return[{className:"dropdown-insert-image",html:Confluence.Editor.Autocompleter.Util.dropdownLink("\u6253\u5F00\u56FE\u7247\u6D4F\u89C8\u5668","dropdown-prevent-highlight","editor-icon"),callback:function(g){g.replaceWithSelectedSearchText();Confluence.Editor.defaultInsertImageDialog()}},{className:"dropdown-insert-macro",html:Confluence.Editor.Autocompleter.Util.dropdownLink("\u63D2\u5165\u5176\u4ED6\u5A92\u4F53","dropdown-prevent-highlight","editor-icon"),callback:function(g){g.replaceWithSelectedSearchText();tinymce.confluence.macrobrowser.macroBrowserToolbarButtonClicked({selectedCategory:"media"})}}]},getDataAndRunCallback:function(g,e,f){Confluence.Editor.Autocompleter.Util.getRestData(g,a,c,e,f,"attachment")},update:function(h,i){var n=AJS.REST.wikiLink(i.restObj),e=i.restObj&&i.restObj.title||i.name;if(i.restObj.niceType=="Image"){var l=n.destination&&n.destination.replace(/^\^/,"");var k=d.extend({filename:e,contentId:i.ownerId||i.restObj.ownerId},n.params);tinymce.confluence.ImageUtils.insertFromProperties(k)}else{var g;switch(i.restObj.niceType){case"PDF Document":g="viewpdf";break;case"Word Document":g="viewdoc";break;case"Excel Spreadsheet":g="viewxls";break;case"PowerPoint Presentation":g="viewppt";break;case"Multimedia":g="multimedia";break}var m=n.destination.substring(0,n.destination.indexOf("^"));var j={page:m,name:e};AJS.MacroBrowser.getMacroJsOverride("viewdoc").beforeParamsRetrieved(j);if(!j.page){delete j.page}var f={contentId:AJS.Meta.get("content-id")||"0",macro:{name:g,params:j,defaultParameterValue:"",body:""}};tinymce.confluence.MacroUtils.insertMacro(f)}}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-autocomplete-resources-only', location = 'tinymce3/plugins/autocomplete/js/tinyMce-autocomplete-settings-macros.js' */
(function(c){AJS.debug("tinyMce-autocomplete-settings-macro initialising");var b=function(f,e){var d=e.presetMacroMetadata;f.replaceWithSelectedSearchText();if(!d){tinymce.confluence.macrobrowser.macroBrowserToolbarButtonClicked(e)}else{if(AJS.MacroBrowser.hasRequiredParameters(d)||!!d.alwaysShowConfig){tinymce.confluence.macrobrowser.macroBrowserToolbarButtonClicked(e)}else{AJS.Rte.BookmarkManager.storeBookmark();tinymce.confluence.MacroUtils.insertMacro({contentId:AJS.Meta.get("content-id")||"0",macro:{name:d.macroName,body:""}})}}};var a=function(d){if(d.hidden&&!AJS.MacroBrowser.isHiddenMacroShown(d)){return null}var e={className:"autocomplete-macro-"+d.macroName,callback:function(f){b(f,{ignoreEditorSelection:true,presetMacroMetadata:d})}};if(d.icon){e.name=d.title;e.href="#";e.icon=(d.icon.relative?AJS.params.staticResourceUrlPrefix:"")+d.icon.location}else{e.html=Confluence.Editor.Autocompleter.Util.dropdownLink(d.title)}return e};Confluence.Editor.Autocompleter.Settings["{"]={ch:"{",cache:false,endChars:["}",":","{"],dropDownClassName:"autocomplete-macros",dropDownDelay:0,selectFirstItem:true,getHeaderText:function(e,d){return "\u5B8F\u5EFA\u8BAE"},getAdditionalLinks:function(e,d){return[{className:"dropdown-insert-macro",html:Confluence.Editor.Autocompleter.Util.dropdownLink("\u6253\u5F00\u5B8F\u6D4F\u89C8\u5668","dropdown-prevent-highlight","editor-icon"),callback:function(g){var f=g.text();b(g,{searchText:f})}}]},getDataAndRunCallback:function(h,g,l){var f=[];if(!g){c("#macro-insert-list li").each(function(){var i=AJS.MacroBrowser.getMacroMetadata(c(this).attr("data-macro-name"));if(i){var n=a(i);n&&f.push(n)}})}else{var k=AJS.MacroBrowser.searchSummaries(g,{keywordsField:"keywordsNoDesc"}),d;for(var j=0,m=k.length;j<m;j++){var e=a(k[j]);if(e&&f.push(e)==h.maxResults){break}}}l([f],g)},update:function(e,d){throw new Error("All items in the Macro Autocomplete dropdown must have a callback function")}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-autocomplete-resources-only', location = 'tinymce3/plugins/autocomplete/editor_plugin_src.js' */
(function(){AJS.Rte.BootstrapManager.addTinyMcePluginInit(function(a){if(AJS.Meta.get("remote-user")&&AJS.Meta.get("confluence.prefs.editor.disable.autocomplete")){return}else{a.plugins+=",autocomplete"}});tinymce.create("tinymce.plugins.AutoComplete",{init:function(a){a.addCommand("mceConfAutocompleteLink",function(){Confluence.Editor.Autocompleter.Manager.shortcutFired("[")});a.addCommand("mceConfAutocompleteImage",function(){Confluence.Editor.Autocompleter.Manager.shortcutFired("!")});a.addShortcut("ctrl+shift+k",a.getLang("AutoComplete"),"mceConfAutocompleteLink");a.addShortcut("ctrl+shift+m",a.getLang("AutoComplete"),"mceConfAutocompleteImage");a.onPostRender.add(function(){AJS.$(function(){AJS.debug("Autocomplete enabled, adding keyPress listener");a.onKeyPress.addToTop(Confluence.Editor.Autocompleter.Manager.triggerListener);AJS.trigger("ready-editor-autocomplete")})});a.onUndo.add(Confluence.Editor.Autocompleter.Manager.reattach);a.onRedo.add(Confluence.Editor.Autocompleter.Manager.reattach)},getInfo:function(){return{longname:"Auto Complete",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("autocomplete",tinymce.plugins.AutoComplete)})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-autocomplete-resources-only', location = 'tinymce3/plugins/searchreplace/editor_plugin_src.js' */
(function(e){var h="searchreplace";var b=null;var j=false;var l=function(m,n){n.preventDefault();n.stopPropagation()};var i=function(m,o){l(m,o);var n=o.which;if(!n){n=o.charCode?o.charCode:o.keyCode}if(n<48){return}b.push(n)};var g=function(m){if(m>65535){m-=65536;return String.fromCharCode(55296+(m>>10),56320+(m&1023))}else{return String.fromCharCode(m)}};var d=function(){var m=AJS.Rte.getEditor();b=[];m.onKeyDown.add(i);m.onKeyPress.add(l);m.onKeyUp.add(l)};var a=function(n){var m=e("#rte-button-searchreplace a");if(m.length){if(n){m.unbind("click",false)}else{m.bind("click",false)}}};var f=function(){var m=AJS.Rte.getEditor();m.onKeyDown.remove(i);m.onKeyPress.remove(l);m.onKeyUp.remove(l);var n="";for(var o=0;o<b.length;o++){n+=g(b[o])}return n.toLowerCase()};var k=function(){if(j){return}j=true;var p=e("#rte-button-searchreplace");var o=!p.hasClass("active");var m=e("body");var n=!m.hasClass("no-tools")||m.hasClass("no-tools-toolbars-visible");if(o){p.addClass("active");if(!Confluence.Editor.searchManager){Confluence.Editor.searchManager=new Confluence.Editor.SearchManager(h)}e(document).trigger("createContextToolbarRow.Toolbar",{id:h,buttons:Confluence.Editor.searchToolbar.Buttons,topToolbar:true,editorAdjacent:true,animate:n,onVisible:function(){var q=f();Confluence.Editor.searchManager.onVisible(q);a(true);j=false;Confluence.Editor.searchManager.initialised=true}}).trigger("enableContextToolbarRow.Toolbar");d();Confluence.Editor.searchManager.init();a(false)}else{p.removeClass("active");Confluence.Editor.searchManager.onHide();e(document).trigger("removeContextToolbarRow.Toolbar",{id:h,animate:n,onHide:function(){e(document).trigger("contextToolbarRowRemoved.Toolbar");a(true);j=false;Confluence.Editor.searchManager.initialised=false}});a(false);if(!tinymce.isGecko){frames.wysiwygTextarea_ifr.focus()}tinyMCE.activeEditor.focus()}};var c=function(n){if(tinyMCE.isIE){var m=n.createTextRange();m.execCommand("SelectAll");m.move("textedit");m.select()}else{if(tinyMCE.isGecko){var o=e(n).val().length;n.setSelectionRange(o,o)}}};tinymce.create("tinymce.plugins.AtlassianSearchReplacePlugin",{init:function(m,n){m.addCommand("mceSearchReplaceToolbar",function(){k()});m.addCommand("mceConfSearch",function(p,o){if(!Confluence.Editor.searchManager){return}o=o||{};if(o.backwards&&!tinyMCE.activeEditor.plugins.customtoolbar.isToolbarButtonEnabled("search-toolbar-find-previous-button")){Confluence.Editor.searchManager.focus();return}if(!o.backwards&&!tinyMCE.activeEditor.plugins.customtoolbar.isToolbarButtonEnabled("search-toolbar-find-next-button")){Confluence.Editor.searchManager.focus();return}Confluence.Editor.searchManager.find(o.backwards,o.onFound,o.onNotFound)});m.addCommand("mceConfReplace",function(p,o){if(!Confluence.Editor.searchManager){return}o=o||{};if(!tinyMCE.activeEditor.plugins.customtoolbar.isToolbarButtonEnabled("search-toolbar-replace-button")){o.onInactive&&o.onInactive()}else{Confluence.Editor.searchManager.replace(o.onFound,o.onNotFound)}});m.addCommand("mceConfReplaceAll",function(p,o){if(!Confluence.Editor.searchManager){return}o=o||{};if(!tinyMCE.activeEditor.plugins.customtoolbar.isToolbarButtonEnabled("search-toolbar-replaceall-button")){return}Confluence.Editor.searchManager.replaceAll(o.onReplaced,o.onNotReplaced)});m.addCommand("mceConfSearchClose",function(p,o){if(!Confluence.Editor.searchManager){return}m.execCommand("mceSearchReplaceToolbar",false,null)});m.addButton("searchreplace",{title:"searchreplace.search_desc",cmd:"mceSearchReplaceToolbar"});if(!tinyMCE.isIE8){m.addShortcut("ctrl+f","searchreplace.search_desc",function(){if(Confluence.Editor.searchManager&&Confluence.Editor.searchManager.isVisible()){Confluence.Editor.searchManager.focus()}else{m.execCommand("mceSearchReplaceToolbar",false,false,{skip_undo:true})}})}},getInfo:function(){return{longname:"Search/Replace",author:"Atlassian",authorurl:"http://www.atlassian.com",infourl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("searchreplace",tinymce.plugins.AtlassianSearchReplacePlugin)})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-autocomplete-resources-only', location = 'tinymce3/plugins/searchreplace/searchreplace.js' */
(function(){if(typeof Confluence=="undefined"){Confluence={}}if(!Confluence.Editor){Confluence.Editor={}}var b='<mark class="find-current">';var a="</mark>";Confluence.Editor.SearchManager=function(k){var j=k;var i=null;var c=null;var g=null;var e=null;var f=null;var d=function(){e=null;f=null};var h=function(l,m){m.content=m.content.replace(new RegExp(b,"g"),"");m.content=m.content.replace(new RegExp(a,"g"),"")};this.initialised=false;this.find=function(l,p,m){var n=i.getFindInput().val();var o=g.findText(n,true,l);if(o&&p){p()}else{if(!o&&m){m()}}};this.replace=function(q,m){var l=i.getFindInput();var n=i.getReplaceInput();var p="";if(n){p=n.val()}var o=g.replaceText(l.val(),p,true);if(o&&q){q()}else{if(!o&&m){m()}}};this.replaceAll=function(m,n){var l=i.getFindInput();var p=i.getReplaceInput();var q="";if(p){q=p.val()}var o=g.replaceAll(l.val(),q);if(o&&m){m()}else{if(!o&&n){n()}}};this.focus=function(){i.focusFindTextBox()};this.isVisible=function(){return i!=null};this.init=function(){i=new Confluence.Editor.SearchManager.UI(j,e,f);c=new Confluence.Editor.SearchManager.MarkManager();c.addListener(i);g=null;if(tinyMCE.isIE){g=new Confluence.Editor.SearchManager.implIE(i)}else{g=new Confluence.Editor.SearchManager.impl(i,c)}tinyMCE.activeEditor.undoManager.onAdd.add(h)};this.onVisible=function(n){if(n!=null&&n.length>0){var l=i.getFindInput();var m=l.val();l.val(m+n)}i.onVisible()};this.onHide=function(){e=i.getFindInput().val();f=i.getReplaceInput().val();g.destroy();g=null;i.destroy();i=null;c.destroy();c=null;tinyMCE.activeEditor.undoManager.onAdd.remove(h)};this._clearSavedValues=d};Confluence.Editor.SearchManager.utils={moveCursorToEnd:function(d){if(tinyMCE.isIE){var c=d.createTextRange();c.execCommand("SelectAll");c.move("textedit");c.select()}else{if(tinyMCE.isGecko){var e=AJS.$(d).val().length;d.setSelectionRange(e,e)}}},createTextRange:function(d,c){return d.selection?d.selection.createRange():c.getBody().createTextRange()}};Confluence.Editor.SearchManager.impl=function(h,g){var d=new tinymce.html.Writer();var e=g;var j=h;var l=function(t,q,n){if(!t){return false}var o=tinyMCE.activeEditor,r=o.selection,m=o.getWin();if(e.isCursorAtCurrentMark()){r=e.selectCurrentMark()}if(!r.isCollapsed()){r.collapse(n)}function s(){e.markCurrentlySelectedRange();return true}function p(){e.removeCurrentMark(true);if(!tinyMCE.activeEditor.selection.isCollapsed()){tinyMCE.activeEditor.selection.collapse()}return false}if(tinymce.isGecko){if(m.find(t,false,n)){return s()}else{if(q){r.select(o.getBody(),false);r.collapse(!n);return l(t,false,n)}else{return p()}}}else{if(m.find(t,false,n,true,false,false,false)){return s()}else{return p()}}};var f=function(m,p,n){if(!e.hasCurrentMark()){return l(m,n)}var o=e.replaceCurrentMark(p);if(o){tinyMCE.activeEditor.selection.select(o)}return l(m,n)};var c=function(m){var n=tinyMCE.activeEditor;d.text(m);n.selection.setContent(d.getContent(),{format:"raw"});d.reset();n.selection.collapse(true)};var i=function(q,t){var p=tinyMCE.activeEditor,r=p.selection,o=p.getWin(),n=p.undoManager;e.removeCurrentMark(false);p.execCommand("selectAll");p.selection.collapse(true);var m=0;while(o.find(q,false,false,false,false,false,false)){c(t);m++}p.undoManager.add();if(m==0){AJS.Confluence.EditorNotification.notify("info",p.getLang("searchreplace_dlg.notfound"))}else{if(m==1){AJS.Confluence.EditorNotification.notify("success",p.getLang("searchreplace_dlg.allreplacedsingular"))}else{if(m>1){var s=p.getLang("searchreplace_dlg.allreplacedplural");AJS.Confluence.EditorNotification.notify("success",s.replace("{0}",m))}}}return m};var k=function(){j=null;e=null;d=null};this.findText=l;this.replaceText=f;this.replaceAll=i;this.destroy=k};Confluence.Editor.SearchManager.implIE=function(k){var m=k;var q=null;var d=new tinymce.html.Writer();var h=Confluence.Editor.SearchManager.utils.createTextRange;var p=function(z,t,y){if(!z){return false}var v=tinyMCE.activeEditor,x=v.getDoc(),A=this.storedRange=this.storedRange||h(x,v);v.focus();if(q){q.select()}v.selection.collapse(!y);i();if(y&&q){var s=h(x,v);s.moveToElementText(AJS.$("p:first",v.getBody())[0]);A.setEndPoint("StartToStart",s);var w=q.text;if(w.length){w=w.replace(/s+$/,"");if(w.length){A.moveEnd("character",-w.length)}}var u=A.text.length;A.moveEnd("word",-1);if(A.text.length>=u){A.moveEnd("character",-1)}A.select();A.collapse(false)}q=null;if(A.findText(z,y?-1:1,0)){A.scrollIntoView();A=g(A);A.select();q=A;return true}else{if(t){v.selection.select(tinyMCE.activeEditor.getBody(),true);v.selection.collapse(!y);return p(z,false,y)}else{this.storedRange=null}}};var j=function(t,s,u){i()};var f=function(){var s=tinyMCE.activeEditor;s.onChange.add(j);s.onBeforeSetContent.add(j)};var c=function(){var s=tinyMCE.activeEditor;s.onChange.remove(j);s.onBeforeSetContent.remove(j)};var g=function(s){var t=s.htmlText;s.pasteHTML(b+t+a);m.marked();f();return s};var i=function(){c();var u=tinyMCE.activeEditor;var t=AJS.$("mark",u.getDoc());if(t.length){var v=false;var s=u.selection.getRng(true).commonAncestorContainer;var w=AJS.$(s).closest("mark");if(w.length){v=true}t.each(function(x,y){$markElement=AJS.$(y);$markElement.contents().each(function(z,A){$markElement.before(A)})}).remove();if(v){u.execCommand("RemoveFormat")}}m.markRemoved()};var e=function(t,y,u){var s=tinyMCE.activeEditor;if(q){var w=s.getDoc().createTextNode(y);var v=AJS.$("mark",s.getDoc());v.parent()[0].replaceChild(w,v[0]);s.undoManager.add();var x=s.getDoc().createElement("mark");x.setAttribute("class","current");w.parentNode.insertBefore(x,w);x.appendChild(s.getDoc().createTextNode(y));x.parentNode.removeChild(w)}return p(t,u)};var l=function(u,y){var v=tinyMCE.activeEditor,x=v.selection,B=v.getWin(),z=v.undoManager,A=v.getDoc();i();x.select(v.getBody(),false);x.collapse(true);v.focus();var s=h(A,v);var C=0;while(s.findText(u,1,0)){s.scrollIntoView();s.select();d.text(y);v.selection.setContent(d.getContent(),{format:"raw"});d.reset();C++;s.moveStart("character",y.length)}z.add();if(C==0){AJS.Confluence.EditorNotification.notify("info",v.getLang("searchreplace_dlg.notfound"))}else{if(C==1){AJS.Confluence.EditorNotification.notify("success",v.getLang("searchreplace_dlg.allreplacedsingular"))}else{if(C>1){var t=v.getLang("searchreplace_dlg.allreplacedplural");AJS.Confluence.EditorNotification.notify("success",t.replace("{0}",C))}}}return C};var o=function(s,t){i()};var r=function(){tinyMCE.activeEditor.onBeforeGetContent.add(o)};var n=function(){tinyMCE.activeEditor.onBeforeGetContent.remove(o);i();m=null;q=null;d=null};this.findText=p;this.replaceText=e;this.replaceAll=l;this.destroy=n;r()};Confluence.Editor.SearchManager.UI=function(g,r,h){var m=null,v=Confluence.Editor.SearchManager.utils.moveCursorToEnd;if(tinyMCE.activeEditor&&tinyMCE.activeEditor.plugins&&tinyMCE.activeEditor.plugins.customtoolbar){m=tinyMCE.activeEditor.plugins.customtoolbar.getToolbarRow(g)}var j=function(){var x=AJS.$(".toolbar-find-input",m);if(!x.length){return null}return x};var u=function(){top.focus();j().focus()};var f=function(){var x=AJS.$(".toolbar-replace-input",m);if(!x.length){return null}return x};var s=function(z){if(z.type=="input"||z.type=="propertychange"){var x=j();var y=(x!=null)&&(x.val().length>0);q(y);k(y)}};var e=function(y){var x=j();i(x&&x.val())};var n=function(){function x(B,A){if(!B){return}if(tinymce.isIE9){B[0].attachEvent("onpropertychange",A)}else{var z=tinymce.isIE8?"propertychange":"input";B.bind(z,A)}}var y=j();x(y,s);x(y,e);AJS.$(m).focusin(function(z){k(true)}).focusout(function(z){k(false)});y.focus(function(z){k(true)})};var q=function(x){if(x){tinyMCE.activeEditor.plugins.customtoolbar.enableToolbarButton("search-toolbar-find-next-button");tinyMCE.activeEditor.plugins.customtoolbar.enableToolbarButton("search-toolbar-find-previous-button")}else{tinyMCE.activeEditor.plugins.customtoolbar.disableToolbarButton("search-toolbar-find-next-button");tinyMCE.activeEditor.plugins.customtoolbar.disableToolbarButton("search-toolbar-find-previous-button")}};var k=function(y){var x=j();w().toggleClass("default-action",y&&x.val().length>0)};var w=function(){var x=AJS.$(".search-toolbar-find-next-button",m).closest(".aui-button");if(!x.length){return null}return x};var o=function(){d(false)};var l=function(){d(true)};var d=function(y){var z=tinyMCE.activeEditor.plugins.customtoolbar;var x="search-toolbar-replace-button";if(y){z.enableToolbarButton(x)}else{z.disableToolbarButton(x)}};var i=function(y){var z=tinyMCE.activeEditor.plugins.customtoolbar;var x="search-toolbar-replaceall-button";if(y){z.enableToolbarButton(x)}else{z.disableToolbarButton(x)}};var p=function(B,x){var y=j();var z=false;if(B&&B.length){y.val(B);z=true}if(x&&x.length){var A=f();A.val(x)}n();q(z);i(z);d(false)};var c=function(){var x=j();x.focus();if(x.val().length>0){v(x[0]);q(true);i(true)}};var t=function(){};this.getFindInput=j;this.getReplaceInput=f;this.focusFindTextBox=u;this.onVisible=c;this.destroy=t;this.marked=l;this.markRemoved=o;p(r,h);return this};Confluence.Editor.SearchManager.MarkManager=function(){var u=null;var g=new tinymce.html.Writer();var k=null;var m=[];var f=function(y,x,z){e()};var h=function(x){m.push(x)};var s=function(){if(!u){return null}var x=tinyMCE.activeEditor;x.selection.select(u[0]);return x.selection};var q=function(){var y=tinyMCE.activeEditor;if(u){var z=y.selection.getBookmark();o(false);y.selection.moveToBookmark(z)}k=null;var x=y.selection.getRng(true);u=AJS.$(b+a,y.getDoc());try{x.surroundContents(u[0]);j(false)}catch(A){if(A.code==1){k=x.toString();u=null;j(true)}}AJS.$.each(m,function(B,C){C.marked()});if(!k){s().collapse()}};var c=function(){if(!u){return false}var z=tinyMCE.activeEditor;var A=z.selection;if(!A.isCollapsed()){A.collapse()}var y=A.getRng(true);if(y.startContainer.nodeType==3){y.startContainer.parentNode.normalize();return y.startContainer.nextSibling===u[0]||y.startContainer.previousSibling===u[0]}else{if(y.startContainer.nodeType==1){var B=y.startContainer.childNodes;var x=y.startOffset;if(x>0&&B[x-1]===u[0]){return true}if((x+1)<B.length&&B[x+1===u[0]]){return true}return false}}};var o=function(x){d();if(i(u,x)||(k&&tinyMCE.activeEditor.selection.getRng(true).toString()==k)){u=null;k=null;AJS.$.each(m,function(y,z){z.markRemoved()})}};var e=function(){d();AJS.$("mark",tinyMCE.activeEditor.getDoc()).each(function(x,y){var z=i(AJS.$(y),false)});u=null;k=null;AJS.$.each(m,function(x,y){y.markRemoved()})};var i=function(E,x){var z=tinyMCE.activeEditor.selection.getRng(true);if(!E){return false}function D(F,H){if(F.intersectsNode){return F.intersectsNode(H)}else{var G=tinyMCE.activeEditor.getDoc().createRange();G.selectNodeContents(H);if(F.compareBoundaryPoints(Range.START_TO_END,G)<=0||F.compareBoundaryPoints(Range.END_TO_START,G)>=0){return false}else{return true}}}var C=D(z,E[0]);var B=null;var y=null;E.contents().each(function(F,G){E.before(G);if(!B){B=G}y=G});if(C||x){var A=tinyMCE.activeEditor.selection.getRng(true);A.setStartBefore(B);A.setEndAfter(y);if(!x){A.collapse(false)}tinyMCE.activeEditor.selection.setRng(A)}E.remove();return true};var p=function(){if(u){return true}if(k){return tinyMCE.activeEditor.selection.getRng(true).toString()==k}};var n=function(y){if(u||!p()){return false}var x=tinyMCE.activeEditor;g.text(y);x.selection.setContent(g.getContent(),{format:"raw"});g.reset();x.undoManager.add();o(false);return true};var w=function(B){if(n(B)){return null}if(!u){return null}var x=[];u.contents().each(function(C,D){x.push(D)});o(false);var y=tinyMCE.activeEditor;var A=AJS.$(x[0]).before(y.getDoc().createTextNode(B))[0].previousSibling;for(var z=x.length-1;z>=0;z--){AJS.$(x[z]).remove()}y.undoManager.add();return A};var v=function(x,y){e()};var l=function(x,y){d();AJS.$.each(m,function(z,A){A.markRemoved()})};var j=function(y){var x=tinyMCE.activeEditor;x.onChange.add(f);x.onBeforeSetContent.add(f);if(y){x.onClick.add(l);x.onDblClick.add(l)}};var d=function(){var x=tinyMCE.activeEditor;x.onChange.remove(f);x.onBeforeSetContent.remove(f);x.onClick.remove(l);x.onDblClick.remove(l)};var r=function(){tinyMCE.activeEditor.onBeforeGetContent.add(v)};var t=function(){o(true);tinyMCE.activeEditor.onBeforeGetContent.remove(v)};this.markCurrentlySelectedRange=q;this.removeCurrentMark=o;this.removeAllMarks=e;this.selectCurrentMark=s;this.isCursorAtCurrentMark=c;this.hasCurrentMark=p;this.replaceCurrentMark=w;this.addListener=h;this.destroy=t;r()}})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.editor:editor-autocomplete-resources-only', location = 'tinymce3/plugins/searchreplace/tinyMce-search-toolbar.js' */
AJS.$(document).bind("initContextToolbars.Toolbar",function(k,j){var b=function(s){if(tinyMCE.isIE){var e=s.createTextRange();e.execCommand("SelectAll");e.move("textedit");e.select()}else{if(tinyMCE.isGecko){var t=AJS.$(s).val().length;s.setSelectionRange(t,t)}}};var c=function(e){top.focus();tinyMCE.activeEditor.plugins.customtoolbar.focusToolbarButton(e)};var h=function(){top.focus();var e=AJS.$("#search-toolbar-find-text");e.focus();b(e[0])};var d=function(){top.focus();var e=AJS.$("#search-toolbar-replace-text");e.focus();b(e[0])};var g=function(){if(tinyMCE.isIE){frames.wysiwygTextarea_ifr.focus()}if(tinyMCE.isIE||tinyMCE.isGecko){var e=tinyMCE.activeEditor;e.focus();e.selection.select(e.getBody());e.selection.collapse(false);e.focus()}};var r=function(t){if(!tinyMCE.isIE8&&(t.ctrlKey||(tinymce.isMac&&t.metaKey))&&t.which=="70"){t.preventDefault()}else{if(t.which=="13"){t.preventDefault();var s={backwards:false,onFound:h,onNotFound:h};tinyMCE.activeEditor.execCommand("mceConfSearch",false,s,{skip_undo:true})}else{if(t.which=="27"){t.preventDefault();tinyMCE.activeEditor.execCommand("mceSearchReplaceToolbar",false,false,{skip_undo:true})}}}};var o=function(t){if(!tinyMCE.isIE8&&(t.ctrlKey||(tinymce.isMac&&t.metaKey))&&t.which=="70"){t.preventDefault()}else{if(t.which=="13"){t.preventDefault();var s={onFound:d,onNotFound:h,onInactive:function(){tinyMCE.activeEditor.execCommand("mceConfSearch",false,{backwards:false,onFound:d,onNotFound:h},{skip_undo:true})}};tinyMCE.activeEditor.execCommand("mceConfReplace",false,s,{skip_undo:true})}else{if(t.which=="27"){t.preventDefault();tinyMCE.activeEditor.execCommand("mceSearchReplaceToolbar",false,false,{skip_undo:true})}}}};var f=new Confluence.Editor.Toolbar.Components.TextBox({id:"search-toolbar-find-text",text:j.getLang("searchreplace_dlg.findlabel"),name:"find",keydown:r,cssClass:"toolbar-find-input"});var n=new Confluence.Editor.Toolbar.Components.TextBox({id:"search-toolbar-replace-text",text:j.getLang("searchreplace_dlg.replacelabel"),name:"replace",keydown:o,cssClass:"toolbar-replace-input"});var p=new Confluence.Editor.Toolbar.Components.TextButton({text:j.getLang("searchreplace_dlg.findprevious"),click:function(){var e={backwards:true,onFound:function(){top.focus();c("search-toolbar-find-previous-button")},onNotFound:h};j.execCommand("mceConfSearch",false,e,{skip_undo:true})},textClass:"search-toolbar-find-previous-button"});var q=new Confluence.Editor.Toolbar.Components.TextButton({text:tinyMCE.isIE?j.getLang("searchreplace_dlg.findlabel"):j.getLang("searchreplace_dlg.findnext"),click:function(){var e={backwards:false,onFound:function(){top.focus();c("search-toolbar-find-next-button")},onNotFound:h};j.execCommand("mceConfSearch",false,e,{skip_undo:true})},textClass:"search-toolbar-find-next-button"});var i=new Confluence.Editor.Toolbar.Components.TextButton({text:j.getLang("searchreplace_dlg.replace"),click:function(){j.execCommand("mceConfReplace",false,{onFound:function(){top.focus();c("search-toolbar-replace-button")},onNotFound:h},{skip_undo:true})},textClass:"search-toolbar-replace-button"});var m=new Confluence.Editor.Toolbar.Components.TextButton({text:j.getLang("searchreplace_dlg.replaceall"),click:function(){var e={onReplaced:g,onNotReplaced:h};j.execCommand("mceConfReplaceAll",false,e)},textClass:"search-toolbar-replaceall-button"});var a=new Confluence.Editor.Toolbar.Components.Button({text:j.getLang("searchreplace_dlg.close"),iconClass:"icon-close",click:function(){j.execCommand("mceConfSearchClose",false,null)}});var l=null;if(tinyMCE.isIE){l=[new Confluence.Editor.Toolbar.Components.Group([a],{groupClass:"close"}),new Confluence.Editor.Toolbar.Components.Group([f,n]),new Confluence.Editor.Toolbar.Components.Group([q]),new Confluence.Editor.Toolbar.Components.Group([i,m])]}else{l=[new Confluence.Editor.Toolbar.Components.Group([a],{groupClass:"close"}),new Confluence.Editor.Toolbar.Components.Group([f,n]),new Confluence.Editor.Toolbar.Components.Group([p,q]),new Confluence.Editor.Toolbar.Components.Group([i,m])]}Confluence.Editor.searchToolbar={Buttons:l}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.confluence-editor-hide-tools:confluence-editor-hide-tools-resources', location = '/js/confluence-editor-hide-tools.js' */
(function(g){if(tinymce.isIE){return}AJS.Rte.BootstrapManager.addTinyMcePluginInit(function(y){y.plugins+=",dfe"});var s=function(y){return{"-moz-transform":y,"-webkit-transform":y,transform:y}};var p=function(z){var y=z.css("transform")||z.css("-webkit-transform")||z.css("-moz-transform");if(y=="none"){return 0}return parseInt((y.match(/^matrix\(.*?(-?[\d.]+)\)$/)||[])[1])||0};var u=function(y){return"translateY("+y+"px)"};var l=function(){return"transitionend webkitTransitionEnd MSTransitionEnd"};var n=function(){if(window.fullScreen){return window.fullScreen}return(window.innerWidth==screen.width&&window.innerHeight==screen.height)};var w=false;var t=true;var r="dfe.";var h=0;var m=0;var b=null;var x=null;var f=0;var a=null;var j=+new Date;var q=function(y,z){z=z||{};z.uid=j;AJS.trigger("analyticsEvent",{name:r+y,data:z})};var i=null;var e=false;var o=0;var k=null;var d=null;var c=null;g(function(){k="confluence."+AJS.params.remoteUser+".dfe.";d=k+"totalEdits";c=k+"hasUsed";if(window.localStorage){o=window.localStorage.getItem(d)||0;e=!!window.localStorage.getItem(c)}});var v=function(){f+=(+new Date-x)};g(window).on("beforeunload",function(){if(!w){return}q("hoveredOverToolbarsCount",{header:h,footer:m});var y=(+new Date-b-f);q("editorInteractionTimeSeconds",{normal:Math.round(y/1000),dfe:Math.round(f/1000)})});tinymce.create("tinymce.plugins.DFEPlugin",{active:false,transitioning:false,hangOnScreenHeightHeader:t?0:8,hangOnScreenHeightFooter:8,hideToolsButton:null,editorToolbar:null,savebarContainer:null,wysiwyg:null,iframe:null,activatedDropdownContext:false,originalEditorToolbarHeight:0,originalEditorToolbarTranslateY:0,editorToolbarCurrentHeight:0,editorToolbarCurrentTranslateY:0,init:function(y){y.onInit.add(_.bind(function(H){var J=g("body");var X=!!g(H.formElement).closest("#comments-section").length;var E=this.editorToolbar=g("#toolbar");var R=this.savebarContainer=g("#savebar-container");var W=this.hangOnScreenHeightHeader;var P=this.hangOnScreenHeightFooter;var L=[E,R];this.wysiwyg=g("#wysiwyg");this.iframe=this.wysiwyg.find("iframe");this.messages=g("#editor-messages, #all-messages");if(X){return}b=+new Date;g(function(){o++;window.localStorage&&window.localStorage.setItem(d,o)});w=true;g(window).scroll(function(Y){Y.preventDefault()});J.toggleClass("no-tools-pin-toolbar",t);var T=g("<ul />",{"class":"aui-buttons"});var U=g("<li />",{"class":"toolbar-item aui-button",id:"rte-button-toolbartoggle","data-tooltip":"Hide tools (Ctrl+Shift+F)"});var V=g("<a />",{href:"#"});var S=g("<span />",{"class":"icon icon-toolbartoggle",text:"Hide tools (Ctrl+Shift+F)"});S.prependTo(V);V.appendTo(U);U.appendTo(T);T.prependTo("#rte-toolbar .aui-toolbar2-secondary");this.hideToolsButton=T;J.toggleClass("no-transition",!this.useTransition());setTimeout(function(Y){Y.contents().find("body").addClass("no-tools-capable")},500,this.iframe);this.hideToolsButton.click(_.bind(this.toggle,this));this.bindKeyboardShortcuts();var M=_.bind(function(aa){if(i){setTimeout(function(){i.view.popup.refresh();i.view.$el.find(".arrow svg").slice(1).remove()},100)}if(!this.active){return}var Z=u(this.editorToolbarCurrentTranslateY-(E.height()-this.editorToolbarCurrentHeight));var Y=u(R.height()-P);N({header:Z,footer:Y})},this);AJS.bind("messageClose",M);var B=[];var A=function(Y){return/\((?:max|min)-(?:width|height):\s*/.test(Y)};window.matchMedia&&_.each(document.styleSheets,function(Y){try{if(Y.media&&A(Y.media.mediaText)){B.push(Y.media.mediaText)}_.each(Y.cssRules,function(aa){if(aa instanceof CSSMediaRule){if(A(aa.media.mediaText)){B.push(aa.media.mediaText)}}})}catch(Z){}});_.each(B,function(Z){var Y=window.matchMedia(Z);Y.addListener(M)});var O=_.bind(this.showHelpTips,this);g(setTimeout(O,3000));g(window).resize(_.debounce(O,100));function I(){J.toggleClass("no-tools-probably-full-screen",n())}g(window).resize(_.debounce(I,100));I();g(document).on("hideLayer",function(Z,Y,aa){if(Y!="inlineDialog"){return}setTimeout(function(){a=null},5000)});g("#rte-button-preview").click(this.hideHelpTips);if(!this.useTransition()){return}var Q=g("<div class='editor-toolbar-transition-cover' />");!t&&Q.clone().addClass("header").appendTo("body");Q.addClass("footer").appendTo("body");var F;var N=_.bind(function(Y){var Z="no-tools-dont-animate";if(t&&this.active){setTimeout(_.bind(function(){var aa=this.originalEditorToolbarTranslateY+this.editorToolbar.height()-this.originalEditorToolbarHeight;this.wysiwyg.css(s(u(aa)));this.adjustIframeHeight()},this),0);return}J.addClass(Z);E.css(s(Y.header));R.css(s(Y.footer));clearTimeout(F);F=setTimeout(function(){J.removeClass(Z)},1000)},this);var D=null;g(window).resize(_.bind(function(){if(!this.active){return}var Y=g(window).width();if(Y!=D&&D<1024){M()}D=Y},this));this.originalEditorToolbarTranslateY=p(E);this.savebarContainerOriginalTranslateY=p(R);var K=false;var G=false;g(document).on("mouseenter",".tipsy",function(){K=true}).on("mouseleave",".tipsy",function(){setTimeout(function(){if(K){g.each(L,function(){g(this).trigger("mouseleave")})}K=false},50)});g.each(L,_.bind(function(Z,aa){var ac=aa[0]==R[0];if(t&&!ac){return}var ab=null;var ad="no-tools-toolbars-visible";var Y=null;var ae=aa.find(".extended-hit-zone");if(!ae.length){ae=g("<div class='extended-hit-zone' />").appendTo(aa)}aa.on("mouseenter",_.bind(function(){if(!this.active||this.transitioning){return}if(ac){var ag=this.iframe;var af=ag.contents().find("body").prop("scrollWidth")>ag.width();ae.toggle(!af);m++}else{h++}K=false;G=true;J.addClass(ad);var ai=ac?this.savebarContainerOriginalTranslateY:this.originalEditorToolbarTranslateY-W+E.height()-(E.height()-this.originalEditorToolbarHeight);var ah=u(ai);aa.css(s(ah))},this));aa.on("mouseleave",_.bind(function(){clearTimeout(Y);if(!this.active||this.transitioning){return}G=false;this.hideStragglers();var ag=ac?this.savebarContainerOriginalTranslateY+R.height()-P:this.originalEditorToolbarTranslateY-(E.height()-this.originalEditorToolbarHeight);var af=u(ag);Y=setTimeout(function(){if(K){return}aa.css(s(af));J.removeClass(ad)},50)},this))},this));g(document).on("createContextToolbarRow.Toolbar resize.resizeplugin rte.heartbeat",_.bind(function(aa,Y){if(!this.active){M();return}if(G){return}if(Y&&Y.id=="searchreplace"){this.deactivate();return}this.updateToolbarsDimensions();var Z=u(this.editorToolbarCurrentTranslateY);N({header:Z,footer:null})},this));var z=AJS.Meta.get("page-id")!="0";if(z){var C=_.bind(this.setActiveStateFromLastSession,this);g(function(){setTimeout(C,500)})}},this))},useTransition:(function(){var y=null;return function(){if(y===null){var z=["","webkit","moz"];if(g.browser.msie){return false}var A=function(B){return(B?"-"+B+"-":"")};y=!!g.grep(z,function(B){return document.body.style[A(B)+"transition"]!==undefined}).length}return y}})(),toggle:function(y){y&&y.preventDefault();this.active=!this.active;this[this.active?"activate":"deactivate"].call(this)},deactivate:function(){this.active=false;this.update();q("deactivate")},activate:function(){this.active=true;this.update();var y={viewportSize:window.innerWidth+"x"+window.innerHeight,helpTipDiscovered:a};q("activate",y);window.localStorage.setItem(c,true);this.hideHelpTips()},update:function(){var D=function(Y,X){X===undefined&&(X="auto");return E?Y:X};var H=g("body");var E=this.active;var W=E?"Show tools (Esc)":"Hide tools (Ctrl+Shift+F)";g("#rte-button-toolbartoggle").toggleClass("active",E).attr({title:W,"data-tooltip":W,"original-title":W});if(E){x=+new Date}else{v()}this.hideStragglers();H.scrollTop(0);if(!this.useTransition()){H.toggleClass("no-tools",E);g.browser.msie&&g(window).resize();return}this.transitioning=true;var A=this.wysiwyg;var M=g("#editor-precursor");var P=g("#header");var G=g("#header-precursor");var U=this.messages;var B=this.editorToolbar;var T=this.savebarContainer;var F=T.height();var O=P.height();var I=G.height();var z=g("form.editor");var J=M.height()+O+B.height()+I;var V=this.hangOnScreenHeightHeader;var R=this.hangOnScreenHeightFooter;this.originalEditorToolbarHeight=B.height();E&&H.css("overflow-y","hidden");this.adjustIframeHeight();!E&&U.insertAfter(M.find("#content-title-div"));H.removeClass("no-tools-toolbars-visible no-tools-animate no-tools-animate-end");var S=A.add(P).add(G).add(B).add(M);E&&S.css({top:function(){return g(this).offset().top}});H.addClass("no-tools");var Q=AJS.dropDown.current||g(".aui-property-panel-parent");M.css({height:D(M.height()),overflow:D("hidden")});if(t){J-=B.height()}var K=D(u(V-J),"none");var y=D(u(F-R),"none");if(Q.length){var L=u((-J+(V*2)+(t?0:2))*(this.activatedDropdownContext?-1:1));var C="none";var N=this.activatedDropdownContext?D(C,L):D(L,C)}this.originalEditorToolbarTranslateY=V-J;this.savebarContainerOriginalTranslateY=p(T);!this.active&&H.addClass("no-tools-show-tools");if(!t){this.iframe.contents().find("body").toggleClass("no-tools-enabled",E)}setTimeout(function(X){var Y=l();z.off(Y).on(Y,function(Z){if(Z.target!=M[0]){return}if(E){AJS.messages.makeCloseable(U.find(".aui-message").not(".closeable").addClass("closeable"));U.appendTo(H);setTimeout(function(){H.addClass("no-tools-animate-end")},0)}else{A.css("height","100%");H.removeClass("no-tools no-tools-animate").css("overflow-y","auto")}X.transitioning=false;document.activeElement.tagName.toLowerCase()!="input"&&AJS.Rte.getEditor().focus();X.updateToolbarsDimensions()});H.addClass("no-tools-animate");S.css(s(K));T.css(s(y));if(Q){(Q instanceof jQuery?Q:Q.$.parent().add("body > svg")).css(s(N))}},0,this);this.storeActiveStateForNextSession()},updateToolbarsDimensions:function(){this.editorToolbarCurrentHeight=this.editorToolbar.height();this.editorToolbarCurrentTranslateY=this.originalEditorToolbarTranslateY-(this.editorToolbarCurrentHeight-this.originalEditorToolbarHeight)},hideStragglers:function(){g(".aui-dropdown, #table-picker-backdrop").each(function(){if(g(this).hasClass("hidden")){return true}var y=this.id=="table-picker-backdrop"?g(this):g(this).closest(".toolbar-item");y.click()})},adjustIframeHeight:function(){this.iframe.css("paddingBottom",this.active?this.editorToolbar.height()+this.hangOnScreenHeightFooter+1:0)},bindKeyboardShortcuts:(function(){var A=false;var C={};var B=function(D){if(typeof D!="string"){D=D.type}return D};var y=function(D){D=B(D);C[D]=true};var z=function(D){if(!_.keys(C).length){return}D=B(D);setTimeout(function(){delete C[D]},500)};return function(){if(A){return}A=true;var H=_.bind(function(I){if(!this.transitioning&&I.ctrlKey&&I.shiftKey&&I.keyCode=="F".charCodeAt(0)){this.toggle(I);q("keyboardShortcutUsed",{shortcut:"toggle"})}},this);var E=AJS.Rte.getEditor();E.onKeyDown.add(_.bind(function(I,J){H(J)},this));g(document).on("keydown",H);E.onKeyUp.add(_.bind(function(I,J){if(!this.active||_.keys(C).length||J.keyCode!=27){return}this.deactivate();q("keyboardShortcutUsed",{shortcut:"escape"})},this));var F=function(I){return I=="dropdown"||(g.isPlainObject(I)&&I.panel)};var G=_.bind(function(J,I,K){if(I.dialog){return}if(F(I)){this.activatedDropdownContext=this.active}y(I)},this);var D=_.bind(function(J,I,K){if(F(I)){this.activatedDropdownContext=false}z(I)},this);AJS.bind("show.dialog created.property-panel",G);g(document).bind("showLayer",G);AJS.bind("hide.dialog destroyed.property-panel",D);g(document).bind("hideLayer",D)}})(),hideHelpTips:function(){if(!i){return}i.view.$el.remove();i=null},showHelpTips:(function(){var y={};var A="dfe.betteruseofscreen";var z="dfe.neverused";return function(){var B=parseInt(AJS.Meta.get("build-number"),10);var C=B>4370;if(!AJS.HelpTip||!C){return}AJS.HelpTip.Manager.loaded.done(_.bind(function(){var J=n();if(this.active||g(".aui-help-tip").length||i!=null){if(!J&&i!=null&&i.attributes.fullScreen){this.hideHelpTips()}return}var L=AJS.HelpTip.Manager.dismissedTipIds;var N=function(O){return g.inArray(O,L)>-1};var F=25;var M=20;var D=g(window).height();var I=(D-this.wysiwyg.height())/D;var G={id:null,body:null,anchor:this.hideToolsButton};if(!e&&o>F&&!N(z)&&!N(A)){G.body="\u003cstrong>Get in the zone.\u003c\/strong> Hide the toolbar and focus on your content with distraction-free editing. \u003ca href=\"http:\/\/blogs.atlassian.com\/2013\/06\/get-in-the-zone-with-distraction-free-editing\/?utm_source=confluence-inproduct&utm_medium=inproduct-helptips&utm_campaign=confluence-distraction-free-editor\" target=\"_blank\">Learn more\u003ca>";G.id=a=z}else{if(o>M&&I>0.3&&!N(A)){G.body="\u003cstrong>Want more room?\u003c\/strong> Hide the toolbar and focus on your content with distraction-free editing. \u003ca href=\"http:\/\/blogs.atlassian.com\/2013\/06\/get-in-the-zone-with-distraction-free-editing\/?utm_source=confluence-inproduct&utm_medium=inproduct-helptips&utm_campaign=confluence-distraction-free-editor\" target=\"_blank\">Learn more\u003ca>";G.id=A;a="smalleditingspace"}else{if(J){G.body="\u003cstrong>Looks like you\'re in full-screen mode\u003c\/strong>. Get even more editing space by hiding the editor toolbar. \u003ca href=\"http:\/\/blogs.atlassian.com\/2013\/06\/get-in-the-zone-with-distraction-free-editing\/?utm_source=confluence-inproduct&utm_medium=inproduct-helptips&utm_campaign=confluence-distraction-free-editor\" target=\"_blank\">Learn more\u003ca>";G.id=A;G.fullScreen=true;a="fullscreen"}}}if(!G.id){this.hideHelpTips();return}var K=new AJS.HelpTip(G);if(window.localStorage){var H=k+"helptip."+G.id+".showncount";var E=+window.localStorage.getItem(H)||0;if(!y.hasOwnProperty(G.id)){E++;window.localStorage.setItem(H,E);y[G.id]=true}if(E>4){K.dismiss();return}}K.show();i=K},this))}})(),setActiveStateFromLastSession:function(){var y=window.localStorage&&window.localStorage.getItem(k+"activeState");if(y==="true"){this.activate()}},storeActiveStateForNextSession:function(){window.localStorage&&window.localStorage.setItem(k+"activeState",this.active)},getInfo:function(){return{longname:"Distraction Free Editor Plugin",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("dfe",tinymce.plugins.DFEPlugin)})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.ext.newcode-macro-plugin:editor-scripts', location = 'scripts/paste-cleanup.js' */
AJS.$(document).bind("postPaste",function(b,a,c){AJS.$(c.node).find('span[class|="code"]').contents().unwrap();AJS.$(c.node).find('pre[class|="code"]').each(function(d,f){f.className=f.className.replace(/\bcode-.[^\s]*\b/gi,"")})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.status-macro:editor_status', location = 'js/status-editor.js' */
(function(d){var v="macro-placeholder-property-panel-edit-button";var n="status-macro-title first last editable";var r=13;var f=27;var o="status";var q=["Grey","Red","Yellow","Green","Blue"];var k=q[0];var t;var u,m,a;function s(){e();var z=Confluence.MacroParameterSerializer.deserialize(d(u).attr("data-macro-parameters")),A=false,y=false;if(z&&m){A=z.title!==m.title;y=z.colour!==m.colour}return A||y}function e(){if(a){var y=(b(m)==a.val());var z=(a.val()==="");if(y||z){delete m.title}else{m.title=a.val()}}}function p(){if(t&&t.state&&t.state()==="pending"){AJS.log("Macro update already in progress.");return}e();var z={contentId:Confluence.Editor.getContentId(),macro:{name:o,params:m,defaultParameterValue:"",body:""}};t=tinymce.confluence.MacroUtils.insertMacro(z,u);function y(A){AJS.Rte.getEditor().selection.select(A);AJS.Rte.BookmarkManager.storeBookmark();AJS.Rte.getEditor().selection.collapse()}t.done(function(A,B){u=A;y(u)}).fail(function(A){AJS.logError("Failed to load status macro - "+A)})}function b(y){return((y.colour||y.color)||k)}function j(){a=null;return true}function c(y){var z=d("<input/>");z.attr("class",n);z.keyup(function(A){if(A.keyCode===r){AJS.Confluence.PropertyPanel.destroy();return false}return true});z.keydown(function(A){if(A.keyCode===f){return j()}return true});return z}function x(y){a=c(m);a.val(y.find("span.panel-button-text").text());y.replaceWith(a);a.select().focus()}function h(){d.each(q,function(y,A){var z=function(C,B){m.colour=A;AJS.Confluence.PropertyPanel.destroy()};AJS.Confluence.PropertyPanel.Macro.registerButtonHandler(A,z,o)})}function i(y){return y.title||b(y)}function g(y){return{className:n,text:AJS.escapeHtml(y),click:x}}function l(z){for(var y=0;y<z.length;y++){if(z[y].className.indexOf(v)>-1){return z[y]}}return null}function w(y){var z=l(y);var A=function(B){tinymce.confluence.macrobrowser.editMacro(d(B))};z.click=function(){AJS.Confluence.PropertyPanel.destroy();if(!s()){A(u)}else{t.always(A)}}}AJS.Confluence.PropertyPanel.Macro.registerInitHandler(function(A,z,y){u=A;w(z);m=Confluence.MacroParameterSerializer.deserialize(d(u).attr("data-macro-parameters"));a=null;z.splice(1,0,g(i(m)))},"status");h();AJS.bind("destroyed.property-panel",function(y){if(s()){p()}})})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.macros.advanced:editor_includemacro', location = 'com/atlassian/confluence/plugins/macros/advanced/js/include-macro.js' */
AJS.bind("init.rte",function(){var b=AJS.Meta.get("context-path"),d=AJS.Meta.get("content-id"),c="plugins/servlet/confluence/include-page-macro/goto",a=function(e){var j=AJS.$(e),f=j.attr("data-macro-default-parameter"),h=b+"/"+c+"?location="+f+"&contentId="+d,g=(AJS.$.browser&&AJS.$.browser.msie)?"_blank":"confluence-goto-link-include-macro-"+e.id,i=window.open(h,g);if(i){i.focus()}};AJS.Confluence.PropertyPanel.Macro.registerButtonHandler("goto-page",function(g,f){a(f)})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-image-attributes:soy-resources', location = 'soy/image-attributes-panel.soy' */
// This file was automatically generated from image-attributes-panel.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Editor == 'undefined') { Confluence.Templates.Editor = {}; }
if (typeof Confluence.Templates.Editor.ImageAttributes == 'undefined') { Confluence.Templates.Editor.ImageAttributes = {}; }


Confluence.Templates.Editor.ImageAttributes.content = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form class="aui" onsubmit="return false;"><div class="field-group"><label for="image-title-attribute">', soy.$$escapeHtml("Title text"), '</label><input class="text" type="text" id="image-title-attribute" name="image-title-attribute" value="', (opt_data.imgTitle) ? soy.$$escapeHtml(opt_data.imgTitle) : '', '"><div class="description">', soy.$$escapeHtml("Appears when the cursor hovers over the image"), '</div></div><div class="field-group"><label for="image-alt-attribute">', soy.$$escapeHtml("Alt text"), '</label><input class="text" type="text" id="image-alt-attribute" name="image-alt-attribute" value="', (opt_data.imgAlt) ? soy.$$escapeHtml(opt_data.imgAlt) : '', '"><div class="description">', soy.$$escapeHtml("Used by screen readers and when the image cannot be shown"), '</div></div></form>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-image-attributes:image-attributes', location = 'js/image-attributes-panel.js' */
AJS.toInit(function(f){AJS.bind("dialog-created.image-properties",function(k,l){a=f(l.img);j()});var c="image-attributes",d="image-attributes-panel",a,b,i;function j(){var k=f(Confluence.Templates.Editor.ImageAttributes.content({imgTitle:a.attr("data-element-title"),imgAlt:a.attr("alt")}));b=k.find("#image-title-attribute");i=k.find("#image-alt-attribute");e();Confluence.Editor.ImageProps.registerPanel(c,k,d,h)}function h(){var k=b.val();a.attr({"data-element-title":k,title:g(a.attr("data-location"),k),alt:i.val()})}function e(){if(b.val()===i.val()){b.bind("input.chained",function(k){i.val(b.val())});i.on("change",function(){b.unbind("input.chained")})}}function g(k,l){if(k&&k.length>0&&l&&l.length>0){return k+" ("+l+")"}if(k&&k.length>0){return k}if(l&&l.length>0){return"("+l+")"}return""}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.keyboardshortcuts:confluence-tinymce-keyboard-shortcuts', location = 'js/tinymce-plugin.js' */
(function($) {
	tinymce.create('tinymce.plugins.KeyboardShortcutsPlugin', {
        init : function(ed) {

            AJS.debug("Init Editor Keyboard shortcuts plugin");

            var buildFormatFunction = function(format) {
                return function() {
                    ed.execCommand("FormatBlock", false, format);
                };
            };
            for (var i=1; i<7; i++) {
                ed.addCommand("FormatBlock-h" + i, buildFormatFunction("h" + i));
            }
            ed.addCommand("FormatBlock-p", buildFormatFunction("p"));
            ed.addCommand("FormatBlock-pre", buildFormatFunction("pre"));
            ed.addCommand("FormatBlock-blockquote", buildFormatFunction("blockquote"));

            ed.addCommand("mceConfShortcutDialog", Confluence.KeyboardShortcuts.openDialog);
            ed.addButton("help", {title : "confluence.conf_shortcuts_help_desc", cmd : "mceConfShortcutDialog"});
        },
        getInfo : function () {
            return {
                longname : "Atlassian Editor Keyboard Shortcuts Plugin",
                author : "Atlassian",
                authorurl : "http://www.atlassian.com",
                version : tinymce.majorVersion + "." + tinymce.minorVersion
            };
        }
    });

    // Register plugin
    tinymce.PluginManager.add("keyboardshortcuts", tinymce.plugins.KeyboardShortcutsPlugin);
})(AJS.$);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-create-content-plugin:editor-resources', location = 'com/atlassian/confluence/plugins/createcontent/js/move-hidden-fields-hack.js' */
AJS.toInit(function(a){a("fieldset.create-content-template-fields > input").appendTo("form.editor")});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-create-content-plugin:create-from-template-macro-browser-resources', location = 'com/atlassian/confluence/plugins/createcontent/js/create-from-template-macro-fields.js' */
AJS.toInit(function(f){function b(h,i){h=h||AJS.Meta.get("space-key");Confluence.Blueprint.Dialog.requestWebItems(h,false).done(function(j){var k=Confluence.Blueprint.Dialog.loadedWebitems[h];if(_.isEmpty(k)){AJS.log("create-from-template-macro-fields: No Create dialog web items found for spaceKey >"+h+"<");return}i(j,k)}).fail(function(){AJS.log("create-from-template-macro-fields: requestWebItems call for spaceKey >"+h+"< failed")})}function c(h,i){b(i,function(k,l){var j=h.val();h.empty();_.each(l,function(m){var o=m.itemModuleCompleteKey;if((o=="com.atlassian.confluence.plugins.confluence-create-content-plugin:create-blank-page"||o=="com.atlassian.confluence.plugins.confluence-create-content-plugin:create-blog-post")){return}if(!(m.templateId||m.contentBlueprintId)){return}var n=f("<option></option>").text(m.name);n.attr("data-template-id",m.templateId);n.attr("data-blueprint-module-complete-key",m.blueprintModuleCompleteKey);n.attr("data-content-blueprint-id",m.contentBlueprintId);n.attr("data-create-result",m.createResult);n.val(m.templateId||m.contentBlueprintId);h.append(n)});h.val(j)})}var g={fields:{spacekey:{spaceKey:function e(k){var j=AJS.MacroBrowser.ParameterFields.spacekey(k),h=j.input.val();var i=function(){var l=j.input.val();if(l!=h){c(AJS.MacroBrowser.fields.templateName.input,l)}h=l};j.input.bind("selected.autocomplete-content",i);j.input.blur(i);return j}}},beforeParamsSet:function a(i,h){i.buttonLabel=i.buttonLabel||i.createButtonLabel||"Create from template";c(f("#macro-param-templateName"),i.spaceKey);return i},beforeParamsRetrieved:function d(j,k,h){var i=AJS.MacroBrowser.fields.templateName.input.find("option:selected");j.blueprintModuleCompleteKey=i.data("blueprint-module-complete-key");j.contentBlueprintId=i.data("content-blueprint-id");j.templateId=i.data("template-id");j.createResult=i.data("create-result");return j}};AJS.MacroBrowser.setMacroJsOverride("create-from-template",g)});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.resources:jira-controls', location = '/includes/js/ajs/class/class.js' */
(function(){var b=function(e){var d=function(){};d.prototype=e;return new d()};var a=false,c=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(){var k;var h=this.prototype;if(arguments.length>1){var j=AJS.$.makeArray(arguments);k=j.pop();var i;AJS.$.each(j,function(m,l){if(i){i=i.extend(l)}else{i=l}});return i.extend(this.prototype).extend(k)}else{k=arguments[0]}a=true;var g=new this();a=false;for(var f in k){if(g[f]=typeof k[f]=="function"&&typeof h[f]=="function"&&c.test(k[f])){g[f]=(function(l,m){return function(){var o=this._super;this._super=h[l];var n=m.apply(this,arguments);this._super=o;return n}})(f,k[f])}else{if(typeof h[f]==="object"){var e=b(k[f]);AJS.$.each(h[f],function(m,n){if(!e[m]){e[m]=n}else{if(typeof e[m]==="object"){var l=b(e[m]);AJS.$.each(n,function(p,o){if(!l[p]){l[p]=o}});e[m]=l}}});g[f]=e}else{g[f]=k[f]}}}function d(){if(!a&&this.init){this.init.apply(this,arguments)}}d.prototype=g;d.constructor=d;d.extend=arguments.callee;return d}})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.resources:jira-controls', location = '/includes/js/ajs/control/control.js' */
AJS.jiraTrigger=function(a,b){a=new jQuery.Event(a);jQuery(b||window.top.document).trigger(a);return !a.isDefaultPrevented()};AJS.Control=Class.extend({INVALID:"INVALID",_throwReadOnlyError:function(a){new Error(this.CLASS_SIGNATURE+": Sorry ["+a+"] is a read-only property")},_assignEvents:function(c,a){this._unassignEvents(c,a);if(typeof a==="string"){for(var b in this._events[c]){AJS.$(document).delegate(a,b,this._getDispatcher(c,b))}}else{a=jQuery(a);for(b in this._events[c]){a.bind(b,this._getDispatcher(c,b));AJS.debug("AJS.Control bound eventType '"+b+"' for group '"+c+"' on target '"+(a[0].type||a[0])+"'")}}},_unassignEvents:function(h,a){if(typeof a==="string"){for(var e in this._events[h]){AJS.$(document).undelegate(a,e,this._getDispatcher(h,e))}}else{a=jQuery(a);try{for(e in this._events[h]){a.unbind(e,this._getDispatcher(h,e))}}catch(g){var d=a.data("events");if(d){for(e in d){if(e in this._events[h]){var f=this._getDispatcher(h,e);var b=d[e];for(var c=0;c<b.length;c++){if(b[c]===f){b.splice(c,1);break}}AJS.debug("AJS.Control unbound eventType '"+e+"' for group '"+h+"' on target '"+(a[0].type||a[0])+"'")}}}}}},_getDispatcher:function(e,b){var d=e+"/"+b;if(!this._dispatchers){this._dispatchers={}}if(!this._dispatchers[d]){var c=this._events[e][b];var a=this;this._dispatchers[d]=function(f){AJS.debug("AJS.Control dispatching eventType '"+b+"' for group '"+e+"' on instance '"+a.type+"'");return c.call(a,f,AJS.$(this))}}return this._dispatchers[d]},_isValidInput:function(){return true},_handleKeyEvent:function(f){var b=this;if(b._isValidInput(f)){var c=AJS.Keyboard.SpecialKey,a=AJS.Keyboard.shortcutEntered(f);if(a){if(b.keys[a]){b.keys[a].call(b,f);return}else{if((a===c.BACKSPACE||a===c.DELETE)&&b.keys.onEdit){b.keys.onEdit.call(b,f);return}}}var d=AJS.Keyboard.characterEntered(f);if(d&&b.keys.onEdit){b.keys.onEdit.call(b,f,d)}}},getCustomEventName:function(a){return(this.CLASS_SIGNATURE||"")+"_"+a},_getCustomEventArgs:function(){return[this]},trigger:function(a){return AJS.jiraTrigger(a,this)},_supportsBoxShadow:function(){var a=document.body.style;return a.WebkitBoxShadow!==undefined||a.MozBoxShadow!==undefined||a.boxShadow!==undefined},_setOptions:function(a){var b,c;a=a||{};if(a instanceof AJS.$||typeof a==="string"||(typeof a==="object"&&a.nodeName)){a={element:a}}b=AJS.$(a.element);c=b.getOptionsFromAttributes();this.options=AJS.$.extend(true,this._getDefaultOptions(a),c,a);if(b.length===0){return this.INVALID}return undefined},getCaret:function(a){var c=a.selectionStart;if(c>=0){return(a.selectionEnd>c)?-1:c}if(document.selection){var d=document.selection.createRange();if(d.text.length===0){var b=d.duplicate();b.moveToElementText(a);b.setEndPoint("EndToStart",d);return b.text.length}}return -1},_render:function(){var c,b=arguments[0],a=[];for(c=1;c<arguments.length;c++){a.push(arguments[c])}return this._renders[b].apply(this,a)}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.resources:jira-controls', location = '/includes/js/ajs/input/keyboard.js' */
AJS.Keyboard={};(function(e){var f={},i={},d={};var g=AJS.Keyboard.SpecialKey={BACKSPACE:h("backspace",8,true),TAB:h("tab",9,true),RETURN:h("return",13,true),SHIFT:h("shift",16),CTRL:h("ctrl",17),ALT:h("alt",18),PAUSE:h("pause",19),CAPS_LOCK:h("capslock",20),ESC:h("esc",27,true),SPACE:h("space",32,true),PAGE_UP:h("pageup",33),PAGE_DOWN:h("pagedown",34),END:h("end",35),HOME:h("home",36),LEFT:h("left",37),UP:h("up",38),RIGHT:h("right",39),DOWN:h("down",40),INSERT:h("insert",45),DELETE:h("del",46),F1:h("f1",112),F2:h("f2",113),F3:h("f3",114),F4:h("f4",115),F5:h("f5",116),F6:h("f6",117),F7:h("f7",118),F8:h("f8",119),F9:h("f9",120),F10:h("f10",121),F11:h("f11",122),F12:h("f12",123),NUMLOCK:h("numlock",144),SCROLL:h("scroll",145),META:h("meta",224)};function h(l,m,k){f[m]=l;i[l]=m;if(k){d[m]=true}return l}g.eventType=function(){return e.browser.mozilla?"keypress":"keydown"};g.fromKeyCode=function(k){return f[k]};g.toKeyCode=function(k){return i[k]};g.isAscii=function(k){return !!d[k]};g.isSpecialKey=function(k){return !!g.toKeyCode(k)};function a(k){return k.originalEvent||k}AJS.Keyboard.characterEntered=function(k){var m=a(k);if(m.type==="keypress"){var l=c(m);if(l!==null&&(!g.isAscii(l)||g.fromKeyCode(l)===g.SPACE)){return String.fromCharCode(l)}}return undefined};function c(k){var l=a(k);if(l.which==null){return l.keyCode}else{if(l.which!=0&&l.charCode!=0){return l.which}else{return null}}}AJS.Keyboard.specialKeyEntered=function(l){l=a(l);if(e.browser.mozilla){if(l.type==="keypress"){var k=c(l);if(k===null){return g.fromKeyCode(l.keyCode)}else{if(g.isAscii(k)){return g.fromKeyCode(k)}}}}else{if(l.type!=="keypress"){return g.fromKeyCode(l.keyCode)}}return undefined};function j(m){m=a(m);var l=AJS.Keyboard.specialKeyEntered(m);if(l){return l}else{if(e.browser.mozilla){if(m.type==="keypress"){var k=c(m);if(k!==null){return String.fromCharCode(k).toLowerCase()}}}else{if(m.type!=="keypress"){return String.fromCharCode(m.keyCode).toLowerCase()}}}return undefined}AJS.Keyboard.shortcutEntered=function(n){n=a(n);if(n.type===AJS.Keyboard.SpecialKey.eventType()){var m=AJS.Keyboard.specialKeyEntered(n),k="";if(n.altKey&&m!==g.ALT){k+=b(g.ALT)}if(n.ctrlKey&&m!==g.CTRL){k+=b(g.CTRL)}if(n.metaKey&&!n.ctrlKey&&m!==g.META){k+=b(g.META)}if(n.shiftKey&&m!==g.SHIFT){k+=b(g.SHIFT)}if(m){return k+m}else{if(k.length>0&&k!=="shift+"){var l=j(n);if(l){return k+l}}}}return undefined};function b(k){return k+"+"}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.resources:jira-controls', location = '/includes/js/ajs/input/mouse.js' */
(function(b){AJS.Mouse={};var a=AJS.Mouse.MotionDetector=function(){this.reset()};a.prototype.reset=function(){this._handler=null;this._x=null;this._y=null;this.moved=false};a.prototype.wait=function(d){var c=this;if(!c._handler){this.reset();b(window.top.document).bind("mousemove",c._handler=function(f){if(!c._x&&!c._y){c._x=f.pageX;c._y=f.pageY}else{if(!(f.pageX===c._x&&f.pageY===c._y)){c.unbind();c.moved=true;if(d){d.call(this,f)}}}})}};a.prototype.unbind=function(){if(this._handler){b(window.top.document).unbind("mousemove",this._handler);this.reset()}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.resources:jira-controls', location = '/includes/js/ajs/group/group.js' */
AJS.Group=AJS.Control.extend({init:function(){this.type=this.type||"Group";this.items=[];this.index=-1;this._assignEvents("instance",this)},addItem:function(a){this.items.push(a);this._assignEvents("item",a)},removeItem:function(b){var a=AJS.$.inArray(b,this.items);if(a<0){throw new Error("AJS.Group: item ["+b+"] is not a member of this group")}b.trigger("blur");if(a<this.index){this.index--}this.items.splice(a,1);this._unassignEvents("item",b)},removeAllItems:function(){for(var a=0;a<this.items.length;a++){this._unassignEvents("item",this.items[a]);this.items[a].trigger("blur")}this.index=-1;this.items.length=0;this._unassignEvents("keys",document)},shiftFocus:function(b){AJS.debug("Group.shiftFocus called with offset: "+b);if(this.index===-1&&b===1){b=0}if(this.items.length>0){var a=(Math.max(0,this.index)+this.items.length+b)%this.items.length;this.items[a].trigger("focus")}},prepareForInput:function(){this._assignEvents("keys",document)},_events:{instance:{focus:function(){if(this.items.length===0){return}if(this.index<0){this.items[0].trigger("focus")}else{this._assignEvents("keys",document)}},blur:function(){if(this.index>=0){this.items[this.index].trigger("blur")}else{this._unassignEvents("keys",document)}}},keys:{"keydown keypress":function(a){this._handleKeyEvent(a)}},item:{focus:function(b){var a=this.index;this.index=AJS.$.inArray(b.target,this.items);if(a<0){this.trigger("focus")}else{if(a!==this.index){this.items[a].trigger("blur")}}},blur:function(a){if(this.index===AJS.$.inArray(a.target,this.items)){this.index=-1;this.trigger("blur")}},remove:function(a){this.removeItem(a.target)}}},keys:{}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.resources:jira-controls', location = '/includes/js/components/select-grid.js' */
(function(c){AJS.SelectGrid=AJS.Group.extend({init:function(e){this.type=this.type||"SelectGrid";this._super();var f=c(Confluence.Templates.SelectGrid.gridOutline());var g=f.find("thead tr");c(e.columns).each(function(h,j){var k=AJS("th").addClass(j.getClassName()).text(j.heading);g.append(k)});this.gridContainer=c(e.gridContainer).append(f);this.getRowId=e.getRowId;this.table=f;this.columns=e.columns;this.selectionCallback=e.selectionCallback;this.body=f.find("tbody");this.body.delegate("a","click",function(h){h.preventDefault()});this.dontShiftFocus=e.dontShiftFocus||function(){}},keys:{up:function(f){if(!this.table.is(":visible")||this.dontShiftFocus()){return}this.shiftFocus(-1);f.preventDefault()},down:function(f){if(!this.table.is(":visible")||this.dontShiftFocus()){return}this.shiftFocus(1);f.preventDefault()}},_addRow:function(h,g,e,i){if(c.isFunction(e)){i=e;e=false}e?this.body.prepend(h):this.body.append(h);var f=new b({row:h,data:g,callback:i,getRowId:this.getRowId,selectionCallback:i});this.addItem(f);return f},clear:function(){this.removeAllItems();this.body.children().remove()},_addRows:function(g,e){var f=this;var h=[];c(g).each(function(j,k){var l=a(k,f.columns);l.attr("data-id",f.getRowId(k));h.push(f._addRow(l,k,e,f.selectionCallback))});return h},update:function(e){this.clear();if(!e||!e.length){AJS.debug("SelectGrid.update called with no data, returning.");return}this._addRows(e);this.prepareForInput()},prependAndSelect:function(f,e){if(!f||!f.length){AJS.debug("SelectGrid.prependAndSelect called with no data, returning.");return}var g=this._addRows(f,true);g[e||0].selectRow()},findItem:function(g){for(var e=0;e<this.items.length;e++){var f=this.items[e].getRowId();if(f==g){return this.items[e]}}AJS.debug("SelectGrid.findItem didn't find item, returning null.");return null},select:function(f){var e=this.findItem(f);e&&e.selectRow()},selectIndex:function(e){e=e||0;if(this.items[e]){this.items[e].selectRow()}else{AJS.debug("SelectGrid.selectIndex couldn't select row with index "+e+", not found")}},show:function(){this.gridContainer.removeClass("hidden")},hide:function(){this.gridContainer.addClass("hidden")},isVisible:function(){return !this.gridContainer.hasClass("hidden")}});var b=AJS.Control.extend({init:function(e){this.type="SelectableRow";this.$row=AJS.$(e.row);this.$row.data("properties",e.data);this.getRowId=function(){return e.getRowId(e.data)};this.selectionCallback=e.selectionCallback;this._assignEvents("element",this.$row);this._assignEvents("instance",this);AJS.debug("SelectableRow initialized")},_events:{instance:{focus:function(f){var g=this.$row;g.addClass("selected");this.selectionCallback(g,g.data("properties"))},blur:function(f){this.$row.removeClass("selected")}},element:{click:function(){this.trigger("focus")}}},selectRow:function(){this.trigger("focus")}});var d=function(f,e){return{outerClass:e.getClassName(f)||"",href:e.getHref&&e.getHref(f)||"",innerClass:e.getInnerClass&&e.getInnerClass(f)||"",title:e.getTitle&&e.getTitle(f)||"",text:e.getText(f)||""}};var a=function(i,h){var j,g,f,e;j=AJS("tr");c(h).each(function(k,l){g=d(i,l);f=g.href?"cellWithLink":"cellWithoutLink";e=Confluence.Templates.SelectGrid[f](g);j.append(e)});return j};AJS.SelectGrid.Column=function(g){var e=function(){return g.className||(g.key+"-field")},f=function(h){return h[g.key]};return{key:g.key,heading:g.heading,getClassName:g.getClassName||e,getHref:g.getHref,getInnerClass:g.getInnerClass,getTitle:g.getTitle,getText:g.getText||f}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.resources:jira-controls', location = '/includes/js/components/select-grid.soy' */
// This file was automatically generated from select-grid.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.SelectGrid == 'undefined') { Confluence.Templates.SelectGrid = {}; }


Confluence.Templates.SelectGrid.gridOutline = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<table class="select-grid aui"><thead><tr class="data-table-header"></tr></thead><tbody></tbody></table>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.SelectGrid.cellWithLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<td class="', soy.$$escapeHtml(opt_data.outerClass), '"><a class="', soy.$$escapeHtml(opt_data.innerClass), '" href="', soy.$$escapeHtml(opt_data.href), '" title="', soy.$$escapeHtml(opt_data.title), '"><span>', soy.$$escapeHtml(opt_data.text), '</span></a></td>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.SelectGrid.cellWithoutLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<td class="', soy.$$escapeHtml(opt_data.outerClass), '"><span class="', soy.$$escapeHtml(opt_data.innerClass), '" title="', soy.$$escapeHtml(opt_data.title), '">', soy.$$escapeHtml(opt_data.text), '</span></td>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.resources:jira-controls', location = '/includes/js/components/result-grid.js' */
(function(a){AJS.ResultGrid=AJS.Control.extend({init:function(k){this.type=this.type||"ResultGrid";var b,d,g,i,j,f,e;d=k.gridContainer||a(k.baseElement).find(".data-table");if(!d.length){AJS.debug("gridContainer for AJS.ResultGrid not found!")}g=function(l){return l.id};b=new AJS.SelectGrid({gridContainer:d,columns:k.columns,selectionCallback:k.selectionCallback,getRowId:k.getRowId||g,dontShiftFocus:k.dontShiftFocus});f=k.messageHandler||AJS.MessageHandler({baseElement:a(k.baseElement).find(".message-panel")});function c(o,m){if(i){return}var n,p,q,l;l=60;q=13;n=o/2-(l+q);p=m/2-(l+q);o=o-n;m=m-p;j=AJS("div").addClass("spinner-container").width(o).height(m).css({"padding-left":n,"padding-top":p}).insertAfter(d);i=Raphael.spinner(j[0],l,"#666")}function h(){if(i){i();j.remove();i=null}}e=k.noResultMessage||"\u65E0\u7ED3\u679C\u3002";a.extend(this,{update:function(m,l){f.clearMessages();h();b.clear();if(!m||!m.length){b.hide();var n=a.isFunction(e)?e(l):e;f.displayMessages(n);return false}b.update(m);b.show();return true},updateAndSelect:function(n,m,l){if(this.update(n,m)){this.selectIndex(l)}},prependAndSelect:function(m,l){if(!m||!m.length){AJS.debug("ResultGrid.prependAndSelect called with no data, returning.");return}f.clearMessages();b.prependAndSelect(m,l);b.show()},select:function(l){b.select(l)},selectIndex:function(l){b.selectIndex(l)},clear:function(){f.clearMessages();b.hide()},loading:function(){b.show();var m=d.width();var l=d.height();this.clear();c(m,l)},isVisible:function(){return b.isVisible()}})}})})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-link-browser:link-browser-resources', location = 'js/link-object.js' */
(function ($) {
/**
 * The Link object contains all of Confluence's business logic about a front-end Link.
 *
 * It should not interact with the RTE directly but rather use the LinkAdapter singleton.
 */
Confluence.Link = {

    // Until this code gets refactored to use proper prototyping just do a duck-type check
    // instead of a constructor check.
    isLink: function (obj) {
        return obj && !!obj.fillNode;
    }
};

var newLink = function (props) {

    // If the object passed in is already a Link just return it.
    if (Confluence.Link.isLink(props)) {
        return props;
    }

    var link = {

        /**
         * Inserts this link into the RTE
         */
        insert: function () {
            Confluence.Editor.LinkAdapter.setLink(link);
        },

        /**
         * Fills the passed DOM node with the contents of this Link object.
         * @param $link the jQuery-wrapped node to fill with the link data
         */
        fillNode: function ($link) {
            var attrs = this.attrs;
            attrs.href = attrs.href || '#';
            $link.attr(attrs);

            if (this.classes && this.classes.length) {
                $link.addClass(this.classes.join(" "));
            }

            $link.html(this.body.html);
            return $link;
        },

        /**
         * Returns a representation of this link as data only - no functions.
         */
        getData: function () {
            var props = {}, key;

            for (key in this) {
                if (this.hasOwnProperty(key) && !$.isFunction(this[key]))
                    props[key] = this[key];
            }
            return props;
        },

        /**
         * If the body for this link is a lone image, return it.
         */
        getLinkedImage: function () {
            if (this.body && this.body.jquery) {
                return this.body.length == 1 && this.body.is('img') && this.body;
            }
            return null;
        },

        getResourceId: function () {
            return this.attrs["data-linked-resource-id"] || "";
        },

        /**
         * Returns true if this link points to Confluence content like a Page, Attachment, Space, et al.
         */
        isToConfluenceEntity: function () {
            return this.attrs["data-linked-resource-id"];
        },

        isToAttachmentOnSamePage: function (contentId) {
            return this.attrs["data-linked-resource-type"] == 'attachment' && this.attrs["data-linked-resource-container-id"] == contentId;
        },

        /**
         * A standard link will be stored as an a tag whereas a custom 'atlassian-content' link will be stored as an ac:link
         * tag. This method lets you differentiate between them in the browser.
         *
         * When used in conjunction with isToConfluenceEntity this can identify a relative link (link to the current page).
         *
         * @return true if the link is an atlassian-content (custom XHTML namespace) link (as opposed to an HTML link)
         */
        isCustomAtlassianContentLink: function() {
            if (this.classes && this.classes.length) {
                return $.inArray("confluence-link", this.classes) != -1;
            } else {
                return false;
            }
        },

        /**
         * @return true if the link has the correct anchor attribute
         */
        hasAnchor: function() {
            return this.attrs["data-anchor"];
        },

        getResourceType: function () {
            return this.attrs["data-linked-resource-type"];
        },

        getDefaultAlias: function () {
            return this.attrs["data-linked-resource-default-alias"];
        },

        getHref: function () {
            return this.attrs.href;
        },

        getAnchor: function () {
            return this.attrs["data-anchor"];
        },

        getHtml: function () {
            return this.body.html;
        },

        getShortcut: function() {
            return this.attrs["data-linked-resource-shortcut"];
        },

        isHrefValid: function () {
            return this.attrs.href && this.attrs.href != 'http://';
        },

        isImage: function () {
            return this.body.isImage;
        },

        isNewLink: function () {
            return $.isEmptyObject(this.attrs);    // a link with no attributes has no destination ==> new
        },

        isShortcutLink: function() {
            return this.getResourceType() === "shortcut";
        },

        showsBreadcrumbs: function () {
            return true;
        }
    };

    // if the attrs in the property contain class values extract them
    if (props && props.attrs) {
        var attrsOnly = {};
        var classAttrValue = null;

        $.each(props.attrs, function(key, value) {
           if (key == "class") {
               classAttrValue = value;
           } else {
               attrsOnly[key] = value;
           }
        });

        props.attrs = attrsOnly;
        if (classAttrValue) {
            var classAttrArray = classAttrValue.split(" ");

            if (props.classes && props.classes.length) {
                props.classes = props.classes.concat(classAttrArray);
            } else {
                props.classes = classAttrArray;
            }
        }
    }

    $.extend(link, props);

    return link;
};

/**
 * Returns the image node if the node is an image or if it is a linked image.
 * If no image node is found, null is returned.
 * @param node the node to inspect
 */
function getImageNode(node) {
    if ($.nodeName(node, 'img'))
        return node;

    //we are only interested in nodes that have just an image node.
    var hasOneChild = node.hasChildNodes() && node.childNodes.length == 1;
    if (hasOneChild && $.nodeName(node, "a") && $.nodeName(node.firstChild, "img"))
        return node.firstChild;

    return null;
}

/**
 * Returns the name of given image node. If the node is null, an empty string is returned.
 * @param imageNode - the image node to inspect.
 */
function getImageName(imageNode) {
    if (!imageNode)
        return "";

    return ($(imageNode).attr('data-linked-resource-default-alias') || $(imageNode).attr('src'));
}

/**
 * Returns a map of the attributes present in a link node.
  * @param node
 */
function getLinkNodeAttributes(node) {
    var attrs = {};
    if (node.nodeName == "A") {
        $(node.attributes).each(function () {
            attrs[this.name] = this.value;
        });
    }

    return attrs;
}

/**
 * Returns true if the range between two sibling nodes (have the same parent)
 * contains only text nodes.
 * @param startNode - the node to start from
 * @param endNode - the node to end with
 */
function areSiblingsTextNodes(startNode, endNode) {
    var currentNode = startNode;
    while (currentNode && currentNode != endNode) {
        if (currentNode.nodeType != 3)
            return false;

        currentNode = currentNode.nextSibling;
    }

    return endNode.nodeType == 3;
}

/**
 * This attempts to resolves the given range to account for the situation
 * where one cursor is set just inside of an element, while the other
 * is set inside the parent element.
 * If the range can be resolved such that the start and end container
 * share the same parent, the two values are returned.
 * Otherwise, null is returned.
 * @param rng
 */
function resolveRange(rng) {
    var dom = tinymce.activeEditor.dom,
        start = dom.isBlock(rng.startContainer) ? rng.startContainer.childNodes[rng.startOffset] : rng.startContainer,
    	end = dom.isBlock(rng.endContainer) ? rng.endContainer.childNodes[rng.endOffset - 1] : rng.endContainer;

    if (start && end && (start.parentNode == end.parentNode)) {
        return {
            start: start,
            end: end
        };
    } else {
        return null;
    }
}

function isSelectionContainsEditableLinkText(rng) {
    // Collapsed ranges are always editable - the link text field will be empty
    if (rng.collapsed) {
        return true;
    }

    var start = rng.startContainer,
        end = rng.endContainer;

    // If the selection is a single text node that text can be edited.
    // Anything else - including selected images - cannot be edited.
    if (start == end) {
        if (start.nodeType == 3)
            return true;

        return areSiblingsTextNodes(start.childNodes[rng.startOffset], start.childNodes[rng.endOffset - 1]);
    }

    var resolvedContainers = resolveRange(rng);
    return !!resolvedContainers && areSiblingsTextNodes(resolvedContainers.start, resolvedContainers.end);
}

Confluence.Link.fromData = function(data){
	return newLink(data);
}

/**
 * Given a link node and an alias, creates a link object with correct body and attributes.
 * @param linkNode The link node DOM object. The node is not expected to exist in the Editor.
 * @param alias The link alias.
 */
Confluence.Link.fromNode = function(linkNode, alias) {
    var link = newLink({
        attrs: {},
        body: {
            html: alias,
            text: alias
        }
    });

    return newLink({
      attrs: getLinkNodeAttributes(linkNode),
      body: {
          html: alias,
          text: alias
      }
    });
};


/**
 * Creates a link object from a provided link in the Editor.
 *
 * @param linkEl - an existing link in the editor
 * @param linkText - formatted link text
 */
Confluence.Link.fromSelectedAnchor = function (linkEl, linkText) {
    var $linkEl = $(linkEl),
        imageNode = getImageNode(linkEl),
        isEditable = !imageNode && areSiblingsTextNodes(linkEl.firstChild, linkEl.lastChild);

    return newLink({
        attrs: getLinkNodeAttributes(linkEl),
        body: {
            isEditable: isEditable,
            isImage: !!imageNode,
            html: $linkEl.html(),
            imgName: getImageName(imageNode),
            text: linkText
        }
    });
};

/**
 * Called when creating a Link from an editor selection.
 *
 * If the selection is inside an existing link use #fromSelectedAnchor
 *
 * @param rng - a w3c range object of the selection
 * @param selectedNode - the common ancestor node of the start and end containers
 * @param selectedHtml - the raw html of the selection
 * @param selectedText - formatted selection text
 */
Confluence.Link.fromSelection = function (rng, selectedNode, selectedHtml, selectedText) {
    var imageNode = getImageNode(selectedNode),
        isEditable = !imageNode && isSelectionContainsEditableLinkText(rng);

    return newLink({
        attrs: {},
        body: {
            isEditable: isEditable,
            isImage: !!imageNode,
            html: selectedHtml,
            imgName: getImageName(imageNode),
            text: selectedText
        }
    });
};

/**
 * Creates a Link object from a REST object
 * @param restObj
 */
Confluence.Link.fromREST = function (restObj) {
    var link = newLink({
        attrs: {
            "data-base-url": AJS.Confluence.getBaseUrl(),
            "data-linked-resource-id": restObj.id,
            "data-linked-resource-type": restObj.type,
            href: AJS.REST.findLink(restObj.link),
            "data-linked-resource-default-alias": restObj.title
        },
        body: {
            html: AJS.escapeHtml(restObj.title),
            text: AJS.escapeHtml(restObj.title)
        },
        classes: ["confluence-link"]
    });

    // CONDEV-5286: The problem here is that the REST response will have a type of 'user'
    // whereas the conversion to storage format requires 'userinfo'.
    if (restObj.type == "user")
        link.attrs["data-linked-resource-type"] = "userinfo";

    return link;
};

/**
 * Creates a link that points to a new page.
 */
Confluence.Link.createLinkToNewPage = function (pageTitle, spaceKey) {
    return newLink({
        attrs: {
            "data-space-key": spaceKey,
            "data-content-title": pageTitle,
            href: AJS.contextPath() + '/pages/createpage.action?spaceKey=' + spaceKey + '&title=' + pageTitle
        },
        body: {
            html: AJS.escapeEntities(pageTitle),
            text: pageTitle
        },
        classes: ["createlink", "confluence-link"]
    });
};

/**
 * Creates a link to an external webpage or email address.
 */
Confluence.Link.makeExternalLink = function (href) {
    return newLink({
        attrs: {
            href: href
        },
        body: {
            html: href,
            text: href
        }
    });
};

Confluence.Link.isExternalLink = function(destination) { //Same check as ConfluenceLinkResolver.java
    return destination && (destination.match(/^(\/\/|mailto:|file:|http:|https:)/) || destination.indexOf("\\") === 0);
};

})(AJS.$);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-link-browser:link-browser-resources', location = 'js/link-adapter.js' */
/**
 * LinkAdapter is an adapter between the RTE and a Link object.
 *
 * It should not know about the Link Browser or how the internals of a Link object work.
 * Any interaction with RTE nodes and Links should be via this object.
 */
Confluence.Editor.LinkAdapter = (function ($) {
    return {

        /**
         * Inserts a link at the position of the current range.
         * @param linkObj a Confluence.Link instance
         */
        setLink: function (linkObj) {
            var ed = AJS.Rte.getEditor(),
                newLinkNode = $(ed.dom.create("a"), ed.getDoc());

            linkObj.fillNode(newLinkNode);
            tinymce.confluence.NodeUtils.replaceSelection(newLinkNode);

            // CONFDEV-5203 - Prevent cursor loss when using arrow keys after inserting an
            // image. This is a FF-specific issue that occurs when adding or editing comments.
            if (!!$("#comments-section").length) {
                AJS.Rte.fixEditorFocus();
            }
        },

        /**
         * Constructs a javascript object containing link information.
         * Invoked when the user tries to edit an existing link or make a piece of selected content into a link.
         *
         * Returns a new or existing link based on the current Editor selection.
         */
        getLink: function() {
            var selectedHtml, selectedText, rng,
                ed = AJS.Rte.getEditor(),
                selection = ed.selection,
                selectedNode = selection.getNode(),
                linkNode = $(selectedNode).parents().andSelf().filter("a[href]")[0];

            if (linkNode) {
                selection.select(linkNode);
                selectedText = selection.getContent({format : 'text'});

                return Confluence.Link.fromSelectedAnchor(linkNode, selectedText);
            } else {
                rng = selection.getRng(true);
                selectedText = selection.getContent({format : 'text'});
                selectedHtml = selection.getContent();
                return Confluence.Link.fromSelection(rng, selectedNode, selectedHtml, selectedText);
            }
        }

    };
}(AJS.$));

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-link-browser:link-browser-resources', location = 'js/link-browser.js' */
Confluence.Editor.LinkBrowser = (function($) {

    var popup, locationPresenter, submitButton, currentTab, dialogId = "insert-link-dialog";

    // The key of the search panel, uses internally and exposed.
    var SEARCH_PANEL = 'search',
        ATTACHMENTS_PANEL = 'attachments',
        WEBLINK_PANEL = 'weblink',
        ADVANCED_PANEL = 'advanced';

    /**
     * Called when the user pressed the Insert/Edit button or presses Enter.
     */
    function submit() {
        if (submitButton.prop("disabled")) return;

        submitButton.prop('disabled', true);
        AJS.debug("link-browser.js: submit");

        // Some tabs may need to alter the location if the submit has been called before blur on some element.
        currentTab.preSubmit && currentTab.preSubmit();

        var link = locationPresenter.getLink();
        close();

        link.insert();

        // CONFDEV-10562 (AUI's remove.dialog event fires before the link has been inserted)
        AJS.trigger('closed.link-browser');
    }

    /**
     * Closes the dialog and resets state to before it was opened - called by both submit and cancel.
     */
    function close() {
        popup.hide().remove();
        AJS.Rte.BookmarkManager.restoreBookmark();
    }

    /**
     * Called when the user presses the Cancel link or presses Escape
     */
    function cancel() {
        close();
        AJS.trigger('closed.link-browser');
    }

    /**
     * Make the Link Browser dialog element, setting button text based on whether a link is being created or edited.
     */
    function makePopup(isNew) {
        var dialog, dialogTitle, submitText;

        dialog = new AJS.ConfluenceDialog({
            width: 840,
            height: 590,
            id: dialogId,
            onCancel: cancel,
            onSubmit: submit
        });

        dialogTitle = isNew ? "\u63D2\u5165\u94FE\u63A5" : "\u7F16\u8F91\u94FE\u63A5";
        submitText = isNew ? "\u63D2\u5165" : "\u4FDD\u5B58";

        dialog.addHeader(dialogTitle);

        dialog.addButton(submitText, submit);

        dialog.addCancel("\u53D6\u6D88", cancel);
        dialog.addHelpText("\u63D0\u793A\uFF1A\u5728\u5BCC\u6587\u672C\u7F16\u8F91\u5668\u4E2D\u8F93\u5165\u201C[\u201C\u67E5\u770B\u5F85\u9009\u62E9\u7684\u9875\u9762\u5217\u8868\uFF0C\u7136\u540E\u63D2\u5165\u4E00\u4E2A\u94FE\u63A5\u3002");

        // See CONFDEV-14467 - this can be removed when CONFDEV-12434 is implemented
        var $dialogTip = $('#' + dialogId + ' .dialog-tip');
        $dialogTip.attr('title', $dialogTip.text());

        // CONFDEV-12853: Add help link via prepend() instead of append() to prevent FF display issue
        $("#" + dialogId + " .dialog-components .dialog-title").prepend(Confluence.Templates.LinkBrowser.helpLink());

        submitButton = dialog.get("button:0")[0].item;
        submitButton.attr("id", 'link-browser-insert');
        submitButton.prop("disabled", true);

        return dialog;
    }

    // Creates the panel element for the tab specified by the web-item,
    // and initializes the tab-controller for it.
    function makeTab(i, tabPresenter, controller) {
        var key = tabPresenter.key,
            tabTitle = tabPresenter.label,
            className = key + "-panel",
            panel = Confluence.Templates.LinkBrowser[key + 'Panel']({atlToken: AJS.Meta.get('atl-token')});

        popup.addPanel(tabTitle, panel, className, className + '-id');

        // The Panel object instance.
        var panelObj = popup.get("panel:" + i);

        // The controller.tabs map will have been pre-populated by a 'dialog-created.link-browser' event binding.
        var tab = controller.tabs[key];
        tab.panelObj = panelObj;
        tab.key = key;
        tab.createPanel({
            baseElement: $(panelObj[0].body)
        });

        // Called automatically by the AJS.Dialog code when a panel is changed
        panelObj[0].onblur = tab.onDeselect;

        panelObj[0].onselect = function () {
            // Most tabs don't show breadcrumbs so it's opt-in by declaring a property.
            var hasBreadcrumbs = !!tab.hasBreadcrumbs;
            AJS.debug("Link Browser: on tab select, breadcrumbs enabled: " + hasBreadcrumbs);
            tab.onSelect();
            locationPresenter.refresh(hasBreadcrumbs);
            currentTab = tab;
        };

        return tab;
    }

    /**
     * Browser tabs are pluggable based on web-items with section
     * "system.editor.link.browser.tabs", sorted by item weight.
     * {@see link-browser-web-items.vm}
     */
    function getTabPresenters() {
        var supportedLinkTypes =  $("#link-browser-tab-items").find("div").map(function() {
            var item = $(this);
            return {
                key: item.text(),
                weight: item.attr("data-weight"),
                label: this.title
            }
        }).sort(function (a, b) {
                return a.weight - b.weight;
        });
        var isAttachmentSupported = AJS.Meta.get("content-type") !== "template";
        return $.grep(supportedLinkTypes, function(item, index) {
            return isAttachmentSupported || item.key !==  "attachments";
        });
    }

    /**
     * Sets up the Link Browser tabs and the tab it will be opened to, based on any existing link being edited or a
     * present panel key.
     *
     * @param controller the LB controller
     * @param presetPanelKey a panel key like 'search', 'attachments' or 'web-link'
     * @param linkObj a existing link object being edited
     */
    function setupTabs(controller, linkObj, presetPanelKey) {

        var tabPresenters = getTabPresenters();

        // Loops through each web-item tab, setting up the associated panel.
        var firstTab;
        var currentTab = null;
        for (var i = 0, ii = tabPresenters.length; i < ii; i++) {
            var tab = makeTab(i, tabPresenters[i], controller);
            if (i == 0) {
                firstTab = tab;
            }
            if (!linkObj.isNewLink() && $.isFunction(tab.handlesLink) && tab.handlesLink(linkObj)){
                currentTab = tab;
                tab.openedLink = linkObj;
            }
            else if (presetPanelKey == tab.key) {
                // User wants to open the Link Browser to a particular panel
                currentTab = tab;
            }
        }
        if (currentTab) {
            // A particular tab is selected either by user choice or editing an existing link:
            // don't let the dialog perform its default action of opening the last tab selected.
            controller.popup.overrideLastTab();
        } else {
            currentTab = firstTab;  // Select the first tab by default
        }
        return currentTab;
    }

    /**
     * Returns the Main controller object, separate to the DOM. Should be QUnit-testable.
     */
    function makeController() {
        return {

            // Contains a map of LinkTabPanel objects.
            tabs: {},

            // Called by Tabs when the link they represent is changed
            setLink: function (link, hasBreadcrumbs) {
                locationPresenter.setLink(link, hasBreadcrumbs);
            },

            getLink: function () {
                return locationPresenter.getLink();
            },

            getSelectedDataTableItem: function () {
                return $('.data-table:visible tr.selected');
            },

            // Called by Tabs when the link they represent is valid or not.
            linkValid: function (valid) {
                submitButton.prop("disabled", !valid);
            },

            // If the link text can't be focused because it isn't visible, focus the submit button instead.
            focusLinkText: function () {
                if (!locationPresenter.focusLinkText()) {
                    AJS.debug('LinkBrowser: focusing submit button');
                    submitButton.focus();
                }
            },

            getLinkText: function () {
                return locationPresenter.getLinkText();
            },

            isLinkTextVisible: function () {
                return locationPresenter.isLinkTextVisible();
            },

            hasBreadcrumbs: function (crumbTexts) {
                return locationPresenter.hasBreadcrumbs(crumbTexts);
            },

            getLocationPresenter: function () {
                return locationPresenter;
            },

            // Select the 'Search' tab and perform a search on the passed text
            doSearch: function (searchText) {
                this.tabs[SEARCH_PANEL].doSearch(searchText);
            },

            getSearchTextField: function () {
                return this.tabs[SEARCH_PANEL].getSearchTextField();
            },

            // Moves the location panel to be inside the new parent. Used for styling.
            moveLocationPanel: function (newParent) {
                locationPresenter.moveLocationPanel(newParent);
            },

            // Moves the location panel back to its normal position
            restoreLocationPanel: function () {
                locationPresenter.restoreLocationPanel();
            },

            /**
             * Selects the Link Browser tab with the given index.
             */
            gotoPanel: function (index) {
                this.popup.gotoPanel(index);
            },

            /**
             * Returns the currently-selected tab.
             */
            getCurrentPanel: function () {
                return this.popup.getCurrentPanel();
            },

            /**
             * If the web-link panel is visible, sets the URL field to be the passed value.
             */
            setWebLinkURL: function (url) {
                var webLinkTab = this.tabs[WEBLINK_PANEL];
                if (currentTab != webLinkTab) {
                    AJS.debug('Cannot set URL ' + url + ' on hidden Web Link panel');
                    return;
                }
                webLinkTab.setURL(url);
            },

            getWebLinkUrl: function () {
                var webLinkTab = this.tabs[WEBLINK_PANEL];
                if (currentTab != webLinkTab) {
                    AJS.debug('Cannot get URL ' + url + ' on hidden Web Link panel');
                    return null;
                }
                return webLinkTab.getURL();
            },

            getTitle: function () {
                return this.popup.getTitle();
            },

            getSubmitButtonText: function () {
                return submitButton.text();
            },

            isSubmitButtonEnabled: function () {
                return submitButton.is(':enabled');
            },

            isVisible: function () {
                return this.popup.isVisible();
            },

            /**
             * If the advanced panel is visible, sets the link field.
             */
            getAdvancedTextField: function () {
                var advancedTab = this.tabs[ADVANCED_PANEL];
                if (currentTab != advancedTab) {
                    AJS.debug('Cannot get link text on hidden advanced panel');
                    return null;
                }
                return advancedTab.getLink();
            },

            setAdvancedTextField: function (text) {
                var advancedTab = this.tabs[ADVANCED_PANEL];
                if (currentTab != advancedTab) {
                    AJS.debug('Cannot set link text on hidden advanced panel');
                    return;
                }
                advancedTab.setLink(text);
            },

            submit: submit,
            cancel: cancel
        };
    }

    /**
     * Main method to open the Link Browser, called from open.
     */
    function openLinkDialog(options) {

        var controller = makeController();

        var linkObj = options.linkInfo;
        popup = makePopup(linkObj.isNewLink());
        controller.popup = popup;

        // Link browser tabs aren't registered until this point - new tabs
        // need to add a binding to this event.
        AJS.trigger("dialog-created.link-browser", [controller]);

        // Create the location panel that is shared between all Dialog panels.
        locationPresenter = Confluence.Editor.LinkBrowser.LinkInfoPresenter(controller);
        locationPresenter.setLinkBody(linkObj.body);

        currentTab = setupTabs(controller, linkObj, options.panelKey);

        popup.popup.element.find('.dialog-page-body:first').append(locationPresenter.getContainer());

        currentTab.panelObj.select();
        currentTab.openedLink = null;   // this ref shouldn't be used after the first tab is selected, so kill it

        popup.show();
        //controller the right thing to send?
        AJS.trigger("dialog-shown.link-browser", popup);
        return controller;
    }

    return {
        // These ids let RTE menu and autocomplete items open the Link Browser to a particular panel.
        SEARCH_PANEL: SEARCH_PANEL,
        ATTACHMENTS_PANEL: ATTACHMENTS_PANEL,
        WEBLINK_PANEL: WEBLINK_PANEL,
        ADVANCED_PANEL: ADVANCED_PANEL,

        /**
         * If the options include an "opener" function, that is used to launch the dialog; otherwise a LinkInfo object is
         * created for the current Editor and the default launcher called.
         *
         * @param options : panelKey - (optional) a panel of the Link Browser to open to
         *                  opener - (optional) a function used to launch the Link Browser
         */
        open: function (options) {
            // Prevent it from opening if another popup dialog is open
            if ($('.aui-dialog:visible').length) return null;

            options = options || {};

            // Store the current selection and scroll position, and get the selected text.
            AJS.Rte.BookmarkManager.storeBookmark();

            options.linkInfo = options.linkInfo || Confluence.Editor.LinkAdapter.getLink();

            if (options.opener)
                // Any supplied opener function must include required state in its scope.
                return options.opener(options.linkInfo.alias, options.linkInfo);

            return openLinkDialog(options);
        },

        cancel: cancel
    };
})(jQuery);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-link-browser:link-browser-resources', location = 'js/link-browser-location.js' */
/**
 * Represents the destination panel containing the Link location (internal or external) and the link Alias.
 */
(function($) {
Confluence.Editor.LinkBrowser.LinkInfoPresenter = function (lbController) {

    var container,              // the top-level container holding the location elements
        breadcrumbsEl,          // the element containing any Breadcrumbs
        breadcrumbController,   // the controller for updating and rendering Breadcrumbs
        currentLink,            // the link object currently selected or entered
        defaultAliasClass,      // class that indicates the default alias has been used
        linkTextField,
        linkTextRow,
        linkImageRow,
        linkMixedRow,
        linkMixedContent,
        linkImageName,
        finalBody,              // the body of the link when an image or range is selected - it cannot be changed
        movedPanel,             // when panels are moved, stores the panel that was moved
        movedPanelParent;       // when panels are moved, stores the location the panel should be restored to

    container = $(Confluence.Templates.LinkBrowser.locationPanel());
    breadcrumbsEl = container.find('#breadcrumbs-container');
    breadcrumbController = AJS.MoveDialog.Breadcrumbs(breadcrumbsEl, AJS.Breadcrumbs.getBreadcrumbs);
    defaultAliasClass = "default-alias";
    linkImageRow = container.find('.link-image');
    linkMixedRow = container.find('.link-mixed');
    linkImageName = container.find('#link-image-filename');
    linkMixedContent = container.find('#link-mixed-content');
    linkTextRow = container.find('.link-text');
    linkTextField = linkTextRow.find('input');

    // If the user types in the link text field, we remove the default alias class to indicate this.
    linkTextField.change(function(e) {
        e.keyCode = e.keyCode || e.which;
        if (e.keyCode && e.keyCode != 13)
            linkTextField.removeClass(defaultAliasClass);
    });

    /**
     * Returns the text in the link text field.
     */
    function getLinkText() {
        return AJS.escapeHtml(getRawLinkText());
    }

    function getRawLinkText() {
        return linkTextField.val();
    }

    /**
     * Sets the link text in the link text field only if the field is empty
     * or has the default alias class (signifying that the text currently in the field
     * was generated from the link details and is not user-specified).
     * @param text The text to display in the link text field
     */
    function setLinkText(text) {
        if ((getLinkText() == "") || linkTextField.hasClass(defaultAliasClass)) {
            linkTextField.addClass(defaultAliasClass);
            linkTextField.val(text);
        }
    }

    /**
     * Sets the link text from a link object. Uses the data-linked-resource-default-alias if
     * available, otherwise defaults to the body html.
     */
    function setLinkTextFromLink(linkObj) {
        var alias = linkObj.attrs["data-linked-resource-default-alias"] || linkObj.getHtml();
        setLinkText(alias);
    }

    /**
     * Returns the name of the image being linked.
     */
    function getLinkImageName() {
        return linkImageName.text();
    }

    /**
     * Updates the link body fields to reflect current link body information. Sets and toggles
     * the link text, link image or link mixed content as appropriate.
     *
     * @param body - a body object
     */
    function setLinkBody(body) {
        // Don't modify the link body if the original selection should persist.
        if (finalBody) return;

        if (body.isEditable) {
            linkTextField.val(body.text);
        }
        else if (body.isImage) {
            linkImageName.text(body.imgName);
        }
        else {
            linkMixedContent.text(body.text);
        }

        finalBody = body.isEditable ? null : body;

        linkTextRow.toggleClass('hidden',  !body.isEditable);
        linkImageRow.toggleClass('hidden', !body.isImage);
        linkMixedRow.toggleClass('hidden', body.isEditable || body.isImage);
    }

    /**
     * If true, show the Breadcrumbs element, else hide it. After the element is shown/hidden, resize the location
     * container by setting a CSS class.
     *
     * @param show true if breadcrumbs should be displayed
     */
    function showBreadcrumbsElement(show) {
        breadcrumbsEl.closest('.row').toggleClass('hidden', !show);
        container.toggleClass('has-breadcrumbs', !!show);       // must pass a boolean to toggleClass to force!
    }

    function hasBreadcrumbs(crumbTexts) {
        if (!breadcrumbsEl.is(':visible')) {
            return false;
        }

        var numCrumbs = crumbTexts.length;
        var crumbItems = breadcrumbsEl.find('li');
        if (crumbItems.length != numCrumbs) {
            return false;
        }

        for (var i = 0; i < numCrumbs; i++) {
            if (crumbItems.eq(i).text() != crumbTexts[i]) {
                return false;
            }
        }

        return true;
    }

    /**
     * Updates the breadcrumbs for the passed Link object, retrieving breadcrumb data from the back end and display
     * it.
     */
    function updateBreadcrumbs(linkObj) {
        var controls = {
            clearErrors: function () {
                // do nothing - errors will appear in the breadcrumbs element
            },
            error: function (errMsg) {
                // do nothing - errors will appear in the breadcrumbs element
            },

            // called when a destination is selected on one of the panels
            select: function (options) {
                breadcrumbController.update(options, controls);
            }
        };

        var options = {
            id: linkObj.getResourceId(),
            type: linkObj.getResourceType()
        };
        breadcrumbController.update(options, controls);
    }

    /**
     * Updates the link destination in the Location panel of the Link Browser.
     *
     * @param linkObj a linkable ContentEntity with an id and title, or some other object with an href property
     * @param showBreadcrumbs
     */
    function setLink(linkObj, showBreadcrumbs) {
        AJS.debug("Link Browser: setting link : " + linkObj);

        setLinkTextFromLink(linkObj);

        //id and type is required for update Breadcrumbs so we also check if they have value
        showBreadcrumbs && linkObj.getResourceId() && linkObj.getResourceType() && updateBreadcrumbs(linkObj);
        // Show/hide breadcrumbs element immediately (before any potential AJAX requests). This allows the breadcrumb
        // controller to show loading messages.
        showBreadcrumbsElement(showBreadcrumbs);

        currentLink = linkObj;
        lbController.linkValid(currentLink && currentLink.isHrefValid());
    }

    /**
     * Returns the link object currently stored in the panel.
     */
    function getLink() {
        if (!currentLink) return null;

        var body = finalBody;
        if (!body) {
            // Not an image/mixed content link. Perhaps there is alias text entered in the field?
            var linkText = getLinkText();
            if (!linkText) {
                // If there is no link text, use a defaultAlias in the case of internal Confluence
                // links, or the href for an external link.
                linkText = currentLink.getDefaultAlias() || currentLink.getHref();
            }
            body = {
                html: linkText
            }
        }
        currentLink.body = body;

        return currentLink;
    }

    /**
     * Puts the cursor in the 'Link Text' field, selecting the current text. Returns true on success, else false.
     */
    function focusLinkText() {
        if (isLinkTextVisible()) {
            AJS.debug('LinkInfoPresenter.focusLinkText focusing alias');
            linkTextField.select();
            return true;
        }
        return false;
    }

    function isLinkTextVisible() {
        return linkTextField.is(':visible');
    }

    function isLinkImageVisible() {
        return linkImageName.is(':visible');
    }

    function isLinkMixedContentVisible() {
        return linkMixedContent.is(':visible');
    }

    /**
     * Called when the Link Browser tab is changed, has the location panel refresh itself based on required size
     * and whether breadcrumbs should be shown.
     */
    function refresh(tabShowsBreadcrumbs) {
        currentLink && showBreadcrumbsElement(tabShowsBreadcrumbs);
    }

    /**
     * Returns the container with the Location elements.
     */
    function getContainer() {
        return container;
    }

    /**
     * Moves the location panel to be the last element inside the new parent. Used for styling.
     * @param newParent
     */
    function moveLocationPanel(newParent) {
        if (!movedPanel) {
            movedPanel = container.find('.row:not(.hidden) .field-group');
            movedPanelParent = movedPanel.parent();
        }
        newParent.append(movedPanel);
        container.hide();
    }

    /**
     * Moves the location panel back to its normal position
     */
    function restoreLocationPanel() {
        if (!movedPanelParent) {
            // Due to AJS.Dialog selection weirdness, the Web Link may be deselected when the Search panel is
            // selected *before* the Link Browser opens. Just ignore it, it doesn't matter.
            return;
        }
        // Put the location panel back where it was.
        movedPanelParent.append(movedPanel);
        container.show();

        movedPanel = null;
        movedPanelParent = null;
    }

    return {
        setLink: setLink,
        getLink: getLink,
        refresh: refresh,
        setLinkBody: setLinkBody,
        getContainer: getContainer,
        isLinkTextVisible: isLinkTextVisible,
        isLinkImageVisible: isLinkImageVisible,
        isLinkMixedContentVisible: isLinkMixedContentVisible,
        focusLinkText: focusLinkText,
        getLinkText: getLinkText,
        getRawLinkText: getRawLinkText,
        getLinkImageName: getLinkImageName,
        moveLocationPanel: moveLocationPanel,
        restoreLocationPanel: restoreLocationPanel,
        hasBreadcrumbs: hasBreadcrumbs
    };
};
})(jQuery);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-link-browser:link-browser-resources', location = 'js/link-browser-tab-search.js' */
// :focus selector is added in jQuery 1.6
if (typeof jQuery.expr[':'].focus === 'undefined') {
    jQuery.expr[':'].focus = function ( elem ) {
        return elem === document.activeElement && ( elem.type || elem.href );
    };
}

(function($) {
// The Search tab registers itself when the Link Browser is created.
AJS.bind("dialog-created.link-browser", function (e, linkBrowser) {

    var searchTextField,
        searchSpaceField,
        resultGrid,
        messageHandler,
        key = 'search',
        restSearchUrl = AJS.REST.getBaseUrl() + "search.json";

    var setLink = function (linkObj, updateSearchField) {
        if (!Confluence.Link.isLink(linkObj)) {
            linkObj = Confluence.Link.fromREST(linkObj);
        }
        updateSearchField && searchTextField.val(linkObj.attrs['data-linked-resource-default-alias']);
        linkBrowser.setLink(linkObj, true);
        linkBrowser.focusLinkText();
    };

    // Perform a search on the passed text
    var doSearch = function (callback) {
        AJS.debug("link-browser-tab-search.js: doing search");

        searchTextField.trigger('hide.autocomplete');
        var searchText = $.trim(searchTextField.val());

        if (searchText) {
            resultGrid.loading();

            AJS.getJSONWrap({
                url: restSearchUrl,
                data: {
                    search: 'site',
                    query: searchText,
                    spaceKey: searchSpaceField.val()
                },
                successCallback: function (data) {
                    if ($.isFunction(callback)) {
                        resultGrid.update(data.result);
                        callback();
                    } else {
                        resultGrid.updateAndSelect(data.result);
                    }

                    // If the autocomplete result has appeared, hide it.
                    searchTextField.trigger('hide.autocomplete');
                },
                messageHandler: messageHandler
            });
        } else {
            $.isFunction(callback) && callback();
        }
    };

    linkBrowser.tabs[key] = {

        hasBreadcrumbs: true,

        createPanel: function (context) {

            var $panel = context.baseElement;
            searchTextField = $panel.find("#link-search-text");
            searchSpaceField = $panel.find("#search-panel-space");

            // Space may have changed since page load if page has been moved.
            var currentLocation = Confluence.PageLocation.get();
            searchSpaceField.find("option:eq(1)").text(currentLocation.spaceName).val(currentLocation.spaceKey);

            searchSpaceField.change(function () {
                // When the space changes update the attribute on the autocomplete field so it can re-loaded when the
                // field gets focus.
                searchTextField.attr('data-spacekey', searchSpaceField.val());
                searchTextField.trigger('clearCache.autocomplete');
            });

            Confluence.Binder.autocompleteSearch(searchTextField.parent());

            searchTextField.bind("selected.autocomplete-content", function (e, data) {
                // If the user selects the "Search for" link from the autocomplete, perform the search.
                if (data.searchFor) {
                    doSearch();
                } else {
                    resultGrid.clear();
                    setLink(data.content, false);
                }
            });

            var columns = [

                // File column has a link to the file and a class for styling with an icon
                AJS.SelectGrid.Column({
                    key: 'title',
                    heading: "\u6807\u9898",
                    getHref: function (rowData) {
                        return AJS.REST.findLink(rowData.link);
                    },
                    getInnerClass: function (rowData) {
                        return rowData.iconClass || ('content-type-' + rowData.type);
                    }
                }),

                // Space column
                AJS.SelectGrid.Column({
                    key: 'space',
                    heading: "\u7A7A\u95F4",
                    getText: function (rowData) {
                        return rowData.space && rowData.space.title || '';
                    }
                }),

                // Last Modified column
                AJS.SelectGrid.Column({
                    key: 'last-modified',
                    heading: "\u6700\u8FD1\u4FEE\u6539\u8FC7",
                    getText: function (rowData) {
                        return rowData.lastModifiedDate && rowData.lastModifiedDate.friendly || '';
                    },
                    getTitle: function (rowData) {
                        return rowData.lastModifiedDate && rowData.lastModifiedDate.date || '';
                    }
                })
            ];

            messageHandler = AJS.MessageHandler({
                baseElement: context.baseElement.find('.message-panel')
            });

            resultGrid = new AJS.ResultGrid({
                baseElement: context.baseElement,
                columns: columns,

                // Called when a row of the search results is selected by mouse or keyboard.
                selectionCallback: function (rowElement, data) {
                    setLink(data);
                },

                noResultMessage: "\u65E0\u641C\u7D22\u7ED3\u679C\u3002",

                // Disable the up/down keys of the grid when the search field or space select have the focus
                dontShiftFocus: function () {
                    return $(searchTextField).add(searchSpaceField).is(':focus');
                }
            });

            // Performs the search when the form at the top of the panel is submitted.
            // The form may be submitted by the user clicking the Search button or pressing
            // 'Enter' in one of the form components.
            $panel.find('.search-form').submit(function () {
                doSearch();
                return false;
            }).keydown(function (e) {
                if (e.keyCode === 13) {
                    // If the search autocomplete has a dropdown visible with an item selected we should let it handle
                    // the Enter - if nothing is selected we should close the dropdown and do the search.
                    var dropdownWithSelection = $('.aui-dropdown:visible .active', this).length;
                    if (!dropdownWithSelection) {
                        $("#search-panel-button").focus();
                        e.stopPropagation();     // Don't let the dialog try to Submit itself when it catches the enter.
                    }
                }
            });
        },

        onSelect: function () {
            AJS.debug('Link Browser Search panel selected');

            var openedLink = this.openedLink;
            if (openedLink) {
                AJS.debug('Link Browser Search panel setting link info');
                setLink(openedLink, true);
            } else {
                searchTextField.focus();
            }
        },

        // The Search panel handles links that have a Confluence resource id, unless they're attachment links on the
        // same page or links with anchors.
        handlesLink: function (linkObj) {
            return linkObj.isCustomAtlassianContentLink() && !linkObj.hasAnchor() && !linkObj.isShortcutLink() && !linkObj.isToAttachmentOnSamePage(AJS.Meta.get('content-id'));
        },

        /*
         * Perform the search by setting the search field value and reproducing a search-form submit.
         *
         * @param searchText - the text to set in the search field and search on
         * @param callback (optional) - a function to call after the search results have been populated
         */
        doSearch: function (searchText, callback) {
            searchTextField.val(searchText);
            doSearch(callback);
        },

        isResultGridVisible: function() {
            return resultGrid.isVisible();
        },

        getSearchTextField: function () {
            return searchTextField;
        }
    };
});
})(jQuery);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-link-browser:link-browser-resources', location = 'js/link-browser-tab-history.js' */
(function($) {
// The History tab registers itself when the Link Browser is created.
AJS.bind("dialog-created.link-browser", function (e, linkBrowser) {

    /**
        Link Dialog tab object is a method that initializes the tab and returns an object
        with these methods:
            1. onSelect - code that should run every time the panel is selected
            2. getLinkDetails - returns the current link represented by this panel's state
        The init method takes the following arguments:
            a. linkDialog - the JS link dialog controller
    */
    var restSearchUrl = AJS.REST.makeUrl('session/history.json?max-results=20'),
        resultGrid,
        messageHandler,
        key = 'recentlyviewed';

    linkBrowser.tabs[key] = {

        createPanel: function (context, getOverrideController) {

            var rowSelected = function (rowElement, data) {
                var linkObj = Confluence.Link.fromREST(data);
                linkBrowser.setLink(linkObj);
                linkBrowser.focusLinkText();
            };

            var columns = [

                // File column has a link to the file and a class for styling with an icon
                AJS.SelectGrid.Column({
                    key: 'title',
                    heading: "\u6807\u9898",
                    getHref: function (rowData) {
                        return AJS.REST.findLink(rowData.link);
                    },
                    getInnerClass: function (rowData) {
                        return rowData.iconClass || ('content-type-' + rowData.type);
                    }
                }),
                // Space column
                AJS.SelectGrid.Column({
                    key: 'space',
                    heading: "\u7A7A\u95F4",
                    getText: function (rowData) {
                        return rowData.space && rowData.space.title || '';
                    }
                }),

                // Last Modified column
                AJS.SelectGrid.Column({
                    key: 'last-modified',
                    heading: "\u6700\u8FD1\u4FEE\u6539\u8FC7",
                    getText: function (rowData) {
                        return rowData.lastModifiedDate && rowData.lastModifiedDate.friendly || '';
                    },
                    getTitle: function (rowData) {
                        return rowData.lastModifiedDate && rowData.lastModifiedDate.date || '';
                    }
                })
            ];
            var getRowId = function (rowData) {
                return rowData.attachmentId;
            };

            messageHandler = AJS.MessageHandler({
                baseElement: context.baseElement.find('.message-panel')
            });

            resultGrid = new AJS.ResultGrid({
                baseElement: context.baseElement,
                columns: columns,
                getRowId: getRowId,
                selectionCallback: rowSelected,
                messageHandler: messageHandler,
                noResultMessage: "\u4F60\u6CA1\u6709\u6700\u8FD1\u6D4F\u89C8\u7684\u5185\u5BB9\u3002"
            });
        },

        // The History list is refreshed each time the user selects the "Recently Viewed" tab
        onSelect: function () {
            resultGrid.loading();

            AJS.getJSONWrap({
                url: restSearchUrl,
                messageHandler: messageHandler,
                successCallback: function (data) {
                    resultGrid.update(data.content);
                    AJS.trigger('updated.link-browser-recently-viewed');
                }
            });
        }
    };
});
})(jQuery);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-link-browser:link-browser-resources', location = 'js/link-browser-tab-attachment.js' */
(function($) {
// Not supported for templates
if(AJS.Meta.get("content-type") === "template")
    return;

AJS.bind("dialog-created.link-browser", function (e, linkBrowser) {

    var restUrl = AJS.REST.makeUrl("content/" + AJS.Meta.get('attachment-source-content-id') + "/attachments.json"),
        key = 'attachments',
        controller,
        uploaderController,
        messageHandler,
        resultGrid;

    // Returns the controller for this panel
    var getController = function (context, getOverrideController) {

        var uploadForm = context.baseElement.find('.attach-file-form');

        return $.extend({
                getUploaderController: function () {
                    var uploaderContext = {
                        baseElement: uploadForm
                    },
                    uploaderControllerOverride = function (context) {
                        return {
                            onUploadSuccess: function (attachmentsAdded) {
                                // Jsonated object properties should match REST ones.
                                for (var i = 0, len = attachmentsAdded.length; i < len; i++) {
                                    attachmentsAdded[i].type = 'attachment';
                                }
                                resultGrid.prependAndSelect(attachmentsAdded);
                                AJS.Meta.set("num-attachments", $("#attachments-table").find("tr[data-id]").length);
                                $("#rte-button-attachments").trigger("updateLabel");
                            }
                        };
                    };
                    return Confluence.AttachmentUploader(uploaderContext, uploaderControllerOverride);
                }
            },
            getOverrideController && getOverrideController(context)
        );
    };

    linkBrowser.tabs[key] = {
        hasBreadcrumbs: false,

        // Called by the main Link Browser controller on startup to initialize the by-now-existing panel DOM
        // element.
        createPanel: function (context, getOverrideController) {

            var tab = this;

            controller = getController(context, getOverrideController);
            uploaderController = controller.getUploaderController(context);
            messageHandler = uploaderController.getMessageHandler();

            var columns = [

                // File column has a link to the file and a class for styling with an icon
                AJS.SelectGrid.Column({
                    key: 'title',
                    heading: "\u540D\u79F0",
                    getHref: function (rowData) {
                        if (rowData.link) {
                            // REST object returned by attachment search
                            return AJS.REST.findLink(rowData.link);
                        }
                        // JSON returned by upload attachment action
                        return rowData.url;
                    },
                    getInnerClass: function (rowData) {
                        return rowData.iconClass;
                    }
                }),
                // Size column
                AJS.SelectGrid.Column({
                    key: 'size',
                    heading: "\u5927\u5C0F",
                    getText: function (rowData) {
                        return rowData.niceFileSize;
                    }
                }),

                // Comment column
                AJS.SelectGrid.Column({
                    key: 'comment',
                    heading: "\u8BC4\u8BBA"
                })
            ];

            resultGrid = new AJS.ResultGrid({
                baseElement: context.baseElement,
                columns: columns,

                selectionCallback: function (rowElement, data) {
                    var linkObj = Confluence.Link.fromREST(data);
                    // The attachment will be on the same page so set the data-linked-resource-container-id.
                    linkObj.attrs["data-linked-resource-container-id"] = AJS.Meta.get('content-id');

                    // Need to check that the href leads to the download path for the attachment.
                    if (AJS.$.isArray(data.link)) {
                        for (var i=0,ii=data.link.length; i<ii; i++) {
                            var link = data.link[i];
                               if (link.rel == "download") {
                                   linkObj.attrs.href= link.href;
                               }
                            }
                        }
                    linkBrowser.setLink(linkObj);
                    linkBrowser.focusLinkText();
                },
                noResultMessage: "\u672C\u9875\u9762\u4E0A\u6709\u6CA1\u6709\u9644\u4EF6\u3002"
            });
        },

        // When the Attachment tab is selected the current attachments are refreshed.
        onSelect: function () {
            // Store a ref in scope to last across the AJAX request - the tab.openedLink ref is dropped by the
            // main controller after the tab.select() call is made.
            var openedLink = this.openedLink,
                selectedLink = linkBrowser.getLink();

            resultGrid.loading();
            AJS.getJSONWrap({
                url: restUrl,
                messageHandler: messageHandler,
                successCallback: function (data) {

                    resultGrid.update(data.attachment);

                    if (selectedLink) {
                       if (selectedLink.getResourceType() == "attachment") {
                           resultGrid.select(selectedLink.getResourceId());
                       }
                    } else if (openedLink) {
                        // If this panel has been opened automatically to edit an existing attachment link,
                        // select that link.
                        resultGrid.select(openedLink.getResourceId());
                    } else if (data.attachment.length) {
                        resultGrid.select(data.attachment[0].id);
                    }
                    AJS.debug('Loaded attachments');
                }
            });
        },

        // The Attachment panel opens existing links for attachments that are on the current page or blogpost.
        handlesLink: function (linkObj) {
            return linkObj.isToAttachmentOnSamePage(AJS.Meta.get('content-id'));
        }
    };
});
})(jQuery);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-link-browser:link-browser-resources', location = 'js/link-browser-tab-weblink.js' */
(function($) {
// The Web Link tab registers itself when the Link Browser is created.
AJS.bind("dialog-created.link-browser", function (e, linkBrowser) {

    var urlField,
        key = 'weblink',
        thisPanel,
        tab,
        protocolDelimRegex= new RegExp('[:/]');

    function getURL() {
        return $.trim(urlField.val());
    }

    // Checks that the URL has a protocol, fixes if it can.
    function fixUrl() {
        var url = getURL();
        if (AJS.Validate.url(url) || url.indexOf('mailto:') == 0) {
            // A complete URL - leave it alone
            return;
        }
        // If the URL is not an absolute URL it might be a http URL missing the http or a mailto: missing the mailto.
        var defaultAlias = url;
        if (AJS.Validate.email(url)) {
            // Email link is missing mailto - add it
            url = 'mailto:' + url;
        }
        else if (!protocolDelimRegex.test(url)) {
            // *Probably* just a web address like 'www.atlassian.com' that needs an http:// prefix
            url = 'http://' + url;
        } else {
            // Not a valid URL that we know of - might have deleted half of the protocol or something... as they wish!
            return;
        }

        AJS.debug('Updating Link Browser Web Link URL to: ' + url);
        urlField.val(url);

        // Pass the original URL as the title so that the alias can be set to the non-prefixed URL if it
        // isn't already set.
        var linkObj = Confluence.Link.makeExternalLink(url);
        linkBrowser.setLink(linkObj);
    }

    tab = linkBrowser.tabs[key] = {

        createPanel: function (context) {
            thisPanel = context.baseElement;
            urlField = thisPanel.find("input[name='destination']");
            urlField.keyup(function (e) {
                var url = getURL();
                var linkObj = url ? Confluence.Link.makeExternalLink(url) : null;
                if (linkObj) {
                    linkBrowser.setLink(linkObj); // will enable the Submit button when a URL is added
                }
            });

            urlField.change(fixUrl);
            urlField.bind('paste', function () {
                AJS.debug('Link Browser web link url pasted');
                // CONF-22287 - use setTimeout to wait for the paste event to update the field value
                setTimeout(fixUrl, 0);
            });
        },

        // Called when the panel is selected - may be called before the LB dialog has its 'show' method called
        onSelect: function () {
            // Put the location panel inside the web-link panel for easier styling.
            linkBrowser.moveLocationPanel(thisPanel.find("form"));

            if (this.openedLink) {
                tab.setURL(this.openedLink.attrs.href);
                linkBrowser.setLink(this.openedLink);
            }

            // Defer focus to after LB is shown, gets around AJS.Dialog tabindex issues
            setTimeout(function() {
                urlField.focus();
            });
        },

        onDeselect: linkBrowser.restoreLocationPanel,

        // Called when the submit button is clicked, before the location is retrieved from the Location controller.
        // Re-validate and prefix the URL.
        preSubmit: fixUrl,

        // The Web link panel handles non Confluence links
        handlesLink: function (linkObj) {
            return !linkObj.isCustomAtlassianContentLink();
        },

        setURL: function (url) {
            urlField.val(url);
            urlField.keyup();
            urlField.change();
        },

        getURL: getURL
    };
});
})(jQuery);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-link-browser:link-browser-resources', location = 'js/link-browser-tab-advanced.js' */
(function($) {

    // The Advanced tab registers itself when the Link Browser is created.
    AJS.bind("dialog-created.link-browser", function (e, linkBrowser) {

        var key = 'advanced',                   // This panel's key.
            linkFieldName = 'advanced-link',    // The ID of the link input element.
            errorFieldName = 'advanced-error',  // The ID of the error element.
            $linkField,                         // The jQueryfied link input element.
            $errorField,                        // The jQueryfied error field.
            thisPanel,                          // A reference to this panel.
            keyTimeout,                         // Used to tell when the user has stopped typing.


        /**
         * Triggered on a successful AJAX request.
         */
        successfulConversion = function (data, textStatus) {
            var $data = $(data);

            if (!$data.length) {
                return; // Do nothing if no data was returned.
            }

            // Use the first available link.
            var $link = $data.find("a:first");

            if (!$link.length) { // The markup wasn't link markup.
                $errorField.text("\u65E0\u6548\u7684\u94FE\u63A5\u6807\u8BB0");
            } else if ($link.hasClass("unresolved")) {
                // If the link used an unspecified shortcut or unrecognised space, it will return with an unresolved class
                var shortcutKey = $link.attr("shortcut-key");
                var spaceKey = $link.attr("data-space-key");
                if (!!shortcutKey) {
                    $errorField.text(AJS.format("{0} \u662F\u4E0D\u80FD\u8BC6\u522B\u7684\u5FEB\u6377\u952E", shortcutKey));
                } else if (!!spaceKey) {
                    $errorField.text(AJS.format("{0} \u662F\u4E0D\u80FD\u8BC6\u522B\u7684\u7A7A\u95F4", spaceKey));
                }
            } else { // The link is valid.
                var linkObj = Confluence.Link.fromNode($link[0], $linkField.val());
                linkBrowser.setLink(linkObj);
            }
        },


        /**
         * Triggered on an unsuccessful AJAX request.
         */
        erroredConversion = function(XMLHttpRequest, textStatus, errorThrown) {
            AJS.debug("Error during conversion: textStatus = " + textStatus + ", errorThrown = " + errorThrown);
            $errorField.text("\u53D1\u751F\u5185\u90E8\u670D\u52A1\u5668\u9519\u8BEF");
        },


        /**
         * Uses the wikixhtmlconverter REST API to convert the provided wikimarkup into XHTML.
         */
        convert = function(markup, successfulConversion, erroredConversion) {
            var conversionData = {
                wiki: markup,
                entityId: AJS.Meta.get("content-id"),
                spaceKey: AJS.Meta.get("space-key")
            };

            AJS.$.ajax({
                type : "POST",
                contentType : "application/json; charset=utf-8",
                url : AJS.params.contextPath + "/rest/tinymce/1/wikixhtmlconverter",
                data : AJS.$.toJSON(conversionData),
                dataType : "text", 
                success : successfulConversion,
                error : erroredConversion,
                timeout: 10000
            });
        },

        /**
         * Wraps the text currently in the link input field with square braces and sends
         * it to the convert() method.
         */
        parseLinkText = function () {
            var text = $linkField.val();
            convert("[" + text + "]", successfulConversion, erroredConversion);
        };

        // Define the available Link Browser Advanced tab methods.
        tab = linkBrowser.tabs[key] = {

            createPanel: function (context) {
                thisPanel = context.baseElement;
                $linkField = thisPanel.find("input[name='advanced-link']");
                $errorField = thisPanel.find("div[name='advanced-error']");
                thisPanel.find("form").keydown(function(e) {
                    if(e.keyCode == 13 && !linkBrowser.isSubmitButtonEnabled()) {
                        e.preventDefault();
                    }
                });
                $linkField.keyup(function (e) {
                    clearTimeout(keyTimeout);
                    $errorField.text('');

                    if (!!$linkField.val()) {
                        keyTimeout = setTimeout(function () {
                            parseLinkText();
                        }, 200);
                    }
                });
            },

            setLink: function (text) {
                $linkField.val(text);
                $linkField.keyup();
                $linkField.change();
            },

            getLink: function () {
                return $linkField.val();
            },

            // Called when the panel is selected
            onSelect: function () {
                linkBrowser.moveLocationPanel(thisPanel.find("form"));

                if (this.openedLink) {
                    if(this.openedLink.isShortcutLink()) {
                        tab.setLink(this.openedLink.getShortcut());

                    }else{
                        if (this.openedLink.getResourceId()) { //anchor to external page.
                            tab.setLink(this.openedLink.getDefaultAlias());
                        }
                        else { //anchor in the same page.
                            tab.setLink('#' + this.openedLink.getAnchor());
                        }
                    }

                    linkBrowser.setLink(this.openedLink);
                }
                // Defer focus to after LB is shown, gets around AJS.Dialog tabindex issues
                setTimeout(function() {
                    $linkField.focus();
                });
            },

            // Called when this panel is no longer selected
            onDeselect: function () {
                linkBrowser.restoreLocationPanel();
            },

            handlesLink: function (linkObj) {
                return linkObj.isShortcutLink() || linkObj.hasAnchor();
            }
        };
    });

})(jQuery);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-link-browser:link-browser-resources', location = 'templates/link-browser.soy' */
// This file was automatically generated from link-browser.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.LinkBrowser == 'undefined') { Confluence.Templates.LinkBrowser = {}; }


Confluence.Templates.LinkBrowser.searchPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form class="aui search-form" onsubmit="return false;"><fieldset class="inline"><div class="search-input"><label for="link-search-text" id="linkSearch-label" class="assistive">', soy.$$escapeHtml("\u641c\u7d22"), '</label><input id="link-search-text" type="text" tabindex="0" class="text autocomplete-search" name="linkSearch" autocomplete="off" data-search-link-message="', soy.$$escapeHtml("\u641c\u7d22 \x26lsquo;{0}\x26rsquo;"), '"></div><select tabindex="0" class="search-space select" id="search-panel-space"><option value="">', soy.$$escapeHtml("\u6240\u6709\u7a7a\u95f4"), '</option><option value=""> </option></select><button type="submit" tabindex="0" class="aui-button" id="search-panel-button">', soy.$$escapeHtml("\u641c\u7d22"), '</button></fieldset></form><div class="message-panel hidden"></div><div id="search-results-table" class="data-table hidden"></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.LinkBrowser.recentlyviewedPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="recently-viewed-panel"><div class="message-panel hidden"></div><div class="data-table"></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.LinkBrowser.attachmentsPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="attach-file-form"><form method="post" enctype="multipart/form-data" id="attachments-attachfile-form" action="', soy.$$escapeHtml(""), '/pages/attachfile.action" class="aui"><p>', soy.$$escapeHtml("\u8fde\u63a5\u5230\u672c\u7f51\u9875\u5df2\u5b58\u5728\u7684\u9644\u4ef6\u6216\u9644\u52a0\u4e00\u4e2a\u65b0\u7684\u9644\u4ef6\u3002"), '</p><div class="upload-field field-group"><label for="file_0">', soy.$$escapeHtml("\u4e0a\u4f20\u6587\u4ef6"), '</label> <input type="file" name="file_0" class="upfile" id="file_0"> <input type="hidden" name="minorEdit_0" value="true"></div><input type="hidden" name="atl_token" value="', soy.$$escapeHtml(opt_data.atlToken), '" /></form><div class="upload-in-progress upload-field hidden">', soy.$$escapeHtml("\u4e0a\u4f20\u4e2d u2026"), '</div><div class="warning"><ul class="hidden message-panel"></ul></div></div><div class="message-panel hidden"></div><div id="attachments-table" class="attachment-list data-table"></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.LinkBrowser.weblinkPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form class="aui" onsubmit="return false;"><div class="field-group"><label id="destination-label" for="weblink-destination">', soy.$$escapeHtml("\u5730\u5740"), '</label><input type="text" tabindex="0" class="text" id="weblink-destination" name="destination"><div class="web-link-desc description">', soy.$$escapeHtml("Web\u3001email \u6216\u5176\u4ed6\u4e92\u8054\u7f51\u5730\u5740"), '</div></div></form>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.LinkBrowser.advancedPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form class="aui" onsubmit="return false;"><div class="advanced-desc title">', AJS.format("\u4f7f\u7528 \x3ca href\x3d\x22{0}\x22 target\x3d\x22_blank\x22\x3eWiki\u6807\u8bb0\x3c/a\x3e\u80fd\u591f\u5728\u9875\u9762\u4e2d\u63d2\u5165\u94fe\u63a5\u3002","https://docs.atlassian.com/confluence/docs-55/Working+with+Links"), '</div><div class="field-group"><label id="advanced-label" for="advanced-link">', soy.$$escapeHtml("\u94fe\u63a5"), '</label><input type="text" tabindex="0" class="text" id="advanced-link" name="advanced-link"><div class="advanced-desc description">', soy.$$escapeHtml("\u5728\u65b0\u9875\u9762\u4e2d\u63d2\u5165\u94fe\u63a5\uff0c\u8f93\u5165\u9875\u9762\u6807\u9898\u3002"), '<br/>', soy.$$escapeHtml("\u63d2\u5165\u951a\u70b9\u94fe\u63a5, \u8f93\u5165 #anchorname\u3002"), '</div><div name="advanced-error" class="advanced-error error"></div></div></form>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.LinkBrowser.locationPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="link-browser-location" class="location-info"><form class="aui"><div class="row hidden field-group"><label class="link-location-label" for="breadcrumbs-link">', soy.$$escapeHtml("\u94fe\u63a5\u5730\u5740"), '</label><div class="breadcrumbs-container" id="breadcrumbs-link"><div class="breadcrumbs-line"><ol id="breadcrumbs-container" class="breadcrumbs"></ol></div></div></div></form><div class="row link-text"><form class="aui" onsubmit="return false;"><div class="field-group"><label for="alias" id="alias-label">', soy.$$escapeHtml("\u94fe\u63a5\u6587\u5b57"), '</label><input type="text" tabindex="0" class="text" name="alias" id="alias"></div></form></div><div class="row link-image hidden"><div class="readonly"><label for="link-image-filename">', soy.$$escapeHtml("\u94fe\u63a5\u56fe\u7247"), '</label><span id="link-image-filename" class="content-type-attachment-image"></span></div></div><div class="row link-mixed hidden"><div class="readonly"><label for="link-mixed-content">', soy.$$escapeHtml("\u94fe\u63a5\u6587\u5b57"), '</label><span id="link-mixed-content"></span></div></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.LinkBrowser.helpLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="dialog-help-link"><a href="', soy.$$escapeHtml("https://docs.atlassian.com/confluence/docs-55/Working+with+Links"), '" target="_blank">', soy.$$escapeHtml("\u5e2e\u52a9"), '</a></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-link-browser:link-browser-editor-resources', location = 'tinymce/editor_plugin_src.js' */
// Register TinyMCE plugin

AJS.Rte.BootstrapManager.addTinyMcePluginInit(function(settings) {
    settings.plugins += ",linkbrowser";
    settings.theme_advanced_buttons1 += ",linkbrowserButton";
});

tinymce.create('tinymce.plugins.LinkBrowser', {
    init : function(ed) {
        var LinkBrowser = Confluence.Editor.LinkBrowser;
        ed.addButton("linkbrowserButton", {title: "confluence.conflink_desc", cmd: "mceConflink", "class": "mce_conflink" });

        ed.addCommand('mceConflink', LinkBrowser.open);
        ed.addCommand('mceConfAttachments', function () {
            return LinkBrowser.open({
                panelKey: LinkBrowser.ATTACHMENTS_PANEL
            });
        }); // attachments item in insert menu
    },
    getInfo : function () {
        return {
            longname : "Confluence Link Browser",
            author : "Atlassian",
            authorurl : "http://www.atlassian.com",
            version : tinymce.majorVersion + "." + tinymce.minorVersion
        };
    }
});

tinymce.PluginManager.add('linkbrowser', tinymce.plugins.LinkBrowser);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-mentions-plugin:editor-autocomplete-mentions', location = 'js/editor_plugin_src.js' */
(function(b){AJS.EventQueue=AJS.EventQueue||[];function c(){AJS.EventQueue.push({name:"confluencementioninsert"});Confluence.Editor.Autocompleter.Manager.shortcutFired("@",true)}function a(d){return d&&d.shiftKey&&!d.ctrlKey&&!d.altKey&&!d.altGraphKey&&!d.metaKey&&d.which===64}tinymce.create("tinymce.plugins.InsertMention",{init:function(d){b("#insertmention-button").click(function(e){e.stopPropagation();e.preventDefault();var f=Confluence.Editor.Autocompleter.Manager.getInputDrivenDropdown();if(!f||f.inactive){tinymce.execCommand("mceFocus",false,d.id);c()}});AJS.bind("editor.text-placeholder.activated",function(g,f){if(f&&f.placeholderType==="mention"){if(a(f.triggerEvent)){tinymce.dom.Event.cancel(f.triggerEvent)}c()}});if(AJS.Rte.Placeholder&&AJS.Rte.Placeholder.addPlaceholderType){AJS.Rte.Placeholder.addPlaceholderType({type:"mention",label:"User mention",tooltip:"Instructional text is replaced with suggested people when a person types."})}},getInfo:function(){return{longname:"Insert Mention",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("insertmention",tinymce.plugins.InsertMention)})(AJS.$);AJS.Rte.BootstrapManager.addTinyMcePluginInit(function(a){a.plugins+=",insertmention"});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-mentions-plugin:editor-autocomplete-mentions', location = 'js/tinyMce-autocomplete-settings-mentions.js' */
AJS.Rte.BootstrapManager.addOnInitCallback(function(){if(!Confluence.Editor.Autocompleter){Confluence.Editor.Autocompleter=tinymce.confluence.Autocompleter}var b=function(e){if(e){return AJS.params.contextPath+"/rest/prototype/1/search.json"}else{if(AJS.Meta.get("remote-user")){return AJS.params.contextPath+"/rest/mentions/1/network.json"}}return null},c=function(g,f){var e={"max-results":g.maxResults||10};if(f){e.query=Confluence.unescapeEntities(f);e.search="user"}return e},a=function(m,f,l,h,g){var k=m.statusMessage;var i;if(k){i=[[{html:m.statusMessage,className:"error"}]]}else{var e=[];i=[e];if(m.result){AJS.$.each(m.result,function(n,p){var o=AJS.$.extend({},p);o.key=o.username;o.linkAlias=o.title;o.title=o.title+" ("+o.username+")";e.push(o)})}i=AJS.REST.convertFromRest(i)}function j(o,n){if(g&&typeof g=="function"){g(i,o,n)}}l(i,f,j)},d=function(g,i,m,f,l,o,j){var e=i(f),k=g.settings.cacheManager,h=k.get(f),n;if(e){n=$.ajax({type:"GET",url:e,data:m(g,f),dataType:"json",global:false,timeout:10000});n.done(function(p){k.put(f,p)});if(h){a(h,f,l,o,j)}else{n.done(function(p){a(p,f,l,o,j)});n.fail(function(q,p){if(p=="timeout"){a({statusMessage:"Timeout",query:f},f,l,o)}})}}else{l([],f)}};Confluence.Editor.Autocompleter.Settings["@"]={ch:"@",endChars:[],dropDownClassName:"autocomplete-mentions",selectFirstItem:true,getHeaderText:function(f,e){if(e){return "User suggestions"}else{return "Mention someone by typing their name..."}},getAdditionalLinks:function(h,f,g){var e=[];g(f,e);return e},getDataAndRunCallback:function(g,e,f){d(g,b,c,e,f,"content",function(h,j,i){if(j!==""&&h.length<2){if(i.length==0){i.push({html:'<span class="no-result">'+"No user found"+"</span>"})}}else{i.length=0}})},update:function(g,e){if(e.restObj){var f=AJS.$.extend(e.restObj,{title:e.restObj.linkAlias});e=Confluence.Link.fromREST(f)}e.insert()}}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:drag-and-drop-for-editor', location = 'js/editor.js' */
AJS.toInit(function(d){var g;var c=/^\w+:\/\/[^\/?#]+/.exec(location.href);var a=function(h){var k=document.getElementById("fileuploadShim"),i=false;if(!k){k=document.createElement("div");k.setAttribute("id","fileuploadShim");document.body.appendChild(k)}if(jQuery.browser.mozilla&&jQuery.browser.version.indexOf("1.9.2")>-1){h.addEventListener("drop",function(l){l.stopPropagation()},false)}var j=new plupload.Uploader({runtimes:"html5",dragdrop:true,drop_element:h,browse_button:k.getAttribute("id"),multipart:false,max_file_size:+AJS.Meta.get("global-settings-attachment-max-size")});if(!g){g=new AJS.DragAndDropProgressDialog()}j.init();j.bind("FilesAdded",function(l,p){for(var n=0,o=p.length;n<o;n++){var m=p[n];if(m.status!==plupload.FAILED){g.render({workId:m.id,status:m.status,file:m})}}j.start()});j.bind("BeforeUpload",function(l,o){if(AJS.Meta.get("content-type")==="template"){l.stop();f();return}var n=c+Confluence.getContextPath()+"/plugins/drag-and-drop/upload.action";var r={};var m=AJS.Meta.get("page-id");if(m){r.pageId=m}var p=AJS.Meta.get("draft-id");if(m==0&&p>0){r.draftId=p}var q=AJS.Meta.get("drag-and-drop-entity-id");if(q){r.dragAndDropEntityId=q}var s=o.name.substr(o.name.lastIndexOf(".")+1);r.filename=o.name;r.size=o.size;r.minorEdit=true;r.spaceKey=AJS.Meta.get("space-key")||"";r.mimeType=plupload.mimeTypes[s.toLowerCase()]||"application/x-upload-data";r.atl_token=AJS.Meta.get("atl-token");l.settings.url=plupload.buildUrl(n,r);g.cancelListeners.push(function(v,t){var u=l.getFile(t.workId);u&&l.removeFile(u);g.renderInfo(t.workId,"File was manually removed from the queue.")});g.show()});j.bind("UploadProgress",function(l,m){g.renderUpdateToBytesUploaded(m.id,m.loaded,m.size);g.hideCloseButton()});d.browser.mozilla&&(function(){plupload.addEvent(h,"dragenter",function(l){if(l.rangeParent&&(l.rangeOffset!=undefined)){i={startElement:l.rangeParent,startOffset:l.rangeOffset}}else{i=false}})})();j.bind("FileUploaded",function(m,o,n){if(!n.status){g.renderError(o.id,"The server is not responding. Please check that it is running.")
}else{if(n.response){try{var l=AJS.$.parseJSON(n.response);if(i&&d(i.startElement.parentNode).closest('[contenteditable="true"]',h).length){tinymce.activeEditor.selection.setCursorLocation(i.startElement,i.startOffset)}AJS.Rte.getEditor().execCommand("mceInsertContent",false,l.htmlForEditor,{skip_focus:true})}catch(p){AJS.log("FileUploaded threw an exception "+p)}}AJS.Meta.set("num-attachments",+AJS.Meta.get("num-attachments")+1);d("#rte-button-attachments").trigger("updateLabel");g.renderComplete(o.id)}});j.bind("Error",function(m,n){var l,o;if(n.response){try{l=AJS.$.parseJSON(n.response);o=l.actionErrors[0]}catch(p){if(p.name==="SyntaxError"){o="Invalid response received from the server."}else{o=n.message}}g.renderError(n.file.id,o)}else{o=n.message;if(n.code==plupload.FILE_SIZE_ERROR){o=AJS.format("\u6587\u4EF6\u5927\u5C0F{0}\u8D85\u8FC7\u6700\u5927\u4E0A\u4F20\u9650\u5236{1}",AJS.DragAndDropUtils.niceSize(n.file.size).toString(),AJS.DragAndDropUtils.niceSize(AJS.Meta.get("global-settings-attachment-max-size")).toString());g.render({workId:n.file.id,status:n.file.status,file:n.file,errorMessage:o});if(!g.isVisible()){g.show();g.showCloseButton()}}}});j.bind("UploadComplete",function(){if(!j.total.queued){j.stop();g.showCloseButton();if(!g.hasErrors()){setTimeout(function(){g.hide();g.clearRenderOutput();AJS.Rte.BookmarkManager.restoreBookmark()},1000)}}});AJS.Confluence.Uploader=j;AJS.Confluence.EditorUploadProgressDialog=g};function e(){var i=AJS.Rte.getEditor(),h=i.getBody().parentNode;AJS.DragAndDropUtils.init(function(j){if(j){a(h)}})}var b=false;function f(){if(b){return}var h=new AJS.Dialog(450,180);h.addHeader("Not Supported");h.addSubmit("Ok",function(){h.remove()});h.addPanel("Panel 1","panel1");h.getCurrentPanel().html("\u003cp>Attachments are not supported in Templates.\u003c\/p> \u003cp>Files may be attached to a Page, and added as an image via the Insert menu.\u003c\/p>");h.show();b=true}AJS.Rte.BootstrapManager.addOnInitCallback(e)});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:drag-and-drop-for-editor', location = 'js/image-dialog-client.js' */
AJS.toInit(function(g){var b=function(){this._workIdToBytesUploaded={};this._totalBytes=0},a=/^\w+:\/\/[^\/?#]+/.exec(location.href);b.prototype={update:function(l,k,j){if(!(l in this._workIdToBytesUploaded)){this._totalBytes+=j}this._workIdToBytesUploaded[l]=k},percentComplete:function(){var j=0;g.each(this._workIdToBytesUploaded,function(k,l){j+=l});return Math.round(j*100/this._totalBytes)}};var i=Confluence.Editor.ImageDialog.beforeShowListeners,c,e=[],f=new b(),d=Confluence.Editor.ImageDialog.findPanelComponentById("attachments");i&&i.push(function(){var j=g("#attached-images")[0];if(!j){return}if(DragnDropSupport.hasXhrSupport){h(j)}});var h=function(k){var l=document.getElementById("fileuploadShim");f;if(!l){l=document.createElement("div");l.setAttribute("id","fileuploadShim");document.body.appendChild(l)}document.body.appendChild(l);var j=new plupload.Uploader({runtimes:"html5",dragdrop:true,drop_element:k,browse_button:l.getAttribute("id"),multipart:false,stop_propagation:true});j.init();j.bind("FilesAdded",function(m,n){j.start()});j.bind("BeforeUpload",function(m,p){var o=a+Confluence.getContextPath()+"/plugins/drag-and-drop/upload.action";var n=AJS.Meta.get("page-id");var r=n!=0?{pageId:n}:{draftId:AJS.Meta.get("draft-id")},s=p.name.substr(p.name.lastIndexOf(".")+1);var q=AJS.Meta.get("drag-and-drop-entity-id");if(q){r.dragAndDropEntityId=q}r.filename=p.name;r.size=p.size;r.minorEdit=true;r.spaceKey=AJS.Meta.get("space-key")||"";r.mimeType=plupload.mimeTypes[s.toLowerCase()]||"application/x-upload-data";r.atl_token=AJS.Meta.get("atl-token");m.settings.url=plupload.buildUrl(o,r);e=[];f=new b()});j.bind("UploadProgress",function(m,n){f.update(n.id,n.loaded,n.size);d.setUploadInProgress(true,AJS.format("\u56FE\u50CF\u4E0A\u4F20\u4E2D... {0}%",f.percentComplete().toString()))});j.bind("FileUploaded",function(m,o,n){o.name&&e.push(o.name)});j.bind("Error",function(n,o){var p;if(o.response){try{var m=AJS.$.parseJSON(o.response);p=m.actionErrors[0]}catch(q){p=o.message
}}else{p=o.message}d.displayErrors([p])});j.bind("UploadComplete",function(){d.setUploadInProgress(false);!!e.length&&d.refresh(e);e=[];f=new b()})}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:drag-and-drop-for-editor', location = 'js/link-dialog-drop-zone.js' */
AJS.toInit(function(a){AJS.bind("dialog-shown.link-browser",function(c,b){if(!a.browser.msie){AJS.DragAndDropUtils.bindDrop(a("#insert-link-dialog")[0],function(d){d.preventDefault();d.stopPropagation()})}})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:drop-zone-for-image-dialog', location = 'js/image-dialog-drop-zone.js' */
AJS.toInit(function(b){if(!AJS.DragAndDropUtils.hasXhrSupport){AJS.debug("Browser doesn't have XHR upload support. Skipping image dialog drop zone..");return}if(!(AJS.Meta.get("remote-user"))){AJS.debug("Skipping image attachment drop-zone for anonymous user creating new content");return}var a=Confluence.Editor.ImageDialog.findPanelComponentById("attachments");if(!a){AJS.log("Skipping image attachment drop-zone - no Image Dialog attachment panel");return}b(a).bind("afterThumbnail",function(d,c){if(c.find(".image-dialog-drop-zone-container").length){return}var f=b("<li/>").addClass("attached-image");var e=b("<div/>").addClass("image-dialog-drop-zone-container image-container");b("<div/>").addClass("drop-zone-image").attr("title","\u5C06\u6587\u4EF6\u62D6\u653E\u5230\u8FD9\u91CC\u4E0A\u4F20").appendTo(e);b("<div/>").addClass("drop-zone-text").text("\u62D6\u653E\u5230\u8FD9\u91CC").appendTo(e);e.appendTo(f);c.prepend(f);if(!b.browser.msie){AJS.DragAndDropUtils.bindDragEnter(e[0],function(){e.addClass("drop-zone-on-hover")});AJS.DragAndDropUtils.bindDragOver(e[0],function(){e.addClass("drop-zone-on-hover")});AJS.DragAndDropUtils.bindDragLeave(e[0],function(){e.removeClass("drop-zone-on-hover")})}})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-templates:template-editor-variables-resources', location = 'js/variable-manager.js' */
(function($) {
    if(AJS.Meta.get("content-type") !== "template") return;

    function caseInsensitiveLocalCompare(a, b) {
        var la = a.toLocaleLowerCase();
        var lb = b.toLocaleLowerCase();
        var r = la.localeCompare(lb);
        if(r == 0)
            r = a.localCompare(b);
        return r;
    }

    function defaultVariable(type) {
        var defaultVar = Confluence.VariableManager.defaults[type] || Confluence.VariableManager.defaults["string"];
        return $.extend(true, {}, defaultVar);
    }

    Confluence.VariableManager = function() {
        var variables = {};

        return {
            find : function(startName) {
                var search = startName.toLocaleLowerCase();
                var result = {};
                for(var k in variables) {
                    if(variables.hasOwnProperty(k)) {
                        if(!search.length || k.toLocaleLowerCase().indexOf(search) === 0) {
                            result[k] = variables[k];
                        }
                    }
                }
                return result;
            },

            contains: function(name) {
                return !!variables[name];
            },

            get : function(name) {
                return variables[name];
            },

            getAll : function() {
                return $.extend(true, {}, variables); // clone a copy
            },

            getSortedNames : function() {
                var names = [];
                for(var name in variables)
                    names.push(name);
                return names.sort(caseInsensitiveLocalCompare);
            },

            add : function(name, details) {
                variables[name] = details || defaultVariable();
                AJS.trigger('add.confluence-variable', {
                    name: name,
                    details :$.extend(true, {}, details)
                });
            },

            del : function(name) {
                var details = variables[name];
                delete variables[name];
                AJS.trigger('delete.confluence-variable', {
                    name: name,
                    details :$.extend(true, {}, details)
                });
            },

            rename : function(oldName, newName) {
                var old = variables[oldName];
                delete variables[oldName];
                if(old) {
                    variables[newName] = old;
                    AJS.trigger('rename.confluence-variable', {
                        oldName: oldName,
                        newName: newName,
                        details :$.extend(true, {}, details)
                    });
                }
            },

            createDefault: defaultVariable
        };
    }

    Confluence.VariableManager.defaultVariableManager = Confluence.VariableManager();
    Confluence.VariableManager.defaults =  {
        textarea: {
            type: "textarea",
            rows: 5,
            columns: 100
        },
        list: {
            type: "list",
            options: []
        },
        string: {
            type: "string"
        }
    }

})(AJS.$);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-templates:template-editor-variables-resources', location = 'js/variable-placeholder.js' */
(function($) {
    if(AJS.Meta.get("content-type") !== "template") return;

    Confluence.VariablePlaceHolder = {
        insertPlaceholder : function(name, additionalAttrs) {
            var variable,
                label = '$' + name,
                ed = AJS.Rte.getEditor();

            AJS.Rte.BookmarkManager.storeBookmark();

            var attrs = {
                title: label,
                src: AJS.Meta.get("context-path") +
                    '/plugins/servlet/confluence/placeholder/template-variable?name=' + encodeURIComponent(name),
                'data-variable-name': name,
                'class': 'template-variable',
                'alt': '$' + name
            };
            !!additionalAttrs && $.extend(attrs, additionalAttrs);
            variable = $('<img/>').attr(attrs);

            ed.selection.setNode(variable[0]);
        }
    };

    AJS.bind("init.rte", function() {
        // CONFDEV-9297 - prevent default browser drag behaviour for template variables.
        $(AJS.Rte.getEditor().getBody()).delegate('img.template-variable', 'dragstart', function(e) {
            e.preventDefault();
        });
    });
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-templates:template-editor-variables-resources', location = 'js/variable-toolbar.js' */
(function($) {
    AJS.bind("init.rte", function() {
        if(AJS.Meta.get("content-type") !== "template") return;

        var variableManager = Confluence.VariableManager.defaultVariableManager;
        var menu = $('#template-menu');
        var variableList = menu.find('.variables-list');

        AJS.bind('add.confluence-variable,delete.confluence-variable,rename.confluence-variable', function(e, v) {
            // Simple implementation - just reload the div
            var variables = variableManager.getSortedNames();
            var len = variables.length;
            var items = "";
            variableList.toggleClass('hidden', !len);

            for(var i = 0; i < len; i++) {
                items += Confluence.Templates.Variables.renderVariableItem({
                    variableName : '$' + variables[i],
                    tooltip : AJS.format("Insert the \'\'{0}\'\' field into the page for the template user to fill out.", variables[i])
                });
            }

            variableList.html(items);
        });

        menu.delegate('.variables-list a', 'click', function() {
            var name = $(this).attr('data-variable-name');
            !variableManager.contains(name) && variableManager.add(name);
            Confluence.VariablePlaceHolder.insertPlaceholder(name);
        });

        menu.delegate('.variables-add', 'click', function(e) {
            var inputDrivenDropdown = Confluence.Editor.Autocompleter.Manager.getInputDrivenDropdown();
            AJS.Rte.getEditor().focus();
            if (!inputDrivenDropdown || inputDrivenDropdown.inactive) {
                Confluence.Editor.Autocompleter.Manager.shortcutFired("$", true);
            }
            e.stopPropagation();
        });

        AJS.$(document).bind("showLayer", function(event, type, dd) {
            if(type === "dropdown" && dd.$.closest(menu).length) {
                // is template menu drop down - reset to ensure hover highlights work
                dd.reset();
            }
        });
    });
})(AJS.$);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-templates:template-editor-variables-resources', location = 'js/tinyMce-autocomplete-settings-variables.js' */

/**
 * Settings that each Autocomplete will be initialized on, depending on the trigger character used to activate the
 * autocomplete.
 */
AJS.bind("init.rte", function() {

    if(AJS.Meta.get("content-type") !== "template") return;

    // Confluence 4.1.x uses tinymce.confluence, 4.2 onwards use Confluence.Editor
    if (!Confluence.Editor.Autocompleter) {
        Confluence.Editor.Autocompleter = tinymce.confluence.Autocompleter;
    }

    var variableManager = Confluence.VariableManager.defaultVariableManager;
    var autoComplete = Confluence.Editor.Autocompleter;

    function makeVariableDropdownItem(name, additionalAttrs) {
        var item = {
            callback: function(autoCompleteControl) {
                autoCompleteControl.replaceWithSelectedSearchText();
                createVariable(name, additionalAttrs);
            },
            name : AJS.escapeHtml(name),
            href : '#'
        };

        return item;
    };

    function createVariable(name, additionalAttrs) {
        !variableManager.contains(name) && variableManager.add(name);
        Confluence.VariablePlaceHolder.insertPlaceholder(name, additionalAttrs);
    }

    function ignoreCaseComparator(a, b) {
        if(!a && !b) return 0;
        if(!a) return -1;
        if(!b) return 1;

        return a.toLocaleLowerCase().localeCompare(b.toLocaleLowerCase());
    }

    // Link settings.
    Confluence.Editor.Autocompleter.Settings["$"] = {

        ch : "$",
        cache: false,
        endChars : [],
        dropDownDelay: 0, // No delay needed because there is no AJAX request involved
        preventStartNodes: "",

        dropDownClassName: "autocomplete-variables",
        selectFirstItem: true,

        getHeaderText : function (autoCompleteControl, value) {
            if (value)
            {
                return "Variable suggestions";
            }
            else
            {
                return "Variable suggestions";
            }
        },

        getAdditionalLinks : function (autoCompleteControl, value) {
            var unescapedValue = Confluence.unescapeEntities(value);
            if(variableManager.get(unescapedValue) || value.length == 0) {
                // Variable exists or has no value yet.
                return [];
            }
            return [
                {
                    className: "dropdown-create-variable",
                    href: '#',
                    callback: function(autoCompleteControl) {
                        var searchText = autoCompleteControl.plainText();
                        autoCompleteControl.replaceWithSelectedSearchText();
                        createVariable(searchText);
                    },
                    name : AJS.format("Create variable \'\'{0}\'\'", value)
                }
            ];
        },

        getDataAndRunCallback : function(autoCompleteControl, val, callback) {
            var k, i, l;
            var unescapedVal = Confluence.unescapeEntities(val);
            var variables = variableManager.find(unescapedVal);
            var sortedVariables = [];
            var dropdownItems = [];

            for(var k in variables) {
                if(variables.hasOwnProperty(k)) {
                    sortedVariables.push(k);
                }
            }
            sortedVariables.sort(ignoreCaseComparator);
            for(i = 0, l = sortedVariables.length; i < l; i++) {
                k = sortedVariables[i];
                dropdownItems.push(makeVariableDropdownItem(k, variables[k]));
            }
            callback([dropdownItems], val);
        },

        update : function(autoCompleteControl, link) {
        }
    }

});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-templates:template-editor-variables-resources', location = 'js/tinyMce-property-panel-variables.js' */
(function($) {
    AJS.Confluence.PropertyPanel.Variable = (function() {
        return {
            name : "variable",

            canHandleElement : function ($element) {
                return $element.hasClass("template-variable");
            },

            handle : function (data) {
                if (data.e.type != "click" && data.e.type != "mouseup") { // only activate this panel on click
                    return;
                }

                var variableNode = data.containerEl,
                    $variableNode = $(variableNode);

                var variableName, variableButtons = [];

                var buttons = [],
                    options = {
                        originalHeight : $variableNode.height(),
                        anchorIframe: AJS.Rte.getEditorFrame()
                    };

                variableName = $variableNode.attr("data-variable-name");

                var variableManager = Confluence.VariableManager.defaultVariableManager;
                var variable = variableManager.get(variableName);
                var variableType = (variable && variable.type) || "string";

                function changeType(type) {
                    variable = variableManager.createDefault(type);
                    variableManager.add(variableName, variable);
                    $('.variable-property-panel-type-item').removeClass('selected');
                    $('.variable-property-panel-type-' + type).addClass('selected');
                    refreshPanel(type);
                }

                function refreshPanel(type) {
                    AJS.debug('clicked type: ' + type);
                    var pp = $('#property-panel');

                    pp.find('.panel-buttons').toggleClass('no-inputs', type === 'string');
                    pp.find('.textarea-section,.list-section,.string-section').addClass('hidden');
                    pp.find('.' + type + '-section').removeClass('hidden');
                    if(type === "textarea") {
                        $('#variable-property-panel-textarea-rows').val(variable.rows);
                        $('#variable-property-panel-textarea-columns').val(variable.columns);
                    } else if(type === "list") {
                        $('#variable-property-panel-list-values').val(variable.options.join(","));
                    }
                }

                function createTypeButton(type, text, tooltip) {
                    return {
                        className: "variable-property-panel-type-item variable-property-panel-type-" + type,
                        text: text,
                        tooltip: tooltip,
                        selected: variableType === type,
                        click: function() {
                            variable.type = type;
                            changeType(type);
                        }
                    };
                }

                function typeHiddenClass(type) {
                    return (variableType === type) ? "" : " hidden";
                }

                buttons.push(createTypeButton("string", "Text", "Single line text input field."));
                buttons.push(createTypeButton("textarea", "Multi-line Text", "Multi-line text input field."));
                buttons.push(createTypeButton("list", "List", "Drop down list."));
                buttons.push(null);
                buttons.push({
                    className: "editable textarea-section" + typeHiddenClass("textarea"),
                    tooltip: "Number of rows to display for the field.",
                    html: "<input id=\"variable-property-panel-textarea-rows\"/>"
                });
                buttons.push({
                    className: "variable-property-panel-textarea-split textarea-section" + typeHiddenClass("textarea"),
                    tooltip: "",
                    html: "<span>x</span>"
                });
                buttons.push({
                    className: "editable textarea-section" + typeHiddenClass("textarea"),
                    tooltip: "Number of columns to display for the field.",
                    html: "<input id=\"variable-property-panel-textarea-columns\"/>"
                });
                buttons.push(null);
                buttons.push({
                    className: "editable list-section" + typeHiddenClass("list"),
                    tooltip: "Enter each item for the list, separating each with a comma.",
                    html: "<input id=\"variable-property-panel-list-values\" size='50'/>"
                });

                AJS.Confluence.PropertyPanel.createFromButtonModel("variable", variableNode, buttons, options);

                refreshPanel(variable.type);

                $('#variable-property-panel-textarea-rows').change(function() {
                    variable.rows = +$(this).val() || Confluence.VariableManager.defaults.textarea.rows;
                });
                $('#variable-property-panel-textarea-columns').change(function() {
                    variable.columns = +$(this).val() || Confluence.VariableManager.defaults.textarea.columns;
                });
                $('#variable-property-panel-list-values').change(function() {
                    var i, l, v;
                    var opts = $(this).val().split(',');
                    variable.options = [];
                    for(i = 0, l = opts.length; i < l; i++) {
                        // trim and filter empty values
                        v = $.trim(opts[i]);
                        v && variable.options.push(v);
                    }
                });
                $('#variable-property-panel-textarea-rows,#variable-property-panel-textarea-columns,#variable-property-panel-list-values').keypress(function(e) {
                    if(e.which === 13) {
                        $(this).blur();
                    }
                });
            }

        }})();
})(AJS.$);

AJS.bind("init.rte", function() {
    // defer trigger to ensure any listeners have had a chance to load.
    AJS.trigger("add-handler.property-panel", AJS.Confluence.PropertyPanel.Variable);
});

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-templates:template-editor-variables-resources', location = 'js/variable-marshaller.js' */
(function($) {
    if(AJS.Meta.get("content-type") !== "template") return;

    var DEFAULT_ROWS = 5;
    var DEFAULT_COLUMNS = 100;

    function toVariable(li) {
        var type = li.attr('data-variable-type');
        if(type === "textarea") {
            return {
                type: type,
                rows: +li.attr('data-variable-rows') || DEFAULT_ROWS,
                columns: +li.attr('data-variable-columns') || DEFAULT_COLUMNS
            };
        } else if (type === "list") {
            return {
                type: type,
                options : li.find('li').map(function() { return $(this).attr('data-variable-option'); }).toArray()
            }
        }
        return {
            type: "string" // be explicit in case a bad / missing type
        };
    }

    function encodeVariable(name, details) {
        var optionsGroup, optionLi;
        var type = details.type;
        var li = AJS.$('<li></li>');
        li.attr('data-variable-name', name);
        li.attr('data-variable-type', type);
        li.text(name);
        if(type === "textarea") {
            li.attr('data-variable-rows', details.rows);
            li.attr('data-variable-columns', details.columns);
        } else if (type === "list") {
            optionsGroup = $('<ul></ul>');
            for(var option in details.options) {
                var val = details.options[option];
                optionLi = $('<li></li>').text(val).attr('data-variable-option', val);
                optionsGroup.append(optionLi);
            }
            li.append(optionsGroup);
        }
        return li;
    }

    function getUsedVariables() {
        var usages = $(AJS.Rte.getEditor().getBody()).find('img[data-variable-name]');
        var used = {};
        $.map(usages, function(el) {
            var attrs = {};
            if ($(el).attr("data-variable-raw-xhtml")) {
                attrs = {"data-variable-raw-xhtml": true};
            }
            used[$(el).attr('data-variable-name')] = attrs;
        });
        return used;
    }

    AJS.bind("init.rte", function() {

        var ed = AJS.Rte.getEditor();
        var edBody = $(ed.getBody());
        var dGroup, dec;
        var varMgr = Confluence.VariableManager.defaultVariableManager;

        function addUndeclaredVariables(inUse) {
            for(var used in inUse) {
                if(inUse.hasOwnProperty(used)) {
                    if(!varMgr.contains(used)) {
                        AJS.debug('adding: ', used);
                        varMgr.add(used, inUse[used]);
                    }
                }
            }
        }

        ed.onGetContent.add(function(ed, o) {
            var variableDeclaration = $('<div></div>');
            var ul = $('<ul></ul>').attr('data-variable-declarations', 'true');
            var li;

            variableDeclaration.append(ul);

            var inUse = getUsedVariables();

            // Handle case of variables missing from variable manager (e.g. copy and paste)
            addUndeclaredVariables(inUse);

            var variables = varMgr.getAll();
            for(var variable in variables) {
                if(inUse.hasOwnProperty(variable)) {
                    li = encodeVariable(variable, variables[variable]);
                    ul.append(li);
                }
            }

            o.content = variableDeclaration.html() + o.content;
        });

        // Extract declared variables
        dGroup = edBody.find('ul[data-variable-declarations]');
        dGroup.remove();
        dec = dGroup.find('li[data-variable-name]');
        dec.each(function() {
            var el = $(this);
            varMgr.add(el.attr('data-variable-name'), toVariable(el));
        });
        // Cover case where there's undeclared variables (e.g. a blueprint missing some declarations)
        addUndeclaredVariables(getUsedVariables());
    });

})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-templates:template-editor-variables-template-resources', location = 'js/variable-templates.soy' */
// This file was automatically generated from variable-templates.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.Variables == 'undefined') { Confluence.Templates.Variables = {}; }


Confluence.Templates.Variables.renderVariableItem = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li class="dropdown-item" data-tooltip="', soy.$$escapeHtml(opt_data.tooltip), '"><a href="#" class="item-link variable-item" title="', soy.$$escapeHtml(opt_data.variableName), '" data-variable-name="', soy.$$escapeHtml(opt_data.variableName), '">', soy.$$escapeHtml(opt_data.variableName), '</a></li>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.image.effects.ImageEffectsPlugin:propertiespanel', location = 'com/atlassian/confluence/image/effects/property-panel.js' */
AJS.toInit(function(e){var p,i=/(\?|\&)(effects\=[^&]+)($|&)/,t=/(^|\&)(effects\=([^&]+))($|&)/,s=null,j=[],h=2000;q();if(Confluence.Editor.ImageProps){f()}else{l()}function f(){AJS.bind("dialog-created.image-properties",function(x,y){p=y.img;var z="image-effects",w="image-effects-panel";if(!a()){Confluence.Editor.ImageProps.registerPanel(z,c("Image effects can\'t be applied to web images"),w,null)}else{if(!n()){Confluence.Editor.ImageProps.registerPanel(z,c("The image\'s dimensions are too large to apply effects.\nThe width and height must be under 2000 pixels."),w,null)}else{Confluence.Editor.ImageProps.registerPanel("image-effects",c(),"image-effects-panel",r)}}});AJS.bind("dialog-before-show.image-properties",function(){b();o(m(e(p)))})}function l(){var w=new AJS.Dialog({width:600,height:500,id:"image-effects-dialog"});w.addHeader("Add Image Effect");w.addPanel("",c(),"");b();w.addSubmit("Save",function(){var x=v();x.done(function(){w.hide()})});w.addCancel("Close",function(){w.hide()});AJS.Confluence.PropertyPanel.Image.pluginButtons.push(null,{create:function(x){p=x[0];var z=m(x),y=!a();return{className:"image-effects",text:"Effects...",tooltip:y?"Image effects can\'t be applied to web images":"Add an image effect like drop shadow or picture frame",click:function(){if(!n()){alert("The image\'s dimensions are too large to apply effects.\nThe width and height must be under 2000 pixels.");return false}o(m(e(p)));AJS.Confluence.PropertyPanel.destroy();w.show()},disabled:y,selected:!!z}}})}function g(y,A){var B=y.attr("src");var x=i.exec(B);var w=A?"effects="+A:"";if(x){B=B.replace(x[2],w)}else{if(A){B=B+(B.indexOf("?")!=-1?"&":"?")+w}}y.attr("src",B);y.attr("data-mce-src",B);var z=y.attr("confluence-query-params");if(z){var x=t.exec(z);if(x){z=z.replace(x[2],w)}else{z=z+"&"+w}}else{z=w}y.attr("confluence-query-params",z)}function m(x){var y=x.attr("confluence-query-params");var w=t.exec(y);if(w){return w[3]}}function o(w){e(".image-effect-preview.selected").removeClass("selected");if(w){e(j).each(function(x,y){if(y.effects==w){e(e(".image-effect-preview")[x]).addClass("selected");return false}})}else{e(".image-effect-preview.image-effect-none").addClass("selected")}s=w}function q(){j.push({name:"None",effects:null});j.push({name:"Taped",effects:"border-simple,blur-border,tape"});j.push({name:"Instant Camera",effects:"border-polaroid,blur-border"});j.push({name:"Curl Shadow",effects:"border-simple,shadow-kn"});j.push({name:"Snapshot",effects:"border-simple,blur-border"});j.push({name:"Drop Shadow",effects:"drop-shadow"})}function c(w){if(w){return'<div class="aui-message warning"><span class="aui-icon icon-warning"></span>'+w+"</div>"}return'<div class="image-effects"><ul class="image-list"></ul></div>'}function b(){var x=e("div.image-effects ul.image-list");var z=Math.floor(Math.random()*22)+1;for(var y=0;y<j.length;y++){var w=e('<li class="attached-image image-effect-preview'+(!j[y].effects?" image-effect-none":"")+'"><div class="image-container"><img class="thumbnail" src="'+AJS.contextPath()+"/plugins/servlet/imgFilter.png?preview=true&id="+z+"&effects="+j[y].effects+'" title="'+j[y].name+'" style="margin-top: 5px"></div><span class="caption filename" title="'+j[y].name+'">'+j[y].name+"</span></li>");w.hover(function(){e(this).addClass("hover")},function(){e(this).removeClass("hover")});x.append(w);var A=j[y];w.click(A,function(B){e(".image-effect-preview.selected").removeClass("selected");e(this).addClass("selected");s=B.data.effects})}}function a(){return !e(p).hasClass("confluence-external-resource")}function n(){return !(p.naturalHeight&&p.naturalWidth&&(p.naturalHeight*p.naturalWidth)>(h*h))}function r(){return u()}function v(){return u(d,k)}function u(w,z){var y=e.Deferred();w&&w();p.onload=A;var x=p.src;g(e(p),s);if(p.src==x){A()}function A(){z&&z();y.resolve();p.onload=null;tinyMCE.activeEditor.undoManager.add()}return y}function d(){var z=e("#image-effects-dialog"),w=50,x=e('<div class="image-effects-loading-blanket"><div class="loading-data"></div></div>').appendTo(z.find(".dialog-page-body")),y=x.find(".loading-data");x.css({width:x.parent().width(),height:z.height()});y.css({marginTop:-w*1.2,marginLeft:-w*1.2});y.data("spinner",Raphael.spinner(y[0],w,"#666"))}function k(){var w=e(".image-effects-loading-blanket .loading-data"),x=w.data("spinner");w.css({marginTop:"",marginLeft:""});if(x){x();delete x;w.data("spinner",null)}w.closest(".image-effects-loading-blanket").remove()}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.profile-picture:profile-picture-editor_resources', location = 'js/profile-picture.js' */
AJS.bind("init.rte", function() {
    AJS.Confluence.PropertyPanel.Macro.registerButtonHandler("viewProfile", function(e, macroNode) {
        var $macroDiv = AJS.$(macroNode);

        var params = {};
        if ($macroDiv.attr("data-macro-parameters")) {
            AJS.$.each($macroDiv.attr("data-macro-parameters").split("|"), function(idx, item) {
                var param = item.split("=");
                params[param[0]] = param[1];
            });
        }
        window.open(AJS.Confluence.getBaseUrl() + "/display/~" + params["user"]);
    });
});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:inline-tasks-editor', location = 'js/editor_plugin_src.js' */
(function(b){var c=/^\u200b?(\[)$/;AJS.bind("confluence.editor.registerHandlers",function(n,m){if(!AJS.Rte.Support.inlineTasks()){return}var k=m.handlerManager,j=m.ed,l=m.createHandler;k.registerHandler("]".charCodeAt(0),l(c,function(){j.plugins.lists.applyList("UL","OL","inline-task-list",{attributesOnItems:{"data-inline-task-id":""},placeholderText:"Type your task here, using \"@\" to assign to a user and \"\/\/\" to select a due date"})},true))});function e(j){j.plugins.lists.applyList=_.bind(_.wrap(j.plugins.lists.applyList,function(k){k.apply(this,Array.prototype.slice.call(arguments,1));g(j)}),j.plugins.lists)}function g(j,l){if(!(tinymce.isIE8||tinymce.isIE11||tinymce.isGecko||tinymce.isWebKit)){return}var k=l||b(d(j));if(k.height()===0||tinymce.isIE8){k.append("&nbsp;");(tinymce.isWebKit||tinymce.isIE8)&&j.selection.setCursorLocation(k[0],0)}}function h(m,k){var j,n,l;if(tinymce.isGecko){l=k.getBoundingClientRect();j=m.pageX-(l.left+tinymce.DOM.getViewPort(tinymce.activeEditor.getWin()).x);n=m.pageY-(l.top+tinymce.DOM.getViewPort(tinymce.activeEditor.getWin()).y)}else{if(tinymce.isIE8){j=m.offsetX-k.offsetLeft;n=m.offsetY-k.offsetTop}else{j=m.offsetX;n=m.offsetY}}return j>=3&&j<=14&&n>=3&&n<=14}function i(j,m){var k=m.target;if(k.tagName!=="LI"){return}var l=j.dom.getParent(k,"ul,ol");if(l.tagName==="UL"&&j.dom.hasClass(l,"inline-task-list")){if(h(m,k)){if(j.dom.hasClass(k,"checked")){j.dom.removeClass(k,"checked")}else{j.dom.addClass(k,"checked")}}}}function d(k){var l=k.selection.getStart();var j=(l&&l.tagName&&l.tagName.toUpperCase()==="LI")?l:k.dom.getParent(l,"li");return j}function a(k,l){if(l.keyCode===tinymce.VK.ENTER&&!l.shiftKey){var j=d(k);if(j){var m=b(j);if(k.dom.hasClass(j.parentNode,"inline-task-list")){m.removeClass("checked").attr("data-inline-task-id","")}else{m.removeClass("checked").removeAttr("data-inline-task-id")}g(k,m)}}}function f(k,l){var j=d(k);if(j){var m=b(j);if(k.dom.hasClass(j.parentNode,"inline-task-list")){m.find("font").contents().unwrap()}}}tinymce.create("tinymce.plugins.ConfluenceTaskListPlugin",{init:function(j,k){e(j);j.onClick.add(i);j.onKeyUp.add(a);if(tinymce.isIE){j.onKeyUp.add(f)}},getInfo:function(){return{longname:"Confluence Task List Plugin",author:"Atlassian",authorurl:"http://www.atlassian.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("confluencetasklist",tinymce.plugins.ConfluenceTaskListPlugin);AJS.Editor.Adapter.addTinyMcePluginInit(function(j){j.plugins+=",confluencetasklist"})})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:inline-tasks-editor', location = 'js/inline-tasks-rte.js' */
(function(c){function a(e){var d=c(e).find("li[data-inline-task-id]");d.each(function(){var g=c(this),f=g.parent();if(!f.is("ul")){f.wrapInner('<ul class="inline-task-list"/>')}else{if(!f.hasClass("inline-task-list")){f.addClass("inline-task-list")}}})}function b(e){a(e);var g=AJS.Meta.get("content-type"),f=c(e).find("ul.inline-task-list"),d=f.find("> li");if(g=="comment"){d.removeClass("checked").removeAttr("data-inline-task-id");f.removeClass("inline-task-list")}else{d.attr("data-pasted-task","true")}}c(document).bind("postPaste",function(f,d,g){b(g.node)})})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:date-helper-js-resources', location = '/js/lib/lang/de.js' */
(function(a){if(typeof define==="function"&&define.amd){define(["moment"],a)}else{if(typeof exports==="object"){module.exports=a(require("../moment"))}else{a(window.moment)}}}(function(b){function a(e,d,c,g){var f={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[e+" Tage",e+" Tagen"],M:["ein Monat","einem Monat"],MM:[e+" Monate",e+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[e+" Jahre",e+" Jahren"]};return d?f[c][0]:f[c][1]}return b.lang("de",{months:"Januar_Februar_März_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Febr._Mrz._Apr._Mai_Jun._Jul._Aug._Sept._Okt._Nov._Dez.".split("_"),weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),longDateFormat:{LT:"H:mm [Uhr]",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[Heute um] LT",sameElse:"L",nextDay:"[Morgen um] LT",nextWeek:"dddd [um] LT",lastDay:"[Gestern um] LT",lastWeek:"[letzten] dddd [um] LT"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",m:a,mm:"%d Minuten",h:a,hh:"%d Stunden",d:a,dd:a,M:a,MM:a,y:a,yy:a},ordinal:"%d.",week:{dow:1,doy:4}})}));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:date-helper-js-resources', location = '/js/lib/lang/es.js' */
(function(a){if(typeof define==="function"&&define.amd){define(["moment"],a)}else{if(typeof exports==="object"){module.exports=a(require("../moment"))}else{a(window.moment)}}}(function(c){var b="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),a="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_");return c.lang("es",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(d,e){if(/-MMM-/.test(e)){return a[d.month()]}else{return b[d.month()]}},weekdays:"domingo_lunes_martes_miércoles_jueves_viernes_sábado".split("_"),weekdaysShort:"dom._lun._mar._mié._jue._vie._sáb.".split("_"),weekdaysMin:"Do_Lu_Ma_Mi_Ju_Vi_Sá".split("_"),longDateFormat:{LT:"H:mm",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY LT",LLLL:"dddd, D [de] MMMM [de] YYYY LT"},calendar:{sameDay:function(){return"[hoy a la"+((this.hours()!==1)?"s":"")+"] LT"},nextDay:function(){return"[mañana a la"+((this.hours()!==1)?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+((this.hours()!==1)?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+((this.hours()!==1)?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+((this.hours()!==1)?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un día",dd:"%d días",M:"un mes",MM:"%d meses",y:"un año",yy:"%d años"},ordinal:"%dº",week:{dow:1,doy:4}})}));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:date-helper-js-resources', location = '/js/lib/lang/fr.js' */
(function(a){if(typeof define==="function"&&define.amd){define(["moment"],a)}else{if(typeof exports==="object"){module.exports=a(require("../moment"))}else{a(window.moment)}}}(function(a){return a.lang("fr",{months:"janvier_février_mars_avril_mai_juin_juillet_août_septembre_octobre_novembre_décembre".split("_"),monthsShort:"janv._févr._mars_avr._mai_juin_juil._août_sept._oct._nov._déc.".split("_"),weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"Di_Lu_Ma_Me_Je_Ve_Sa".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[Aujourd'hui à] LT",nextDay:"[Demain à] LT",nextWeek:"dddd [à] LT",lastDay:"[Hier à] LT",lastWeek:"dddd [dernier à] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},ordinal:function(b){return b+(b===1?"er":"")},week:{dow:1,doy:4}})}));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:date-helper-js-resources', location = '/js/lib/lang/ja.js' */
(function(a){if(typeof define==="function"&&define.amd){define(["moment"],a)}else{if(typeof exports==="object"){module.exports=a(require("../moment"))}else{a(window.moment)}}}(function(a){return a.lang("ja",{months:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"日曜日_月曜日_火曜日_水曜日_木曜日_金曜日_土曜日".split("_"),weekdaysShort:"日_月_火_水_木_金_土".split("_"),weekdaysMin:"日_月_火_水_木_金_土".split("_"),longDateFormat:{LT:"Ah時m分",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日LT",LLLL:"YYYY年M月D日LT dddd"},meridiem:function(b,d,c){if(b<12){return"午前"}else{return"午後"}},calendar:{sameDay:"[今日] LT",nextDay:"[明日] LT",nextWeek:"[来週]dddd LT",lastDay:"[昨日] LT",lastWeek:"[前週]dddd LT",sameElse:"L"},relativeTime:{future:"%s後",past:"%s前",s:"数秒",m:"1分",mm:"%d分",h:"1時間",hh:"%d時間",d:"1日",dd:"%d日",M:"1ヶ月",MM:"%dヶ月",y:"1年",yy:"%d年"}})}));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:date-helper-js-resources', location = '/js/lib/lang/en-gb.js' */
(function(a){if(typeof define==="function"&&define.amd){define(["moment"],a)}else{if(typeof exports==="object"){module.exports=a(require("../moment"))}else{a(window.moment)}}}(function(a){return a.lang("en-gb",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd, D MMMM YYYY LT"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(e){var c=e%10,d=(~~(e%100/10)===1)?"th":(c===1)?"st":(c===2)?"nd":(c===3)?"rd":"th";return e+d},week:{dow:1,doy:4}})}));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:date-helper-js-resources', location = '/js/inline-tasks-util.js' */
(function(a){var b=window.Confluence||{};b.InlineTasks=b.InlineTasks||{};b.InlineTasks.Util={NODE_TYPE:{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12},KEY:{BACKSPACE:8,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,INS:45,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESCAPE:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,META:91},addContentEditableIfApplicable:function(d){var c=a(d);c.attr({contenteditable:false,"class":"non-editable",onselectstart:"return false;"});tinymce.isIE&&c.attr({contenteditable:true,unselectable:"on",oncontrolselect:"return false;"})}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:date-helper-js-resources', location = '/js/dateutil.js' */
var Confluence=window.Confluence||{};Confluence.InlineTasks=Confluence.InlineTasks||{};Confluence.InlineTasks.DateUtil=(function(b,a){a={PATTERN_INSERTING:"DD-MM-YYYY",PATTERN_LOZENGE:"DD MMM YYYY",PATTERN_INSIDE_TIME_ELE:"YYYY-MM-DD",convertDateIntoHtml:function(e,f,g,h){if(!h){h=a.PATTERN_INSERTING}if(!g){g=""}if(!f){f="<time>"}var c=b("<div>"),d="",i=e.format(h);if(f.indexOf("time")>=0){d=b(f,{datetime:e.format(a.PATTERN_INSIDE_TIME_ELE)});Confluence.InlineTasks.Util.addContentEditableIfApplicable(d);g&&d.attr("class",g);d.text(i)}else{d=b(f);g&&d.attr("class",g);d.text(i)}c.append(d);return c.html()},insertDateIntoCurrentCursor:function(f,d,l,k,m){var i=tinyMCE.activeEditor,j=a.convertDateIntoHtml(f,d,l,k),e=b(j,i.getDoc())[0],g=tinymce.confluence.NodeUtils.replaceSelection(e);if(m){i.execCommand("mceInsertContent",false,m,{skip_undo:true})}var c=b(i.selection.getRng(true).startContainer).closest("li[data-inline-task-id]").length?"task":"page";var h={context:c,trigger:"character"};AJS.Analytics?AJS.Analytics.triggerPrivacyPolicySafeEvent("confluence-spaces.date.added",h):AJS.trigger("analyticsEvent",{name:"confluence-spaces.date.added",data:h});return g},parse:function(d,e){if(!e){e=a.PATTERN_INSIDE_TIME_ELE}var c=moment(b.trim(d),e,true);return c.isValid()?c:null},format:function(c,d){if(!d){d=a.PATTERN_INSIDE_TIME_ELE}return c?c.format(d):null},guessPartialDate:function(c,g){if(c==null){return null}c=b.trim(c.replace(/[-\.\/]/g,"-"));var f=c.split("-"),e=moment().format(g).split("-");for(var d=0;d<3;d++){if(!f[d]){f[d]=e[d]}if(/^\d$/.test(f[d])){f[d]="0"+f[d]}}return a.parse(f.join("-"),g)},datepicker:{POSITION_ABOVE:true,POSITION_BELOW:false,POSITION_RIGHT:true,POSITION_LEFT:false,dropDownStillFitsVertically:function(d,e,c){if(d===this.POSITION_ABOVE){return e.above>=c}return e.below>=c},dropDownStillFitsHorizontally:function(d,e,c){if(d===this.POSITION_RIGHT){return e.right>=c}return e.left>=c},getPreferredHorizontalPosition:function(d,c){if(d.right>=c){return this.POSITION_RIGHT}else{if(d.left>=c){return this.POSITION_LEFT}}return d.right>d.left?this.POSITION_RIGHT:this.POSITION_LEFT},getPreferredVerticalPosition:function(d,c){if(d.below>=c){return this.POSITION_BELOW}else{if(d.above>=c){return this.POSITION_ABOVE}}return d.below>d.above?this.POSITION_BELOW:this.POSITION_ABOVE},calculateDatepickerPosition:function(c){var d=this;return function(f,o){var l,p,r,i,j,s=16,u=0,e,h,k,m,n=AJS.Rte.getEditorFrame();AJS.Position.spaceLeftRight=function(z,y){var x=y.position().left;return{left:x,right:b(z).width()-x}};l=AJS.Position.spaceAboveBelow(n,c);p=AJS.Position.spaceLeftRight(n,c);j=AJS.Rte.Content.offset(c);e=f.outerHeight(true);h=f.outerWidth(true);k=e+s;m=h+u;var w=d.POSITION_BELOW;var v=d.POSITION_RIGHT;if(w){if(!d.dropDownStillFitsVertically(w,l,k)){w=null}}if(!w){w=d.getPreferredVerticalPosition(l,k)}if(v){if(!d.dropDownStillFitsHorizontally(v,p,k)){v=null}}v=d.getPreferredHorizontalPosition(p,m);if(w===d.POSITION_ABOVE){r=j.top-e-s}else{r=j.top+c.height()+s}if(v===d.POSITION_RIGHT){i=j.left-u}else{i=(j.left+c.outerWidth())-h}var t={top:r,left:i};var g=(v==d.POSITION_RIGHT)?c.outerWidth()/2:h-c.outerWidth()/2;if((g<0)||(g>h)){g=(h/10)}var q={left:g,top:(w===d.POSITION_ABOVE)?e:-s/2};return{displayAbove:w,popupCss:t,arrowCss:q}}},getHintTextOfDatePicker:function(c){return c?"Select a due date for this task.":"Select a date."},create:function(k){var j=k.$attachTo,d=k.$positionTo,c=k.startDate,i=k.onSelect,e=k.isSetDueDate;var h=b("<input>").attr("type","date").addClass("aui-date-picker").css("display","none");var g=h.datePicker({overrideBrowserDefault:true,dateFormat:"yy-mm-dd",languageCode:AJS.Meta.get("user-locale")&&AJS.Meta.get("user-locale").split("_")[0],position:this.calculateDatepickerPosition(d),onSelect:function(l){i(a.parse(l));f()},hint:this.getHintTextOfDatePicker(e)});var f=function(){g&&g.destroyPolyfill&&g.destroyPolyfill();h&&h.remove();b(".aui-datepicker-dialog").remove();g=null;h=null};g.show();g.setDate(a.format(c));b(".aui-datepicker-dialog .aui-datepicker-hint").addClass(e?"set-duedate":"set-date");j.before(h);return{die:function(){f()},show:function(){g.show()},hide:function(){g.hide()},getContainer:function(){return h},setDate:function(m){var l=a.guessPartialDate(m,a.PATTERN_INSERTING);AJS.debug("Set date: "+m);l&&g.setDate(a.format(l))},placeDatePicker:function(){var m=AJS.InlineDialog.current;var l=m&&m.popup;l&&l.refresh()}}}}};return a}(AJS.$,Confluence.InlineTasks.DateUtil||{}));AJS.toInit(function(){var b=function(g,d,f){if(d&&d.toLowerCase()==="en_us"){return"MM"+f+"DD"+f+"YYYY"}var e=_.uniq(g.replace(/[^MDY]/g,"").split(""));return e.join(f).replace("D","DD").replace("M","MM").replace("Y","YYYY")};var c=AJS.Meta.get("user-locale");if(c){moment.lang(c.split("_")[0].toLowerCase())}var a=AJS.Meta.get("user-date-pattern");if(a){Confluence.InlineTasks.DateUtil.PATTERN_LOZENGE=a.toUpperCase();Confluence.InlineTasks.DateUtil.PATTERN_INSERTING=b(a.toUpperCase(),c,"-");Confluence.InlineTasks.DateUtil.PATTERN_INSERTING_ALTERNATE=b(a.toUpperCase(),c,"/")}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:editor-autocomplete-date-js', location = '/js/editor-plugin/date-autocomplete-help-dialog.js' */
AJS.toInit(function(){if(!(Confluence.KeyboardShortcuts&&Confluence.KeyboardShortcuts.Autoformat)){return}Confluence.KeyboardShortcuts.Autoformat.push({action:"//",context:"autoformat.autocomplete",description:"Date"})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:editor-autocomplete-date-js', location = '/js/editor-plugin/autocomplete-manager.js' */
(function(d){var e=window.Confluence||{};e.Editor=e.Editor||{};e.Editor.AutoComplete=e.Editor.AutoComplete||{};var b=e.InlineTasks.Util.KEY,a=e.InlineTasks.DateUtil,c=e.Editor.AutoComplete;c.SETTING_DEFAULT={leadingChar:"",isDataValid:function(f){return false},backWords:0,onBeforeDie:function(){},onAfterStart:function(){},onScroll:function(){}};c.Manager=function(f){this.ed=AJS.Rte.getEditor();this.settings=d.extend({},c.SETTING_DEFAULT,f);this.log=AJS.debug;this.control=null};c.Manager.prototype={start:function(f){this.log("startAutoComplete - Started");var g=d.extend({},this.settings,f);this.control=e.Editor.Autocompleter.Control(this.ed,g);if(!this.control){return false}this.attachEventsToControl();g.onAfterStart&&g.onAfterStart({date:f.date,isTriggerFromOrphan:f.isTriggerFromOrphan?true:false});return true},attachEventsToControl:function(){var i=this,l=i.control,h=i.log,g=i.settings;if(typeof this.settings.onBeforeDie==="function"){var k=this.control.die;this.control.die=function(){i.settings.onBeforeDie.apply(i.control,arguments);if(i.dateInserted()){k.apply(i.control,[true]);AJS.Analytics?AJS.Analytics.triggerPrivacyPolicySafeEvent("confluence-spaces.tasks.daterecognition.killed"):AJS.trigger("analyticsEvent",{name:"confluence-spaces.tasks.daterecognition.killed"})}else{k.apply(i.control,arguments)}}}var f=_.bind(_.throttle(i.settings.onScroll,40),this);var j={onBeforeKey:function(m,n){if(m.keyCode!==b.ESCAPE&&m.keyCode!==b.ENTER){i.control&&i.control.getContainer().addClass("isDirty")}if(m.keyCode===b.DOWN||m.keyCode===b.UP||m.keyCode===b.ENTER){tinymce.dom.Event.cancel(m);return false}if(m.keyCode===b.ESCAPE||m.keyCode===b.TAB||m.keyCode===b.BACKSPACE&&!n){h("autoCompleteControl.onBeforeKey - killing autoCompleteControl");this.die(m.keyCode===b.BACKSPACE);return false}return true},onKeyPress:function(p,q){var n=AJS.$.browser.msie?p.keyCode:p.which;if(p.keyCode===b.ENTER){tinymce.dom.Event.cancel(p);return false}var o=String.fromCharCode(n),m=AJS.indexOf(this.settings.endChars,o);if(m>=0){h("autoCompleteControl.onKeyPress - caught autocomplete-closing char - character");l.die()}return true},onAfterKey:function(o,p){var n=d("#autocomplete-trigger",i.control.getContainer()),m=n.text();if(n.length>0&&m!==i.settings.leadingChar){h("after","dying because of: trigger text is modified");i.reset();return false}if(o.keyCode===b.ENTER){if(g.isDataValid(p)){l.update(p)}else{h("autoCompleteControl.onAfterKey - closing autocomplete due to invalid data - "+p);l.die(false)}return false}if(i.dateInserted()&&(p.length>10)&&(!a.parse(p,[a.PATTERN_INSERTING,a.PATTERN_INSERTING_ALTERNATE]))){i.reset();return false}if(o.keyCode===b.SPACE){i.reset();return false}return true},onDeath:function(){i.reset()},onScroll:function(){if(!i.isAlive()){return}f()}};d.extend(l,j)},isAlive:function(){return this.control&&!this.control.dying},reset:function(){if(!this.control){return}this.control.die();this.control=null},dateInserted:function(f){if(f===true){return this.control.getContainer().addClass("hasDateInserted")}else{if(f===false){return this.control.getContainer().removeClass("hasDateInserted")}else{return this.control.getContainer().hasClass("hasDateInserted")}}},dirty:function(f){if(f===true){return this.control.getContainer().addClass("isDirty")}else{return this.control.getContainer().hasClass("isDirty")}},reattach:function(){var f=e.Editor.Autocompleter.Control.removeOrphanedControl();if(f&&f.leadingChar===this.settings.leadingChar){this.reset();return this.start({backWords:1,isTriggerFromOrphan:true})}return false}}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:editor-autocomplete-date-js', location = '/js/editor-plugin/date-autocomplete.js' */
(function(h,e){var q="dateautocomplete",m="tinymce.plugins.DateAutocomplete",p="mceConfInsertDateAutocomplete",k="//";var r=Confluence.InlineTasks.Util,n=r.NODE_TYPE,d=r.KEY,a=Confluence.InlineTasks.DateUtil,g=null,o=null,b=false,i=e.dom.TreeWalker;var j={initDateAutoCompleteObject:function(s){if(!Confluence.Editor.Autocompleter){Confluence.Editor.Autocompleter=e.confluence.Autocompleter}Confluence.Editor.Autocompleter.Settings[k]={ch:k,endChars:[],update:function(w,v){o.picker.die();var u=(v==a.PATTERN_INSERTING.toLowerCase())?moment():a.guessPartialDate(v,a.PATTERN_INSERTING);u&&a.insertDateIntoCurrentCursor(u,"<time>","",a.PATTERN_LOZENGE,"&nbsp;");if(o.dateInserted()){AJS.Analytics?AJS.Analytics.triggerPrivacyPolicySafeEvent("confluence-spaces.tasks.daterecognition.used"):AJS.trigger("analyticsEvent",{name:"confluence-spaces.tasks.daterecognition.used"})}o.reset();s.undoManager.add()}};var t={leadingChar:k,isDataValid:function(u){return !o.dirty()||a.guessPartialDate(u,a.PATTERN_INSERTING)!=null},onBeforeDie:function(){o.picker&&o.picker.die();if(o.control){var u=h(o.control.getContainer());if(!o.dirty()){u.find("#autocomplete-search-text").remove()}}},onAfterStart:function(v){if(v&&v.date){j.fillPlaceholderDateAutoComplete(s,v.date,true);o.dirty(true);o.dateInserted(true)}else{if(v&&!v.isTriggerFromOrphan){j.fillPlaceholderDateAutoComplete(s,a.PATTERN_INSERTING.toLowerCase(),false);o.dateInserted(false)}}var u=o.control.text();var w=a.guessPartialDate(u,a.PATTERN_INSERTING)||moment();j.bindDatePickerToAutoComplete(w)},onScroll:function(){o.picker&&o.picker.placeDatePicker()}};o=new Confluence.Editor.AutoComplete.Manager(t)},activateDateAutocomplete:function(u,t){if(!o.isAlive()){var s=o.start(t);if(!s){g.execCommand("mceInsertContent",false,k,{skip_undo:true});return false}}},bindDatePickerToAutoComplete:function(v){var s=o.control&&o.control.getContainer();if(!s.length){return}s.addClass("date-autocomplete");s.find("#autocomplete-search-text span").addClass("inserting");var u=function(w){o.control.update(w.format(a.PATTERN_INSERTING))},t=j.isInsideTaskAndFirstTimeNode(s);o.picker=a.datepicker.create({$attachTo:s,$positionTo:s,startDate:v,onSelect:u,isSetDueDate:t})},fillPlaceholderDateAutoComplete:function(t,w,v){var s=o.control.getContainer().find("#autocomplete-search-text span");s.text(AJS.Rte.HIDDEN_CHAR+w);var u=t.dom.createRng();u.setStart(s[0].firstChild,1);u.setEnd(s[0].firstChild,w.length+1);v&&u.collapse(false);t.selection.setRng(u)},registerTriggerDoubleSlash:function(s){s.addCommand(p,j.activateDateAutocomplete);AJS.bind("confluence.editor.registerHandlers",function(y,x){var v=x.handlerManager,u=x.ed,w=x.createHandler;var t=w(/(?:\s|\xA0|^|\ufeff|\u200b)(\/)$/,function(){u.execCommand(p,false,{},{skip_undo:true})},true,"#autocomplete");v.registerHandler("/".charCodeAt(0),t)})},isTimeNode:function(s){return s&&s.nodeType===n.ELEMENT_NODE&&s.tagName.toLowerCase()==="time"},getTimeNodeAtCursor:function(s){if(!s){s=g}var t=s.selection.getNode();if(j.isTimeNode(t)){return t}t=s.selection.getStart();if(j.isTimeNode(t)){return t}t=s.selection.getEnd();if(j.isTimeNode(t)){return t}},makeTimeNodesUnEditable:function(s){s.each(function(){var t=h(this);if(h.trim(t.text())===""){t.remove()}e.isWebKit&&t.remove("br.Apple-interchange-newline");r.addContentEditableIfApplicable(this)})},wrapTimeNodesWithHiddenChar:function(s){s.each(function(){var t=h(this);if(!this.previousSibling||this.previousSibling.nodeType!==n.TEXT_NODE||this.previousSibling.nodeValue===""){t.before(AJS.Rte.HIDDEN_CHAR)}if(!this.nextSibling||this.nextSibling.nodeType!==n.TEXT_NODE||this.previousSibling.nodeValue===""){t.after(AJS.Rte.HIDDEN_CHAR)}})},putCursorAtEdge:function(t,v,s){s=!!s;if(s){if(!v.nextSibling||v.nextSibling.nodeType!==n.TEXT_NODE){h(v).after(t.dom.doc.createTextNode(""))}}else{if(!v.previousSibling||v.previousSibling.nodeType!==n.TEXT_NODE){h(v).before(t.dom.doc.createTextNode(""))}}var u=t.selection.dom.createRng();u.selectNode(s?v.nextSibling:v.previousSibling);u.collapse(s);t.selection.setRng(u)},findFirstTimeNodeInClosestBlock:function(t,y,v){var x=new i(y,t.getBody());var w=y,u=0;do{if(u==1&&j.isTimeNode(y)){return y}var s=v?y.previousSibling:y.nextSibling;if(y!==w&&s&&(t.dom.isBlock(y)||t.dom.isBlock(s))){u++}}while((y=v?x.next():x.prev())&&u<2)},findFirstTimeNodeNearby:function(s,w,t){var v=w;var u=new i(w,s.getBody());do{if(j.isTimeNode(w)){return w}if(s.dom.isBlock(w)||(w!==v&&w.nodeType===n.TEXT_NODE&&w.nodeValue!=="")){return}}while(w=t?u.next():u.prev())},convertInvalidTimeNodeToPlainText:function(s){s.each(function(){var v=h(this);var t=v.attr("datetime");var u=a.parse(t);if(!u){v.before(v.text());v.remove()}})},isInsideTaskAndFirstTimeNode:function(t){var s=h(t),u=s.closest("ul.inline-task-list > li[data-inline-task-id]");if(!u.length){return false}return u.find("time, span.date-autocomplete")[0]===s[0]}};var c={handleRemoveDateLozenge:function(t,z){var y=z.keyCode;if(y!==d.BACKSPACE&&y!==d.DELETE){return}var w=(y===d.DELETE),s=t.selection.getRng(true),u=s.startContainer,v=u;if(u.nodeType==n.TEXT_NODE&&(w?s.startOffset!=u.nodeValue.length:s.startOffset!=0)){return}if(u.nodeType===n.ELEMENT_NODE){if(w){v=(u.childNodes.length===s.startOffset)?u:u.childNodes.item(s.startOffset)}else{v=(s.startOffset===0)?u:u.childNodes.item(s.startOffset-1)}}var x=j.findFirstTimeNodeNearby(t,v,w);x&&t.dom.remove(x)},handleClickingDateLozenge:function(x,A){var u=h(A.target);if(!u.is("time")){return}var s=(u.closest("li[data-inline-task-id]").length)?"task":"page";var v={mode:"editor",context:s};AJS.Analytics?AJS.Analytics.triggerPrivacyPolicySafeEvent("confluence-spaces.date.clicked",v):AJS.trigger("analyticsEvent",{name:"confluence-spaces.date.clicked",data:v});var D=u.closest("body");var z=function(){AJS.Rte.unbindScroll("date-lozenge-date-picker");y.die()};D.one("keydown click",z);var C=function(F){var G=F.format(a.PATTERN_INSIDE_TIME_ELE);var E=F.format(a.PATTERN_LOZENGE);if(G!==u.attr("datetime")){var H={context:s};AJS.Analytics?AJS.Analytics.triggerPrivacyPolicySafeEvent("confluence-spaces.date.changed",H):AJS.trigger("analyticsEvent",{name:"confluence-spaces.date.changed",data:H})}u.attr("datetime",G);u.text(E);D.unbind("keydown click",z)};var t=a.parse(u.attr("datetime")),w=j.isInsideTaskAndFirstTimeNode(u),y=a.datepicker.create({$attachTo:u,$positionTo:u,startDate:t,onSelect:C,isSetDueDate:w});var B=_.bind(_.throttle(function(){if(y&&AJS.Rte.isAnyPartShown(u)){y.placeDatePicker()}else{z()}},40),this);AJS.Rte.bindScroll("date-lozenge-date-picker",B)},handleTypingDate:function(t,v){var u=v.keyCode;if(u===d.UP||u===d.DOWN||u===d.LEFT||u===d.RIGHT||u===d.HOME||u===d.END||u===d.PAGEDOWN||u===d.PAGEUP||v.metaKey||v.ctrlKey||v.altKey){return}if(o.control&&o.picker){var s=o.control.text();o.picker.setDate(s)}},handleOnLoadContent:function(s){var u=h(s.dom.doc),t=u.find("time");j.makeTimeNodesUnEditable(t);j.wrapTimeNodesWithHiddenChar(t)},handlePostPasteContent:function(u,s,v){var t=h(v.node).find("time");j.makeTimeNodesUnEditable(t)},handlePrePasteContent:function(t,s,u){if(j.getTimeNodeAtCursor(g)){u.content="";return false}},fixWhenUpDownNavOnList:function(t,z){var v=z.keyCode;if(v!==d.UP&&v!==d.DOWN){return}var s=t.selection.getRng(true),u=s.startContainer,w=u,x=v===d.DOWN;if(u.nodeType===n.ELEMENT_NODE){if(x){w=(u.childNodes.length===s.startOffset)?u:u.childNodes.item(s.startOffset)}else{w=(s.startOffset===0)?u:u.childNodes.item(s.startOffset-1)}}var y=j.findFirstTimeNodeInClosestBlock(t,w,x);if(y){j.wrapTimeNodesWithHiddenChar(h(y))}},preventCursorInsideDateLozenge:function(t,s,v){var u=(v.nodeType===n.TEXT_NODE)?v.parentNode:v;if(j.isTimeNode(u)){if(b||t.selection.getRng().startOffset>1){j.putCursorAtEdge(t,u,true)}else{j.putCursorAtEdge(t,u,false)}}},handleUndoRedo:function(){o&&o.reattach()}};var f={init:function(s){j.initDateAutoCompleteObject(s);j.registerTriggerDoubleSlash(s);g=s;s.onContextMenu.add(function(){o.reset()});s.onSetContent.add(c.handleOnLoadContent);s.onClick.add(c.handleClickingDateLozenge);s.onKeyUp.add(c.handleTypingDate);if(e.isWebKit){s.onKeyDown.add(c.fixWhenUpDownNavOnList);s.onInit.add(function(){h(document).bind("postPaste",function(u,t,v){c.handlePostPasteContent(u,t,v)})})}s.onKeyUp.add(function(y,A){b=(A.keyCode===d.RIGHT);var x=y.selection.getRng(true);var w=x.commonAncestorContainer;var z=!!w&&w.data;if(!!z&&!AJS.$(w).closest("pre,.text-placeholder").length){var B=String.prototype.slice.apply(z,[-11]);if((A.keyCode>=48&&A.keyCode<=57)||(A.keyCode>=96&&A.keyCode<=105)){var t=/(^| )\d{2}[\/\-]\d{2}[\/\-]\d{4}$/;var v=String.prototype.slice.apply(z,[-10]);if(t.test(z)&&a.parse(v,[a.PATTERN_INSERTING,a.PATTERN_INSERTING_ALTERNATE])){var u=x.commonAncestorContainer;x.setStart(u,x.endOffset-v.length);y.undoManager.add();y.undoManager.beforeChange();y.selection.setRng(x);y.execCommand("mceConfInsertDateAutocomplete",false,{date:v},{skip_undo:true});AJS.Analytics?AJS.Analytics.triggerPrivacyPolicySafeEvent("confluence-spaces.tasks.daterecognition.triggered"):AJS.trigger("analyticsEvent",{name:"confluence-spaces.tasks.daterecognition.triggered"})}}}});if(e.isGecko){s.onKeyDown.add(c.handleRemoveDateLozenge);s.onInit.add(function(){h(document).bind("prePaste",function(u,t,v){c.handlePrePasteContent(u,t,v)})})}if(e.isWebKit||e.isGecko){s.onNodeChange.add(c.preventCursorInsideDateLozenge)}s.onUndo.add(c.handleUndoRedo);s.onRedo.add(c.handleUndoRedo);s.onInit.add(function(){h(document).bind("postPaste",function(u,t,v){j.convertInvalidTimeNodeToPlainText(h(v.node).find("time"))})})},getInfo:function(){return{longname:"Insert Date Autocomplete",author:"Atlassian",authorurl:"http://www.atlassian.com",version:e.majorVersion+"."+e.minorVersion}}};function l(){e.create(m,f);e.PluginManager.add(q,e.plugins.DateAutocomplete);AJS.Rte.BootstrapManager.addTinyMcePluginInit(function(s){s.plugins+=","+q})}l()})(AJS.$,tinymce);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.officeconnector:officeconnector-editor-resources', location = 'javascript/property-panel.js' */
(function(){AJS.Confluence.PropertyPanel.Macro.registerButtonHandler("office-connector-download-file-button",function(L,G){var C=AJS.$(G).attr("data-macro-parameters");
var J=C.split("|");
var D={};
var H;
for(H=0;
H<J.length;
H++){var N=J[H];
var F=N.split("=");
if(F.length>1){D[F[0]]=F[1]
}}var B=AJS.Meta.get("page-id");
var O=AJS.Meta.get("content-type");
if(!D.space){D.space=AJS.Meta.get("space-key")
}addToUrlIfDefined=function(Q,R,P){if(Q&&R){if(P.charAt(P.length-1)!="?"){P+="&"
}P=P+Q+"="+encodeURI(R)
}return P
};
var K=AJS.Meta.get("context-path");
var E="/plugins/servlet/oc/getattachment?";
var A=K+E;
A=addToUrlIfDefined("title",D.page,A);
A=addToUrlIfDefined("date",D.date,A);
A=addToUrlIfDefined("space",D.space,A);
A=addToUrlIfDefined("filename",D.name,A);
A=addToUrlIfDefined("contextid",B,A);
A=addToUrlIfDefined("contexttype",O,A);
var M=(AJS.$.browser&&AJS.$.browser.msie)?"_blank":"download-office-attachment";
var I=window.open(A,M)
})
})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-page-layout:pagelayout', location = 'js/pagelayout/page-layout.soy' */
// This file was automatically generated from page-layout.soy.
// Please don't edit this file by hand.

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.PageLayout == 'undefined') { Confluence.Templates.PageLayout = {}; }


Confluence.Templates.PageLayout.contentLayout = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="contentLayout"></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.PageLayout.cellLayout = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="cell"><div class="innerCell"></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.PageLayout.smallCellLayout = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="cell aside"><div class="innerCell"></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.PageLayout.headerLayout = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="header"><div class="innerCell"></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.PageLayout.footerLayout = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="footer"><div class="innerCell"></div></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.PageLayout.columnLayout = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="columnLayout"></div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.PageLayout.emptyLayout2 = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="contentLayout2">');
  Confluence.Templates.PageLayout.emptySection2(null, output);
  output.append('</div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.PageLayout.emptySection2 = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="columnLayout single" data-layout="single">');
  Confluence.Templates.PageLayout.cell2({type: 'normal'}, output);
  output.append('</div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.PageLayout.newSection2 = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="columnLayout single" data-layout="single">');
  Confluence.Templates.PageLayout.cell2({type: 'normal'}, output);
  output.append('</div>');
  return opt_sb ? '' : output.toString();
};


Confluence.Templates.PageLayout.cell2 = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="cell ', soy.$$escapeHtml(opt_data.type), '" data-type="', soy.$$escapeHtml(opt_data.type), '"><div class="innerCell">', (opt_data.content) ? opt_data.content : '', '</div></div>');
  return opt_sb ? '' : output.toString();
};

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-page-layout:pagelayout', location = 'js/pagelayout/tinymce-page-layout.js' */
(function($) {

    var updateDropDown = function(to) {
        var menu = $('#pagelayout-menu'),
            iconChecks = $('.icon-check', menu);

        updateDropDown = function(to){
            var fromCheck = iconChecks.not('.hidden'),
                toCheck = iconChecks.siblings('.' + to.name).siblings();

            fromCheck.addClass('hidden');
            toCheck.removeClass('hidden');
        };
        updateDropDown(to);
    };

    function isPageLayout2(ed) {
        var $body = $(ed.getBody());
        if($body.children('.contentLayout').length) {
            // PL1 - no migration yet, so don't support PL2, regardless of dark feature setting
            return false;
        }
        if($body.children('.contentLayout2').length) {
            // PL2 has been created at some point enable regardless of dark feature
            return true;
        }
        return true;
    }

    tinymce.create('tinymce.plugins.PageLayoutPlugin', {
        init: function(ed) {
            var pageLayout;
            this.ed = ed;

            if(AJS.Meta.get('content-type') === "comment") {
                // No page layout support for comments
                return;
            }

            function selectionSetContentCallback() {
                if(!isPageLayout2(ed)) {
                    if (!tinymce.plugins.PageLayoutPlugin.PageLayout.needsContentEditableBody(pageLayout.getLayout())) {
                        // we only need to call this focus stuff if a page layout exists on the page. (affects IE and gecko)
                        if(!tinymce.webkit) {
                            ed.focus();
                            ed.dom.getRoot().focus();
                        }
                    }
                }
            }

            function focusIfGecko(){
                if (tinymce.isGecko) {
                    setTimeout(function(){
                        ed.focus();
                        ed.dom.getRoot().focus();
                    }, 1);
                }
            }

            function setContentCallback(){
                var pl1Toolbar = $('#pagelayout-menu').parent();
                var pl2Toolbar = $('#page-layout-2-group');
                if(isPageLayout2(ed)) {
                    pl1Toolbar.addClass('hidden');
                    pl2Toolbar.removeClass('hidden');

                    pageLayout = new tinymce.plugins.PageLayoutPlugin.PageLayout2(ed);

                    // quick edit build is breaking in Bamboo (firefox, linux) if
                    // we don't set contenteditable here.
                    // TODO: this behaviour deserves needs some further investigation: CONFDEV-18312
                    if (tinymce.plugins.PageLayoutPlugin.PageLayout2.needsContentEditableBody()) {
                        $(ed.getBody()).attr('contenteditable', 'true');
                    }
             } else {
                    pl1Toolbar.removeClass('hidden');
                    pl2Toolbar.addClass('hidden');

                    pageLayout = new tinymce.plugins.PageLayoutPlugin.PageLayout(ed);

                    if (tinymce.plugins.PageLayoutPlugin.PageLayout.needsContentEditableBody(pageLayout.getLayout())){
                        pageLayout.body.attr('contenteditable', 'true');
                    } else {
                        // we only need to call this focus stuff if a page layout exists on the page.
                        focusIfGecko();
                    }
                    updateDropDown(pageLayout.getLayout());
                }
            }

            ed.onInit.add(function(){
                // CONFDEV-7758 - default undo state does not include page layouts with contenteditable true - so reset it
                ed.undoManager.clear();
                ed.undoManager.add();
                setContentCallback();

                //CONFDEV-7078 Arrow keys breaks in page layouts. turning it on and off again brings back the arrow keys
                //and makes them work once more. This needs to occur once the page is setup. Hence the setTimeout

                AJS.bind("rte-ready",function() {
                    var contentEditable = $('[contenteditable="true"]', ed.getBody());
                    var autoFocus = AJS.Meta.get('editor-auto-focus') !== false;

                    contentEditable.attr('contenteditable', 'false');
                    contentEditable.attr('contenteditable', 'true');

                    if (autoFocus) {
                        ed.focus();
                    }
                });

                ed.selection.onSetContent.add(selectionSetContentCallback);

                if(isPageLayout2(ed)) {
                    ed.undoManager.onUndo.add(function(){
                        if (tinymce.plugins.PageLayoutPlugin.PageLayout2.needsContentEditableBody()){
                            pageLayout.body.attr('contenteditable', 'true');
                        }
                        focusIfGecko();
                    });
                };
            });

            $("#pagelayout-menu").delegate('li.dropdown-item a', 'click', function() {
                ed.execCommand("mcePageLayout", false, tinymce.plugins.PageLayoutPlugin.PageLayout.getLayoutOptions(this));
            });

            ed.addCommand("mcePageLayoutInitialize", function() {
                ed.undoManager.add();
                pageLayout.createInitialLayoutIfNone();
            });

            ed.addCommand("mcePageLayout", function(ui, options) {
                ed.undoManager.add();
                pageLayout.setLayout(options);
                updateDropDown(pageLayout.getLayout());
            });

            ed.addCommand("mcePageLayoutAddSection", function(ui, options) {
                ed.undoManager.add();
                if(pageLayout.addSection) {
                    pageLayout.addSection(options && options.section);
                }
            });

            ed.addCommand("mcePageLayoutChangeSection", function(ui, options) {
                ed.undoManager.add();
                if(pageLayout.changeSection) {
                    pageLayout.changeSection(options && options.layout, options && options.section);
                }
            });

            ed.addCommand("mcePageLayoutRemoveSection", function(ui, options) {
                ed.undoManager.add();
                if(pageLayout.removeSection) {
                    pageLayout.removeSection(options && options.section);
                }
            });

            ed.addCommand("mcePageLayoutMoveSectionUp", function(ui, options) {
                ed.undoManager.add();
                if(pageLayout.moveSectionUp) {
                    pageLayout.moveSectionUp(options && options.section);
                }
            });

            ed.addCommand("mcePageLayoutMoveSectionDown", function(ui, options) {
                ed.undoManager.add();
                if(pageLayout.moveSectionDown) {
                    pageLayout.moveSectionDown(options && options.section);
                }
            });

            ed.onSetContent.add(setContentCallback);

            // CONFDEV-6938 Ensure the entire cell is a clickable area.
            ed.onClick.add(function(ed, e) {
                var $target = $(e.target),
                    cells, toStart;
                if ($target.is("div.cell")) {
                    $target.children(".innerCell").focus();
                }

                if (tinymce.isWebKit && (e.target === ed.getBody() || e.target === ed.getBody().parentNode)) {
                    cells = $target.find(".innerCell");
                    if (cells.length) {
                        ed.execCommand('selectAll');
                        //If the body was clicked (usually below the page layout) collapse to end otherwise collapse to start.
                        toStart = e.target !== ed.getBody();
                        ed.selection.collapse(toStart);
                    }
                }
            });

            // CONFDEV-6327 Handle backspace and delete keys to ensure page layouts always contain
            // a paragraph. As the deletion occurs on keypress and we are adding in the empty paragraph
            // on keyup, a 'jump' is noticeable as the page layout cell is resized for its content, tracked
            // as CONFDEV-6426.
            !tinymce.isIE9 && ed.onKeyUp.add(function(ed, e){
                var keyCode = e.keyCode,
                    startContainer, cell;
                if (keyCode != 8 && keyCode != 46) {
                    return true;
                }

                startContainer = ed.selection.getRng(true).startContainer;
                if($(startContainer).closest('.contentLayout,.contentLayout2', ed.getBody()).length) {
                    cell = $(startContainer).closest(".innerCell");
                    if(cell && cell.length && ed.dom.isEmpty(cell.clone()[0])) {
                        cell.html('<p><br data-mce-bogus="1"></p>');

                        ed.selection.select(cell[0], true);
                        ed.selection.collapse(true);
                    }
                }
            });
        },

        execCommand: function(command, ui, options){
            if (command === 'selectAll') {
                var ed = this.ed,
                    body = ed.getBody(),
                    cells, first, last, rng;


                if (ed.dom.getAttrib(body, 'contenteditable') == "true"){
                    //will cause the execCommand to fall through to TinyMCE implementation
                    return false;
                }

                cells = ed.dom.select('.innerCell', body);
                first = cells[0];
                last = cells[cells.length - 1];
                rng = ed.dom.createRng();

                rng.setStart(first, 0);
                rng.setEnd(last, last.childNodes.length);
                ed.selection.setRng(rng);
                return true;
            }

            return false;
        },

        getInfo: function() {
            return {
                longname: 'Page Layout Plugin',
                author: 'Atlassian',
                authorurl: 'http://www.atlassian.com',
                infourl: 'http://www.atlassian.com',
                version: '1.0'
            };
        }
    });
    tinymce.PluginManager.add('pagelayoutplugin', tinymce.plugins.PageLayoutPlugin);

})(AJS.$);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-page-layout:pagelayout', location = 'js/pagelayout/page-layout.js' */
/**
 * PageLayout object is a singleton created in the current editor's namespace which maintains state
 * representative of the currently layout used by the editor.
 */

(function($) {
    /**
     * Constructor for the PageLayout object. There is one of these per editor instance.
     *
     * param editor
     * constructor
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout = function (editor) {
        this.editor = editor;
        this.body = $(editor.getBody());
        var layoutElement = $('.contentLayout', this.body);

        if (layoutElement.length) {
            updateLegacyLayout(layoutElement);
            setupLayout(layoutElement, this.body, this.editor);

            this.editor.undoManager.add();
        }
	};

    tinymce.plugins.PageLayoutPlugin.PageLayout.DEFAULT_LAYOUT = {name: "pagelayout-none", columns: 0};

    /*****
     * INSTANCE METHODS
     */

    /**
     * Sets the layout of the current editor to the provided layout.
     *
     * param layout object representing the layout that the current editor should be converted too
     * it is structured as follows:
     * {
     *   name: name of the layout
     *   header: boolean
     *   footer: boolean
     *   columns: array length represents the number of columns and each index n is a string to be added
     *            to the classname of the nth column
     * }
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout.prototype.setLayout = function (layout) {
        var newLayoutElement,
            layoutElement = $('.contentLayout', this.body),
            currentLayout = tinymce.plugins.PageLayoutPlugin.PageLayout.getLayoutOptions(layoutElement);
        if (currentLayout.name === layout.name) {
            return;
        }
        AJS.trigger('analyticsEvent', {name: 'PageLayoutEvent.pageLayoutChanged', data: {name: layout.name}});

        if (layoutElement.length === 1) {
            // todo I think the assumption that layoutElement will be accurate here is incorrect in light of undo
            newLayoutElement = layoutElement.clone();
        } else {
            newLayoutElement = createLayoutElement(this.editor, this.body);
        }

        updateLegacyLayout(newLayoutElement);
        convertColumns(layout, newLayoutElement);
        layout.header ? addHeader(newLayoutElement) : removeHeader(newLayoutElement);
        layout.footer ? addFooter(newLayoutElement) : removeFooter(newLayoutElement);

        if(tinymce.plugins.PageLayoutPlugin.PageLayout.needsContentEditableBody(layout)) {
            newLayoutElement = newLayoutElement.contents().unwrap();
            this.body.attr('contenteditable', 'true');
            layoutElement = "";
        } else {
            setupLayout(newLayoutElement, this.body, this.editor);
            newLayoutElement.attr('data-atlassian-layout', JSON.stringify(layout));
            layoutElement = newLayoutElement;
        }

        drawLayout(this.body, newLayoutElement);
        tinymce.isIE && this.editor.dom.setRoot();
        focus(this.editor);
    };

    tinymce.plugins.PageLayoutPlugin.PageLayout.prototype.getLayout = function () {
        var layoutElement = $('.contentLayout', this.body);
        return layoutElement.length && layoutElement.attr('data-atlassian-layout')
            ? JSON.parse(layoutElement.attr('data-atlassian-layout'))
            : tinymce.plugins.PageLayoutPlugin.PageLayout.DEFAULT_LAYOUT;
    };

    /*****
     * STATIC METHODS
     */

    /**
     * Given an element, parse the JSON inside of the data-atlassian-layout attribute which contains a
     * simple layout object.
     *
     * @param element
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout.getLayoutOptions = function(element) {
        var $element = element.jquery ? element : $(element),
            layoutJson = $element.attr("data-atlassian-layout");
        return layoutJson ? JSON.parse(layoutJson) : tinymce.plugins.PageLayoutPlugin.PageLayout.DEFAULT_LAYOUT;
    };

    /**
     * Returns true if the layout provided needs the body node to be content editable.
     *
     * @param layout The layout to check.
     * @return {Boolean} True if this layout requires body node to be content editable.
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout.needsContentEditableBody = function(layout){
        return !(layout.header || layout.footer || layout.columns);
    };

    /*****
     * PRIVATE METHODS
     */

    /**
     * Returns the html content of the given element. Returns an empty string if the
     * the element is empty (i.e. consists only of empty <p><br></p> structures).
     *
     * param element Can be a jQuery object or a DOM element.
     */
    var getContents = function (element) {
        var $element = element.jquery? element : $(element);
        if (!!$element.length) {
            var childNodes = $element[0].childNodes;
            for (var i = 0; i < childNodes.length; i++) {
                var thisNode = childNodes[i];
                if (!((thisNode.nodeName == "P") && (thisNode.childNodes.length == 1) && (thisNode.firstChild.nodeName == "BR"))) {
                    return $element.html();
                }
            }
        }
        return "";
    };

    /**
     * CONFDEV-6926: IE8 requires an extra div inside cell in order to have the appropriate layout. Older layouts did not
     * have this div. The disrepency causes older lyout's to break. This function looks for older layouts
     * and manually injects the new div to resolve this issue.
     *
     */
    var updateLegacyLayout = function (layoutElement) {
        var cells, cell, content;

        cells = $('.cell, .header, .footer', layoutElement);

        for(var i=0, ii=cells.length; i<ii; i++) {
            cell = $(cells[i]);
            content = cell.html();
            
            if(!$('.innerCell', cell).length) {
                cell.removeAttr('contenteditable');
                cell.html('<div class="innerCell">' + content + '</div>');
            }
        }
    };

    /**
     * Makes the correct elements content editable and puts minimally sufficient content in each
     *
     * param layout
     */
    var setupLayout = function (layout, body, editor) {
        body.attr("contenteditable", 'false');
        var layoutSelector = ".innerCell",
            defaultCellContents = tinymce.isIE9 ? '<p></p>' : '<p><br /></p>';

        // add at least an empty paragraph to the sections
        $(layoutSelector, layout).each(function() {
            var $this = $(this);
            $this.attr("contenteditable", "true");

            if (!$this.children().length) {
                $this.append(defaultCellContents);
            }
        });
        // CONFDEV-6815 Focus the div element instead of the body for IE8 so the focus() method does not fail.
        tinymce.isIE && body.delegate(layoutSelector, 'focus.pageLayout', function () {
            // CONFDEV-7362 setRoot does not exist as a function when this code is first run. As a result we
            // need to set the root_element manually.
            editor.dom.settings.root_element = this;
        });
    };

    /**
     * Add a header to the provided layout
     * param layout
     */
    var addHeader = function (layout) {
        if ($('.header', layout).length)
            return;

        layout.prepend(Confluence.Templates.PageLayout.headerLayout());
    };

    /**
     * Remove the header from the provided layout
     * param layout
     */
    var removeHeader = function (layout) {
        var header = $('.header', layout),
            firstCol = getFirstColumn(layout),
            content = getContents($('.innerCell',header));

        if(firstCol.length) {
            firstCol.prepend(content);
            header.remove();
        }
        else {
            header.replaceWith(content);
        }
    };

    /**
     * Add a footer to the provided layout
     * param layout
     */
    var addFooter = function (layout) {
        if ($('.footer', layout).length)
            return;

        layout.append(Confluence.Templates.PageLayout.footerLayout());
    };

    /**
     * Remove the footer from the provided layout
     * param layout
     */
    var removeFooter = function (layout) {
        var footer = $('.footer', layout),
            lastCol = getLastColumn(layout),
            content = getContents($('.innerCell', footer));

        if(lastCol.length) {
            lastCol.append(content);
            footer.remove();
        }
        else {
            footer.replaceWith(content);
        }
    };

    var getColumnCount = function (layout){
        return $('.columnLayout > .cell', layout).length;
    };

    /**
     * Get the first column of the provided layout
     * param layout
     */
    var getFirstColumn = function (layout) {
        return $('.columnLayout > .cell:first-child .innerCell', layout);
    };

    /**
     * Get the last column of the provided layout
     * param layout
     */
    var getLastColumn = function(layout) {
        return $('.columnLayout > .cell:last-child .innerCell', layout);
    };

    var addColumn = function (layout) {
        return $('.columnLayout', layout).append(Confluence.Templates.PageLayout.cellLayout());
    };

    var removeAllColumns = function (layout) {
        var content = "";
        $('.columnLayout > .cell', layout).each(function() {
            content += getContents($('.innerCell', this));
        });

        $('.columnLayout', layout).replaceWith(content);
    };

    var mergeColumns = function (from, to) {
        var content = getContents(from);
        to.append(content);
        from.parent().remove();
    };

    /**
     * Converts to the passed layout to the number and type of passed columns.
     *
     * param toLayout Array representing the columns that the layout is to be converted to. Length represents
     *   the number of columns and each index n is a string to be added to the classname of the nth column
     * param layout
     */
    var convertColumns = function (toLayout, layout) {
        var columnCount = getColumnCount(layout),
            name = toLayout.name,
            columns = toLayout.columns,
            content, numCols;

        if (columnCount == 0) { //first time applying a layout
            content = layout.html();
            layout.html(Confluence.Templates.PageLayout.columnLayout());
            while (columnCount !== columns.length) {
                addColumn(layout);
                columnCount++;
            }
        }

        /* CONFDEV-6137 Because IE8 compat mode doesn't support table layout we need to be able
           To determine how many columns we have and alter our widths appropriately. This piece
           of code adds a class to make this possible.

           Slice off beginning and end. account for layout names without end portions (pagelayout-none)
         */
        numCols = name.substring(name.indexOf('-') + 1);
        numCols = numCols.substring(0, Math.max(0, numCols.indexOf('-')) || undefined);

        $('.columnLayout', layout).attr('class', 'columnLayout ' + numCols + 'Columns');

        if (columns) {
            $('.columnLayout > .cell', layout).each(function(index, column){
                (columns[index] !== undefined) && $(column).attr('class', 'cell ' + columns[index]);
            });

            while(columnCount !== columns.length) {
                if (columnCount < columns.length) {
                    addColumn(layout);
                    columnCount++;
                } else {
                    mergeColumns($('.columnLayout .cell:nth-child(' + (columnCount) + ') .innerCell', layout),
                        $('.columnLayout > .cell:nth-child(' + (columnCount-1) + ') .innerCell', layout));
                    columnCount--;
                }
            }
        } else {
            removeAllColumns(layout);
        }

        content && getFirstColumn(layout).html(content);
    };

    /**
     * Replaces the body content with the layout
     *
     * param body
     * param layout
     */
    var drawLayout = function (body, layout){
        body.empty().append(layout);
    };

    /**
     * Creates a layout element within which a new page layout can be constructed
     *
     * param editor
     * param body
     */
    var createLayoutElement = function (editor, body){
        var layout = createElementInEditor(Confluence.Templates.PageLayout.contentLayout(), editor);
        return layout.html(body.html());
    };

    /**
     * Sets focus to the first p in the body.
     */
    var focus = function (editor) {
        var sel = editor.selection,
            rng = sel.getRng(true),
            ce = $('[contenteditable="true"]', editor.getBody()),
            p;

        if (ce.length) {
            editor.focus();
            ce[0].focus();

            p = ce.children()[0];
            rng.setStart(p, 0);
            rng.setEnd(p, 0);
            sel.setRng(rng);
        } else {
            editor.focus();
        }
    };

    /**
     * Creates an html element in the context of the editor
     *
     * param html
     * param editor
     */
    var createElementInEditor = function(html, editor) {
        var div = editor.dom.create('div');
        div.innerHTML = html;
        return $(div).children();
    };
})(AJS.$);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-page-layout:pagelayout', location = 'js/pagelayout/page-layout-2.js' */
/**
 * PageLayout object is a singleton created in the current editor's namespace which maintains state
 * representative of the currently layout used by the editor.
 */

(function($) {

    var EVENT_PREFIX = "editor.page-layout.";
    var EMPTY_CELL_CONTENT = tinymce.isIE9 ? '<p></p>' : '<p><br /></p>';
    var EMPTY_BODY_CONTENT = '<p></p>';

    /**
     * Constructor for the PageLayout object. There is one of these per editor instance.
     *
     * param editor
     * constructor
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout2 = function (editor) {
        this.editor = editor;
        this.body = $(editor.getBody());
        var layoutElement = this.body.find('.contentLayout2');

        if (layoutElement.length) {
            setupLayout(layoutElement, this.body, this.editor);
            this.editor.undoManager.add();
        }
	};

    /*****
     * INSTANCE METHODS
     */

    /**
     * Adds a section layout below the current cursor position
     *
     * @param section section to add a new section after, or if not specified, the section where the caret is located.
     *
     * Triggers a editor.page-layout.add-section event. eventData is is { section: newSection }.
     */

    tinymce.plugins.PageLayoutPlugin.PageLayout2.prototype.addSection = function(section) {
        var self = this;
        var newSection = $(Confluence.Templates.PageLayout.newSection2());
        var curSection = section || findNearestSection(this.body, this.editor, true);

        if (!curSection.length){
            this.createInitialLayoutIfNone();
            return;
        }

        // let's create a section of the same type as the selected one
        var layoutFromCurrentSection = tinymce.plugins.PageLayoutPlugin.PageLayout2.Layouts.get(curSection.attr('data-layout'));
        this.editor.undoManager.ignore(function(){
            configureSection(newSection, layoutFromCurrentSection, self.body, self.editor);
            curSection.after(newSection);
        });

        focusSection(this.editor, newSection);

        AJS.trigger(EVENT_PREFIX + "add-section", {
            section: newSection
        });
    };

    /**
    * Configures a section with a given layout.
    *
    * @param section
    * @param layout
    * @param body
    * @param editor
    */
    function configureSection(curSection, layout, body, editor)
    {
        var cells = curSection.find('.cell');
        var cellsLength = cells.length;
        var newCells = $();
        var newCellsLength = layout.cells.length;
        var contents = [];
        var newContents = [];
        var i, len, cell;

        curSection.attr('class', 'columnLayout'); // reset class
        curSection.addClass(layout.id);
        curSection.attr('data-layout', layout.id);

        for (i = 0, len = cellsLength; i < len; i++) {
            cell = cells.eq(i).detach();
            contents.push(getContents(cell.children('.innerCell')));
        }

        for (i = 0, len = newCellsLength; i < len; i++) {
            newCells = newCells.add(Confluence.Templates.PageLayout.cell2({ type: layout.cells[i].type || '' }));
        }

        if (cellsLength <= newCellsLength) {
            // simple case 1-to-1
            newContents = contents;
        }
        else {
            // need to combine some cells
            newContents = contents.slice(0, newCellsLength);
            for (i = newCellsLength, len = cellsLength; i < len; i++) {
                newContents[newCellsLength - 1] += contents[i];
            }
        }

        // CONFDEV-18166. Make sure we attach the new cells to the DOM before
        // filling its content to avoid rendering problems in IE8
        curSection.prepend(newCells);

        for (i = 0, len = newCellsLength; i < len; i++) {
            newCells.eq(i).find('.innerCell').html(newContents[i]);
        }

        setupLayout(curSection, body, editor);
    }

    /**
     * Changes the layout of the section, will attempt to conserve the contents of the section.
     *
     * @param layout one of tinymce.plugins.PageLayoutPlugin.PageLayout2.Layouts
     * @param section section to change layout form, or if not specified, the section where the caret is located.
     *
     * Triggers a editor.page-layout.change-layout event.
     * eventData is is { section: section, originalLayout: { ... }, currentLayout: { ... } }.
     * originalLayout and currentLayout are one of tinymce.plugins.PageLayoutPlugin.PageLayout2.Layouts
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout2.prototype.changeSection = function(layout, section) {
        var self = this;

        if (!tinymce.plugins.PageLayoutPlugin.PageLayout2.isPageLayout()){
            this.createInitialLayoutIfNone();
        }

        var curSection = section || findNearestSection(this.body, this.editor, false);
        if(!curSection.length) {
            return;
        }
        var originalLayout = tinymce.plugins.PageLayoutPlugin.PageLayout2.Layouts.get(curSection.attr('data-layout'));

        this.editor.undoManager.ignore(function(){
            configureSection(curSection, layout, self.body, self.editor);
        });
        focusSection(this.editor, curSection);

        AJS.trigger(EVENT_PREFIX + "change-layout", {
            section: curSection,
            originalLayout: originalLayout,
            currentLayout: layout
        });
    };

    /**
     * Removes a section, content in section is lost. If last section an empty single column section is
     * put in its place.
     *
     * @param section section to remove, or if missing, the section where the caret is located.
     *
     * Triggers a editor.page-layout.remove-section event. eventData is is {}.
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout2.prototype.removeSection = function(section) {

        if (!tinymce.plugins.PageLayoutPlugin.PageLayout2.isPageLayout())
            return;

        var curSection = section || findNearestSection(this.body, this.editor, true);

        var nextSiblingSection = curSection.next(),
            prevSiblingSection = curSection.prev(),
            newSectionToFocusOn;

        if (nextSiblingSection.length) {
            newSectionToFocusOn = nextSiblingSection;
            curSection.remove();
        } else if(prevSiblingSection.length) {
            newSectionToFocusOn = prevSiblingSection;
            curSection.remove();
        } else {
            // we don't have any other sibling so we can delete the *parent* contentLayout, regardless
            curSection.closest('.contentLayout2').remove();

            // check for any other contentLayout anywhere in the document.
            var otherSectionInTheDocument = this.body.find('.contentLayout2').find('.columnLayout').first();
            if (otherSectionInTheDocument.length){
                // CONF-30193
                // be aware that this scenario is not actually supported on PL2 but we should handled it (corrupted content?)
                newSectionToFocusOn = otherSectionInTheDocument;
            }
            else {
                // this was the last section of the whole document, so we remove the whole PL thing and hide de toolbar
                removeContentAndRestoreContentEditable(this.editor);
                hidePLToolbar();
            }
        }

        if (newSectionToFocusOn && newSectionToFocusOn.length) {
            focusSection(this.editor, newSectionToFocusOn);
        }

        AJS.trigger(EVENT_PREFIX + "remove-section", { });


        function hidePLToolbar() {
            var $plButton = $('#rte-button-pagelayout-2');
            if ($plButton.hasClass('active')) {
                $plButton.click();
            }
        }

        function removeContentAndRestoreContentEditable(ed){
            // hide toolbar, toogle off page layouts functionality
            ed.getBody().setAttribute('contenteditable', true);
            ed.setContent(EMPTY_BODY_CONTENT);
            focus(ed);
        }
    };

    /**
     * Moves the section above the section before it.
     *
     * @param section section to move, or if not specified, the section where the caret is located.
     *
     * Triggers a editor.page-layout.move-section-up event. eventData is is { section: section }.
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout2.prototype.moveSectionUp = function(section) {

        if (!tinymce.plugins.PageLayoutPlugin.PageLayout2.isPageLayout())
            return;

        var curSection = section || findNearestSection(this.body, this.editor, true);
        var prevSection = curSection.prev();
        if(prevSection.length) {
            curSection.detach();
            prevSection.before(curSection);
            focusSection(this.editor, curSection);
        }
        AJS.trigger(EVENT_PREFIX + "move-section-up", { section: curSection });
    };

    /**
     * Moves the section below the section currently after it.
     *
     * @param section section to move, or if not specified, the section where the caret is located.
     *
     * Triggers a editor.page-layout.move-section-down event. eventData is is { section: section }.
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout2.prototype.moveSectionDown = function(section) {

        if (!tinymce.plugins.PageLayoutPlugin.PageLayout2.isPageLayout())
            return;

        var curSection = section || findNearestSection(this.body, this.editor, true);
        var nextSection = curSection.next();
        if(nextSection.length) {
            curSection.detach();
            nextSection.after(curSection);
            focusSection(this.editor, curSection);
        }
        AJS.trigger(EVENT_PREFIX + "move-section-down", { section: curSection });
    };

    /**
     * Page layouts "lazy" initialization.
     *
     * Makes sure a default, empty layout is created if none exists.
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout2.prototype.createInitialLayoutIfNone = function() {

        if (!tinymce.plugins.PageLayoutPlugin.PageLayout2.isPageLayout()) {
            var layoutElement = $(Confluence.Templates.PageLayout.emptyLayout2());
            var innerCell = layoutElement.find('.innerCell');
            var content = this.body.children().detach();

            innerCell.append(content);

            this.body.append(layoutElement);

            setupLayout(layoutElement, this.body, this.editor);

            focus(this.editor);
        }
    };

    /*****
     * STATIC METHODS
     */

    /**
     * Determines if the current page is a Page Layout 2 page.
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout2.isPageLayout = function() {
        var body = $(AJS.Rte.getEditor().getBody());
        return !!body.find('div.contentLayout2').length;
    };

    /**
     * Returns true if the layout provided needs the body node to be content editable.
     *
     * @param layout The layout to check.
     * @return {Boolean} True if this layout requires body node to be content editable.
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout2.needsContentEditableBody = function(){
        return !tinymce.plugins.PageLayoutPlugin.PageLayout2.isPageLayout();
    };

    /*************
     * STATIC VALUES
     */

    /**
     * Array of layouts.
     *
     * Order will affect button render order.
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout2.Layouts = [
        {
            id: 'single',
            name: "Single column section",
            cells: [
                { type: 'normal' }
            ]
        },
        {
            id: 'two-equal',
            name: "Two column section",
            cells: [
                { type: 'normal' },
                { type: 'normal' }
            ]
        },
        {
            id: 'two-left-sidebar',
            name: "Two column section with left side-bar",
            cells: [
                { type: 'aside' },
                { type: 'normal' }
            ]
        },
        {
            id: 'two-right-sidebar',
            name: "Two column section with right side-bar",
            cells: [
                { type: 'normal' },
                { type: 'aside' }
            ]
        },
        {
            id: 'three-equal',
            name: "Three column section",
            cells: [
                { type: 'normal' },
                { type: 'normal' },
                { type: 'normal' }
            ]
        },
        {
            id: 'three-with-sidebars',
            name: "Three column section with side-bars",
            cells: [
                { type: 'sidebars' },
                { type: 'normal' },
                { type: 'sidebars' }
            ]
        }
    ];

    tinymce.plugins.PageLayoutPlugin.PageLayout2.Layouts.get = function(id) {
        var layouts = tinymce.plugins.PageLayoutPlugin.PageLayout2.Layouts;
        for(var i = 0, len = layouts.length; i < len; i++) {
            if(layouts[i].id === id) {
                return layouts[i];
            }
        }
        return null;
    };

    /**
     * Will find the nearest section in the page.
     *
     * @param defaultToLast will return the last section if caret is not inside a section
     */
    tinymce.plugins.PageLayoutPlugin.PageLayout2.Layouts.findNearestSection = function(defaultToLast) {
        var editor = AJS.Rte.getEditor();
        var body = $(editor.getBody());
        return findNearestSection(body, editor, defaultToLast);
    };

    /*****
     * PRIVATE METHODS
     */

    /**
     * Returns the html content of the given element. Returns an empty string if the
     * the element is empty (i.e. consists only of empty <p><br></p> structures).
     *
     * param element Can be a jQuery object or a DOM element.
     */
    var getContents = function (element) {
        var $element = $(element);
        if (!!$element.length) {
            var childNodes = $element[0].childNodes;
            for (var i = 0; i < childNodes.length; i++) {
                var thisNode = childNodes[i];
                if (!((thisNode.nodeName == "P") && (thisNode.childNodes.length == 1) && (thisNode.firstChild.nodeName == "BR"))) {
                    return $element.html();
                }
            }
        }
        return "";
    };

    /**
     * Will find the nearest section in the page.
     *
     * @param body
     * @param editor
     * @param defaultToLast will return the last section if caret is not inside a section
     */
    var findNearestSection = function(body, editor, defaultToLast) {
        var startNode = $(editor.selection.getRng(true).startContainer);
        var nearestSection = startNode.closest('.columnLayout');
        if(!nearestSection.length && defaultToLast) {
            // caret not in section, find last
            nearestSection = body.find('.columnLayout').last();
        }
        return nearestSection;
    };

    /**
     * Makes the correct elements content editable and puts minimally sufficient content in each
     *
     * param layout
     */
    var setupLayout = function (layout, body, editor) {
        body.attr("contenteditable", 'false');
        var layoutSelector = ".innerCell",
            defaultCellContents = EMPTY_CELL_CONTENT;

        // add at least an empty paragraph to the sections
        $(layoutSelector, layout).each(function() {
            var $this = $(this);
            $this.attr("contenteditable", "true");

            if (!$this.children().length) {
                $this.append(defaultCellContents);
            }
        });
        // CONFDEV-6815 Focus the div element instead of the body for IE8 so the focus() method does not fail.
        tinymce.isIE && body.delegate(layoutSelector, 'focus.pageLayout', function () {
            // CONFDEV-7362 setRoot does not exist as a function when this code is first run. As a result we
            // need to set the root_element manually.
            editor.dom.settings.root_element = this;
        });
    };

    /**
     * Sets focus to the first p in the body.
     */
    var focus = function (editor) {
        var sel = editor.selection,
            rng = sel.getRng(true),
            ce = $('[contenteditable="true"]', editor.getBody()),
            p;

        if (ce.length) {
            editor.focus();
            ce[0].focus();

            p = ce.children()[0];
            rng.setStart(p, 0);
            rng.setEnd(p, 0);
            sel.setRng(rng);
        } else {
            editor.focus();
        }
    };

    /**
     * Sets focus into the first p of the first cell in the specified section
     */
    var focusSection = function(editor, section) {
        var sel = editor.selection,
            rng = sel.getRng(true),
            ce = section.find('[contenteditable="true"]').first(),
            target = ce.children(),
            p;
        if(target.length) {
            editor.focus();
            ce[0].focus();
            p = target[0];
            rng.setStart(p, 0);
            rng.setEnd(p, 0);
            sel.setRng(rng);
            AJS.Rte.showElement(p);
        } else {
            editor.focus();
        }
    };

})(AJS.$);

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-page-layout:pagelayout', location = 'js/pagelayout/tinymce-page-layout-toolbar.js' */
/**
 * Toolbar based implementation for editing page layouts.
 */
(function($) {
    if(AJS.Meta.get('content-type') === "comment") {
        // No page layout support for comments
        return;
    }

    function updateToolbarState(section) {
        section = section || tinymce.plugins.PageLayoutPlugin.PageLayout2.Layouts.findNearestSection();
        var sectionType = section.attr('data-layout');
        var layoutButtons = $('#rte-toolbar-row-pl2-toolbar').find('.layouts button');
        var buttonForLayout = layoutButtons.find('.' + "pl2-layout-" + sectionType).closest('.aui-button');
        if(buttonForLayout.hasClass('active'))
            return; // already set
        layoutButtons.filter('.active').removeClass('active');
        buttonForLayout.addClass('active');
    }

    AJS.$(document).bind("initContextToolbars.Toolbar", function(e, editor) {
        var getLang = function(key) {
            var title = editor.getLang(key),
                shortcut = editor.getLang(key + "_shortcut", "");
            if (shortcut) {
                title += " (" + shortcut + ")";
            }
            return title;
        };

        var $doc = AJS.$(document);
        var $plButton = $('#rte-button-pagelayout-2');
        var toolbarId = 'pl2-toolbar';

        $plButton.click(function(e) {
            // TODO should add hide / show event to custom toolbar.
            e.preventDefault();
            if(!$plButton.hasClass('active')) {
                $doc.trigger("createContextToolbarRow.Toolbar", { id: toolbarId, buttons: Confluence.Editor.PageLayoutToolbar.Buttons, topToolbar: true, animate: true});
                updateToolbarState();
                editor.execCommand("mcePageLayoutInitialize");
            } else {
                $doc.trigger("removeContextToolbarRow.Toolbar", { id: toolbarId, animate : true });
            }
            $plButton.toggleClass('active');
        });

        editor.onNodeChange.add(function(ed, cm, n) {
            var section = $(n).closest('.columnLayout');
            updateToolbarState(section);
        });

        var classPrefix =  "pl2-";

        var layouts = tinymce.plugins.PageLayoutPlugin.PageLayout2.Layouts;
        var layoutButtons = [];

        for(var i = 0, l = layouts.length; i < l; i++) {
            (function(layout) {
                layoutButtons.push(new Confluence.Editor.Toolbar.Components.Button({
                    text : layout.name,
                    iconClass : "icon-fat " + classPrefix + "layout-" + layout.id,
                    click : function() {
                        editor.execCommand("mcePageLayoutChangeSection", false, {
                            layout: layout
                        });
                    }
                }));
            })(layouts[i]);
        }

        Confluence.Editor.PageLayoutToolbar = {
            Buttons:[
                new Confluence.Editor.Toolbar.Components.Group([
                    new Confluence.Editor.Toolbar.Components.Button({
                        triggerText : "Add section",
                        id: "add-layout-section",
                        tooltip : "Add a new section below",
                        iconClass : classPrefix + "layout-add-section",
                        click : function() {
                            editor.execCommand("mcePageLayoutAddSection");
                        }
                    }),
                    new Confluence.Editor.Toolbar.Components.Button({
                        triggerText : "Remove section",
                        tooltip : "Remove the current section",
                        iconClass : classPrefix + "layout-remove-section",
                        click : function() {
                            editor.execCommand("mcePageLayoutRemoveSection");
                        }
                    })
                ]),

                new Confluence.Editor.Toolbar.Components.Group([
                    new Confluence.Editor.Toolbar.Components.Button({
                        triggerText : "Move up",
                        tooltip : "Move section up",
                        iconClass : classPrefix + "layout-move-section-up",
                        click : function() {
                            editor.execCommand("mcePageLayoutMoveSectionUp");
                        }
                    }),
                    new Confluence.Editor.Toolbar.Components.Button({
                        triggerText : "Move down",
                        tooltip : "Move section down",
                        iconClass : classPrefix + "layout-move-section-down",
                        click : function() {
                            editor.execCommand("mcePageLayoutMoveSectionDown");
                        }
                    })
                ]),
                new Confluence.Editor.Toolbar.Components.Group(layoutButtons, {
                    id: 'pagelayout2-toolbar',
                    text: "Apply layout",
                    groupClass: 'layouts' }
                ),

                new Confluence.Editor.Toolbar.Components.Group([
                    new Confluence.Editor.Toolbar.Components.Button({
                        text : "Close toolbar",
                        iconClass : "icon-close",
                        click : function() {
                            $plButton.click();
                        }
                    })
                ], { groupClass: 'close' })
            ],

            // takes an array of {type: tinymceEvent, shouldTrigger: function, callback: function, missed: function }
            Events: [
            ]
        };
    });

})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.web.components:editor-notifications', location = '/includes/js/components/editor-notifications.js' */
AJS.bind("init.rte",function(d){var b="editor-notification-container";var e="editor-notification-message";var a=AJS.$('<div class="editor-notifications-container"></div>').attr("id",b);var c=AJS.$("<div></div>").attr("id",e);a.append(c);AJS.$("#wysiwyg").after(a);AJS.Confluence.EditorNotification={notify:function(f,g,i){AJS.messages[f]("#"+e,{body:g,closeable:true,shadowed:true});var h=AJS.$(".aui-message",a).last();if(!i){i=5000}else{i*=1000}setTimeout(function(){h.fadeOut("fast",function(){h.closeMessage();h=null})},i)}}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-paste:paste-resources', location = 'js/clipboard-access.js' */
(function(){

AJS.toInit(function($) {
    "use strict";

    // firefox and IE11 use a mutation observer to detect changes to the DOM and grab the img node that is inserted into the content editable
    function registerMutationObserver(editor){
        var observer = new MutationObserver(function (mutations) {
            for (var i = 0; i < mutations.length; i++) {
                var mutation = mutations[i];

                if (mutation.addedNodes.length) {
                    for (var x = 0; x < mutation.addedNodes.length; x++) {
                        var node = mutation.addedNodes[x];

                        if (node.localName === "img") {
                            setTimeout(pasteHandler.pasteFromDataURL, 0);
                            return;
                        }
                    }
                }
            }
        });
        observer.observe(editor.getDoc(), { childList: true, subtree: true });
    }

    // chrome uses a paste handler and grabs the image data out of the paste event
    function registerOnPasteListener(ed){
        ed.onPaste.add(function (editor, e) {
            if (pasteHandler.onPaste(e))
                return true;
            else {
                tinymce.dom.Event.cancel(e);
                return false;
            }
        });
    }

    var pasteHandler = {
        initializeEditor: function() {
            if (AJS && AJS.Rte && AJS.Rte.BootstrapManager) {
                AJS.Rte.BootstrapManager.addOnInitCallback(function () {

                    var ed = AJS.Rte.getEditor();
                    if (ed) {
                        //register observer to listen for img nodes inserted into the DOM, firefox and IE still don't
                        // expose enough information to grab the image from the clipboard
                        if (window.MutationObserver && !$.browser.webkit) {
                            registerMutationObserver(ed);
                        }
                        else {
                            registerOnPasteListener(ed);
                        }
                    }
                    else {
                        AJS.log("Could not getEditor from adapter");
                    }
                });
            }
            else {
                AJS.log("Could not initialize pasteHandler on Confluence.Editor");
            }
        },

        /**
         * searches the wysiwyg text area for embedded image data URLs and attaches them to the document
         * via the upload, then removes the data URI
         */
        pasteFromDataURL: function() {
            //firefox 4.0 inserts images as data urls
            //do not count the images have data url built by macro placeholder in editor with editor-inline-macro class
            var embeddedImgs = $('img[src^="data:image"]:not(".editor-inline-macro")', tinymce.activeEditor.getDoc());
            $.each(embeddedImgs, function() {
                var imgNode = this;
                var data = imgNode.src.substring(22, imgNode.src.length);

                // calculate the unencoded image size, accounting for potential padding.
                var size = (data.length * 3) / 4;
                //count padded bytes, last two characters might be padding with the '=' char
                var paddedBytes = 0;
                for (var len = data.length, i = len - 1; data[i] == "="; i--) {
                    paddedBytes++;
                }

                AJS.Confluence.Uploader.upload([
                    pasteHandler.createUploadFile(data, size - paddedBytes, "base64")
                ]);
            });

            //remove all embedded images
            embeddedImgs.remove();
        },

        /**
         * onPaste handler, Either uses webkits clipboardData object on the paste event, or interprets
         * the data uri that has been embedded in the page by firefox.
         */
        onPaste: function(event) {

            if (event && event.clipboardData) {
                // webkit exposes a clipboardData object on the paste event
                return pasteHandler.pasteFromEvent(event);
            }
            return true;
        },

        showClipboardAccessError: function() {
            new AJS.Dialog({
                width: 400,
                closeOnOutsideClick: true
            })
                .addPanel("alert", $("<div />", { text: "Your browser does not support pasting images from the clipboard." }))
                .addButton("OK", function(dialog) { dialog.remove(); })
                .show()
                .updateHeight();
        },

        /**
         * chrome supports clipboard data on the paste event, can read the image straight from it.
         * @param event
         */
        pasteFromEvent : function(event) {
            if (event && event.clipboardData) {

                if (event.clipboardData.items) {
                    var dataTransferItem = event.clipboardData.items[0];
                    if (!dataTransferItem || dataTransferItem.kind != "file")
                        return true;

                    var dataFile = dataTransferItem.getAsFile();
                    var uploadFile = pasteHandler.createUploadFile(dataFile, dataFile.size)
                    AJS.Confluence.Uploader.upload([uploadFile]);
                    return false;
                } else {
                    // Safari (and possibly other browsers) will
                    // allow the image to be pasted, but the data
                    // URI is not placed as the image's `src`
                    // attribute. It replaces it with a custom
                    // protocol, which can't be accessed via JavaScript.
                    setTimeout(function(me) {
                        var webkitFakeUrlImages = $("img[src^='webkit-fake-url://']", tinymce.activeEditor.getDoc());
                        if (webkitFakeUrlImages.length) {
                            webkitFakeUrlImages.remove();
                            me.showClipboardAccessError();
                        }
                    }, 0, this);
                }
            }
            return true;
        },

        /**
         * creates an upload file with an optionally specified encoding
         * @param data - the data to be uploaded, either as binary or base64 encoded
         * @param sz - the size of the decoded image
         * @param encoding - optional encoding, only base64 is currently supported.
         */
        createUploadFile: function(data, sz, encoding) {
            var curDate = new Date();
            var month = curDate.getMonth() + 1;
            return {
                fileName: "image" + curDate.getFullYear() + "-" + month + "-" + curDate.getDate() + " " +
                        curDate.getHours() + ":" + curDate.getMinutes() + ":" + curDate.getSeconds() + ".png",
                fileSize: sz,
                slice : function(offset, length) {
                    return data.slice(offset, offset + length);
                },
                getAsBinary : function() {
                    return data;
                },
                getData : function() {
                    return data;
                },
                encoding : encoding
            }
        }
    };

    pasteHandler.initializeEditor($);
    return pasteHandler;
});

})();

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-paste:autoconvert-confluence', location = 'js/autoconvert/transformers/confluencepaste.js' */
(function(){

AJS.bind("init.rte", function() {
	var pasteHandler =function(uri, node, done){
		if (!isConfluence(uri)) {
			done();
			return;
		}

        var stripContextPath = function(uri){
            return AJS.contextPath() ? uri.path.substring(AJS.contextPath().length + 1) : uri.path.substring(1);
        };

		var path = stripContextPath(uri),
			parts = decodeURIComponent(path).split('/'),
			linkString;

        // All URIs provided by the parseUri function should have *at least* an empty queryKey object but we'll guard
        // anyway.
        uri.queryKey = uri.queryKey || {};

        var addAnchorSuffix = function (linkString, uri) {
            if (!uri.anchor || uri.anchor.indexOf('comment-') === 0) {
                // Ignore anchors for focused comments; they're handled by the $ wiki markup.
                return linkString;
            }
            return linkString + '#' + uri.anchor.substring(uri.anchor.indexOf('-') + 1);
        }

        if (uri.queryKey.focusedCommentId) {
            //http://localhost:8080/confluence/display/ds/Home&focusedCommentId=1212425#comment-1212425
            //http://localhost:8080/confluence/pages/viewpage.action?pageId=32784&focusedCommentId=1212425#comment-1212425
            linkString = '$' + uri.queryKey.focusedCommentId;
            // HACK - although the anchor may be added it is currently ignored by the wiki converter.
            // In fact the "$12345" comment linkString above will be converted to a hard href, see CONF-24415.
            linkString = addAnchorSuffix(linkString, uri);
        } else if (uri.queryKey.pageId) {
            //http://localhost:8080/confluence/pages/viewpage.action?pageId=32784
            linkString = '$' + uri.queryKey.pageId;
            linkString = addAnchorSuffix(linkString, uri);
        }
        else if (parts[0] === 'display') {
            if (parts.length === 2 && parts[1].indexOf('~') === 0) {
                //http://localhost:8080/confluence/display/~admin
                linkString = parts[1];
            } else if (parts.length === 3) {
                //http://localhost:8080/confluence/display/ds/Home
                linkString =  parts[1] + ':' + parts[2].replace(/\+/g, ' ');
                linkString = addAnchorSuffix(linkString, uri);
            } else if (parts.length === 4 && parts[1] === "status") {
                //http://localhost:8080/confluence/display/status/admin/1212424
                linkString = '$' + parts[3];
            } else if (parts.length === 6) {
                //http://localhost:8080/confluence/display/ds/2011/10/27/jwafej+again+dog
                linkString = parts[1] + ':' + '/' + parts[2] + '/' + parts[3] + '/' + parts[4] + '/' + parts[5].replace(/\+/g, ' ');
                linkString = addAnchorSuffix(linkString, uri);
            }
        } else if (parts[0] == 'users') {
            if (parts.length == 2 && parts[1] == 'viewuserprofile.action') {
                // http://localhost:8090/confluence/users/viewuserprofile.action?username=admin
                linkString = '~' + uri.queryKey.username;
            } else if (parts.length == 2 && parts[1] == 'viewmyprofile.action') {
                linkString = '~' + AJS.Meta.get('remote-user');
            }
        }

        if (!linkString) {
            // Nothing matches this Confluence URI, leave it alone.
			done();
			return;
		}

		linkString = "[" + linkString + "]";
		tinymce.plugins.Autoconvert.getHtmlFromWikiMarkup(
			linkString,
			function(data){
				done(AJS.$(data).children()[0]);
			},
			function(){
				done();
			});
	};

	var isConfluence = function(uri){
		var isConfluence = true;
		isConfluence = isConfluence && uri.authority === document.location.host;
		isConfluence = isConfluence && (!AJS.contextPath() || uri.path.indexOf(AJS.contextPath()) === 0);
		return isConfluence;
	};


	tinymce.plugins.Autoconvert.autoConvert.addHandler(pasteHandler);
});

})();

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-paste:autoconvert-youtu.be-rewrite', location = 'js/autoconvert/transformers/youtube.js' */
(function(){

AJS.bind("init.rte", function() {    
    tinymce.plugins.Autoconvert.autoConvert.addHandler(function(uri, node, done){
        if (uri.host.match('.*youtu\.be.*')) {
            var vidId = uri.path.substr(1);
            var newurl = "http://youtube.com/watch?v=" + vidId;
            done (AJS.$(node).attr("href", newurl).html(newurl));
        } else { 
            done();
        }
    });
});

})();

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-paste:autoconvert-skitch', location = 'js/autoconvert/transformers/skitchpaste.js' */
(function(){

AJS.bind("init.rte", function() {
	AJS.Editor.SkitchPaste = {
		pasteHandler : function(uri,node, done){
			if (uri.host == 'www.skitch.com' || uri.host == 'skitch.com'){
				AJS.$.get(AJS.params.contextPath + '/rest/autoconvert/1.0/skitchembed?url=' + uri.source, function(data){
					if (data && data.url){
						done(AJS.$('<img class="confluence-embedded-image confluence-external-resource" src="' + data.url + '" data-image-src="' + data.url + '"/>')[0]);
					}
					else{
						done();
					}
				});
			}
			else{
				done();
			}
		}
	}
	tinymce.plugins.Autoconvert.autoConvert.addHandler(AJS.Editor.SkitchPaste.pasteHandler);
});

})();

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-paste:autoconvert-cloudapp', location = 'js/autoconvert/transformers/cloudapppaste.js' */
(function(){
AJS.bind("init.rte", function() {
    AJS.Editor.CloudAppPaste = {
        pasteHandler : function(uri, node, done){
            if (uri.host == 'cl.ly') {
                AJS.$.get(AJS.params.contextPath + '/rest/autoconvert/1.0/cloudappembed?resource=' + uri.path.substr(1), function(data){
					if (data){
                        switch(data.item_type) {
                            case 'image' :
                                var image = AJS.escapeHtml(data.content_url);
						        done(AJS.$('<img class="confluence-embedded-image confluence-external-resource" src="' + image + '" data-image-src="' + image + '"/>')[0]);
                                break;
                            case 'bookmark' :
                                node.text(data.name);
                                node.attr('href', AJS.escapeHtml(data.redirect_url));
                                done(node);
                                break;
                        }
                        return;
					}
					else{
						done();
					}
				});
            } else {
                done();
                return;
            }
        }
    };
    tinymce.plugins.Autoconvert.autoConvert.addHandler(AJS.Editor.CloudAppPaste.pasteHandler);
});

})();

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-paste:autoconvert-openphoto', location = 'js/autoconvert/transformers/openphoto.js' */
(function(){

AJS.bind("init.rte", function() {
    AJS.Editor.OpenPhotoPaste = {
        pasteHandler : function(uri, node, done){
            var openPhoto = uri.host.indexOf('openphoto.me'),
                dir = uri.directory,
                user, photoId;

            if (openPhoto !== -1 && openPhoto !== 0) {
                user = uri.host.substr(0, openPhoto - 1);
                photoId = dir.substr(dir.indexOf('photo/') + 6);
                photoId = photoId.substr(0, photoId.indexOf('/'));
                AJS.$.get(AJS.params.contextPath + '/rest/autoconvert/1.0/openphotoembed?user=' + user + '&photo=' + photoId, function(data){
                    var image;
                    if (data && data.code == 200){
                        image = AJS.escapeHtml(data.result["path600x600"]);
                        done(AJS.$('<img class="confluence-embedded-image confluence-external-resource" src="' + image + '" data-image-src="' + image + '"/>')[0]);
                        return;
					}
					else{
						done();
					}
				});
            } else {
                done();
                return;
            }
        }
    };
    tinymce.plugins.Autoconvert.autoConvert.addHandler(AJS.Editor.OpenPhotoPaste.pasteHandler);
});

})();

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-paste:autoconvert-widget-connector', location = 'js/autoconvert/transformers/widgetpaste.js' */
AJS.bind("init.rte", function() {
    var pasteRegexes = [/youtube.com\/watch\?/, /vimeo.com\/[0-9]+/, /maps.google(.[a-z]+)+\/maps/, /[^\.]\.wufoo\.com\/(?:forms|reports)/];

	function pasteHandler(uri, node, done){
        var urlSrc = decodeURI(uri.source);

        for (var i = 0; i < pasteRegexes.length; i++){
            if (urlSrc.match(pasteRegexes[i])){
                var macro = {name:'widget', params: {url: urlSrc}};
                tinymce.plugins.Autoconvert.convertMacroToDom(macro, done, done);
                return;
            }
        }
        done();
    }

	tinymce.plugins.Autoconvert.autoConvert.addHandler(pasteHandler);
});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-paste:autoconvert-widget-connector', location = 'js/autoconvert/transformers/flickrpaste.js' */
(function(){
AJS.bind("init.rte", function() {
    var tagPathRegex = /^\/photos\/tags\/[^/]+/,
        setPathRegex = /^\/photos\/[^/]+\/sets\/[0-9]+/,
        photoPathRegex = /^\/photos\/[^/]+\/[0-9]+/,
        pasteHandler = function(uri, node, done) {
            var decodedPath;

            if (uri.host.match(/flickr.com/)) {
                decodedPath = decodeURIComponent(uri.path);
                if (decodedPath.match(tagPathRegex) ||
                    decodedPath.match(setPathRegex) ||
                    decodedPath.match(photoPathRegex)) {
                    macro = {name:'widget', params: {url: decodeURI(uri.source)}};
                    tinymce.plugins.Autoconvert.convertMacroToDom(macro, done, done);
                }
                else {
                    done();
                }
            }
            else {
                done();
            }
		};
	tinymce.plugins.Autoconvert.autoConvert.addHandler(pasteHandler);
});

})();

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-paste:autoconvert-shortcut-links', location = 'js/autoconvert/transformers/shortcutlinks.js' */
(function(){

AJS.bind("init.rte", function() {    
    var shortcutLinkConfigurations = [];
    var contextPath;
    if (AJS.contextPath()) {
        contextPath = AJS.contextPath();
    } else {
        contextPath = "";
    }

    var loadShortcutLinkConfiguration = function () {
        AJS.$.ajax({
            url: contextPath + "/rest/autoconvert/latest/shortcutlinkconfigurations",
            type: "GET",
            dataType: "json",
            success: function(data) {
                shortcutLinkConfigurations = data["configurations"];
                for (var i = 0; i < shortcutLinkConfigurations.length; i++) {
                    var config = shortcutLinkConfigurations[i];
                    try {
                        config.regex = new RegExp(translateToRegex(config.expandedValue, config.defaultAlias));
                    } catch(e) {
                        console.log('Failed to generated regex for ' + config);
                    }
                }
            },
            error: function(response)
            {
                console.log('Failed to load shortcut link configurations ' + response.statusText);
            }
        });
    }

    var translateToRegex = function (expandedValue, defaultAlias) {
        if (expandedValue.indexOf("%s") >= 0)
        {
            return expandedValue.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&").replace("%s", "(.*)");
        }
        return expandedValue.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&") + "(.*)";
    };

	var pasteHandler = function(uri, node, done){
		if (uri.source !== node.text()) {
			done();
			return;
		}
        for (var i = 0; i < shortcutLinkConfigurations.length; i++) {
            var shortcutLinkConfig = shortcutLinkConfigurations[i];
            var matches = uri.source.match(shortcutLinkConfig.regex);
            if (matches) {
                var q = matches[1];
                if (shortcutLinkConfig.defaultAlias) {
                    var newText = shortcutLinkConfig.defaultAlias.replace(/%s/, q);
                    done(AJS.$(node).text(newText));
                    return;
                }
                done(AJS.$(node).text(q));
                return;
            }
        }
		done();
	};
	
	tinymce.plugins.Autoconvert.autoConvert.addHandler(pasteHandler);
	setTimeout(function(){
		loadShortcutLinkConfiguration();
	}, 0);
});

})();

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-paste:autoconvert-google-redirect', location = 'js/autoconvert/transformers/google-redirect-convert.js' */
(function(){
AJS.bind("init.rte", function() {
	var pasteHandler = function(uri, node, done){
        if (uri.host.match(/google.*/) && uri.path === "/url" && uri.queryKey && uri.queryKey.url) {
            var newUri = decodeURIComponent(uri.queryKey.url);
            node = AJS.$(node);
            // currently need to do both of these due to the editor storage format
            node.attr('href', newUri);
            node.attr('data-mce-href', newUri);
            node.text(newUri);
            done(node);
        } else {
            done();
        }

	};

	tinymce.plugins.Autoconvert.autoConvert.addHandler(pasteHandler);
});

})();

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.reliablesave:reliable-save', location = 'js/reliable-save.js' */
(function(b){var a=function(){if(!AJS.DarkFeatures.isEnabled("editor.ajax.save")){return}var m="rte_safe_save_offline_error_container";function l(){Confluence.Editor.UI.toggleSavebarBusy(true,true)}function k(){Confluence.Editor.UI.toggleSavebarBusy(false)}Confluence.Editor=Confluence.Editor||{};Confluence.Editor.SafeSave=Confluence.Editor.SafeSave||{};Confluence.Editor.SafeSave._internal=Confluence.Editor.SafeSave._internal||{};Confluence.Editor.SafeSave._internal.onSuccessfulResponse=function(o){AJS.trigger("rte.safe-save.success",o);var n=o.redirectUrl;if(!n){AJS.logError("expected redirectUrl field not found in response");return}if(n.indexOf("/")!=0){window.location=n}else{window.location=AJS.params.contextPath+n}};function d(q,p){var n=Confluence.getContextPath()+"/rest/tinymce/1/content/"+q+".json";var o=b.ajax({url:n,cache:false});o.success(function(r){p(null,r.atlToken)});o.error(function(){p("error accessing the rest endpoint")})}function j(o){AJS.trigger("rte.safe-save.invalid",o);for(var n=0;n<o.length;n++){Confluence.Editor.addErrorMessage("validation",o[n])}k()}var h=false;function g(n){if(n.status===403){AJS.trigger("rte.safe-save.invalid-xsrf-token");if(!h){d(AJS.Meta.get("content-id"),function(p,o){h=true;if(p){Confluence.Editor.addErrorMessage(m,"There was an error processing the request.");AJS.logError(p)}else{AJS.debug("xsrf token updated");b("input[name=atl_token]",f).val(o);AJS.Meta.set("atl-token",o);AJS.trigger("analyticsEvent",{name:"reliable-save-xsrf-token-expired"});k();Confluence.Editor.UI.saveButton.click()}});return}}h=false;AJS.trigger("rte.safe-save.error");Confluence.Editor.addErrorMessage(m,"Unable to communicate with server. Saving is not possible at the moment.");Confluence.Editor.heartbeatType.recovery();k()}function c(){return Confluence.Editor.UI.isFormEnabled()}var f=b("form.editor");if(!f.length){return}var i=f.attr("action");i=i.replace("docreatepage.action","docreatepage_ajax.action");i=i.replace("doeditpage.action","doeditpage_ajax.action");i=i.replace("docreateblogpost.action","docreateblogpost_ajax.action");i=i.replace("doeditblogpost.action","doeditblogpost_ajax.action");if(i.indexOf("_ajax")==-1){AJS.logError("no ajaxified action found on safe-save plugin");return}f.attr("action",i);f.ajaxForm({beforeSubmit:c,error:g,success:function(q,o,p,n){h=false;Confluence.Editor.heartbeatType.normal();if(q.actionErrors){j(q.actionErrors)}else{Confluence.Editor.SafeSave._internal.onSuccessfulResponse(q)}}});AJS.debug("reliable save ready!");var e=false;AJS.bind("rte.heartbeat-error",function(n,o){AJS.debug("reliable-save: heartbeat - error");Confluence.Editor.addErrorMessage(m,"Unable to communicate with server. Saving is not possible at the moment.");e=true;l()});AJS.bind("rte.heartbeat",function(n){if(e){AJS.debug("reliable-save: heartbeat - back to business!");AJS.$("#"+m).fadeOut().remove();e=false;k()}})};AJS.bind("rte.init.ui",a)})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.reliablesave:reliable-save', location = 'js/ajax-login.js' */
AJS.toInit(function(e){if(!AJS.DarkFeatures.isEnabled("ajax.login")){return}AJS.debug("AJAX login support enabled");var b=false;var g;var d;var m;var n=[];var l=e.ajax;var j=AJS.Meta.get("remote-user");var i=AJS.Meta.get("base-url");var c=AJS.Meta.get("context-path");var k="ajaxlogincomplete.action";var h=AJS.Meta.get("context-path")+"/login.action?os_destination=%2F"+k;function f(p,q){var r=p&&p.url;return j&&(!q||q&&!q.preventAjaxLogin)&&r&&(i&&r.indexOf(i)===0||c&&r.indexOf(c)===0)}function o(p,r,q){AJS.debug("Using authenticatingPromise");var s={abort:function(){q.abort.apply(q,arguments)},getAllResponseHeaders:function(){q.getAllResponseHeaders.apply(q,arguments)},getResponseHeader:function(){q.getResponseHeader.apply(q,arguments)},overrideMimeType:function(){q.overrideMimeType.apply(q,arguments)},readyState:q.readyState,setRequestHeader:function(z,A){q.setRequestHeader.apply(q,arguments)},state:function(){q.state.apply(q,arguments)},status:q.status,statusCode:function(){q.statusCode.apply(q,arguments)},statusText:q.statusText};var x=e.Deferred();x.promise(s);s.success=s.done;s.error=s.fail;function w(z){var A=z.getResponseHeader("X-AUSERNAME");return j===A}function y(C){for(var B=0,A=C.length;B<A;B++){var z=C[B];AJS.debug("Rerunning ajax query to: "+z.url,z);l.call(e,z.url,z.settings).done(function(){AJS.debug("Rerunning done");z.deferred.resolve(arguments)}).fail(function(){AJS.debug("Rerunning failed");z.deferred.reject(arguments)})}}function u(C){for(var B=0,A=C.length;B<A;B++){var z=C[B];AJS.debug("Executing with original response for: "+z.url,z);z.defaultCallback&&z.defaultCallback()}}function v(A){n.push({deferred:x,url:p,settings:r,defaultCallback:A});if(b){return}m=false;if(!g){g=new AJS.Dialog(840,700);g.addPanel("ajax-login","ajax-login-content","ajax-login-panel",1);var z=e(".ajax-login-panel");d=e("<iframe></iframe>");d.bind("load",function(C){var B=d[0].contentDocument.location.pathname;if(B&&B.indexOf("/"+k)>=0){b=false;m=true;g.hide();d.attr("src","about:blank")}});z.append(d);e(document).bind("hideLayer",function(D,C,B){if(C==="popup"&&B===g.popup){AJS.debug("hiding login dialog");if(m){y(n);n=[]}else{u(n);n=[]}}})}d.attr("src",h);g.show();b=true}function t(B,D,z,A){function C(){s.readyState=B.readyState;s.status=B.status;s.statusText=B.statusText;if(B.responseXML){s.responseXML=B.responseXML}else{s.responseText=B.responseText}D.apply(z,A)}if(w(B)){C()}else{v(C)}}q.done(function(z,B,A){t(A,x.resolve,x,arguments)});q.fail(function(A,B,z){t(A,x.reject,x,arguments)});return s}function a(p,q){var r=l.call(e,p,q);if(f(p,q)){return o(p,q,r)}return r}e.ajax=a});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-sortable-tables:ConfluenceSortableTablesEditorPlugin', location = 'js/editor_plugin_src.js' */
(function ($) {
    /**
     * The only thing this plugin does is check on paste to see if a sortable table has been pasted
     * from a view page and if it has, revert it back into something the editor has an easy time manipulating.
     */
    tinymce.create('tinymce.plugins.ConfluenceSortableTablesPlugin', {
        init: function (ed) {
            $(document).bind('postPaste', function (e, pl, o) {
                var tables = $('.tablesorter', o.node);
                tables.each(function(i, current){
                    var thead = $(current).find('thead'),
                        tbody, firstTr;

                    if (thead.length !== 1) {
                        return;
                    }
                    thead = thead[0];

                    if (thead.nodeName === 'THEAD' && thead.childNodes.length === 1) {
                        firstTr = thead.removeChild(thead.childNodes[0]);
                        tbody = $(current).find('tbody')[0];
                        current.removeChild(thead);
                        tbody.insertBefore(firstTr, tbody.childNodes[0]);
                    }
                });
            });
        },
        getInfo: function () {
            return {
                longname: 'ConfluenceSortableTablesPlugin',
                author: 'Atlassian',
                authorurl: 'http://www.atlassian.com',
                infourl: 'http://www.atlassian.com',
                version: '1.0'
            };
        }
    });

    tinymce.PluginManager.add('confluencesortabletablesplugin', tinymce.plugins.ConfluenceSortableTablesPlugin);
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.ext.newcode-macro-plugin:code-macro-editor', location = '/scripts/code-macro-languages.js' */
(function(d){var b=function(){};b.prototype.fields={string:{language:function(h,f){var g=d(Confluence.Templates.MacroBrowser.macroParameterSelect());var e=d("select",g);if(f==null){f={}}f.setValue=function(k){var j=e.find("option[value='"+k+"']");if(j.length==0){var i=d("<option/>");i.val(k);i.text(k);e.append(i)}};a(e);return new AJS.MacroBrowser.Field(g,e,f)}}};AJS.MacroBrowser.Macros.code=new b();function a(e){c(function(g){if(!g.length){AJS.log("Configured code macro languages result was not in the expected format.");return}var f=e.val();e.empty();e.append(d("<option/>").attr("value",""));d.each(g,function(h,j){var i=d("<option />");i.val(j.aliases[0]);i.text(j.friendlyName);e.append(i)});e.val(f)},function(g,h,f){AJS.log("Failed to retrieve syntax highlighters from Confluence "+h+" - "+f)})}function c(f,e){AJS.$.ajax({async:true,url:AJS.params.contextPath+"/plugins/newcode/getlanguages.action",dataType:"json",timeout:10000,error:function(h,i,g){if(e&&typeof(e)=="function"){e(h,i,g)}},success:function(g){if(f&&typeof(f)=="function"){f(g)}}})}})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.gadgets.embedded:gadget-core-resources', location = 'js/rpc.js' */
var gadgets=gadgets||{};gadgets.rpc=function(){var CALLBACK_NAME="__cb";var DEFAULT_NAME="";var FE_G2C_CHANNEL="__g2c_rpc";var FE_C2G_CHANNEL="__c2g_rpc";var services={};var iframePool=[];var relayUrl={};var useLegacyProtocol={};var authToken={};var callId=0;var callbacks={};var setup={};var sameDomain={};var params={};if(gadgets.util){params=gadgets.util.getUrlParameters()}authToken[".."]=params.rpctoken||params.ifpctok||0;function getRelayChannel(){return typeof window.postMessage==="function"?"wpm":typeof document.postMessage==="function"?"dpm":navigator.product==="Gecko"?"fe":"ifpc"}function setupChannel(){if(relayChannel==="dpm"||relayChannel==="wpm"){window.addEventListener("message",function(packet){try{if(typeof packet==="object"&&typeof packet.data==="string"){process(gadgets.json.parse(packet.data))}}catch(e){if(AJS.debug){var origin=packet&&packet.origin?packet.origin:"unknown origin";AJS.log("Error processing gadget rpc message from '"+origin+"': "+e)}}},false)}}var relayChannel=getRelayChannel();setupChannel();services[DEFAULT_NAME]=function(){throw new Error("Unknown RPC service: "+this.s)};services[CALLBACK_NAME]=function(callbackId,result){var callback=callbacks[callbackId];if(callback){delete callbacks[callbackId];callback(result)}};function setupFrame(frameId){if(setup[frameId]){return }if(relayChannel==="fe"){try{var frame=document.getElementById(frameId);frame[FE_G2C_CHANNEL]=function(args){process(gadgets.json.parse(args))}}catch(e){}}setup[frameId]=true}function encodeLegacyData(args){var stringify=gadgets.json.stringify;var argsEscaped=[];for(var i=0,j=args.length;i<j;++i){argsEscaped.push(encodeURIComponent(stringify(args[i])))}return argsEscaped.join("&")}function process(rpc){if(rpc&&typeof rpc.s==="string"&&typeof rpc.f==="string"&&rpc.a instanceof Array){if(authToken[rpc.f]){if(authToken[rpc.f]!=rpc.t){if(AJS.debug){console.log("Invalid auth token received for operation: "+rpc.s)}return }}if(rpc.c){rpc.callback=function(result){gadgets.rpc.call(rpc.f,CALLBACK_NAME,null,rpc.c,result)}}var result=(services[rpc.s]||services[DEFAULT_NAME]).apply(rpc,rpc.a);if(rpc.c&&typeof result!="undefined"){gadgets.rpc.call(rpc.f,CALLBACK_NAME,null,rpc.c,result)}}}function callFrameElement(targetId,serviceName,from,rpcData,callArgs){try{if(from!=".."){var fe=window.frameElement;if(typeof fe[FE_G2C_CHANNEL]==="function"){if(typeof fe[FE_G2C_CHANNEL][FE_C2G_CHANNEL]!=="function"){fe[FE_G2C_CHANNEL][FE_C2G_CHANNEL]=function(args){process(gadgets.json.parse(args))}}fe[FE_G2C_CHANNEL](rpcData);return }}else{var frame=document.getElementById(targetId);if(typeof frame[FE_G2C_CHANNEL]==="function"&&typeof frame[FE_G2C_CHANNEL][FE_C2G_CHANNEL]==="function"){frame[FE_G2C_CHANNEL][FE_C2G_CHANNEL](rpcData);return }}}catch(e){}callIfpc(targetId,serviceName,from,rpcData,callArgs)}function callIfpc(targetId,serviceName,from,rpcData,callArgs){var relay=gadgets.rpc.getRelayUrl(targetId);if(!relay){throw new Error("No relay file assigned for IFPC")}var src=null;if(useLegacyProtocol[targetId]){src=[relay,"#",encodeLegacyData([from,callId,1,0,encodeLegacyData([from,serviceName,"","",from].concat(callArgs))])].join("")}else{src=[relay,"#",targetId,"&",from,"@",callId,"&1&0&",encodeURIComponent(rpcData)].join("")}emitInvisibleIframe(src)}function emitInvisibleIframe(src){var iframe;for(var i=iframePool.length-1;i>=0;--i){var ifr=iframePool[i];try{if(ifr&&(ifr.recyclable||ifr.readyState==="complete")){ifr.parentNode.removeChild(ifr);if(window.ActiveXObject){iframePool[i]=ifr=null;iframePool.splice(i,1)}else{ifr.recyclable=false;iframe=ifr;break}}}catch(e){}}if(!iframe){iframe=document.createElement("iframe");iframe.style.border=iframe.style.width=iframe.style.height="0px";iframe.style.visibility="hidden";iframe.style.position="absolute";iframe.onload=function(){this.recyclable=true};iframePool.push(iframe)}iframe.src=src;setTimeout(function(){document.body.appendChild(iframe)},0)}function callSameDomain(target,rpc){if(typeof sameDomain[target]==="undefined"){sameDomain[target]=false;var targetEl=null;if(target===".."){targetEl=parent}else{targetEl=frames[target]}try{sameDomain[target]=targetEl.gadgets.rpc.receiveSameDomain}catch(e){}}if(typeof sameDomain[target]==="function"){sameDomain[target](rpc);return true}return false}if(gadgets.config){function init(config){if(config.rpc.parentRelayUrl.substring(0,7)==="http://"){relayUrl[".."]=config.rpc.parentRelayUrl}else{var params=document.location.search.substring(0).split("&");var parentParam="";for(var i=0,param;param=params[i];++i){if(param.indexOf("parent=")===0){parentParam=decodeURIComponent(param.substring(7));break}}relayUrl[".."]=parentParam+config.rpc.parentRelayUrl}useLegacyProtocol[".."]=!!config.rpc.useLegacyProtocol}var requiredConfig={parentRelayUrl:gadgets.config.NonEmptyStringValidator};gadgets.config.register("rpc",requiredConfig,init)}return{register:function(serviceName,handler){if(serviceName==CALLBACK_NAME){throw new Error("Cannot overwrite callback service")}if(serviceName==DEFAULT_NAME){throw new Error("Cannot overwrite default service:"+" use registerDefault")}services[serviceName]=handler},unregister:function(serviceName){if(serviceName==CALLBACK_NAME){throw new Error("Cannot delete callback service")}if(serviceName==DEFAULT_NAME){throw new Error("Cannot delete default service:"+" use unregisterDefault")}delete services[serviceName]},registerDefault:function(handler){services[""]=handler},unregisterDefault:function(){delete services[""]},call:function(targetId,serviceName,callback,var_args){++callId;targetId=targetId||"..";if(callback){callbacks[callId]=callback}var from="..";if(targetId===".."){from=window.name}var rpc={s:serviceName,f:from,c:callback?callId:0,a:Array.prototype.slice.call(arguments,3),t:authToken[targetId]};if(callSameDomain(targetId,rpc)){return }var rpcData=gadgets.json.stringify(rpc);var channelType=relayChannel;if(useLegacyProtocol[targetId]){channelType="ifpc"}switch(channelType){case"dpm":var targetDoc=targetId===".."?parent.document:frames[targetId].document;targetDoc.postMessage(rpcData);break;case"wpm":var targetWin=targetId===".."?parent:frames[targetId];targetWin.postMessage(rpcData,relayUrl[targetId]);break;case"fe":callFrameElement(targetId,serviceName,from,rpcData,rpc.a);break;default:callIfpc(targetId,serviceName,from,rpcData,rpc.a);break}},getRelayUrl:function(targetId){return relayUrl[targetId]},setRelayUrl:function(targetId,url,opt_useLegacy){relayUrl[targetId]=url;useLegacyProtocol[targetId]=!!opt_useLegacy},setAuthToken:function(targetId,token){authToken[targetId]=token;setupFrame(targetId)},getRelayChannel:function(){return relayChannel},receive:function(fragment){if(fragment.length>4){process(gadgets.json.parse(decodeURIComponent(fragment[fragment.length-1])))}},receiveSameDomain:function(rpc){rpc.a=Array.prototype.slice.call(rpc.a);window.setTimeout(function(){process(rpc)},0)}}}();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.gadgets.embedded:gadget-core-resources', location = 'js/util.js' */
Function.prototype.inherits=function(parentCtor){function tempCtor(){}tempCtor.prototype=parentCtor.prototype;this.superClass_=parentCtor.prototype;this.prototype=new tempCtor();this.prototype.constructor=this};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.gadgets.embedded:gadget-core-resources', location = 'js/json.js' */
var gadgets=gadgets||{};gadgets.json=function(){function f(n){return n<10?"0"+n:n}Date.prototype.toJSON=function(){return[this.getUTCFullYear(),"-",f(this.getUTCMonth()+1),"-",f(this.getUTCDate()),"T",f(this.getUTCHours()),":",f(this.getUTCMinutes()),":",f(this.getUTCSeconds()),"Z"].join("")};var m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function stringify(value){var a,i,k,l,r=/["\\\x00-\x1f\x7f-\x9f]/g,v;switch(typeof value){case"string":return r.test(value)?'"'+value.replace(r,function(a){var c=m[a];if(c){return c}c=a.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"':'"'+value+'"';case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}a=[];if(typeof value.length==="number"&&!(value.propertyIsEnumerable("length"))){l=value.length;for(i=0;i<l;i+=1){a.push(stringify(value[i])||"null")}return"["+a.join(",")+"]"}for(k in value){if(value.hasOwnProperty(k)){if(typeof k==="string"){v=stringify(value[k]);if(v){a.push(stringify(k)+":"+v)}}}}return"{"+a.join(",")+"}"}}return{stringify:stringify,parse:function(text){if(/^[\],:{}\s]*$/.test(text.replace(/\\["\\\/b-u]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){return eval("("+text+")")}return false}}}();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.gadgets.embedded:gadget-core-resources', location = 'js/gadgets-core.js' */
var gadgets=gadgets||{};gadgets.error={};gadgets.error.SUBCLASS_RESPONSIBILITY="subclass responsibility";gadgets.error.TO_BE_DONE="to be done";gadgets.log=function(message){if(window.console&&console.log){console.log(message)}else{var logEntry=document.createElement("div");logEntry.className="gadgets-log-entry";logEntry.innerHTML=message;document.body.appendChild(logEntry)}};gadgets.Extensible=function(){};gadgets.Extensible.prototype.setDependencies=function(dependencies){for(var p in dependencies){this[p]=dependencies[p]}};gadgets.Extensible.prototype.getDependencies=function(name){return this[name]};gadgets.UserPrefStore=function(){};gadgets.UserPrefStore.prototype.getPrefs=function(gadget){throw Error(gadgets.error.SUBCLASS_RESPONSIBILITY)};gadgets.UserPrefStore.prototype.savePrefs=function(gadget){throw Error(gadgets.error.SUBCLASS_RESPONSIBILITY)};gadgets.DefaultUserPrefStore=function(){gadgets.UserPrefStore.call(this)};gadgets.DefaultUserPrefStore.inherits(gadgets.UserPrefStore);gadgets.DefaultUserPrefStore.prototype.getPrefs=function(gadget){};gadgets.DefaultUserPrefStore.prototype.savePrefs=function(gadget){};gadgets.GadgetService=function(){};gadgets.GadgetService.prototype.setHeight=function(elementId,height){throw Error(gadgets.error.SUBCLASS_RESPONSIBILITY)};gadgets.GadgetService.prototype.setTitle=function(gadget,title){throw Error(gadgets.error.SUBCLASS_RESPONSIBILITY)};gadgets.GadgetService.prototype.setUserPref=function(id){throw Error(gadgets.error.SUBCLASS_RESPONSIBILITY)};gadgets.IfrGadgetService=function(){gadgets.GadgetService.call(this);var service=this;gadgets.rpc.register("resize_iframe",function(){service.setHeight.apply(this,arguments)});gadgets.rpc.register("set_pref",function(){service.setUserPref.apply(this,arguments)});gadgets.rpc.register("set_title",function(){service.setTitle.apply(this,arguments)});gadgets.rpc.register("requestNavigateTo",function(){service.requestNavigateTo.apply(this,arguments)})};gadgets.IfrGadgetService.inherits(gadgets.GadgetService);gadgets.IfrGadgetService.prototype.setHeight=function(height){if(height>gadgets.container.maxheight_){height=gadgets.container.maxheight_}var element=document.getElementById(this.f);if(element){element.style.height=height+"px"}};gadgets.IfrGadgetService.prototype.requestNavigateTo=function(view,opt_params){var id=this.getGadgetIdFromModuleId(this.f);var url=this.getUrlForView(view);if(opt_params){var paramStr=JSON.stringify(opt_params);if(paramStr.length>0){url+="&appParams="+encodeURIComponent(paramStr)}}if(url&&document.location.href.indexOf(url)==-1){document.location.href=url}};gadgets.IfrGadgetService.prototype.getUrlForView=function(view){if(view==="canvas"){return"/canvas"}else{if(view==="profile"){return"/profile"}else{return null}}};gadgets.IfrGadgetService.prototype.getGadgetIdFromModuleId=function(moduleId){return parseInt(moduleId.match(/_([0-9]+)$/)[1],10)};gadgets.LayoutManager=function(){};gadgets.LayoutManager.prototype.getGadgetChrome=function(gadget){throw Error(gadgets.error.SUBCLASS_RESPONSIBILITY)};gadgets.StaticLayoutManager=function(){gadgets.LayoutManager.call(this)};gadgets.StaticLayoutManager.inherits(gadgets.LayoutManager);gadgets.StaticLayoutManager.prototype.setGadgetChromeIds=function(gadgetChromeIds){this.gadgetChromeIds_=gadgetChromeIds};gadgets.StaticLayoutManager.prototype.getGadgetChrome=function(gadget){var chromeId=this.gadgetChromeIds_[gadget.id];return chromeId?document.getElementById(chromeId):null};gadgets.FloatLeftLayoutManager=function(layoutRootId){gadgets.LayoutManager.call(this);this.layoutRootId_=layoutRootId};gadgets.FloatLeftLayoutManager.inherits(gadgets.LayoutManager);gadgets.FloatLeftLayoutManager.prototype.getGadgetChrome=function(gadget){var layoutRoot=document.getElementById(this.layoutRootId_);if(layoutRoot){var chrome=document.createElement("div");chrome.className="gadgets-gadget-chrome";chrome.style.cssFloat="left";layoutRoot.appendChild(chrome);return chrome}else{return null}};
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.gadgets:macro-browser-for-gadgetsplugin', location = 'script/gadget-macro-browser.js' */
AJS.toInit(function ($) {
    var overrides = {};

    overrides.postPreview = function (iframe, macro) {
        var hasAJS = iframe.contentWindow.AJS;
        var userPreferencesMap = {};
        var keyValuePairs = $("#macro-param-div-preferences input").val().split("&");
        for (var i = 0, lk = keyValuePairs.length; i < lk; i++) {
            var keyValue = keyValuePairs[i].split("=");
            try {
                userPreferencesMap[decodeURI(keyValue[0])] = decodeURI(keyValue[1]);
            } catch(e) {
                //Do nothing, just skip it. It's not essential that we capture all preferences, and not all are valid
                //to be decoded as a URI
            }
        }
        if (macro.needsConfig && hasAJS) {
            var bodyConfigured = !!userPreferencesMap["isConfigured"];

            if (!bodyConfigured) {
                var okButton = $("#macro-browser-dialog .dialog-button-panel .ok");
                $("#save-warning-span").addClass("gadget-not-configured-warning").text("\u8BF7\u9996\u5148\u4E8E\u9884\u89C8\u533A\u57DF\u5B8C\u6210\u914D\u7F6E").removeClass("hidden");
                okButton.prop("disabled", true);
            }
        }
    };

    overrides.beforeParamsSet = function(selectedParams, inserting) {
        var userPreferences = selectedParams["preferences"];
        if (!inserting && userPreferences) {
            var keyValuePairs = userPreferences.split("&");
            for (var i = 0, lk = keyValuePairs.length; i < lk; i++) {
                var keyValue = keyValuePairs[i].split("=");
                selectedParams[decodeURI(keyValue[0])] = decodeURI(keyValue[1]);
            }
        }

        return selectedParams;
    };

    overrides.updateMacroParametersForPreview = function(params) {
        params["forceWrite"] = true;
        return params;
    };

    overrides.manipulateMarkup = function (macro) {
        if(AJS.MacroBrowser.gadgetPrefsChanged){
            var container = top.document.getElementById("macro-insert-container");
            var preferencesInput = $("#macro-param-div-preferences input", container);
            var baseVal = "";
            for (var key in AJS.MacroBrowser.gadgetPrefs)
            {
                if (baseVal.length != 0)
                {
                    baseVal += "&";
                }
                baseVal = baseVal + encodeURI(key) + "=" + encodeURI(AJS.MacroBrowser.gadgetPrefs[key]);
            }
            preferencesInput.val(baseVal);
        }
    };

    //Adds special behaviour for "gadget" macros : only considered the same if they share the same url as the selected macro
    overrides.getMacroDetailsFromSelectedMacro = function(metadataList, selectedMacroToUse) {
        var selectedUrl = selectedMacroToUse.params["url"];
        for (var i = 0, lm = metadataList.length; i < lm; i++) {
            var tempMacro = metadataList[i];
            if (tempMacro.macroName === selectedMacroToUse.name &&
                tempMacro.gadgetUrl === selectedUrl) {
                return tempMacro;
            }
        }
    };

    //Add special handling to intepret and merge existing body params for opensocial preference gadgets
    overrides.beforeParamsRetrieved = function(paramMap, macro, sharedParamMap) {
        var result="";

        if (macro.nonHiddenUserPrefs) {
            var first = true;
            //reparse the possible existing key value pairs
            var userPreferenceMap = {},
                previousPreferences = paramMap["preferences"];

            if (previousPreferences) {
                var keyValuePairs = previousPreferences.split("&");
                for (var i = 0, lk = keyValuePairs.length; i < lk; i++) {
                    var keyValue = keyValuePairs[i].split("=");
                    var userPrefKey = decodeURI(keyValue[0]);
                    var userPrefValue = decodeURI(keyValue[1]);
                    userPreferenceMap[userPrefKey] = userPrefValue;
                }
            }

            //New values take precedence over existing values
            for (var param1 in sharedParamMap) {
                userPreferenceMap[param1] = sharedParamMap[param1];
            }

            var isDefaultValue = function (macro, name, value)
            {
                var params = macro.formDetails.parameters;
                for (var i = 0; i < params.length; i++)
                {
                    if (params[i].name == name)
                    {
                        return value == params[i].defaultValue;
                    }
                }
                //Not necessarily bad ... could be a param we don't have metadata for
                AJS.log("Unable to find matching param for " + name);
                return false;
            };

            for (var param in userPreferenceMap) {
                if (!isDefaultValue(macro, param, userPreferenceMap[param]))
                {
                    if (!first)
                    {
                        result += "&";
                    }
                    first = false;
                    result = result + encodeURI(param) + "=" + encodeURI(userPreferenceMap[param]);
                }
            }

            paramMap["preferences"] = result;
        }

        return paramMap;
    };

    AJS.MacroBrowser.setMacroJsOverride("gadget", overrides);
});

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-inline-tasks:inline-tasks-macro-browser', location = 'js/inline-tasks-macro-browser.js' */
(function(b){var a={"space-and-page":function(i,e){e=e||{};var c=i.multiple?true:false;var f=i.multiple?"autocomplete-multi-space-and-page":"autocomplete-space-and-page";var h=b(Confluence.Templates.MacroBrowser.macroParameter());var d=AJS.$("input[type='text']",h);d.addClass(f).attr("data-none-message","\u672A\u53D1\u73B0");if(i.required){d.keyup(AJS.MacroBrowser.processRequiredParameters)}var g=_.extend({},{manualInit:true,multiple:c,orgElement:d},e);d.auiSelect2(Confluence.UI.Components.SpacePagePicker.build(g));e.setValue=function(j){Confluence.UI.Components.SpacePagePicker.setValue(j,d)};return AJS.MacroBrowser.Field(h,d,e)}};AJS.MacroBrowser.setMacroJsOverride("tasks-report-macro",{fields:{string:{spaceAndPage:function(d){var c={inputSpaceId:"macro-param-spaces",inputSpaceName:"macro-param-spaces",inputPageId:"macro-param-pages",inputPageName:"macro-param-pages"};return a["space-and-page"](d,c)}}}})})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'com.atlassian.confluence.extra.officeconnector:macro-browser-smart-fields', location = 'javascript/office-connector-macro-fields.js' */
(function(B){var A=function(C){this.fileTypes=C
};
A.prototype.beforeParamsSet=function(E,C){if(!E.page&&!(E.date||E.space)){if(AJS.params.contentType=="page"||AJS.params.contentType=="blogpost"){E.page=B("#content-title").val()
}else{if(AJS.params.contentType=="comment"){E.page=AJS.params.pageTitle
}}}if(E.date){var D=E.date.split("/");
E.page=["",D[2],D[0],D[1],E.page].join("/")
}if(E.space){E.page=E.space+":"+E.page
}return E
};
A.prototype.beforeParamsRetrieved=function(E){if(E.page){var D=E.page.split(":");
if(D.length>1){E.space=D[0];
E.page=D[1]
}var C=E.page.split("/");
if(C.length>1){E.date=[C[2],C[3],C[1]].join("/");
E.page=C[4]
}if(((AJS.params.contentType=="page"||AJS.params.contentType=="blogpost")&&E.page==B("#content-title").val())||(AJS.params.contentType=="comment"&&E.page==AJS.params.pageTitle)){delete E.page
}}return E
};
A.prototype.fields={attachment:function(F){var C=function(G){var I={};
var H=G.split(":",2);
I.spaceKey=((H.length==2)&&H[0])||AJS.params.spaceKey;
I.title=H[H.length-1];
if(I.title.indexOf("/")==0){I.postingDay=I.title.substr(1,10);
I.title=I.title.substr(12)
}if(I.title==B("#content-title").val()){I.title=""
}if(!I.title){if(AJS.params.newPage){I.draftId=AJS.params.contentId
}else{I.pageId=AJS.params.pageId
}}return I
};
var D={fileTypes:this.fileTypes};
var E=AJS.MacroBrowser.ParameterFields.attachment(F,D);
E.dependencyUpdated=function(I,H){AJS.log("attachment:dependencyUpdated called: "+I+", "+H);
var G=C(H);
this.getData(G)
};
return E
},spacekey:function(C){return AJS.MacroBrowser.ParameterFields._hidden(C,{})
},date:function(C){return AJS.MacroBrowser.ParameterFields._hidden(C,{})
},"confluence-content":function(D){var C={dependencies:["name"]};
return AJS.MacroBrowser.ParameterFields["confluence-content"](D,C)
}};
AJS.MacroBrowser.Macros.viewdoc=new A(["doc","docx"]);
AJS.MacroBrowser.Macros.viewpdf=new A(["pdf"]);
AJS.MacroBrowser.Macros.viewxls=new A(["xls","xlsx"]);
AJS.MacroBrowser.Macros.viewppt=new A(["ppt","pptx"]);
AJS.MacroBrowser.Macros.viewfile={updateSelectedMacro:function(D){var F=D.params[""]||D.params.name;
if(F){var E=F.lastIndexOf(".");
if(E>0){var C=F.substring(E+1);
if(C){(C=="doc")&&(C=="docx")&&(D.name="viewdoc");
(C=="pdf")&&(D.name="viewpdf");
(C=="ppt")&&(C=="pptx")&&(D.name="viewppt");
(C=="xls")&&(C=="xlsx")&&(D.name="viewxls")
}}}}}
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


try {
/* module-key = 'confluence.macros.core:macro-browser-smart-fields', location = 'javascript/confluence-core-macro-fields.js' */
(function($) {
   AJS.MacroBrowser.activateSmartFieldsAttachmentsOnPage("multimedia", ["swf", "avi", "mov", "mp4", "mpeg", "mpg", "wmv", "wma", "mp3","ram","rm"]);
})(AJS.$);
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}


